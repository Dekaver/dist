import{a as E}from"./options-b2eb7ae6.js";import{a as S}from"./api-917068af.js";import"./custom-zod-e9521e5d.js";/* empty css                             */import{A as M}from"./index-b9e295bc.js";import{_ as Q,r as h,A as G,o as c,c as D,d as l,b as o,l as p,t as f,e as u,n as w,m as x,q as X,k as V,f as Z,B as L}from"./index-11eb6111.js";import{z as r}from"./index-0ec66d4d.js";const I=r.object({id:r.number().optional(),nomor:r.string().optional(),no_so:r.string().optional(),tanggal:r.coerce.string().optional(),referensi:r.string().optional(),id_customer:r.number().optional(),id_salesman:r.number().optional(),id_gudang:r.number().optional(),id_so:r.number().optional(),status:r.string().optional(),gudang:r.string().optional(),customer:r.string().optional(),kepada:r.string().optional(),alamat:r.string().optional(),telepon:r.string().optional(),hp:r.string().optional(),email:r.string().optional(),keterangan:r.string().nullish(),received_date:r.coerce.string().optional(),arrived_date:r.coerce.string().optional(),return_date:r.coerce.string().optional(),received_name:r.string().optional()}),T=r.object({id_barang:r.number().nullish(),nama_barang:r.string().nonempty(),qty:r.coerce.number().gte(0),qty_diterima:r.coerce.number().gte(0),id_satuan:r.number(),keterangan:r.string().nullish()}),H=I.extend({status:r.literal("D"),detail:r.array(T)}),J=I.extend({status:r.literal("C"),detail:r.array(T)}),K=r.discriminatedUnion("status",[H,J]),W={data(){return{FormError:{},item:{id:null,nomor:null,no_so:null,tanggal:null,referensi:null,id_customer:null,id_salesman:null,id_gudang:null,id_so:null,gudang:null,customer:null,kepada:null,alamat:null,telepon:null,hp:null,email:null,driver:null,driver_hp:null,sipb:null,lic_plate:null,tgl_transporter:null,transporter:null,transporter_time:null,keterangan:null,received_date:null,arrived_date:null,return_date:null,received_name:null,status:"D",detail:[]},selectedDo:null,filteredlDo:[],columns:[{field:"nama_barang",header:"Nama Barang",width:"15%",class:"left"},{field:"qty",header:"Qty Send",width:"15%",class:"left"},{field:"qty_diterima",header:"Qty Receive",width:"15%",class:"left"},{field:"selectedSatuan",header:"Satuan",width:"15%",class:"left"},{field:"keterangan",header:"Remark",width:"15%",class:"left"}],datedo:null,dateArrived:null,dateReceived:null,dateReturn:null,filters:{},lProduk:[],lSatuan:[]}},computed:{isEdit:function(){return!!this.$route.params.id},invalid:function(){return!(this.item.received_date!=null&&this.item.return_date!=null&&this.item.arrived_date!=null&&(this.item.received_name!=null||this.item.received_name!=""))}},mounted(){this.$isLoading.value=!1,this.datedo=new Date,this.item.tanggal=new Date,this.datetransporter=new Date,this.item.received_date=new Date,this.item.status="D",this.getData().then(()=>{this.isEdit&&this.getDeliveryReceipt()})},methods:{onCellEditComplete(a){let{data:t,newValue:s,field:v}=a;switch(v){case"qty_diterima":t[v]=s;break;case"keterangan":t[v]=s;break}},async getData(){await E.getDeliveryOrder({status:"C"}).then(a=>{this.lSo=a.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Delivery Order",life:3e3})}),await E.getProduk().then(a=>{this.lProduk=a.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await E.getSatuan().then(a=>{this.lSatuan=a.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})})},getDeliveryReceipt(){this.isEdit&&S.show(this.$route.params.id).then(a=>{this.item=a.data.data,this.item.received_date=this.item.received_date==null?new Date:new Date(this.item.received_date),this.item.arrived_date=this.item.arrived_date==null?new Date:new Date(this.item.arrived_date),this.item.return_date=this.item.return_date==null?new Date:new Date(this.item.return_date),this.dateArrived=this.item.arrived_date,this.dateReceived=this.item.received_date,this.dateReturn=this.item.return_date,this.selectedDo=this.item.nomor,this.item.detail.forEach(t=>{if(t.id_barang){let s=this.lProduk.find(v=>v.id==t.id_barang);t.option_satuan=s.option_satuan,t.selectedSatuan=t.option_satuan.find(v=>v.id==t.id_satuan)}else t.option_satuan=[],t.selectedSatuan=this.lSatuan.find(s=>s.id==t.id_satuan)})}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Delivery Receipt",life:3e3})})},selectReturnDate(a){this.item.return_date=new Date(a)},selectReceivedDate(a){this.item.received_date=new Date(a)},selectArrivedDate(a){this.item.arrived_date=new Date(a)},selectDo(a){S.show(a.value.id).then(t=>{this.item=t.data.data,this.item.status="D",this.item.detail.forEach(s=>{if(s.qty_diterima=s.qty,s.id_barang){let v=this.lProduk.find(e=>e.id==s.id_barang);s.option_satuan=v.option_satuan,s.selectedSatuan=s.option_satuan.find(e=>e.id==s.id_satuan)}else s.option_satuan=[],s.selectedSatuan=this.lSatuan.find(v=>v.id==s.id_satuan)}),this.item.received_date=this.item.received_date==null?new Date:new Date(this.item.received_date),this.item.arrived_date=this.item.arrived_date==null?new Date:new Date(this.item.arrived_date),this.item.return_date=this.item.return_date==null?new Date:new Date(this.item.return_date),this.dateArrived=this.item.arrived_date,this.dateReceived=this.item.received_date,this.dateReturn=this.item.return_date,this.datedo=this.item.tanggal==null?new Date:new Date(this.item.tanggal),this.item.detail=this.item.detail.filter(s=>s.qty!=0)})},searchDo(a){setTimeout(()=>{a.query.trim().length?this.filteredlDo=this.lSo.filter(t=>t.nomor.toLowerCase().includes(a.query.trim().toLowerCase())):this.filteredlDo=[...this.lSo]},250)},async Save(a="D"){let t=this.item.status;try{if(this.item.status=a,K.parse(this.item),this.isSubmitted=!0,this.isEdit){this.item.status!="X"&&(this.item.alasan="");let s=!0;a=="S"&&await S.updateReceipt(this.item.id,this.item).catch(()=>{s=!1,this.item.status="D",this.$toast.add({severity:"error",summary:"Failed",detail:"Update Sales Receipt",life:3e3})}).finally(()=>{s&&this.$toast.add({severity:"success",summary:"Successful",detail:"Updated Sales Receipt",life:3e3})}),await S.update(this.item.id,this.item).catch(()=>{s=!1,this.item.status="D",this.$toast.add({severity:"error",summary:"Failed",detail:"Update Sales Receipt",life:3e3})}).finally(()=>{s&&this.$toast.add({severity:"success",summary:"Successful",detail:"Updated Sales Receipt",life:3e3})})}else{let s=!0;await S.update(this.item.id,this.item).catch(()=>{s=!1,this.$toast.add({severity:"error",summary:"Failed",detail:"Create Sales Receipt",life:3e3})}).finally(()=>{s&&(this.$toast.add({severity:"success",summary:"Successful",detail:"Created Sales Receipt",life:3e3}),setTimeout(()=>{this.$router.replace({name:"do-receipt.edit",params:{id:this.item.id}})},1e3))})}}catch(s){s instanceof r.ZodError?this.FormError=s.format():s instanceof M&&this.$toast.add({severity:"error",summary:"Failed",detail:s.response.data.message,life:3e3}),this.item.status=t,console.log(s)}finally{this.$timeoutLoading()}},submitReceipt(){this.Save("C").catch(()=>{this.item.status="D"})},buttons(){return[{label:"Posting",icon:"pi pi-refresh",command:()=>{this.submitPosting()}}]}}},Y={class:"grid"},$={class:"col-12"},ee={class:"card"},te={class:"p-fluid formgrid grid"},le={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},ie={class:"product-autocomplete"},oe={class:"kode"},ae={class:"row"},re={class:"col-12"},se={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},ne={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},de={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},ue={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},me={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},ce={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},pe={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},_e={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},he={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},ge={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},ve={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},fe={class:"col-12 my-4"},ye=o("div",{class:"text-center"},"Empty",-1),De={class:"flex align-items-center gap-2"},Ve={class:"capitalize"},be={key:0},we={key:1},Se={key:0,class:"flex flex-column"},ke={class:"text-green-500"},xe={key:2},Ce={class:"flex flex-column"},Re={class:""},Ee={key:4},Fe={class:"col-12 md:col-4"},Ue={class:"col-12 md:col-4"},qe=o("br",null,null,-1),Be={class:"grid"},Ae={class:"col-6"},Le={class:"flex flex-wrap gap-3 justify-content-start"},Ie={class:"col-6"},Te={class:"flex flex-wrap gap-3 justify-content-end"};function Ne(a,t,s,v,e,b){const N=h("Toast"),P=h("Tag"),_=h("Label"),F=h("AutoComplete"),g=h("ErrorMsg"),k=h("Calendar"),y=h("InputText"),U=h("InputNumber"),C=h("Column"),R=h("Button"),q=h("Dropdown"),O=h("DataTable"),B=h("Textarea"),z=h("SubmitButton"),A=G("select-all-text");return c(),D(x,null,[l(N),o("div",Y,[o("div",$,[o("div",ee,[o("h5",null,[p(f(b.isEdit?"Edit":"Add")+" Delivery Receipt ",1),l(P,{style:{float:"right"},value:a.$h.getLabel(e.item.status),severity:a.$h.getLabel(e.item.status)},null,8,["value","severity"])]),o("div",te,[o("div",le,[l(_,{required:"",for:"itemnumber"},{default:u(()=>[p("Nomor DO")]),_:1}),l(F,{modelValue:e.selectedDo,"onUpdate:modelValue":t[0]||(t[0]=i=>e.selectedDo=i),suggestions:e.filteredlDo,optionLabel:"nomor",virtualScrollerOptions:{itemSize:50},onComplete:b.searchDo,onItemSelect:b.selectDo,dropdown:""},{option:u(i=>[o("div",ie,[o("div",oe,f(i.option.id),1),o("div",ae,[o("div",re,f(i.option.nomor),1)])])]),_:1},8,["modelValue","suggestions","onComplete","onItemSelect"]),l(g,{error:e.FormError.id_do},null,8,["error"])]),o("div",se,[l(_,{required:"",class:"mb-1"},{default:u(()=>[p("DO Date")]),_:1}),l(k,{dateFormat:"dd-mm-yy",modelValue:e.datedo,"onUpdate:modelValue":t[1]||(t[1]=i=>e.datedo=i),inputId:"datedo",onDateSelect:a.selectDateDo,maxDate:a.$h.today,showButtonBar:""},null,8,["modelValue","onDateSelect","maxDate"]),l(g,{error:e.FormError.tanggal},null,8,["error"])]),o("div",ne,[l(_,{required:"",for:"nopo"},{default:u(()=>[p("PO No")]),_:1}),l(y,{modelValue:e.item.referensi,"onUpdate:modelValue":t[2]||(t[2]=i=>e.item.referensi=i),id:"nopo",type:"text",readonly:""},null,8,["modelValue"]),l(g,{error:e.FormError.referensi},null,8,["error"])]),o("div",de,[l(_,{required:"",for:"gudang"},{default:u(()=>[p("Gudang")]),_:1}),l(y,{modelValue:e.item.gudang,"onUpdate:modelValue":t[3]||(t[3]=i=>e.item.gudang=i),id:"gudang",type:"text",readonly:""},null,8,["modelValue"]),l(g,{error:e.FormError.gudang},null,8,["error"])]),o("div",ue,[l(_,{required:"",for:"customer"},{default:u(()=>[p("Customer")]),_:1}),l(y,{modelValue:e.item.customer,"onUpdate:modelValue":t[4]||(t[4]=i=>e.item.customer=i),id:"customer",type:"text",readonly:""},null,8,["modelValue"]),l(g,{error:e.FormError.customer},null,8,["error"])]),o("div",me,[l(_,{required:"",for:"contactpeson"},{default:u(()=>[p("Contact Person")]),_:1}),l(y,{modelValue:e.item.kepada,"onUpdate:modelValue":t[5]||(t[5]=i=>e.item.kepada=i),id:"contactpeson",type:"text"},null,8,["modelValue"]),l(g,{error:e.FormError.kepada},null,8,["error"])]),o("div",ce,[l(_,{required:"",for:"phone"},{default:u(()=>[p("Phone No")]),_:1}),l(y,{modelValue:e.item.hp,"onUpdate:modelValue":t[6]||(t[6]=i=>e.item.hp=i),id:"phone",inputId:"withoutgrouping"},null,8,["modelValue"]),l(g,{error:e.FormError.hp},null,8,["error"])]),o("div",pe,[l(_,{required:"",for:"dateArrived"},{default:u(()=>[p("Date Arrived")]),_:1}),l(k,{dateFormat:"dd-mm-yy",modelValue:e.dateArrived,"onUpdate:modelValue":t[7]||(t[7]=i=>e.dateArrived=i),inputId:"dateArrived",onDateSelect:b.selectArrivedDate,showButtonBar:"",class:w({"p-invalid":a.isSubmitted&&!e.item.arrived_date})},null,8,["modelValue","onDateSelect","class"]),l(g,{error:e.FormError.arrived_date},null,8,["error"])]),o("div",_e,[l(_,{required:"",for:"shipping_costs"},{default:u(()=>[p("Shipping Costs")]),_:1}),l(U,{modelValue:e.item.shipping_costs,"onUpdate:modelValue":t[8]||(t[8]=i=>e.item.shipping_costs=i),id:"shipping_costs",inputId:"shipping_costs",mode:"currency",locale:"id-ID",currency:"IDR"},null,8,["modelValue"]),l(g,{error:e.FormError.shipping_costs},null,8,["error"])]),o("div",he,[l(_,{required:"",for:"date_arrived"},{default:u(()=>[p("Received Name")]),_:1}),l(y,{modelValue:e.item.received_name,"onUpdate:modelValue":t[9]||(t[9]=i=>e.item.received_name=i),id:"receive_name",inputId:"date_arrived",class:w({"p-invalid":a.isSubmitted&&!e.item.received_name})},null,8,["modelValue","class"]),l(g,{error:e.FormError.received_name},null,8,["error"])]),o("div",ge,[l(_,{required:"",for:"dateReceived"},{default:u(()=>[p("Received Date")]),_:1}),l(k,{dateFormat:"dd-mm-yy",modelValue:e.dateReceived,"onUpdate:modelValue":t[10]||(t[10]=i=>e.dateReceived=i),inputId:"dateReceived",onDateSelect:b.selectReceivedDate,showButtonBar:"",class:w({"p-invalid":a.isSubmitted&&!e.item.received_date})},null,8,["modelValue","onDateSelect","class"]),l(g,{error:e.FormError.received_date},null,8,["error"])]),o("div",ve,[l(_,{required:"",for:"dateReturn"},{default:u(()=>[p("Return date")]),_:1}),l(k,{dateFormat:"dd-mm-yy",modelValue:e.dateReturn,"onUpdate:modelValue":t[11]||(t[11]=i=>e.dateReturn=i),inputId:"dateReturn",onDateSelect:b.selectReturnDate,showButtonBar:"",class:w({"p-invalid":a.isSubmitted&&!e.item.return_date})},null,8,["modelValue","onDateSelect","class"]),l(g,{error:e.FormError.return_date},null,8,["error"])]),o("div",fe,[l(O,{value:e.item.detail,editMode:"cell",onCellEditComplete:b.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{empty:u(()=>[ye]),default:u(()=>[l(C,{header:"#",headerStyle:"width:10px;"},{body:u(({index:i})=>[p(f(i+1),1)]),_:1}),l(C,{header:"Type",headerStyle:"width:5%;"},{body:u(({data:i,index:n})=>[o("div",De,[l(R,{onClick:d=>a.switchType(n),icon:i.type=="produk"?"pi pi-box":"pi pi-briefcase",severity:i.type=="produk"?"primary":"secondary"},null,8,["onClick","icon","severity"]),o("span",Ve,f(i.type),1)])]),_:1}),(c(!0),D(x,null,X(e.columns,i=>(c(),V(C,{key:i.field,field:i.field,header:i.header,headerStyle:i.width,class:w(i.class)},{body:u(({data:n,field:d,index:m})=>[d=="selectedSatuan"?(c(),D("div",be,f(n[d]&&n[d].satuan),1)):d=="nama_barang"?(c(),D("div",we,[n.type=="produk"?(c(),D("span",Se,[o("small",ke,f(n.kode_barang),1),o("span",null,f(n.nama_barang),1)])):(c(),V(y,{key:1,modelValue:n[d],"onUpdate:modelValue":j=>n[d]=j,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))])):(c(),D("div",xe,f(n[d]),1)),e.FormError.detail&&e.FormError.detail[m]?(c(),V(g,{key:3,error:e.FormError.detail[m][i.error?i.error:d]},null,8,["error"])):Z("",!0)]),editor:u(({data:n,field:d})=>[d=="nama_barang"?(c(),D(x,{key:0},[n.type=="produk"?(c(),V(F,{key:0,modelValue:n[d],"onUpdate:modelValue":m=>n[d]=m,suggestions:a.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:a.searchProduk,class:"min-w-max",dropdown:"",onDropdownClick:a.searchAllProduk},{option:u(m=>[o("div",Ce,[o("small",{class:w(m.option.is_stok?"text-green-500":"text-blue-500")},f(m.option.kode_barang),3),o("div",Re,f(m.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(c(),V(y,{key:1,modelValue:n[d],"onUpdate:modelValue":m=>n[d]=m,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))],64)):d=="selectedSatuan"?(c(),D(x,{key:1},[n.type=="produk"?(c(),V(q,{key:0,modelValue:n[d],"onUpdate:modelValue":m=>n[d]=m,id:"satuan",options:n.option_satuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"])):(c(),V(q,{key:1,modelValue:n[d],"onUpdate:modelValue":m=>n[d]=m,id:"satuan",options:e.lSatuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"]))],64)):d=="qty_diterima"?L((c(),V(U,{key:2,modelValue:n[d],"onUpdate:modelValue":m=>n[d]=m,id:"qty_diterima",minFractionDigits:1,maxFractionDigits:5},null,8,["modelValue","onUpdate:modelValue"])),[[A]]):d=="keterangan"?L((c(),V(y,{key:3,modelValue:n[d],"onUpdate:modelValue":m=>n[d]=m,id:"keterangan",type:"text"},null,8,["modelValue","onUpdate:modelValue"])),[[A]]):(c(),D("div",Ee,f(n[d]),1))]),_:2},1032,["field","header","headerStyle","class"]))),128))]),_:1},8,["value","onCellEditComplete"])]),o("div",Fe,[l(_,{required:"",for:"address"},{default:u(()=>[p("Delivery Address")]),_:1}),l(B,{modelValue:e.item.alamat,"onUpdate:modelValue":t[12]||(t[12]=i=>e.item.alamat=i),id:"address",required:"true",rows:"3"},null,8,["modelValue"])]),o("div",Ue,[l(_,{required:"",for:"notes"},{default:u(()=>[p("Notes")]),_:1}),l(B,{modelValue:e.item.keterangan,"onUpdate:modelValue":t[13]||(t[13]=i=>e.item.keterangan=i),id:"notes",required:"true",rows:"3"},null,8,["modelValue"])])]),qe,o("div",Be,[o("div",Ae,[o("div",Le,[l(R,{label:"Back",severity:"secondary",iconPos:"left",icon:"pi pi-arrow-left",onClick:t[14]||(t[14]=i=>this.$router.back())}),l(R,{label:"print",severity:"help",iconPos:"left",icon:"pi pi-print"})])]),o("div",Ie,[o("div",Te,[l(z,{loading:a.$isLoading.value,data:e.item,onClick:t[15]||(t[15]=i=>b.Save("D"))},null,8,["loading","data"])])])])])])])],64)}const Xe=Q(W,[["render",Ne]]);export{Xe as default};
