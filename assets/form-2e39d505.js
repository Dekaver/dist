import{a as x}from"./options-b2eb7ae6.js";import{a as P}from"./produk-90d88791.js";import{a as T}from"./internalorder-81a59869.js";/* empty css                             */import{_ as q,r as c,A as F,o as m,c as k,b as a,d as r,l as S,t as v,n as C,f as _,B,e as p,m as N,q as z,k as f}from"./index-11eb6111.js";const R={data(){return{item:{id:null,nomor:null,tanggal:null,id_gudang_asal:null,id_gudang_tujuan:null,status:null,keterangan:null,detail:[{nama_barang:null,kode_barang:null,id_barang:null,id_satuan:null,qty:0,keterangan:"",satuan:"-",optionSatuan:[]}]},lGudang:[],selectedGudangAsal:null,selectedGudangTujuan:null,lProduk:[],selectedProduk:null,filteredlProduk:[],lSatuan:[],columns:[{field:"nama_barang",header:"Product",width:"15%",class:"left"},{field:"kode_barang",header:"Code Product",width:"15%",class:"left"},{field:"qty",header:"Qty",width:"15%",class:"left"},{field:"satuan",header:"Unit",width:"15%",class:"left"},{field:"keterangan",header:"Notes",width:"15%",class:"right"}],tanggal:null,isSubmitted:!1,isLoading:!1,cancelDialog:!1,isEdit:!1,items:[{label:"Save as Draft",icon:"pi pi-refresh",command:()=>{this.submitForm()}}]}},computed:{invalid:function(){return!(this.item.tanggal!=null&&this.item.id_gudang_asal!=null&&this.item.id_gudang_tujuan!=null)}},mounted(){this.item.id=this.$route.params.id?this.$route.params.id:null,this.isEdit=!!this.$route.params.id,this.tanggal=this.$serverTime,this.item.tanggal=this.$h.Date(this.$serverTime),this.item.status="D",this.getData().finally(()=>{this.isEdit&&this.getInternalOrder()}),this.item.created_name=this.$auth.name},methods:{onCellEditComplete(i){let{data:t,newValue:l,field:s}=i;switch(s){case"nama_barang":if(typeof l=="string"||l==null)return;if(l.id){let e={};e=this.lSatuan.find(o=>o.id==l.id_satuan),t.satuan=e,P.getSatuanBarang(l.id).then(o=>{l.optionSatuan=[],e.konversi=1,l.optionSatuan.push(e),o.data.data.forEach(h=>{e=this.lSatuan.find(y=>y.id==h.id_satuan_kanan),e.konversi=h.konversi,l.optionSatuan.push(e)}),t.optionSatuan=l.optionSatuan,t.id_barang=l.id,t.id_satuan=l.id_satuan})}t[s]=l.nama_barang,t.optionSatuan=l.optionSatuan,t.kode_barang=l.kode_barang;break;case"qty":typeof l=="number"?t[s]=l:t[s]=0;break;case"satuan":t.id_satuan=l.id,t[s]=l;break;default:t[s]=l;break}},async getInternalOrder(){await T.show(this.item.id).then(i=>{this.item=i.data.data,this.tanggal=new Date(this.item.tanggal),this.item.tanggal=this.tanggal,this.item.detail.forEach(t=>{if(t.id_barang){let l=this.lProduk.find(e=>e.id==t.id_barang),s={};s=this.lSatuan.find(e=>e.id==l.id_satuan),P.getSatuanBarang(t.id_barang).then(e=>{let o=[];s.konversi=1,o.push(s),e.data.data.forEach(h=>{s=this.lSatuan.find(y=>y.id==h.id_satuan_kanan),s.konversi=h.konversi,o.push(s)}),t.optionSatuan=o,t.satuan=o.find(h=>h.id==t.id_satuan)})}}),this.item.id_gudang_asal&&(this.selectedGudangAsal=this.lGudang.find(t=>t.id==this.item.id_gudang_asal)),this.item.id_gudang_tujuan&&(this.selectedGudangTujuan=this.lGudang.find(t=>t.id==this.item.id_gudang_tujuan))})},async getData(){await x.getGudang().then(i=>{this.lGudang=i.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Gudang",life:3e3})}),await x.getProduk().then(i=>{this.lProduk=i.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await x.getSatuan().then(i=>{this.lSatuan=i.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})})},selectGudangAsal(i){this.item.id_gudang_asal=i.value.id},selectGudangTujuan(i){this.item.id_gudang_tujuan=i.value.id},selectDate(i){this.item.tanggal=this.$h.Date(i)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(i=>!this.item.detail.map(t=>t.id_barang).includes(i.id))},250)},searchProduk(i){setTimeout(()=>{i.query.trim().length?this.filteredlProduk=this.lProduk.filter(t=>(console.log(t.id),t.nama_barang.toLowerCase().includes(i.query.trim().toLowerCase())&&!this.item.detail.map(l=>l.id_barang).includes(t.id))):this.filteredlProduk=[...this.lProduk]},250)},tambahBarisDetail(){this.item.detail.push({nama_barang:null,kode_barang:null,id_barang:null,id_satuan:null,qty:0,keterangan:"",satuan:"-",optionSatuan:[]})},hapusBarisDetail(i){this.item.detail.length!=1&&(this.item.detail=this.item.detail.filter(t=>t!==i))},async submitForm(i="D"){if(this.isSubmitted=!0,this.invalid)return;let t=!1;const l=new Set;let s=[];if(this.item.id_gudang_asal==this.item.id_gudang_tujuan&&(t=!0,s.push("Gudang Asal dan tujuan Tidak boleh sama")),this.item.detail.forEach(e=>{l.has(parseInt(e.id_barang))&&(t=!0,s.push("Tidak boleh ada barang yang sama")),l.add(parseInt(e.id_barang)),e.id_barang==null&&(t=!0,s.push("Barang Tidak boleh kosong")),i=="O"&&e.qty==0&&(t=!0,s.push("Quantity cannot be ZERO (0)"))}),t){Array.from(new Set(s)).forEach(e=>{this.$toast.add({severity:"warn",summary:"Warning!",detail:e,life:3e3})});return}this.item.status=i,this.isLoading=!0,this.isEdit?(this.item.status!="X"&&(this.item.alasan=""),await T.update(this.item.id,this.item).then(()=>{this.$toast.add({severity:"success",summary:"Successful",detail:"Updated Internal Order",life:3e3})}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Update Internal Order",life:3e3})}).finally(()=>{this.isLoading=!1})):await T.store(this.item).then(e=>{this.item.id=e.data.data.id,this.item.nomor=e.data.data.nomor,this.$toast.add({severity:"success",summary:"Successful",detail:"Created Internal Order",life:3e3}),setTimeout(()=>{this.$router.push({name:"internal-order.edit",params:{id:this.item.id}})},1e3),this.isEdit=!0}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Create Internal Order",life:3e3})}).finally(()=>{this.isLoading=!1})},submitOpen(){this.submitForm("O").catch(()=>{this.item.status="D"})},submitCancel(){this.submitForm("X").catch(()=>{this.item.status="O"}).finally(()=>{this.cancelDialog=!1})}}},Q={class:"grid"},X={class:"col-12"},K={class:"card"},M={class:"p-fluid formgrid grid"},W={class:"field col-12 md:col-3"},Z=a("label",{for:"sonumber"},"Internal Order Number",-1),H={class:"field col-12 md:col-3"},J={class:"p-float-label"},Y=a("p",{class:"mb-1"},[S("Internal Order Date"),a("small",{class:"text-red-500"},"*")],-1),$={key:0,class:"p-invalid"},ee={class:"field col-12 md:col-3"},te=a("label",{for:"gudang",class:"mb-2"},[S("Gudang Asal"),a("small",{class:"text-red-500"},"*")],-1),ae={key:0,class:"p-invalid"},ie={class:"field col-12 md:col-3"},le=a("label",{for:"gudang",class:"mb-2"},[S("Gudang Tujuan"),a("small",{class:"text-red-500"},"*")],-1),ne={key:0,class:"p-invalid"},se={class:"field col-12 md:col-12"},oe=a("label",{for:"gudang",class:"mb-2"},[S("Keterangan"),a("small",{class:"text-red-500"},"*")],-1),de={class:"field col-6 md:col-2"},ue={class:"col-12 my-4"},re={key:0},me={key:1},ce={class:"product-autocomplete"},ge={class:"kode"},he={class:"row"},_e={class:"col-12"},pe=a("br",null,null,-1),fe={class:"grid"},be={class:"col-6"},ke={class:"flex flex-wrap gap-3 justify-content-start"},ye={class:"col-6"},ve={class:"flex flex-wrap gap-3 justify-content-end"},Se=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"Enter the reason for canceling")],-1);function Ce(i,t,l,s,e,o){const h=c("Toast"),y=c("Tag"),w=c("InputText"),j=c("Calendar"),V=c("Dropdown"),b=c("Button"),O=c("AutoComplete"),E=c("InputNumber"),G=c("Column"),L=c("DataTable"),U=c("SplitButton"),A=c("Textarea"),I=c("Dialog"),D=F("select-all-text");return m(),k("div",Q,[a("div",X,[a("div",K,[r(h),a("h5",null,[S(v(e.isEdit?"Edit":"Add")+" Internal Order ",1),r(y,{style:{float:"right"},value:i.$h.getLabel(e.item.status),severity:i.$h.getLabel(e.item.status)},null,8,["value","severity"])]),a("div",M,[a("div",W,[Z,r(w,{id:"sonumber",type:"text",modelValue:e.item.nomor,"onUpdate:modelValue":t[0]||(t[0]=n=>e.item.nomor=n),readonly:""},null,8,["modelValue"])]),a("div",H,[a("span",J,[Y,r(j,{dateFormat:"dd-mm-yy",modelValue:e.tanggal,"onUpdate:modelValue":t[1]||(t[1]=n=>e.tanggal=n),inputId:"tanggal",onDateSelect:o.selectDate,class:C({"p-invalid":e.isSubmitted&&!e.item.tanggal}),showButtonBar:""},null,8,["modelValue","onDateSelect","class"]),e.isSubmitted&&!e.item.tanggal?(m(),k("small",$,"Required")):_("",!0)])]),a("div",ee,[te,r(V,{id:"gudangitem",modelValue:e.selectedGudangAsal,"onUpdate:modelValue":t[2]||(t[2]=n=>e.selectedGudangAsal=n),options:e.lGudang,optionLabel:"gudang",class:C({"p-invalid":e.isSubmitted&&!e.item.id_gudang_asal}),onChange:o.selectGudangAsal},null,8,["modelValue","options","class","onChange"]),e.isSubmitted&&!e.item.id_gudang_asal?(m(),k("small",ae,"Required")):_("",!0)]),a("div",ie,[le,r(V,{id:"gudangitem",modelValue:e.selectedGudangTujuan,"onUpdate:modelValue":t[3]||(t[3]=n=>e.selectedGudangTujuan=n),options:e.lGudang,optionLabel:"gudang",class:C({"p-invalid":e.isSubmitted&&!e.item.id_gudang_tujuan}),onChange:o.selectGudangTujuan},null,8,["modelValue","options","class","onChange"]),e.isSubmitted&&!e.item.id_gudang_tujuan?(m(),k("small",ne,"Required")):_("",!0)]),a("div",se,[oe,B(r(w,{modelValue:e.item.keterangan,"onUpdate:modelValue":t[4]||(t[4]=n=>e.item.keterangan=n),id:"note",class:"min-w-max"},null,8,["modelValue"]),[[D]])]),a("div",de,[r(b,{label:"Add",size:"small",icon:"pi pi-plus",onClick:o.tambahBarisDetail},null,8,["onClick"])]),a("div",ue,[r(L,{value:e.item.detail,editMode:"cell",onCellEditComplete:o.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{default:p(()=>[(m(!0),k(N,null,z(e.columns,n=>(m(),f(G,{key:n.field,field:n.field,header:n.header,headerStyle:n.width,class:C(n.class)},{body:p(({data:u,field:d})=>[d=="satuan"?(m(),k("div",re,v(u[d]==null?u[d]:u[d].satuan),1)):(m(),k("div",me,v(u[d]),1))]),header:p(()=>[n.header==="Tax"?(m(),f(b,{key:0,icon:"pi pi-chevron-down",class:"p-button p-button-outlined",onClick:i.toggleSelectAllPajak},null,8,["onClick"])):_("",!0)]),editor:p(({data:u,field:d})=>[d=="nama_barang"?(m(),f(O,{key:0,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,suggestions:e.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:o.searchProduk,onDropdownClick:o.searchAllProduk,class:"min-w-max",dropdown:""},{option:p(g=>[a("div",ce,[a("div",ge,v(g.option.id_barang),1),a("div",he,[a("div",_e,v(g.option.nama_barang),1)])])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):d=="keterangan"?B((m(),f(w,{key:1,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,id:"note",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[D]]):d=="qty"?B((m(),f(E,{key:2,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,id:"qty",minFractionDigits:1,maxFractionDigits:5,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[D]]):d=="satuan"?(m(),f(V,{key:3,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,id:"satuan",options:u.optionSatuan,optionLabel:"satuan",class:"min-w-max",disabled:u.optionSatuan.length==1},null,8,["modelValue","onUpdate:modelValue","options","disabled"])):_("",!0)]),_:2},1032,["field","header","headerStyle","class"]))),128)),r(G,{header:"#",headerStyle:"width:5%;"},{body:p(({data:n})=>[r(b,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:u=>o.hapusBarisDetail(n)},null,8,["onClick"])]),_:1})]),_:1},8,["value","onCellEditComplete"])])]),pe,a("div",fe,[a("div",be,[a("div",ke,[r(b,{label:"Back",severity:"secondary",iconPos:"left",icon:"pi pi-arrow-left",onClick:t[5]||(t[5]=n=>this.$router.push("/internal/order"))})])]),a("div",ye,[a("div",ve,[_("",!0),e.item.status=="O"?(m(),f(b,{key:1,label:"Save",severity:"primary",iconPos:"right",icon:"pi pi-check",onClick:o.submitOpen,loading:e.isLoading},null,8,["onClick","loading"])):_("",!0),e.item.status=="D"?(m(),f(U,{key:2,label:"Save",onClick:o.submitOpen,model:e.items,loading:e.isLoading},null,8,["onClick","model","loading"])):_("",!0)])])]),r(I,{visible:e.cancelDialog,"onUpdate:visible":t[9]||(t[9]=n=>e.cancelDialog=n),style:{width:"450px"},header:"Confirm",modal:!0},{footer:p(()=>[r(b,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:t[8]||(t[8]=n=>e.cancelDialog=!1)}),r(b,{label:"Submit",icon:"pi pi-check",class:"p-button-text",onClick:o.submitCancel},null,8,["onClick"])]),default:p(()=>[Se,r(A,{class:"w-full",modelValue:e.item.alasan,"onUpdate:modelValue":t[7]||(t[7]=n=>e.item.alasan=n),rows:"5",cols:"30"},null,8,["modelValue"])]),_:1},8,["visible"])])])])}const Be=q(R,[["render",Ce]]);export{Be as default};
