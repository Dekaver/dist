import{a as q}from"./options-b2eb7ae6.js";import{a as $}from"./pajak-69cfe91a.js";import{a as x}from"./api-c6c36a80.js";import{_ as ee,y as te,r as _,A as ae,o as d,c as k,d as h,b as i,l as v,t as m,e as g,n as D,m as j,q as F,k as y,f,B as L,C as ie}from"./index-11eb6111.js";import{A as se}from"./index-b9e295bc.js";import"./custom-zod-e9521e5d.js";/* empty css                             *//* empty css                                */import{z as p}from"./index-0ec66d4d.js";const J=p.object({id:p.number().nullish(),nomor:p.string().nullish(),tanggal:p.date(),tgl_dibutuhkan:p.date(),keterangan:p.string().nullish(),persendiskon:p.number(),status:p.string()}),z=p.object({nama_barang:p.string().min(1),id_barang:p.number().nullish(),id_satuan:p.number(),id_pajak:p.string().nullish(),qty:p.number().min(0),harga:p.number().gte(0),diskonpersen:p.number().min(0),diskonrp:p.number().min(0),persen_pajak:p.string().nullish(),total:p.number().min(0)}),le=J.extend({status:p.literal("D"),detail:p.array(z).min(1,"Produk/Jasa Required")}),U=J.extend({status:p.literal("O"),detail:p.array(z.extend({qty:p.number().gt(0),harga:p.number().gt(0)})).min(1,"Produk/Jasa Required")}),ne=U.extend({status:p.literal("C")}),oe=U.extend({status:p.literal("S")}),re=p.discriminatedUnion("status",[le,U,oe,ne]),de={data(){return{settingStore:te(),item:{tanggal:null,referensi:null,tgl_dibutuhkan:null,persendiskon:0,keterangan:null,status:null,detail:[{type:"produk",nama_barang:null,kode_barang:null,qty:null,harga:null,diskonpersen:null,diskonrp:null,pajak:null,id_pajak:null,persen_pajak:null,total:null,id_barang:null,id_satuan:null,selectedPajak:[],option_satuan:[],id_proyek:null,proyek:null}]},nullDetail:null,isEdit:!1,isClean:!0,status:null,lProyek:[],selectedProyek:null,filteredlProyek:[],lProduk:[],selectedProduk:null,filteredlProduk:[],lPajak:[],selectedAllPajak:[],lSatuan:[],columns:[{field:"nama_barang",header:"Produk/Jasa",editor:!0},{field:"keterangan",header:"Deskripsi",editor:!0},{field:"qty",header:"Kuantitas",type:"number",editor:!0},{field:"selectedSatuan",header:"Satuan",error:"id_satuan",editor:!0},{field:"harga",header:"Harga Satuan",type:"currency",editor:!0},{field:"diskonpersen",header:"Diskon %",type:"number",editor:!0},{field:"selectedPajak",header:"Pajak",class:"right",error:"id_pajak",editor:!0},{field:"total",header:"Jumlah",type:"currency",editor:!1},{field:"selectedProyek",header:"Proyek",error:"id_proyek",editor:!0}]}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.getData().then(()=>{if(this.isEdit){this.GetPR();return}this.item.keterangan=`Permintaan Pembelian a/n ${this.$auth.nama}`,this.item.tanggal=new Date,this.item.tgl_dibutuhkan=new Date}).finally(()=>{this.$timeoutLoading()})},methods:{async submitPersetujuan(t=!1){const e={id:this.item.id,status:t,keterangan:this.item.keterangan};this.$isLoading.value=!0,await x.updatePersetujuan(e).then(a=>{this.item.status=a.data.data.status_pr?a.data.data.status_pr:this.item.status,this.item.persetujuan.forEach(o=>{o.urut==a.data.data.urut&&(o.tanggal_persetujuan=a.data.data.tanggal_persetujuan,o.status=a.data.data.status,o.keterangan=a.data.data.keterangan)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Update persetujuan",life:3e3}),this.showPersetujuanDialog=!1}).catch(a=>{this.$toast.add({severity:"error",summary:"Error",detail:a,life:3e3})}).finally(()=>{this.$timeoutLoading()}),this.showPersetujuanDialog=!1},confirmApprove(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!0},confirmReject(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!1},getColumnDetail(){return this.columns.filter(t=>t.field=="diskonpersen"?this.settingStore.pembelian.diskon_per_baris:t.field=="selectedPajak"?this.settingStore.pembelian.pajak=="a":t.field=="selectedProyek"?!!this.settingStore.pembelian.proyek:!0)},onCellEditComplete(t){let{data:e,newValue:a,field:o}=t;switch(o){case"nama_barang":if(typeof a=="string"||a==null){e.type=="jasa"&&(e[o]=a,e.qty=e.qty||0,this.tambahDetail());return}e.id_satuan=a.id_satuan,e.diskonpersen=0,e.diskonrp=0,e.option_satuan=a.option_satuan,e.selectedSatuan=e.option_satuan.find(l=>l.id==a.id_satuan),e.qty=0,e.harga=parseFloat(a.harga_beli),e.total=e.qty*e.harga-e.diskonrp,e.kode_barang=a.kode_barang,e.id_barang=a.id,e[o]=a.nama_barang,this.tambahDetail();break;case"selectedSatuan":if(!a)return;e[o]=a,e.id_satuan=a.id,e.harga=e.harga/a.konversi*(t.value?t.value.konversi:1),e.diskonrp=e.diskonpersen*(e.qty*e.harga)/100,e.total=e.qty*e.harga-e.diskonrp;break;case"selectedProyek":if(!a)return;e[o]=a,e.proyek=a.proyek,e.id_proyek=a.id;break;case"selectedPajak":if(!a)return;e[o]=a,e.pajak=a.map(l=>l.nama).join(),e.id_pajak=a.map(l=>l.id).join(),e.persen_pajak=a.map(l=>l.nilai).join();break;case"qty":e[o]=a||0,e.total=a*e.harga-e.diskonrp;break;case"harga":e[o]=a||0,e.total=e.qty*e.harga-e.diskonrp;break;case"diskonpersen":e[o]=a||0,e.diskonrp=e.qty*e.harga*(a||0)/100,e.total=e.qty*e.harga-e.diskonrp;break;case"diskonrp":if(!a)return;e[o]=a,e.diskonpersen=a/e.harga*100,e.total=e.qty*e.harga-e.diskonrp;break;default:e[o]=a;break}},async GetPR(){await x.show(this.$route.params.id).then(t=>{this.item=t.data.data,this.item.tanggal=this.$h.Date(this.item.tanggal),this.item.tgl_dibutuhkan=this.$h.Date(this.item.tgl_dibutuhkan),this.item.persendiskon=parseFloat(this.item.persendiskon),this.item.detail.forEach(e=>{if(e.qty=parseFloat(e.qty),e.harga=parseFloat(e.harga),e.diskonpersen=parseFloat(e.diskonpersen),e.diskonrp=parseFloat(e.diskonrp),e.total=parseFloat(e.total),e.id_barang){let a=this.lProduk.find(o=>o.id==e.id_barang);e.option_satuan=a.option_satuan,e.selectedSatuan=e.option_satuan.find(o=>o.id==e.id_satuan)}else e.option_satuan=[],e.selectedSatuan=this.lSatuan.find(a=>a.id==e.id_satuan);if(e.id_proyek&&(e.selectedProyek=this.lProyek.find(a=>a.id==e.id_proyek)),e.id_pajak){let a=this.lPajak.filter(o=>e.id_pajak.split(",").includes(o.id.toString()));e.selectedPajak=a,e.pajak=a.map(o=>o.nama).join(),e.id_pajak=a.map(o=>o.id).join(),e.persen_pajak=a.map(o=>o.nilai).join()}}),this.settingStore.pembelian.pajak=="b"&&(this.lPajak=this.lPajak.map(e=>{var a,o;return{...e,is_selected:(o=(a=this.item.detail[0])==null?void 0:a.selectedPajak)==null?void 0:o.some(l=>l.id==e.id)}})),(this.item.status=="D"||this.item.status=="O")&&this.tambahDetail()}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})})},async Save(t){try{if(this.$isLoading.value=!0,this.status=t,this.item.total=this.subtotal,this.item.total_discount=this.total_discount,this.item.dpp=this.dpp,this.item.grandtotal=this.grandtotal,this.item.pajak=this.selectedPajakDetail,this.isClean=!1,Object.keys(this.FormError).length>0){this.$timeoutLoading();return}this.isEdit?await x.update(this.item.id,this.FormItem).then(e=>{this.item.status=e.data.data.status,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),this.isClean=!0}):await x.store(this.FormItem).then(e=>{this.item.id=e.data.data.id,this.item.status=e.data.data.status,this.item.nomor=e.data.data.nomor,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),this.isEdit=!0,setTimeout(()=>{this.$router.replace({name:"pr.edit",params:{id:this.item.id}})},1e3),this.isClean=!0})}catch(e){e instanceof se&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})}finally{this.$timeoutLoading()}},async getData(){await q.getProyek().then(t=>{this.lProyek=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Gudang",life:3e3})}),await q.getProduk().then(t=>{this.lProduk=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await $.index().then(t=>{this.lPajak=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Pajak",life:3e3})}),await q.getSatuan().then(t=>{this.lSatuan=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})})},searchProduk(t){setTimeout(()=>{this.filteredlProduk=t.query.trim().length?this.lProduk.filter(e=>e.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProduk]},250)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(t=>!this.item.detail.some(e=>e.nama_barang==t.nama_barang))},250)},searchProyek(t){setTimeout(()=>{this.filteredlProyek=t.query.trim().length?this.lProyek.filter(e=>e.proyek.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProyek]},250)},searchAllProyek(){setTimeout(()=>{this.filteredlProyek=this.lProyek.filter(t=>!this.item.detail.some(e=>e.proyek==t.proyek))},250)},searchPajak(t){setTimeout(()=>{this.filteredlPajak=t.query.trim().length?this.lPajak.filter(e=>e.nama.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lPajak]},250)},selectAllPajak(t){this.item.detail.forEach(e=>{e.selectedPajak=t.value,e.pajak=t.value.map(a=>a.nama).join(),e.id_pajak=t.value.map(a=>a.id).join(),e.persen_pajak=t.value.map(a=>a.nilai).join()})},changePajakSelection(){this.item.detail.forEach(t=>{const e=this.lPajakSelection.filter(a=>a.is_selected);t.selectedPajak=this.lPajakSelection.filter(a=>a.is_selected),t.pajak=e.map(a=>a.nama).join(),t.id_pajak=e.map(a=>a.id).join(),t.persen_pajak=e.map(a=>a.nilai).join()})},toggleSelectAllPajak(t){this.$refs.op_select_all_pajak.toggle(t)},tambahDetail(){this.item.detail.some(t=>t.nama_barang==null)||this.item.detail.push({...this.nullDetail})},switchType(t){const e=this.item.detail[t].type=this.item.detail[t].type=="produk"?"jasa":"produk";this.item.detail[t]={...this.nullDetail,type:e}},removeDetail(t){this.item.detail.length>1&&(this.item.detail=this.item.detail.filter(e=>e!==t))},cetakPDF(){this.$router.push({name:"pr.cetak",params:this.item.id})},filters:{pretty:function(t){return JSON.stringify(JSON.parse(t),null,2)}}},computed:{FormError(){var t,e;return this.isClean?{}:((e=(t=re.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}},FormItem(){return{...this.item,status:this.status,detail:this.item.detail.filter(t=>t.nama_barang!=null)}},subtotal_diskon(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.qty)*parseFloat(e.harga)*parseFloat(e.diskonpersen)/100,0)},subtotal(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total||0),0)},diskon(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total-this.subtotal_diskon),0)},total_discount(){return this.subtotal*(this.item.persendiskon??0)/100},dpp(){return this.subtotal-this.total_discount},grandtotal(){return this.dpp+this.selectedPajakDetail.reduce((t,e)=>t+e.nilai,0)},selectedPajakDetail(){let t=[];return this.item.detail.forEach(e=>{let a=e.total-(e.diskon?e.diskon:0)*e.qty;e.selectedPajak!=null&&e.selectedPajak.forEach(o=>{let l={};l.id=o.id,l.nama=o.nama,l.nilai=(a-a*(this.item.persendiskon||0)/100)*o.nilai/100;let n=-1;for(let P=0;P<t.length;P++)if(t[P].nama===l.nama){n=P;break}n==-1?t.push(l):t[n].nilai=t[n].nilai+l.nilai})}),t},canPersetujuan:function(){var a;const t=(a=this.item.persetujuan)==null?void 0:a.find(o=>o.id_pegawai==this.$auth.id&&o.tanggal_persetujuan==null),e=t?this.item.persetujuan.find(o=>o.urut<t.urut&&o.status===!0):null;return t&&(e||(t==null?void 0:t.urut)==1)},lPajakSelection(){return this.settingStore.pembelian.pajak=="b"?this.lPajak.filter(t=>this.settingStore.pembelian.id_pajak.some(e=>e==t.id)).map(t=>({...t,is_selected:t.is_selected||!1})):[]}}},ue={class:"card"},me={class:"p-fluid formgrid grid"},ce={class:"field col-3 sm:col-2 md:col-2"},he={class:"field col-2 sm:col-2 md:col-2"},pe={class:"field col-3 sm:col-2 md:col-2"},ke=i("div",{class:"col-1 md:col-1 mb-2"},null,-1),_e={class:"col-12 md:col-6 mb-2"},ge={class:"col-12 my-4"},ye={class:"flex align-items-center gap-2"},fe={class:"capitalize"},be={key:0},je={key:1},Pe={key:2,style:{"text-align":"end"}},ve={key:3,style:{"text-align":"center"}},Se={key:4},De={key:5},Ce={class:"flex flex-column"},we={class:"text-green-500"},Ve={key:6},xe={class:"flex flex-column"},Fe={key:7},Ee={class:"flex flex-column"},qe={class:""},Le={class:"flex flex-column"},Ue={class:""},Ae={class:"grid col pb-0"},Te={class:"col py-1"},Ne={class:"col text-green-500 py-1"},Oe=i("div",{class:"col-12 md:col-8"},null,-1),Be={class:"col-12 md:col-4"},Re={class:"grid py-3 justify-content-center align-items-center"},Ie=i("div",{class:"col-8"},"Subtotal",-1),Me={class:"col-4 text-right"},Je={class:"grid py-3 justify-content-center align-items-center"},ze=i("div",{class:"col-4"},"Diskon",-1),Ge={class:"col-4"},He={class:"p-inputgroup"},Ye=i("span",{class:"p-inputgroup-addon"},[i("i",{class:"pi pi-percentage"})],-1),Ke={class:"col-4 text-right"},Qe={key:0,class:"grid py-3 justify-content-center align-items-center"},We=i("div",{class:"col-8"},"DPP",-1),Xe={class:"col-4 text-right"},Ze={key:1},$e={class:"col-4"},et={class:"field col-4"},tt={class:"col-4 text-right"},at={key:2},it={class:"col-8"},st={class:"col-4 text-right"},lt={class:"grid py-3 justify-content-center align-items-center"},nt=i("div",{class:"col-8"},"Grand Total",-1),ot={class:"col-4 text-right"},rt=i("br",null,null,-1),dt={key:0,class:"p-datatable col-6"},ut={class:"p-datatable-table p-datatable-striped"},mt=i("thead",{class:"p-datatable-thead"},[i("tr",{role:"row"},[i("th",{colspan:"7",class:"text-left"},"Harus Disetujui Oleh:")]),i("tr",null,[i("th",null,"No"),i("th",null,"Nama"),i("th",null,"Jabatan"),i("th",null,"Tanggal"),i("th",null,"Status"),i("th",null,"Keterangan")])],-1),ct={class:"p-datatable-tbody"},ht={key:0},pt={key:1},kt={key:2},_t={class:"grid"},gt={class:"col-6"},yt={class:"flex flex-wrap gap-3 justify-content-start"},ft={class:"col-6"},bt={class:"flex flex-wrap gap-3 justify-content-end"},jt={class:"grid col pb-0"},Pt={class:"col py-1"},vt={class:"col text-green-500 py-1"},St=i("div",{class:"flex align-items-center justify-content-center"},[i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),i("span",null,"Masukkan Catatan")],-1);function Dt(t,e,a,o,l,n){var R,I,M;const P=_("Toast"),G=_("Tag"),C=_("Label"),A=_("Calendar"),S=_("ErrorMsg"),w=_("InputText"),V=_("Column"),b=_("Button"),T=_("AutoComplete"),N=_("Dropdown"),O=_("MultiSelect"),B=_("InputNumber"),H=_("DataTable"),Y=_("Checkbox"),K=_("Divider"),Q=_("SubmitButton"),W=_("OverlayPanel"),X=_("Textarea"),Z=_("Dialog"),E=ae("select-all-text");return d(),k(j,null,[h(P),i("div",ue,[i("h5",null,[v(m(l.isEdit?"Ubah":"Tambah")+" Purchase Request ",1),h(G,{style:{float:"right"},value:t.$h.getLabel(l.item.status),severity:t.$h.getLabel(l.item.status)},null,8,["value","severity"])]),i("div",me,[i("div",ce,[h(C,{required:""},{default:g(()=>[v("Tanggal")]),_:1}),h(A,{modelValue:l.item.tanggal,"onUpdate:modelValue":e[0]||(e[0]=s=>l.item.tanggal=s),inputId:"tanggal",class:D(n.FormError.tanggal&&"p-invalid"),maxDate:t.$h.today},null,8,["modelValue","class","maxDate"]),h(S,{error:n.FormError.tanggal},null,8,["error"])]),i("div",he,[h(C,{required:l.isEdit},{default:g(()=>[v("Nomor")]),_:1},8,["required"]),h(w,{readonly:"",id:"nomor",type:"text",modelValue:l.item.nomor,"onUpdate:modelValue":e[1]||(e[1]=s=>l.item.nomor=s),class:D(n.FormError.nomor&&"p-invalid")},null,8,["modelValue","class"]),h(S,{error:n.FormError.nomor},null,8,["error"])]),i("div",pe,[h(C,{required:""},{default:g(()=>[v(" Tanggal Dibutuhkan")]),_:1}),h(A,{modelValue:l.item.tgl_dibutuhkan,"onUpdate:modelValue":e[2]||(e[2]=s=>l.item.tgl_dibutuhkan=s),inputId:"tgl_dibutuhkan",class:D(n.FormError.tgl_dibutuhkan&&"p-invalid")},null,8,["modelValue","class"]),h(S,{error:n.FormError.tgl_dibutuhkan},null,8,["error"])]),ke,i("div",_e,[h(C,{for:"syarat"},{default:g(()=>[v("Keterangan")]),_:1}),h(w,{id:"keterangan",type:"text",modelValue:l.item.keterangan,"onUpdate:modelValue":e[3]||(e[3]=s=>l.item.keterangan=s),class:D(n.FormError.keterangan&&"p-invalid")},null,8,["modelValue","class"])]),i("div",ge,[h(H,{value:l.item.detail,editMode:"cell",onCellEditComplete:n.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{default:g(()=>[h(V,{header:"#",headerStyle:"width:10px;"},{body:g(({index:s})=>[v(m(s+1),1)]),_:1}),h(V,{header:"Tipe",headerStyle:"width:5%;"},{body:g(({data:s,index:r})=>[i("div",ye,[h(b,{onClick:u=>n.switchType(r),icon:s.type=="produk"?"pi pi-box":"pi pi-briefcase",severity:s.type=="produk"?"primary":"secondary"},null,8,["onClick","icon","severity"]),i("span",fe,m(s.type),1)])]),_:1}),(d(!0),k(j,null,F(n.getColumnDetail(),s=>(d(),y(V,{key:s.field,field:s.field,header:s.header},ie({body:g(({data:r,field:u,index:c})=>[u=="selectedSatuan"?(d(),k("div",be,m(r[u]&&r[u].satuan),1)):u=="selectedPajak"?(d(),k("div",je,m(r.pajak==null?null:r.pajak.toString()),1)):s.type=="currency"?(d(),k("div",Pe,m(t.$h.formatNumber(r[u])),1)):s.type=="number"?(d(),k("div",ve,m(t.$h.formatNumber(r[u])),1)):s.type=="date"?(d(),k("div",Se,m(t.$h.formatDate(r[u])),1)):u=="nama_barang"?(d(),k("div",De,[i("span",Ce,[i("small",we,m(r.kode_barang),1),i("span",null,m(r.nama_barang),1)])])):u=="selectedProyek"?(d(),k("div",Ve,[i("span",xe,[i("span",null,m(r.proyek),1)])])):(d(),k("div",Fe,m(r[u]),1)),n.FormError.detail&&n.FormError.detail[c]?(d(),y(S,{key:8,error:n.FormError.detail[c][s.error?s.error:u]},null,8,["error"])):f("",!0)]),header:g(()=>[s.header==="Pajak"?(d(),y(b,{key:0,icon:"pi pi-chevron-down",class:"p-button p-button-outlined",onClick:n.toggleSelectAllPajak},null,8,["onClick"])):f("",!0)]),_:2},[s.editor?{name:"editor",fn:g(({data:r,field:u})=>[u=="nama_barang"?(d(),k(j,{key:0},[r.type=="produk"?(d(),y(T,{key:0,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,suggestions:l.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:n.searchProduk,class:"min-w-max",dropdown:"",onDropdownClick:n.searchAllProduk},{option:g(c=>[i("div",Ee,[i("small",{class:D(c.option.is_stok?"text-green-500":"text-blue-500")},m(c.option.kode_barang),3),i("div",qe,m(c.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(d(),y(w,{key:1,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))],64)):u=="selectedProyek"?(d(),y(T,{key:1,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,suggestions:l.filteredlProyek,optionLabel:"proyek",virtualScrollerOptions:{itemSize:50},onComplete:n.searchProyek,class:"min-w-max",dropdown:"",onDropdownClick:n.searchAllProyek},{option:g(c=>[i("div",Le,[i("small",null,m(c.option.kode),1),i("div",Ue,m(c.option.proyek),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):u=="selectedSatuan"?(d(),k(j,{key:2},[r.type=="produk"?(d(),y(N,{key:0,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,id:"satuan",options:r.option_satuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"])):(d(),y(N,{key:1,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,id:"satuan",options:l.lSatuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"]))],64)):u=="selectedPajak"?(d(),y(O,{key:3,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,options:l.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem"},{option:g(c=>[i("div",Ae,[i("div",Te,m(c.option.nama),1),i("div",Ne,m(c.option.nilai)+"%",1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])):s.type=="number"||s.type=="currency"?L((d(),y(B,{key:4,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,inputClass:"text-right",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[E]]):u=="keterangan"?L((d(),y(w,{key:5,modelValue:r[u],"onUpdate:modelValue":c=>r[u]=c,autofocus:"",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[E]]):f("",!0)]),key:"0"}:void 0]),1032,["field","header"]))),128)),this.item.status!="A"&&this.item.status!="R"&&this.item.status!="S"?(d(),y(V,{key:0,header:"#",headerStyle:"width:5%;"},{body:g(({data:s})=>[h(b,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:r=>n.removeDetail(s)},null,8,["onClick"])]),_:1})):f("",!0)]),_:1},8,["value","onCellEditComplete"]),h(S,{error:n.FormError.detail},null,8,["error"])]),Oe,i("div",Be,[i("div",Re,[Ie,i("div",Me,m(t.$h.formatNumber(n.subtotal)),1)]),i("div",Je,[ze,i("div",Ge,[i("div",He,[L(h(B,{placeholder:"Discount",modelValue:l.item.persendiskon,"onUpdate:modelValue":e[4]||(e[4]=s=>l.item.persendiskon=s),min:0,max:100},null,8,["modelValue"]),[[E]]),Ye])]),i("div",Ke,m(t.$h.formatNumber(n.total_discount)),1)]),n.selectedPajakDetail.length>0&&n.total_discount>0?(d(),k("div",Qe,[We,i("div",Xe,m(t.$h.formatNumber(n.dpp)),1)])):f("",!0),l.settingStore.pembelian.pajak=="b"?(d(),k("div",Ze,[(d(!0),k(j,null,F(n.lPajakSelection,(s,r)=>{var u;return d(),k("div",{key:s,class:"grid py-3 justify-content-center align-items-center"},[i("div",$e,m(s.nama),1),i("div",et,[h(Y,{modelValue:s.is_selected,"onUpdate:modelValue":c=>s.is_selected=c,binary:!0,onChange:n.changePajakSelection},null,8,["modelValue","onUpdate:modelValue","onChange"])]),i("div",tt,m(t.$h.formatNumber((u=n.selectedPajakDetail[r])==null?void 0:u.nilai)),1)])}),128))])):f("",!0),l.settingStore.pembelian.pajak=="a"?(d(),k("div",at,[(d(!0),k(j,null,F(n.selectedPajakDetail,s=>(d(),k("div",{key:s,class:"grid py-3 justify-content-center align-items-center"},[i("div",it,m(s.nama),1),i("div",st,m(t.$h.formatNumber(s.nilai)),1)]))),128))])):f("",!0),i("div",lt,[h(K),nt,i("div",ot,m(t.$h.formatNumber(n.grandtotal)),1)])])]),rt,((R=l.item.persetujuan)==null?void 0:R.length)>0&&!this.$route.query.revisi?(d(),k("div",dt,[i("table",ut,[mt,i("tbody",ct,[(d(!0),k(j,null,F(l.item.persetujuan,(s,r)=>(d(),k("tr",{key:r},[i("td",null,m(r+1),1),i("td",null,m(s.nama),1),i("td",null,m(s.jabatan),1),i("td",null,m(t.$h.formatDate(s.tanggal_persetujuan,"DD-MM-YYYY HH:mm:ss")),1),s.tanggal_persetujuan!=null&&!s.status?(d(),k("td",ht,"Reject")):s.tanggal_persetujuan!=null&&s.status?(d(),k("td",pt,"Approve")):(d(),k("td",kt,"Menunggu Persetujuan")),i("td",null,m(s.keterangan),1)]))),128))])])])):f("",!0),i("div",_t,[i("div",gt,[i("div",yt,[l.isEdit?(d(),y(b,{key:0,label:"Print",severity:"help",icon:"pi pi-print",iconPos:"left",onClick:n.cetakPDF},null,8,["onClick"])):f("",!0)])]),i("div",ft,[i("div",bt,[(M=(I=l.item.persetujuan)==null?void 0:I[0])!=null&&M.tanggal_persetujuan?f("",!0):(d(),y(Q,{key:0,loading:t.$isLoading.value,data:l.item,onClick:e[5]||(e[5]=s=>{var r;return n.Save((r=l.settingStore.pembelian.persetujuan.permintaan)!=null&&r.persetujuan1?"S":"O")}),onDraft:e[6]||(e[6]=s=>n.Save("D")),showDraft:l.item.status==null||l.item.status=="D"},null,8,["loading","data","showDraft"])),l.item.status=="S"&&n.canPersetujuan?(d(),y(b,{key:1,label:"Reject",severity:"danger",iconPos:"right",icon:"pi pi-times",onClick:n.confirmReject,class:"mx-2"},null,8,["onClick"])):f("",!0),l.item.status=="S"&&n.canPersetujuan?(d(),y(b,{key:2,label:"Approve",severity:"success",iconPos:"right",icon:"pi pi-check",onClick:n.confirmApprove},null,8,["onClick"])):f("",!0)])])]),h(W,{ref:"op_select_all_pajak"},{default:g(()=>[h(O,{modelValue:l.selectedAllPajak,"onUpdate:modelValue":e[7]||(e[7]=s=>l.selectedAllPajak=s),options:l.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem",onChange:n.selectAllPajak},{option:g(s=>[i("div",jt,[i("div",Pt,m(s.option.nama),1),i("div",vt,m(s.option.nilai)+"%",1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},512),h(Z,{visible:t.showPersetujuanDialog,"onUpdate:visible":e[11]||(e[11]=s=>t.showPersetujuanDialog=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:g(()=>[h(b,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:e[9]||(e[9]=s=>t.showPersetujuanDialog=!1)}),h(b,{label:t.isApprove?"Approve":"Reject",icon:"pi pi-check",class:"p-button-text",onClick:e[10]||(e[10]=s=>n.submitPersetujuan(t.isApprove))},null,8,["label"])]),default:g(()=>[St,h(X,{class:"w-full",modelValue:l.item.keterangan,"onUpdate:modelValue":e[8]||(e[8]=s=>l.item.keterangan=s),rows:"5",cols:"30",placeholder:"Optional"},null,8,["modelValue"])]),_:1},8,["visible"])])],64)}const At=ee(de,[["render",Dt]]);export{At as default};
