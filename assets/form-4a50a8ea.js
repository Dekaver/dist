import{a as j}from"./api-646607e4.js";import{a as k}from"./uangmuka-9a822cf6.js";import{_ as E,o as p,c as f,b as e,t as a,m as I,q as B,p as M,g as q,r,A as $,d as l,l as d,e as n,n as g,B as v,f as w,k as K}from"./index-11eb6111.js";import"./custom-zod-e9521e5d.js";import{A as z}from"./index-b9e295bc.js";import{z as _}from"./index-0ec66d4d.js";const G={data(){return{id:null,item:{journal_code:null,gl_number:null,gl_date:null,total:0,is_posting:!0,note:null,reference:null,detail:[{gl_number:null,line:null,id_account:null,amount:null,is_debit:null,description:null,account_name:null,account_code:null,debit:0,credit:0}]}}},methods:{async getData(){await k.journal(this.$route.params.id).then(o=>{console.log(o),this.item=o.data.data}).catch(o=>{this.$toast.add({severity:"error",summary:"Failed",detail:o.response.data.message,life:3e3})})}},computed:{total_debit:function(){return this.item.detail.reduce((o,t)=>o+parseFloat(t.debit),0)},total_credit:function(){return this.item.detail.reduce((o,t)=>o+parseFloat(t.credit),0)},invalid:function(){return!(this.item.date!=null&&this.item.id_customer!=null&&this.item.bank_account!=null)}},watch:{total:function(o){this.item.total=o}},mounted(){this.id=this.$route.params.id?this.$route.params.id:null,this.getData()}},u=o=>(M("data-v-aef91df2"),o=o(),q(),o),R={class:"layout-invoice-page"},Y={class:"book layout-invoice-content"},Z={id:"akm-invoice",class:"page"},H={class:"subpage"},Q={class:"report-container w-100"},W={class:"report-content"},X={class:"report-content-cell"},ee={class:"main-content"},te={class:"page-details border-0"},se=u(()=>e("div",{class:"page-title text-start"},[e("p",{class:"fw-bolder fs-5"},"Jurnal Voucher")],-1)),oe={class:"row my-3"},le={class:"col-12 p-0"},ie={class:"table table-sm font-smaller w-100 mb-0"},ae={class:"border-2 border-dark"},re=u(()=>e("td",{width:"25%"},"Nomor",-1)),ne=u(()=>e("td",{width:"5%",class:"text-center"},":",-1)),de={class:"fw-bold"},ue={class:"border-2 border-dark"},ce=u(()=>e("td",{width:"25%"},"Tanggal",-1)),me=u(()=>e("td",{width:"5%",class:"text-center"},":",-1)),_e={class:"border-2 border-dark"},he=u(()=>e("td",{width:"25%"},"Referensi",-1)),pe=u(()=>e("td",{width:"5%",class:"text-center"},":",-1)),ge={class:"border-2 border-dark"},fe=u(()=>e("td",{width:"25%"},"Keterangan",-1)),be=u(()=>e("td",{width:"5%",class:"text-center"},":",-1)),ye={class:"table-details border-0"},ve={class:"table table-sm font-smaller"},we=u(()=>e("thead",null,[e("tr",{class:"text-center"},[e("th",{width:"30%"},"Kode"),e("th",{width:"30%"},"Akun"),e("th",{width:"20%"},"Debit"),e("th",{width:"20%"},"Kredit")])],-1)),ke={class:"text-end"},xe={class:"text-end"},Ve=u(()=>e("td",{colspan:"2"},"Total",-1)),De={class:"text-end"},Pe={class:"text-end"};function Ce(o,t,F,O,s,c){return p(),f("div",R,[e("div",Y,[e("div",Z,[e("div",H,[e("table",Q,[e("tbody",W,[e("tr",null,[e("td",X,[e("div",ee,[e("div",te,[se,e("div",oe,[e("div",le,[e("table",ie,[e("tr",ae,[re,ne,e("td",de,a(s.item.gl_number),1)]),e("tr",ue,[ce,me,e("td",null,a(o.$h.formatDate(s.item.gl_date)),1)]),e("tr",_e,[he,pe,e("td",null,a(s.item.reference),1)]),e("tr",ge,[fe,be,e("td",null,a(s.item.note),1)])])])])]),e("div",ye,[e("table",ve,[we,e("tbody",null,[(p(!0),f(I,null,B(s.item.detail,(b,x)=>(p(),f("tr",{key:x},[e("td",null,a(b.account_code),1),e("td",null,a(b.account_name),1),e("td",ke,a(o.$h.formatNumber(b.debit)),1),e("td",xe,a(o.$h.formatNumber(b.credit)),1)]))),128))]),e("tfoot",null,[e("tr",null,[Ve,e("td",De,a(o.$h.formatNumber(c.total_debit)),1),e("td",Pe,a(o.$h.formatNumber(c.total_credit)),1)])])])])])])])])])])])])])}const je=E(G,[["render",Ce],["__scopeId","data-v-aef91df2"]]),Ee=_.object({nomor:_.string(),tanggal:_.date(),jenis_pembayaran:_.string(),id_supplier:_.number(),id_po:_.number({invalid_type_error:"Nomor PO harus diisi"}),id_account:_.number().positive(),status:_.string()}),Fe={components:{MyJurnal:je},data(){return{item:{id:null,nomor:"",tanggal:new Date(Date.now()),id_supplier:null,nomor_po:null,keterangan:null,jenis_pembayaran:null,id_account:null,account:null,alamat:null,id_po:null,status:"D",created_date:null,created_by:null,modified_date:null,modified_by:null,pajak_po:[]},jurnalDialog:!1,selectedAccountPenjualan:null,filteredAccountPenjualan:[],selectedJenisPembayaran:null,lJenisPembayaran:[{label:"Kas Tunai/Cek",value:"C"},{label:"Giro/Transfer Bank/Kartu Kredit",value:"T"}],FormError:{},id:null,revisi:null,selectedPurchaseOrder:null,filteredPurchaseOrder:[],lPurchaseOrder:[],tanggal:null,date:null,checked:!0,filters:{},closingDialog:!1,isSubmitted:!1}},mounted(){this.item.id=this.$route.params.id?this.$route.params.id:null,this.date=new Date(Date.now()),this.$isLoading.value=!1,this.getData().then(()=>{this.item.id&&(this.getUangMuka(),this.$isLoading.value=!1)})},computed:{isEdit(){return this.item.id!=null},total(){return this.item.sisa_tagihan-this.item.bayar}},watch:{bayar(o){this.item.bayar=o,this.item.customer=o.text}},methods:{selectJenisPembayaran(o){this.item.jenis_pembayaran=o.value.value,this.item.jenis_pembayaran=="C"&&this.item.pembayaran==null},async getUangMuka(){this.isEdit&&await k.show(this.item.id).then(o=>{this.item=o.data.data,this.selectedPurchaseOrder={id:this.item.id_po,nomor:this.item.nomor_po},this.tanggal=new Date(this.item.tanggal),this.tanggal_referensi=new Date(this.item.tanggal_referensi),this.item.tanggal=this.$h.Date(this.item.tanggal),this.item.tanggal_referensi=this.$h.Date(this.item.tanggal_referensi),this.selectedJenisPembayaran=this.lJenisPembayaran.find(t=>t.value==this.item.jenis_pembayaran)}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Uang Muka",life:3e3})})},async getData(){await j.index({type:"option",module:"uang-muka"}).then(o=>{this.lPurchaseOrder=o.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data PO",life:3e3})})},searchPurchaseOrder(o){setTimeout(()=>{o.query.trim().length?this.filteredPurchaseOrder=this.lPurchaseOrder.filter(t=>t.nomor.toLowerCase().includes(o.query.toLowerCase())):this.filteredPurchaseOrder=[...this.lPurchaseOrder]},250)},async selectPurchaseOrder(o){this.selectedPurchaseOrder=o.value,await j.show(this.selectedPurchaseOrder.id).then(t=>{this.item.id_po=t.data.data.id,this.item.total_po=t.data.data.grandtotal,this.item.sisa_tagihan=t.data.data.grandtotal,this.item.id_supplier=t.data.data.id_supplier,this.item.supplier=t.data.data.supplier})},async Save(o){try{this.isSubmitted=!0,this.$isLoading.value=!0,this.item.status=o,this.FormError={},Ee.parse(this.item),this.item.is_pajak?(this.item.grandtotal=parseFloat(this.item.bayar)/(1+.11),this.item.pajak=parseFloat(this.item.bayar)-parseFloat(this.item.grandtotal)):(this.item.grandtotal=this.item.bayar,this.item.pajak=0),this.isEdit?await k.update(this.item.id,this.item).then(t=>{this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3})}):await k.store(this.item).then(t=>{this.item.id=t.data.data.id,this.item.nomor=t.data.data.nomor,this.$toast.add({severity:"success",summary:"Successful",detail:"Created Uang Muka",life:3e3}),setTimeout(()=>{this.$router.replace({name:"uangmuka.edit",params:{id:this.item.id}})},1e3),this.isEdit=!0});return}catch(t){console.log(t),t instanceof _.ZodError?this.FormError=t.format():t instanceof z&&this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3}),this.item.status="D"}finally{this.$timeoutLoading(),this.isSubmitted=!1,this.closingDialog=!1}}},filters:{pretty(o){return JSON.stringify(JSON.parse(o),null,2)}}},Oe={class:"grid"},Se={class:"col-12"},Ue={class:"card"},Te=e("p",null,null,-1),Je={class:"p-fluid formgrid grid"},Ne={class:"field col-12 md:col-3"},Le={class:"grid"},Ae={class:"col-4"},Ie={class:"text-green-500"},Be={class:"text-green-600 font-bold"},Me={class:"col-8"},qe={class:""},$e={class:"font-bold",style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ke={class:"field col-12 md:col-3"},ze={class:"field col-12 md:col-3"},Ge=e("div",{class:"col-12"},null,-1),Re={class:"field col-12 md:col-2"},Ye={class:"field col-12 md:col-3"},Ze={class:"field col-12 md:col-3"},He={key:0,class:"field col-12 md:col-4"},Qe=e("div",{class:"col-12"},null,-1),We={class:"field col-12 md:col-3"},Xe={class:"field col-12 md:col-3"},et={class:"field col-12 md:col-3"},tt={class:"field flex flex-column gap-2 col-12 md:col-4 lg:col-3 xl:col-2"},st={class:"grid"},ot=e("div",{class:"col-9 md:col-6"},[e("div",{class:"flex flex-wrap md:gap-3 justify-content-between align-items-stretch md:justify-content-start"})],-1),lt={class:"col-9 md:col-6"},it=e("div",{class:"flex flex-wrap gap-3 justify-content-start"},null,-1),at={key:1,class:"flex flex-wrap justify-content-end"},rt={class:"flex flex-column align-items-center justify-content-center"},nt=e("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),dt={key:0};function ut(o,t,F,O,s,c){const b=r("Toast"),x=r("Tag"),m=r("Label"),S=r("AutoComplete"),h=r("ErrorMsg"),U=r("AutoCompleteAkun"),V=r("InputText"),T=r("Calendar"),J=r("Dropdown"),D=r("InputNumber"),N=r("InputSwitch"),P=r("Button"),L=r("SubmitButton"),C=r("Dialog"),A=r("MyJurnal"),y=$("select-all-text");return p(),f("div",Oe,[e("div",Se,[e("div",Ue,[l(b),e("h5",null,[d(a(c.isEdit?"Ubah ":"Tambah")+" Uang Muka ",1),l(x,{style:{float:"right"},value:o.$h.getLabel(s.item.status),severity:o.$h.getLabel(s.item.status)},null,8,["value","severity"])]),Te,e("div",Je,[e("div",Ne,[l(m,{required:""},{default:n(()=>[d("Nomor Po")]),_:1}),l(S,{id:"purchase_order",modelValue:s.selectedPurchaseOrder,"onUpdate:modelValue":t[0]||(t[0]=i=>s.selectedPurchaseOrder=i),optionLabel:"nomor",suggestions:s.filteredPurchaseOrder,onComplete:c.searchPurchaseOrder,onItemSelect:c.selectPurchaseOrder,dropdown:"",class:g({"p-invalid":s.FormError.id_po})},{option:n(i=>[e("div",Le,[e("div",Ae,[e("small",Ie,a(o.$h.formatDate(i.option.tanggal)),1),e("div",Be,a(i.option.nomor),1)]),e("div",Me,[e("div",qe,a(i.option.nama_gudang),1),e("div",$e,a(i.option.nama_supplier),1)])])]),_:1},8,["modelValue","suggestions","onComplete","onItemSelect","class"]),l(h,{error:s.FormError.id_po},null,8,["error"])]),e("div",Ke,[l(U,{modelValue:s.item.id_account,"onUpdate:modelValue":t[1]||(t[1]=i=>s.item.id_account=i),label:"Akun",error:s.FormError.id_account,level:4},null,8,["modelValue","error"])]),e("div",ze,[l(m,null,{default:n(()=>[d("Supplier")]),_:1}),l(V,{modelValue:s.item.supplier,"onUpdate:modelValue":t[2]||(t[2]=i=>s.item.supplier=i),disabled:""},null,8,["modelValue"])]),Ge,e("div",Re,[l(m,{for:"tanggal",required:""},{default:n(()=>[d("Tanggal")]),_:1}),l(T,{modelValue:s.item.tanggal,"onUpdate:modelValue":t[3]||(t[3]=i=>s.item.tanggal=i),inputId:"tanggal",maxDate:o.$h.today,class:g(s.FormError.tanggal&&"p-invalid")},null,8,["modelValue","maxDate","class"]),l(h,{error:s.FormError.tanggal},null,8,["error"])]),e("div",Ye,[l(m,{for:"nomor",required:""},{default:n(()=>[d("Nomor")]),_:1}),l(V,{id:"nomor",modelValue:s.item.nomor,"onUpdate:modelValue":t[4]||(t[4]=i=>s.item.nomor=i),disable:""},null,8,["modelValue"])]),e("div",Ze,[l(m,{required:""},{default:n(()=>[d("Jenis Pembayaran")]),_:1}),l(J,{id:"jenis_pembayaran",modelValue:s.selectedJenisPembayaran,"onUpdate:modelValue":t[5]||(t[5]=i=>s.selectedJenisPembayaran=i),options:s.lJenisPembayaran,optionLabel:"label",placeholder:"Jenis Pembayaran",onChange:c.selectJenisPembayaran},null,8,["modelValue","options","onChange"]),l(h,{error:s.FormError.jenis_pembayaran},null,8,["error"])]),s.item.jenis_pembayaran=="T"?(p(),f("div",He,[l(m,{required:""},{default:n(()=>[d("Pembayaran")]),_:1}),v(l(V,{id:"pembayaran",type:"text",modelValue:s.item.pembayaran,"onUpdate:modelValue":t[6]||(t[6]=i=>s.item.pembayaran=i),class:g({"p-invalid":s.FormError.pembayaran})},null,8,["modelValue","class"]),[[y]]),l(h,{error:s.FormError.pembayaran},null,8,["error"])])):w("",!0),Qe,e("div",We,[l(m,null,{default:n(()=>[d("Total PO")]),_:1}),v(l(D,{disabled:"",id:"total_po",type:"text",modelValue:s.item.total_po,"onUpdate:modelValue":t[7]||(t[7]=i=>s.item.total_po=i),class:g({"p-invalid":s.FormError.total_po})},null,8,["modelValue","class"]),[[y]]),l(h,{error:s.FormError.total_po},null,8,["error"])]),e("div",Xe,[l(m,null,{default:n(()=>[d("Sisa Tagihan")]),_:1}),v(l(D,{disabled:"",id:"sisa_tagihan",type:"text",modelValue:s.item.sisa_tagihan,"onUpdate:modelValue":t[8]||(t[8]=i=>s.item.sisa_tagihan=i),class:g({"p-invalid":s.FormError.sisa_tagihan})},null,8,["modelValue","class"]),[[y]]),l(h,{error:s.FormError.sisa_tagihan},null,8,["error"])]),e("div",et,[l(m,{required:""},{default:n(()=>[d("Bayar")]),_:1}),v(l(D,{id:"bayar",type:"text",modelValue:s.item.bayar,"onUpdate:modelValue":t[9]||(t[9]=i=>s.item.bayar=i),class:g({"p-invalid":s.FormError.bayar})},null,8,["modelValue","class"]),[[y]]),l(h,{error:s.FormError.bayar},null,8,["error"])]),e("div",tt,[l(m,{for:"pajak"},{default:n(()=>[d("Pajak")]),_:1}),l(N,{inputId:"pajak",modelValue:s.item.is_pajak,"onUpdate:modelValue":t[10]||(t[10]=i=>s.item.is_pajak=i)},null,8,["modelValue"]),l(h,{error:s.FormError.bayar},null,8,["error"])])]),e("div",st,[ot,e("div",lt,[s.item.status=="C"?(p(),K(P,{key:0,style:{float:"right"},label:"Jurnal",class:g(["p-button mx-2",{"p-button-block":o.filter,"p-button-outlined":!o.filter}]),onClick:t[11]||(t[11]=i=>s.jurnalDialog=!0)},null,8,["class"])):w("",!0),it,s.item.status=="D"?(p(),f("div",at,[l(L,{loading:o.$isLoading.value,data:s.item,onClick:t[12]||(t[12]=i=>c.Save("D")),onClose:t[13]||(t[13]=i=>c.Save("C")),showClose:s.item.status!="C"},null,8,["loading","data","showClose"])])):w("",!0)])])]),l(C,{visible:s.closingDialog,"onUpdate:visible":t[16]||(t[16]=i=>s.closingDialog=i),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[l(P,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[14]||(t[14]=i=>s.closingDialog=!1)}),l(P,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t[15]||(t[15]=i=>c.Save("C"))})]),default:n(()=>[e("div",rt,[nt,s.item?(p(),f("span",dt,[d("Are you sure you want to close this "),e("b",null,a(s.item.nomor),1),d("?")])):w("",!0)])]),_:1},8,["visible"]),l(C,{visible:s.jurnalDialog,"onUpdate:visible":t[17]||(t[17]=i=>s.jurnalDialog=i),modal:!0},{default:n(()=>[l(A)]),_:1},8,["visible"])])])}const ft=E(Fe,[["render",ut]]);export{ft as default};
