import{D as b,G as T,_ as W,y as X,x as Z,F as $,r as m,A as tt,o as l,c as p,b as a,d as r,l as k,e as g,k as v,n as L,m as S,q as N,B as j,t as h,f as A}from"./index-11eb6111.js";import{a as x}from"./paymentar-110b431d.js";import{M as et}from"./ModalJurnal-5f84a831.js";import"./custom-zod-e9521e5d.js";import{A as it}from"./index-b9e295bc.js";import{z as _}from"./index-0ec66d4d.js";const M={index(e){return b.get("/acc-ar-faktur?"+T.stringify(e))},indexByCustomer(e){return b.get("/acc-ar-faktur/customer?"+T.stringify(e))},indexByDate(e){return b.get(`/acc-ar-faktur/tanggal/${e}`)},store(e){return b.post("/acc-ar-faktur/",e)},update(e,t){return b.patch("/acc-ar-faktur/"+e,t)},show(e){return b.get("/acc-ar-faktur/"+e)},destroy(e){return b.delete("/acc-ar-faktur/"+e)},getUmurInvoice(){return b.get("/report/umur-invoice-ar")}},at=_.object({number:_.string().nullish(),id_customer:_.number().positive(),date:_.date(),bank_account:_.number().positive(),description:_.string(),detail:_.array(_.object({invoice:_.string().max(100),ar_amount:_.number().gte(0),discount:_.number().gte(0),discountpersen:_.number().gte(0),amount:_.number().positive().gt(0)})).min(1,{message:"Minimal satu Invoice Dibayar"})}),st={components:{ModalJurnal:et},data(){return{settingStore:X(),akunStore:Z(),item:{id:null,number:null,date:null,id_customer:null,status:null,other_cost:0,total:null,bank_account:null,description:null,detail:[{id:null,invoice:null,ar_amount:null,discount:null,discountpersen:null,amount:null}]},lAccArF:[],selectedAccArF:[],filterAccArF:[],columns:[{field:"invoice",header:"Invoice"},{field:"date",header:"Tanggal",type:"date"},{field:"ar_amount",header:"Jumlah",type:"currency"},{field:"discountpersen",header:"Diskon (%)"},{field:"discount",header:"Diskon (Rp)",type:"currency"},{field:"amount",header:"Bayar",type:"currency"}],status:null,isClean:!0,isEdit:!1,closingDialog:!1,showPersetujuanDialog:!1,jurnalDialog:!1,filters:{global:{value:null,matchMode:$.CONTAINS}}}},computed:{FormItem(){return{...this.item,status:this.status,jurnal:this.jurnal,detail:this.item.detail.filter(e=>e.invoice!=null)}},FormError(){var e,t;return this.isClean?{}:((t=(e=at.safeParse(this.FormItem))==null?void 0:e.error)==null?void 0:t.format())||{}},total(){return this.item.detail.reduce((e,t)=>e+parseFloat(t.amount||0),0)+parseFloat(this.item.other_cost||0)},canPersetujuan(){var o;const e=(o=this.item.persetujuan)==null?void 0:o.find(d=>d.id_pegawai==this.$auth.id&&d.tanggal_persetujuan==null),t=e?this.item.persetujuan.find(d=>d.urut<e.urut&&d.status===!0):null;return e&&(t||(e==null?void 0:e.urut)==1)},jurnal(){var d;const e=[];if(this.total&&this.item.bank_account){const i=this.akunStore.getAkunById(this.item.bank_account);e.push({id_account:i.id,account_name:i.name,account_code:i.code,is_debit:!0,amount:this.total})}const t=this.item.detail.filter(i=>i.invoice!=null).reduce((i,n)=>i+parseFloat(n.discount||0),0);if(t){const i=this.akunStore.getAkunById(245);e.push({id_account:i.id,account_name:i.name,account_code:i.code,is_debit:!0,amount:t})}const o=this.item.detail.filter(i=>i.invoice!=null).reduce((i,n)=>i+parseFloat(n.amount||0),0);if(o&&(d=this.item)!=null&&d.akun_piutang){const i=this.akunStore.getAkunById(this.item.akun_piutang);e.push({id_account:i.id,account_name:i.name,account_code:i.code,is_debit:!1,amount:o+t})}if(parseFloat(this.item.other_cost)){const i=this.akunStore.getAkunById(234);e.push({id_account:i.id,account_name:i.name,account_code:i.code,is_debit:!1,amount:parseFloat(this.item.other_cost)})}return e}},watch:{total(e){this.item.total=e}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.getData().then(()=>{this.isEdit&&this.getPaymentAr(),this.item.date=new Date}).finally(()=>{this.$timeoutLoading()})},methods:{onCellEditComplete(e){let{data:t,newValue:o,field:d}=e;switch(d){case"invoice":if(typeof o=="string"||o==null){this.tambahDetail();break}t.amount=parseFloat(o.sisa),t.ar_amount=parseFloat(o.sisa),t.discountpersen=0,t.discount=0,t.date=new Date(o.invoice_date),t[d]=o.invoice,this.tambahDetail();break;case"discountpersen":if(typeof o!="number"||o==null)return;t[d]=o,t.discount=t.ar_amount*t.discountpersen/100,t.amount=t.ar_amount-t.discount;break;case"discount":if(typeof o!="number"||o==null)return;t[d]=o,t.discountpersen=parseFloat((t.discount/parseFloat(t.ar_amount)*100).toFixed(2)),t.amount=t.ar_amount-t.discount;break;default:t[d]=o;break}},async getData(){},async Save(e="D"){try{if(this.$isLoading.value=!0,this.isClean=!1,this.status=e,Object.keys(this.FormError).length>0){this.$timeoutLoading();return}this.isEdit?await x.update(this.item.id,this.FormItem).then(t=>{this.item.status=t.data.data.status,this.item.persetujuan=t.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Success",detail:t.data.message,life:3e3}),this.isClean=!0}):await x.store(this.FormItem).then(t=>{this.item.id=t.data.data.id,this.item.number=t.data.data.number,this.item.status=t.data.data.status,this.item.persetujuan=t.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Success",detail:t.data.message,life:3e3}),this.isClean=!0,this.isEdit=!0,setTimeout(()=>{this.$router.replace({name:"paymentar.edit",params:{id:this.item.id}})},1e3)})}catch(t){t instanceof it&&this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3}),console.log(t)}finally{this.closingDialog=!1,this.$timeoutLoading()}},async submitPersetujuan(e=!1){const t={id:this.item.id,status:e,keterangan:this.item.keterangan};this.$isLoading.value=!0,await x.updatePersetujuan(t).then(o=>{this.item.status=o.data.data.update_status||this.item.status,this.item.persetujuan.forEach(d=>{d.urut==o.data.data.urut&&(d.tanggal_persetujuan=o.data.data.tanggal_persetujuan,d.status=o.data.data.status,d.keterangan=o.data.data.keterangan)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Update persetujuan",life:3e3}),this.showPersetujuanDialog=!1}).catch(o=>{this.$toast.add({severity:"error",summary:"Error",detail:o,life:3e3})}).finally(()=>{this.$timeoutLoading()}),this.showPersetujuanDialog=!1},confirmApprove(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!0},confirmReject(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!1},Destroy(e){this.item.detail.length!=1&&(this.item.detail=this.item.detail.filter(t=>t!==e))},submitApprove(){this.Save("A")},async getPaymentAr(){await x.show(this.$route.params.id).then(async e=>{this.item=e.data.data,this.item.date=new Date(e.data.data.date),this.item.detail=this.item.detail.map(t=>({...t,discount:parseFloat(t.discount),ar_amount:parseFloat(t.ar_amount),amount:parseFloat(t.amount),discountpersen:parseFloat(t.discount)/parseFloat(t.ar_amount)*100})),await M.indexByCustomer({kontak:this.item.id_customer}).then(t=>{this.lAccArF=t.data.data})}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})},async selectCustomer(e){this.item.detail=[],this.tambahDetail(),this.item.akun_piutang=e.value.akun_piutang,this.item.kontak=e.value.kontak,this.item.description=`Pembayaran Piutang Usaha, "${e.value.kontak}"`,await M.indexByCustomer({kontak:this.item.id_customer}).then(t=>{this.lAccArF=t.data.data})},searchAccArF(e){setTimeout(()=>{this.filterAccArF=e.query.trim().length?this.lAccArF.filter(t=>t.invoice.toLowerCase().includes(e.query.toLowerCase())&&!this.item.detail.map(o=>o.invoice).includes(t.invoice)):[...this.lAccArF]},250)},searchAllAccArF(){setTimeout(()=>{this.filterAccArF=this.lAccArF.filter(e=>!this.item.detail.map(t=>t.invoice).includes(e.invoice))},250)},tambahDetail(){this.item.detail.some(e=>e.invoice==null)||this.item.detail.push({id:null,invoice:null,ar_amount:null,discount:null,discountpersen:null,amount:null})},Cetak(){this.$router.push({name:"paymentar.print",params:{id:this.id}})},splitButton(){return[{label:"Approve",icon:"pi pi-refresh",command:()=>{this.submitApprove()}}]}}},ot={class:"grid"},nt={class:"col-12"},lt={class:"card"},rt={class:"p-fluid formgrid grid"},ut={class:"field col-12 md:col-3"},ct={class:"field col-12 md:col-3"},dt=a("div",{class:"col-12"},null,-1),mt={class:"field col-12 md:col-3"},ht={class:"field col-12 md:col-3"},pt={class:"field col-12 md:col-12"},gt={class:"col-12 my-4"},_t={key:0},ft={key:1},vt={key:2,class:"text-right"},yt={key:3},bt={class:"formgrid grid"},kt={class:"col-12 md:col-6"},At={class:"col-12 md:col-6 text-right text-green-500"},Ct={class:"col-12 md:col-12"},Dt={key:1},Ft={key:3,class:"text-right"},jt=a("div",{class:"col-12 md:col-8"},null,-1),xt={class:"field col-12 md:col-4"},wt={class:"grid formdgrid py-3 justify-content-center align-items-center"},Vt=a("div",{class:"col-6"},"Biaya Lain",-1),St={class:"col-6"},Pt={class:"grid py-3 justify-content-center align-items-center"},Et=a("div",{class:"col-12"},[a("hr")],-1),Ut=a("div",{class:"col-6"},"Total",-1),It={class:"col-6 text-right"},Bt=a("div",{class:"col-12"},null,-1),Tt={key:0,class:"p-datatable col-6"},Lt={class:"p-datatable-table p-datatable-striped"},Nt=a("thead",{class:"p-datatable-thead"},[a("tr",{role:"row"},[a("th",{colspan:"7",class:"text-left"},"Harus Disetujui Oleh:")]),a("tr",null,[a("th",null,"No"),a("th",null,"Nama"),a("th",null,"Jabatan"),a("th",null,"Tanggal"),a("th",null,"Status"),a("th",null,"Keterangan")])],-1),Mt={class:"p-datatable-tbody"},qt={key:0},Jt={key:1},Rt={key:2},zt={class:"grid"},Ot={class:"col-6"},Yt={class:"flex flex-wrap gap-3 justify-content-start"},Kt={class:"col-6"},Ht={class:"flex flex-wrap gap-3 justify-content-end"},Gt={class:"flex flex-column align-items-center justify-content-center"},Qt=a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Wt={key:0},Xt=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"Masukkan Catatan")],-1);function Zt(e,t,o,d,i,n){var U,I,B;const q=m("Toast"),J=m("Tag"),C=m("Label"),w=m("InputText"),R=m("AutoCompleteKontak"),z=m("AutoCompleteAkun"),O=m("Calendar"),V=m("ErrorMsg"),Y=m("AutoComplete"),D=m("InputNumber"),P=m("Column"),y=m("Button"),K=m("DataTable"),H=m("SubmitButton"),E=m("Dialog"),G=m("Textarea"),Q=m("ModalJurnal"),F=tt("select-all-text");return l(),p("div",ot,[a("div",nt,[a("div",lt,[r(q),a("h5",null,[k(" Pembayaran Piutang "),r(J,{style:{float:"right"},value:e.$h.getLabel(i.item.status),severity:e.$h.getLabel(i.item.status)},null,8,["value","severity"])]),a("div",rt,[a("div",ut,[r(C,{required:""},{default:g(()=>[k("Pelanggan")]),_:1}),i.item.status=="C"?(l(),v(w,{key:0,value:i.item.kontak,disabled:""},null,8,["value"])):(l(),v(R,{key:1,modelValue:i.item.id_customer,"onUpdate:modelValue":t[0]||(t[0]=s=>i.item.id_customer=s),"is-customer":"",onSelectItem:n.selectCustomer,error:n.FormError.id_customer,showLabel:!1},null,8,["modelValue","onSelectItem","error"]))]),a("div",ct,[r(z,{modelValue:i.item.bank_account,"onUpdate:modelValue":t[1]||(t[1]=s=>i.item.bank_account=s),label:"Account",forceSelection:"",error:n.FormError.bank_account,cashable:""},null,8,["modelValue","error"])]),dt,a("div",mt,[r(C,{for:"date",required:""},{default:g(()=>[k("Tanggal")]),_:1}),r(O,{modelValue:i.item.date,"onUpdate:modelValue":t[2]||(t[2]=s=>i.item.date=s),inputId:"date",maxDate:e.$h.today,class:L(n.FormError.date&&"p-invalid")},null,8,["modelValue","maxDate","class"]),r(V,{error:n.FormError.date},null,8,["error"])]),a("div",ht,[r(C,{for:"noproposal"},{default:g(()=>[k("Nomor")]),_:1}),r(w,{modelValue:i.item.number,"onUpdate:modelValue":t[3]||(t[3]=s=>i.item.number=s),modelModifiers:{trim:!0},id:"noproposal",disabled:""},null,8,["modelValue"])]),a("div",pt,[r(C,{for:"Notes"},{default:g(()=>[k("Keterangan")]),_:1}),r(w,{modelValue:i.item.description,"onUpdate:modelValue":t[4]||(t[4]=s=>i.item.description=s),modelModifiers:{trim:!0},id:"Notes",class:L(n.FormError.description&&"p-invalid")},null,8,["modelValue","class"]),r(V,{error:n.FormError.description},null,8,["error"])]),a("div",gt,[r(K,{filters:i.filters,"onUpdate:filters":t[5]||(t[5]=s=>i.filters=s),value:i.item.detail,compareSelectionBy:"deepEquals",editMode:"cell",onCellEditComplete:n.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{default:g(()=>[(l(!0),p(S,null,N(i.columns,s=>(l(),v(P,{key:s.field,field:s.field,header:s.header},{body:g(({data:u,field:c})=>[c=="invoice"?(l(),p("div",_t,h(u[c]),1)):s.type=="date"?(l(),p("div",ft,h(e.$h.formatDate(u[c])),1)):s.type=="currency"?(l(),p("div",vt,h(e.$h.formatNumber(u[c])),1)):(l(),p("div",yt,h(u[c]),1))]),editor:g(({data:u,field:c})=>[c=="invoice"?(l(),v(Y,{key:0,class:"min-w-max",modelValue:u[c],"onUpdate:modelValue":f=>u[c]=f,suggestions:i.filterAccArF,optionLabel:"invoice",virtualScrollerOptions:{itemSize:50},onComplete:n.searchAccArF,onDropdownClick:n.searchAllAccArF,dropdown:""},{option:g(({option:f})=>[a("div",bt,[a("div",kt,h(e.$h.formatDate(f.invoice_date)),1),a("div",At,h(e.$h.formatNumber(f.sisa)),1),a("div",Ct,h(f.invoice),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):c=="date"?(l(),p("div",Dt,h(e.$h.formatDate(u[c])),1)):c=="amount"?j((l(),v(D,{key:2,modelValue:u[c],"onUpdate:modelValue":f=>u[c]=f,autofocus:"",inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,max:u.sisa,class:"min-w-max",inputClass:"text-right"},null,8,["modelValue","onUpdate:modelValue","max"])),[[F]]):c=="ar_amount"?(l(),p("div",Ft,h(e.$h.formatNumber(u[c])),1)):c=="discount"?j((l(),v(D,{key:4,inputClass:"text-right",modelValue:u[c],"onUpdate:modelValue":f=>u[c]=f,autofocus:"",inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,max:u.sisa,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","max"])),[[F]]):c=="discountpersen"?j((l(),v(D,{key:5,modelValue:u[c],"onUpdate:modelValue":f=>u[c]=f,autofocus:"",inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,max:100,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[F]]):(l(),p(S,{key:6},[k(h(u[c]),1)],64))]),_:2},1032,["field","header"]))),128)),r(P,{header:"#",headerStyle:"width:5%;"},{body:g(({data:s})=>[r(y,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:u=>n.Destroy(s)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","onCellEditComplete"]),r(V,{error:n.FormError.detail},null,8,["error"])]),jt,a("div",xt,[a("div",wt,[Vt,a("div",St,[j(r(D,{modelValue:i.item.other_cost,"onUpdate:modelValue":t[6]||(t[6]=s=>i.item.other_cost=s),inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,class:"w-full",inputClass:"text-right"},null,8,["modelValue"]),[[F]])])]),a("div",Pt,[Et,Ut,a("div",It,h(e.$h.formatNumber(n.total)),1)])]),Bt]),((U=i.item.persetujuan)==null?void 0:U.length)>0&&!this.$route.query.revisi?(l(),p("div",Tt,[a("table",Lt,[Nt,a("tbody",Mt,[(l(!0),p(S,null,N(i.item.persetujuan,(s,u)=>(l(),p("tr",{key:u},[a("td",null,h(u+1),1),a("td",null,h(s.nama),1),a("td",null,h(s.jabatan),1),a("td",null,h(e.$h.formatDate(s.tanggal_persetujuan,"DD-MM-YYYY HH:mm:ss")),1),s.tanggal_persetujuan!=null&&!s.status?(l(),p("td",qt,"Reject")):s.tanggal_persetujuan!=null&&s.status?(l(),p("td",Jt,"Approve")):(l(),p("td",Rt,"Menunggu Persetujuan")),a("td",null,h(s.keterangan),1)]))),128))])])])):A("",!0),a("div",zt,[a("div",Ot,[a("div",Yt,[i.item.status=="A"?(l(),v(y,{key:0,label:"Print",severity:"help",icon:"pi pi-print",iconPos:"left",onClick:n.Cetak},null,8,["onClick"])):A("",!0),r(y,{label:"Jurnal",severity:"help",iconPos:"left",icon:"pi pi-print",onClick:t[7]||(t[7]=s=>i.jurnalDialog=!0)})])]),a("div",Kt,[a("div",Ht,[!n.canPersetujuan&&!((B=(I=i.item.persetujuan)==null?void 0:I[0])!=null&&B.tanggal_persetujuan)&&i.item.status!="C"?(l(),v(H,{key:0,loading:e.$isLoading.value,data:i.item,onClick:t[8]||(t[8]=s=>{var u;return n.Save((u=i.settingStore.penjualan.persetujuan.payment)!=null&&u.persetujuan1?"S":"C")}),onDraft:t[9]||(t[9]=s=>n.Save("D")),showDraft:i.item.status==null||i.item.status=="D"},null,8,["loading","data","showDraft"])):A("",!0),i.item.status=="S"&&n.canPersetujuan?(l(),v(y,{key:1,label:"Reject",severity:"danger",iconPos:"right",icon:"pi pi-times",onClick:n.confirmReject,class:"mx-2"},null,8,["onClick"])):A("",!0),i.item.status=="S"&&n.canPersetujuan?(l(),v(y,{key:2,label:"Approve",severity:"success",iconPos:"right",icon:"pi pi-check",onClick:n.confirmApprove},null,8,["onClick"])):A("",!0)])])]),r(E,{visible:i.closingDialog,"onUpdate:visible":t[12]||(t[12]=s=>i.closingDialog=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:g(()=>[r(y,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[10]||(t[10]=s=>i.closingDialog=!1)}),r(y,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t[11]||(t[11]=s=>n.Save("C"))})]),default:g(()=>[a("div",Gt,[Qt,i.item?(l(),p("span",Wt,[k("Are you sure you want to close this "),a("b",null,h(i.item.number),1),k("?")])):A("",!0)])]),_:1},8,["visible"]),r(E,{visible:i.showPersetujuanDialog,"onUpdate:visible":t[16]||(t[16]=s=>i.showPersetujuanDialog=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:g(()=>[r(y,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:t[14]||(t[14]=s=>i.showPersetujuanDialog=!1)}),r(y,{label:e.isApprove?"Approve":"Reject",icon:"pi pi-check",class:"p-button-text",onClick:t[15]||(t[15]=s=>n.submitPersetujuan(e.isApprove))},null,8,["label"])]),default:g(()=>[Xt,r(G,{class:"w-full",modelValue:i.item.keterangan,"onUpdate:modelValue":t[13]||(t[13]=s=>i.item.keterangan=s),rows:"5",cols:"30",placeholder:"Optional"},null,8,["modelValue"])]),_:1},8,["visible"]),r(Q,{visible:i.jurnalDialog,"onUpdate:visible":t[17]||(t[17]=s=>i.jurnalDialog=s),value:n.jurnal,"onUpdate:value":t[18]||(t[18]=s=>n.jurnal=s)},null,8,["visible","value"])])])])}const oe=W(st,[["render",Zt]]);export{oe as default};
