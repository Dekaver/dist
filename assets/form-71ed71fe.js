import{a as K}from"./options-b2eb7ae6.js";import{a as le}from"./satuan-84ad7de8.js";import{a as E}from"./api-e3a7587b.js";import{a as se}from"./pajak-69cfe91a.js";import{A as ie}from"./index-b9e295bc.js";import{_ as ne,y as oe,r as _,A as re,o as c,c as g,b as a,l as f,t as p,d,e as k,n as V,m as D,q as F,B as U,f as b,k as y}from"./index-11eb6111.js";import"./custom-zod-e9521e5d.js";/* empty css                                */import{z as u}from"./index-0ec66d4d.js";const M=u.object({nomor:u.string().nullish(),tanggal:u.date(),id_customer:u.number(),kepada:u.string().nullish(),keterangan:u.string().nullish(),total:u.number().gte(0).nonnegative(),total_discount:u.number().gte(0),id_salesman:u.number(),id_gudang:u.number(),dpp:u.number().gte(0).nonnegative(),grandtotal:u.number().gte(0).nonnegative(),telepon:u.string(),hp:u.string().nullish(),email:u.string().email(),diskonpersen:u.number().gte(0).nonnegative(),syarat:u.string().nullish(),id_top:u.number().int().positive()}),R=u.object({type:u.string(),id_barang:u.number().nullish(),kode_barang:u.string().nullish(),nama_barang:u.string().min(1),id_satuan:u.number(),qty:u.number().gte(0).nonnegative(),harga:u.number().gte(0).nonnegative(),diskonpersen:u.number().gte(0).nonnegative(),diskonrp:u.number().gte(0).nonnegative(),pajak:u.string().nullish(),id_pajak:u.string().nullish(),persen_pajak:u.string().nullish(),total:u.number().gte(0).nonnegative(),note:u.string().nullish()}),de=M.extend({status:u.literal("D"),detail:u.array(R).min(1,"Produk/Jasa Required")}),J=M.extend({status:u.literal("O"),detail:u.array(R.extend({qty:u.number().gt(0).nonnegative(),harga:u.number().gt(0).nonnegative(),total:u.number().gt(0).nonnegative()})).min(1,"Produk/Jasa Required")}),ue=J.extend({status:u.literal("S")}),me=u.discriminatedUnion("status",[de,J,ue]),ce={data(){return{settingStore:oe(),item:{diskonpersen:0,valid:0,top:0,total:0,dpp:0,total_discount:0,discount_baris:0,grandtotal:0,tanggal:null,keterangan:"",id_customer:null,customer:null,telepon:null,kepada:null,hp:null,email:null,id_gudang:null,id_salesman:null,salesman:null,status:null,detail:[{type:"produk",kode_barang:null,id_satuan:null,nama_barang:null,note:null,qty:null,harga:null,diskonpersen:null,diskonrp:null,pajak:null,id_pajak:null,persen_pajak:null,total:null,selectedPajak:[],optionSatuan:[]}]},nullDetail:null,lSalesman:[],filteredSalesman:[],selectedSalesman:null,lProduk:[],filteredlProduk:[],selectedProduk:null,lPajak:[],selectedAllPajak:[],lSatuan:[],optionSatuan:[],columns:[{field:"nama_barang",header:"Produk/Jasa",width:"width:15%",class:"left"},{field:"note",header:"Deskripsi",width:"width:15%",class:"left"},{field:"qty",header:"Kuantitas",width:"width:auto",class:"left",type:"number"},{field:"selectedSatuan",header:"Satuan",width:"width:10%",class:"left"},{field:"harga",header:"Harga",width:"width:max-content;",class:"right",type:"currency"},{field:"diskonpersen",header:"Diskon %",width:"width:auto",class:"left"},{field:"selectedPajak",header:"Pajak",width:"width:10%",class:"right"},{field:"total",header:"Total",width:"width:15%",class:"right",type:"currency"}],showPersetujuanDialog:!1,filters:{},cancelDialog:!1,status:null,isClean:!0,isEdit:!1}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.getData().then(()=>{this.isEdit?this.getQuotation():(this.getSalesman(),this.item.tanggal=new Date)}).finally(()=>{this.$timeoutLoading()}),window.addEventListener("keydown",this.shortCut)},beforeUnmount(){window.removeEventListener("keydown",this.shortCut)},computed:{subtotal(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total||0),0)},total_discount(){return this.subtotal*(this.item.diskonpersen||0)/100},dpp(){return this.subtotal-this.total_discount},grandtotal(){return this.dpp+this.selectedPajakDetail.reduce((t,e)=>t+e.nilai,0)},selectedPajakDetail(){const t=[];return this.item.detail.forEach(e=>{const i=e.total;e.selectedPajak!=null&&e.selectedPajak.forEach(m=>{const s={};s.id=m.id,s.nama=m.nama,s.nilai=(i-i*(this.item.diskonpersen||0)/100)*m.nilai/100;let n=-1;for(let w=0;w<t.length;w++)if(t[w].nama===s.nama){n=w;break}n==-1?t.push(s):t[n].nilai+=s.nilai})}),t},FormItem(){return{...this.item,status:this.status,detail:this.item.detail.filter(t=>t.nama_barang!=null)}},FormError(){var t,e;return this.isClean?{}:((e=(t=me.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}},canPersetujuan(){var i;const t=(i=this.item.persetujuan)==null?void 0:i.find(m=>m.id_pegawai==this.$auth.id&&m.tanggal_persetujuan==null),e=t?this.item.persetujuan.find(m=>m.urut<t.urut&&m.status===!0):null;return t&&(e||(t==null?void 0:t.urut)==1)},lPajakSelection(){return this.settingStore.penjualan.pajak=="b"?this.lPajak.filter(t=>this.settingStore.penjualan.id_pajak.some(e=>e==t.id)).map(t=>({...t,is_selected:t.is_selected||!1})):[]}},methods:{getColumnDetail(){return this.columns.filter(t=>t.field=="diskonpersen"?this.settingStore.penjualan.diskon_per_baris:t.field=="selectedPajak"?this.settingStore.penjualan.pajak=="a":t.field=="selectedProyek"?!!this.settingStore.penjualan.proyek:!0)},onCellEditComplete(t){let{data:e,newValue:i,field:m}=t;switch(m){case"nama_barang":if(typeof i=="string"||i==null){e.type=="jasa"&&(e[m]=i,this.tambahDetail());return}e.id_satuan=i.id_satuan,e.diskonpersen=0,e.diskonrp=0,e.option_satuan=i.option_satuan,e.selectedSatuan=e.option_satuan.find(s=>s.id==i.id_satuan),e.qty=0,e.harga=parseFloat(i.harga_jual),e.total=e.qty*(e.harga-e.diskonrp),e.kode_barang=i.kode_barang,e.id_barang=i.id,e[m]=i.nama_barang,this.tambahDetail();break;case"selectedSatuan":if(!i)return;e[m]=i,e.id_satuan=i.id,e.harga=e.harga/i.konversi*(t.value?t.value.konversi:1),e.diskonrp=e.diskonpersen*e.harga/100,e.total=e.qty*(e.harga-e.diskonrp);break;case"selectedPajak":e[m]=i,e.pajak=i.map(s=>s.nama).join(),e.id_pajak=i.map(s=>s.id).join(),e.persen_pajak=i.map(s=>s.nilai).join();break;case"qty":e[m]=typeof i=="number"?i:0,e.total=e.qty*(e.harga-e.diskonrp);break;case"harga":e[m]=i,e.diskonrp=e.harga*e.diskonpersen/100,e.total=e.qty*(e.harga-e.diskonrp);break;case"diskonpersen":e[m]=i||0,e.diskonrp=e.harga*i/100,e.total=e.qty*(e.harga-e.diskonrp);break;case"diskonrp":e[m]=i||0,e.diskonpersen=parseFloat(i/e.harga*100).toFixed(2),e.total=e.qty*(e.harga-e.diskonrp);break;case"note":e[m]=i;break}},async Save(t="D"){try{if(this.$isLoading.value=!0,this.item.total=this.subtotal,this.item.dpp=this.dpp,this.item.grandtotal=this.grandtotal,this.item.total_discount=this.total_discount,this.status=t,this.item.pajak=this.selectedPajakDetail,this.isClean=!1,Object.keys(this.FormError).length>0){this.$timeoutLoading();return}this.isEdit?await E.update(this.item.id,this.FormItem).then(e=>{this.item.status=t,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3})}):await E.store(this.FormItem).then(e=>{this.item.id=e.data.data.id,this.item.nomor=e.data.data.nomor,this.item.persetujuan=e.data.data.persetujuan,this.item.status=t,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),this.isEdit=!0,setTimeout(()=>{this.$router.replace({name:"quotation.edit",params:{id:e.data.data.id}})},1e3)}),this.item.status=="D",this.item.status=="O",this.item.status==null&&this.tambahDetail()}catch(e){e instanceof ie&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})}finally{this.$timeoutLoading()}},async submitPersetujuan(t=!1){const e={id:this.item.id,status:t,keterangan:this.item.keterangan};this.$isLoading.value=!0,await E.updatePersetujuan(e).then(i=>{this.item.status=i.data.data.status_pr?i.data.data.status_pr:this.item.status,this.item.persetujuan.forEach(m=>{m.urut==i.data.data.urut&&(m.tanggal_persetujuan=i.data.data.tanggal_persetujuan,m.status=i.data.data.status,m.keterangan=i.data.data.keterangan)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Update persetujuan",life:3e3}),this.showPersetujuanDialog=!1}).catch(i=>{this.$toast.add({severity:"error",summary:"Error",detail:i,life:3e3})}).finally(()=>{this.$timeoutLoading()}),this.showPersetujuanDialog=!1},confirmApprove(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!0},confirmReject(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!1},async getQuotation(){await E.show(this.item.id).then(t=>{this.item=t.data.data,this.item.diskonpersen=parseFloat(t.data.data.diskonpersen),this.item.id_salesman!=null&&(this.selectedSalesman=this.lSalesman.find(e=>e.id==this.item.id_salesman)),this.item.tanggal=new Date(t.data.data.tanggal),this.item.detail.forEach(e=>{if(e.id_barang){const m=this.lProduk.find(s=>s.id==e.id_barang);e.option_satuan=m.option_satuan,e.selectedSatuan=e.option_satuan.find(s=>s.id==e.id_satuan)}else e.option_satuan=[],e.selectedSatuan=this.lSatuan.find(m=>m.id==e.id_satuan);if(e.qty=parseFloat(e.qty),e.harga=parseFloat(e.harga),e.diskonpersen=parseFloat(e.diskonpersen),e.diskonrp=parseFloat(e.diskonrp),e.total=parseFloat(e.total),!e.id_pajak)return;const i=this.lPajak.filter(m=>e.id_pajak.split(",").includes(m.id.toString()));e.selectedPajak=i,e.pajak=i.map(m=>m.nama).join(),e.id_pajak=i.map(m=>m.id).join(),e.persen_pajak=i.map(m=>m.nilai).join()}),this.settingStore.penjualan.pajak=="b"&&(this.lPajak=this.lPajak.map(e=>{var i,m;return{...e,is_selected:(m=(i=this.item.detail[0])==null?void 0:i.selectedPajak)==null?void 0:m.some(s=>s.id==e.id)}})),(this.item.status==null||this.item.status=="D"||this.item.status=="O")&&this.tambahDetail()})},getSalesman(){this.selectedSalesman=this.lSalesman.find(t=>t.id==this.$auth.id),this.selectedSalesman!=null&&(this.item.id_salesman=this.selectedSalesman.id,this.item.salesman=this.selectedSalesman.name)},async getData(){try{await K.getPegawai().then(t=>{this.lSalesman=t.data.data}).catch(()=>{}),await K.getProduk().then(t=>{this.lProduk=t.data.data}).catch(()=>{}),await se.index().then(t=>{this.lPajak=t.data.data}).catch(()=>{}),await le.index().then(t=>{this.lSatuan=t.data.data}).catch(()=>{})}catch(t){console.error(t)}},selectAllPajak(t){this.item.detail.forEach(e=>{e.selectedPajak=t.value,e.pajak=t.value.map(i=>i.nama).join(),e.id_pajak=t.value.map(i=>i.id).join(),e.persen_pajak=t.value.map(i=>i.nilai).join()})},searchSalesman(t){setTimeout(()=>{this.filteredSalesman=t.query.trim().length?this.lSalesman.filter(e=>e.nama.toLowerCase().includes(t.query.toLowerCase())):[...this.lSalesman]},250)},selectCustomer(t){this.item.id_customer=t.value.id,this.item.customer=t.value.kontak,this.item.telepon=t.value.telepon,this.item.hp=t.value.hp,this.item.kepada=t.value.attention,this.item.email=t.value.email,this.item.top=t.value.top,this.item.id_top=t.value.id_top,this.item.deliverypoint=t.value.alamat_kirim,this.item.keterangan=`Penawaran Kepada ${t.value.kontak}`},selectSalesman(t){this.item.id_salesman=t.value.id},clearSalesman(){this.item.id_salesman=null},searchProduk(t){setTimeout(()=>{this.filteredlProduk=t.query.trim().length?this.lProduk.filter(e=>e.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())&&!this.item.detail.some(i=>i.nama_barang==e.nama_barang)):[...this.lProduk]},250)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(t=>!this.item.detail.some(e=>e.nama_barang==t.nama_barang))},250)},changePajakSelection(){this.item.detail.forEach(t=>{const e=this.lPajakSelection.filter(i=>i.is_selected);t.selectedPajak=this.lPajakSelection.filter(i=>i.is_selected),t.pajak=e.map(i=>i.nama).join(),t.id_pajak=e.map(i=>i.id).join(),t.persen_pajak=e.map(i=>i.nilai).join()})},toggleSelectAllPajak(t){this.$refs.op_select_all_pajak.toggle(t)},removeDetail(t){this.item.detail.length!=1&&(this.item.detail=this.item.detail.filter(e=>e!==t))},tambahDetail(){this.item.detail.some(t=>t.nama_barang==null)||this.item.detail.push({...this.nullDetail})},switchType(t){const e=this.item.detail[t].type=this.item.detail[t].type=="produk"?"jasa":"produk";this.item.detail[t]={...this.nullDetail,type:e}},cetakPDF(){this.$router.push({name:"quotation.cetak",params:this.item.id})},shortCut(t){(t.ctrlKey||t.metaKey)&&t.key==="s"&&(this.$isLoading.value&&t.preventDefault(),t.preventDefault(),this.Save(this.item.status)),(t.ctrlKey||t.metaKey)&&t.key==="S"&&t.shiftKey&&(t.preventDefault(),this.Save("O"))}},filters:{pretty(t){return JSON.stringify(JSON.parse(t),null,2)}}},pe={class:"card"},he={class:"p-fluid formgrid grid"},ge={class:"field col-12 md:col-3"},_e={class:"field col-12 md:col-2"},ke={class:"field col-12 md:col-2"},ye={class:"field col-12 md:col-2"},fe=a("div",{class:"col-12"},null,-1),be={class:"field col-12 md:col-3 lg:col-3"},je={class:"field col-12 sm:col-6 md:col-3 lg:col-3"},ve={class:"field col-12 sm:col-6 md:col-3 lg:col-3"},Se={class:"field col-12"},we=a("div",{class:"col-12"},null,-1),Pe={class:"col-12 mt-4 mb-4"},Ve={class:"flex align-items-center gap-2"},De={class:"capitalize"},Ce={key:0},xe={key:1},Ee={key:0,class:"flex flex-column"},Fe={class:"text-green-500"},Ue={key:2},qe={key:3,style:{"text-align":"end"}},Le={key:4,style:{"text-align":"center"}},Ae={key:5},Te={class:"flex flex-column"},Ne={class:""},Ie={key:4,class:"text-right"},Oe={class:"grid col pb-0"},Be={class:"col py-1"},Ke={class:"col text-green-500 py-1"},Me={class:"col-12 md:col-6"},Re=a("span",{class:"ql-formats"},[a("button",{class:"ql-bold",type:"button"}),a("button",{class:"ql-italic",type:"button"}),a("button",{class:"ql-underline",type:"button"})],-1),Je=a("span",{class:"ql-formats"},[a("button",{class:"ql-list",value:"ordered",type:"button"}),a("button",{class:"ql-list",value:"bullet",type:"button"}),a("select",{class:"ql-align"},[a("option",{defaultValue:""}),a("option",{value:"center"}),a("option",{value:"right"}),a("option",{value:"justify"})])],-1),ze=a("br",null,null,-1),He=a("div",{class:"col"},null,-1),Ye={class:"col-12 md:col-6 xl:col-4"},Ge={class:"grid py-3 justify-content-center align-items-center"},Qe=a("div",{class:"col-7 md:col-6"},"Subtotal",-1),We={class:"col-5 md:col-6 text-right"},Xe={class:"grid py-3 justify-content-center align-items-center"},Ze=a("div",{class:"col-3 sm:col-2 md:col-2 lg:col-2"},"Diskon",-1),$e={class:"col-5 sm:col-4 md:col-5 lg:col-4"},et={class:"p-inputgroup"},tt=a("span",{class:"p-inputgroup-addon"},[a("i",{class:"pi pi-percentage"})],-1),at={class:"col-4 sm:col-6 md:col-5 lg:col-6 text-right"},lt={class:"grid py-3 justify-content-center align-items-center"},st=a("div",{class:"col-7 md:col-6"},"Total Setelah Diskon",-1),it={class:"col-5 md:col-6 text-right"},nt={key:0},ot={class:"col-4"},rt={class:"field col-4"},dt={class:"col-4 text-right"},ut={key:1},mt={class:"col-6"},ct={class:"col-6 text-right"},pt={class:"grid py-3 justify-content-center align-items-center"},ht=a("div",{class:"col-12"},[a("hr")],-1),gt=a("div",{class:"col-6"},"Grand Total",-1),_t={class:"col-6 text-right"},kt={key:0,class:"p-datatable col-6"},yt={class:"p-datatable-table p-datatable-striped"},ft=a("thead",{class:"p-datatable-thead"},[a("tr",{role:"row"},[a("th",{colspan:"7",class:"text-left"},"Harus Disetujui Oleh:")]),a("tr",null,[a("th",null,"No"),a("th",null,"Nama"),a("th",null,"Jabatan"),a("th",null,"Tanggal"),a("th",null,"Status"),a("th",null,"Keterangan")])],-1),bt={class:"p-datatable-tbody"},jt={key:0},vt={key:1},St={key:2},wt={class:"grid"},Pt={class:"col-6"},Vt={class:"flex flex-wrap gap-3 justify-content-start"},Dt={class:"col-6"},Ct={class:"flex flex-wrap gap-3 justify-content-end"},xt={class:"grid col pb-0"},Et={class:"col py-1"},Ft={class:"col text-green-500 py-1"},Ut=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"Masukkan Catatan")],-1);function qt(t,e,i,m,s,n){var I,O,B;const w=_("Tag"),z=_("AutoCompleteKontak"),v=_("Label"),P=_("InputText"),j=_("ErrorMsg"),H=_("InputTop"),Y=_("Calendar"),A=_("AutoComplete"),G=_("AutoCompleteGudang"),q=_("Textarea"),C=_("Column"),S=_("Button"),T=_("Dropdown"),L=_("InputNumber"),N=_("MultiSelect"),Q=_("DataTable"),W=_("Editor"),X=_("inputNumber"),Z=_("Checkbox"),$=_("SubmitButton"),ee=_("OverlayPanel"),te=_("Dialog"),x=re("select-all-text");return c(),g("div",pe,[a("h5",null,[f(p(this.isEdit?"Ubah":"Tambah")+" Penawaran ",1),d(w,{style:{float:"right"},value:t.$h.getLabel(s.item.status),severity:t.$h.getLabel(s.item.status)},null,8,["value","severity"])]),a("div",he,[a("div",ge,[d(z,{modelValue:s.item.id_customer,"onUpdate:modelValue":e[0]||(e[0]=l=>s.item.id_customer=l),"is-customer":"",onSelectItem:n.selectCustomer,error:n.FormError.id_customer,label:"Pelanggan"},null,8,["modelValue","onSelectItem","error"])]),a("div",_e,[d(v,{required:"",for:"hp"},{default:k(()=>[f("Telepon")]),_:1}),d(P,{modelValue:s.item.telepon,"onUpdate:modelValue":e[1]||(e[1]=l=>s.item.telepon=l),id:"hp",class:V(n.FormError.telepon&&"p-invalid")},null,8,["modelValue","class"]),d(j,{error:n.FormError.telepon},null,8,["error"])]),a("div",ke,[d(v,{required:"",for:"email"},{default:k(()=>[f("Email")]),_:1}),d(P,{inputId:"email",modelValue:s.item.email,"onUpdate:modelValue":e[2]||(e[2]=l=>s.item.email=l),class:V(n.FormError.email&&"p-invalid")},null,8,["modelValue","class"]),d(j,{error:n.FormError.email},null,8,["error"])]),a("div",ye,[d(H,{top:s.item.top,"onUpdate:top":e[3]||(e[3]=l=>s.item.top=l),id:s.item.id_top,"onUpdate:id":e[4]||(e[4]=l=>s.item.id_top=l),error:n.FormError.id_top},null,8,["top","id","error"])]),fe,a("div",be,[d(v,{required:""},{default:k(()=>[f("Tanggal Penawaran")]),_:1}),d(Y,{modelValue:s.item.tanggal,"onUpdate:modelValue":e[5]||(e[5]=l=>s.item.tanggal=l),inputId:"birth_date",dateFormat:"dd-mm-yy",maxDate:t.$h.today,class:V(n.FormError.tanggal&&"p-invalid"),showButtonBar:"",showIcon:"",iconDisplay:"input"},null,8,["modelValue","maxDate","class"]),d(j,{error:n.FormError.tanggal},null,8,["error"])]),a("div",je,[d(v,{generated:"",for:"nomor"},{default:k(()=>[f("Nomor")]),_:1}),d(P,{id:"nomor",modelValue:s.item.nomor,"onUpdate:modelValue":e[6]||(e[6]=l=>s.item.nomor=l),readonly:""},null,8,["modelValue"]),d(j,{error:n.FormError.nomor},null,8,["error"])]),a("div",ve,[d(v,{required:"",for:"salesitem",class:"mb-2"},{default:k(()=>[f("Salesman")]),_:1}),d(A,{modelValue:s.selectedSalesman,"onUpdate:modelValue":e[7]||(e[7]=l=>s.selectedSalesman=l),optionLabel:"nama",suggestions:s.filteredSalesman,onComplete:n.searchSalesman,onItemSelect:n.selectSalesman,onClear:n.clearSalesman,dropdown:"",forceSelection:"",class:V(n.FormError.id_salesman&&"p-invalid")},null,8,["modelValue","suggestions","onComplete","onItemSelect","onClear","class"]),d(j,{error:n.FormError.id_salesman},null,8,["error"])]),d(G,{modelValue:s.item.id_gudang,"onUpdate:modelValue":e[8]||(e[8]=l=>s.item.id_gudang=l),error:n.FormError.id_gudang},null,8,["modelValue","error"]),a("div",Se,[d(v,{for:"keterangan"},{default:k(()=>[f("Keterangan")]),_:1}),d(q,{id:"keterangan",modelValue:s.item.keterangan,"onUpdate:modelValue":e[9]||(e[9]=l=>s.item.keterangan=l)},null,8,["modelValue"]),d(j,{error:n.FormError.keterangan},null,8,["error"])]),we,a("div",Pe,[d(Q,{value:s.item.detail,editMode:"cell",onCellEditComplete:n.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"width:100%"},{default:k(()=>[d(C,{header:"#",headerStyle:"width:10px;"},{body:k(({index:l})=>[f(p(l+1),1)]),_:1}),d(C,{header:"Tipe",headerStyle:"width:5%;"},{body:k(({data:l,index:o})=>[a("div",Ve,[d(S,{onClick:r=>n.switchType(o),icon:l.type=="produk"?"pi pi-box":"pi pi-briefcase",severity:l.type=="produk"?"primary":"secondary"},null,8,["onClick","icon","severity"]),a("span",De,p(l.type),1)])]),_:1}),(c(!0),g(D,null,F(n.getColumnDetail(),l=>(c(),y(C,{key:l.field,class:V(l.class),field:l.field,header:l.header,headerStyle:l.width},{body:k(({data:o,field:r,index:h})=>[r=="selectedSatuan"?(c(),g("div",Ce,p(o[r]&&o[r].satuan),1)):r=="nama_barang"?(c(),g("div",xe,[o.type=="produk"?(c(),g("span",Ee,[a("small",Fe,p(o.kode_barang),1),a("span",null,p(o.nama_barang),1)])):(c(),y(P,{key:1,modelValue:o[r],"onUpdate:modelValue":ae=>o[r]=ae,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))])):r=="selectedPajak"?(c(),g("div",Ue,p(o.pajak==null?null:o.pajak.toString()),1)):l.type=="currency"?(c(),g("div",qe,p(t.$h.formatNumber(o[r])),1)):l.type==="number"?(c(),g("div",Le,p(t.$h.formatNumber(o[r])),1)):(c(),g("div",Ae,p(o[r]),1)),n.FormError.detail&&n.FormError.detail[h]?(c(),y(j,{key:6,error:n.FormError.detail[h][l.error?l.error:r]},null,8,["error"])):b("",!0)]),header:k(()=>[l.header==="Pajak"?(c(),y(S,{key:0,icon:"pi pi-chevron-down",class:"p-button p-button-outlined",onClick:n.toggleSelectAllPajak},null,8,["onClick"])):b("",!0)]),editor:k(({data:o,field:r})=>[r=="nama_barang"?(c(),g(D,{key:0},[o.type=="produk"?(c(),y(A,{key:0,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,suggestions:s.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:n.searchProduk,class:"min-w-max",dropdown:"",onDropdownClick:n.searchAllProduk},{option:k(h=>[a("div",Te,[a("small",{class:V(h.option.is_stok?"text-green-500":"text-blue-500")},p(h.option.kode_barang),3),a("div",Ne,p(h.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(c(),y(P,{key:1,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))],64)):r=="selectedSatuan"?(c(),g(D,{key:1},[o.type=="produk"?(c(),y(T,{key:0,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,id:"satuan",options:o.option_satuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"])):(c(),y(T,{key:1,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,id:"satuan",options:s.lSatuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"]))],64)):r=="note"?(c(),y(P,{key:2,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,name:"note",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])):l.type=="number"?U((c(),y(L,{key:3,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,id:"qty",minFractionDigits:1,maxFractionDigits:5,min:"0",max:"999999","input-class":"text-right",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[x]]):r=="total"?(c(),g("div",Ie,p(t.$h.formatNumber(o[r])),1)):l.type=="currency"?U((c(),y(L,{key:5,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,name:r,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","name"])),[[x]]):r=="diskonpersen"?U((c(),y(L,{key:6,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,name:"diskonpersen",min:"0",max:"100","input-class":"text-right",minFractionDigits:1,maxFractionDigits:5,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[x]]):r=="selectedPajak"?(c(),y(N,{key:7,modelValue:o[r],"onUpdate:modelValue":h=>o[r]=h,options:s.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem min-w-max"},{option:k(h=>[a("div",Oe,[a("div",Be,p(h.option.nama),1),a("div",Ke,p(h.option.nilai)+"%",1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])):b("",!0)]),_:2},1032,["class","field","header","headerStyle"]))),128)),d(C,{header:"#",headerStyle:"width:5%;"},{body:k(({data:l})=>[d(S,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:o=>n.removeDetail(l)},null,8,["onClick"])]),_:1})]),_:1},8,["value","onCellEditComplete"]),d(j,{error:n.FormError.detail},null,8,["error"])]),a("div",Me,[d(v,{for:"description"},{default:k(()=>[f("Syarat dan Ketentuan")]),_:1}),d(W,{id:"syarat",rows:"5",modelValue:s.item.syarat,"onUpdate:modelValue":e[10]||(e[10]=l=>s.item.syarat=l),editorStyle:n.FormError.syarat&&"border: 1px red solid !important"},{toolbar:k(()=>[Re,Je]),_:1},8,["modelValue","editorStyle"]),d(j,{error:n.FormError.syarat},null,8,["error"]),ze,d(v,{for:"description",class:"mt-3"},{default:k(()=>[f("Delivery Point")]),_:1}),d(q,{id:"description",required:"true",rows:"3",modelValue:s.item.deliverypoint,"onUpdate:modelValue":e[11]||(e[11]=l=>s.item.deliverypoint=l)},null,8,["modelValue"])]),He,a("div",Ye,[a("div",Ge,[Qe,a("div",We,p(t.$h.formatNumber(n.subtotal)),1)]),a("div",Xe,[Ze,a("div",$e,[a("div",et,[U(d(X,{placeholder:"Discount",modelValue:s.item.diskonpersen,"onUpdate:modelValue":e[12]||(e[12]=l=>s.item.diskonpersen=l),min:0,max:100,step:"0.5",minFractionDigits:1,maxFractionDigits:5},null,8,["modelValue"]),[[x]]),tt])]),a("div",at,p(t.$h.formatNumber(n.total_discount)),1)]),a("div",lt,[st,a("div",it,p(t.$h.formatNumber(n.dpp)),1)]),s.settingStore.penjualan.pajak=="b"?(c(),g("div",nt,[(c(!0),g(D,null,F(n.lPajakSelection,(l,o)=>{var r;return c(),g("div",{key:l,class:"grid py-3 justify-content-center align-items-center"},[a("div",ot,p(l.nama),1),a("div",rt,[d(Z,{modelValue:l.is_selected,"onUpdate:modelValue":h=>l.is_selected=h,binary:!0,onChange:n.changePajakSelection},null,8,["modelValue","onUpdate:modelValue","onChange"])]),a("div",dt,p(t.$h.formatNumber(((r=n.selectedPajakDetail[o])==null?void 0:r.nilai)||0)),1)])}),128))])):b("",!0),s.settingStore.penjualan.pajak=="a"?(c(),g("div",ut,[(c(!0),g(D,null,F(n.selectedPajakDetail,l=>(c(),g("div",{key:l,class:"grid py-3 justify-content-center align-items-center"},[a("div",mt,p(l.nama),1),a("div",ct,p(t.$h.formatNumber(l.nilai)),1)]))),128))])):b("",!0),a("div",pt,[ht,gt,a("div",_t,p(t.$h.formatNumber(n.grandtotal)),1)])])]),((I=s.item.persetujuan)==null?void 0:I.length)>0&&!this.$route.query.revisi?(c(),g("div",kt,[a("table",yt,[ft,a("tbody",bt,[(c(!0),g(D,null,F(s.item.persetujuan,(l,o)=>(c(),g("tr",{key:o},[a("td",null,p(o+1),1),a("td",null,p(l.nama),1),a("td",null,p(l.jabatan),1),a("td",null,p(t.$h.formatDate(l.tanggal_persetujuan,"DD-MM-YYYY HH:mm:ss")),1),l.tanggal_persetujuan!=null&&!l.status?(c(),g("td",jt,"Reject")):l.tanggal_persetujuan!=null&&l.status?(c(),g("td",vt,"Approve")):(c(),g("td",St,"Menunggu Persetujuan")),a("td",null,p(l.keterangan),1)]))),128))])])])):b("",!0),a("div",wt,[a("div",Pt,[a("div",Vt,[s.isEdit?(c(),y(S,{key:0,label:"Print",severity:"help",icon:"pi pi-print",iconPos:"left",onClick:n.cetakPDF},null,8,["onClick"])):b("",!0)])]),a("div",Dt,[a("div",Ct,[!n.canPersetujuan&&!((B=(O=s.item.persetujuan)==null?void 0:O[0])!=null&&B.tanggal_persetujuan)&&s.item.status!="C"?(c(),y($,{key:0,loading:t.$isLoading.value,data:s.item,onClick:e[13]||(e[13]=l=>{var o;return n.Save((o=s.settingStore.penjualan.persetujuan.quotation)!=null&&o.persetujuan1?"S":"O")}),onDraft:e[14]||(e[14]=l=>n.Save("D")),showDraft:s.item.status==null||s.item.status=="D"},null,8,["loading","data","showDraft"])):b("",!0),s.item.status=="S"&&n.canPersetujuan?(c(),y(S,{key:1,label:"Reject",severity:"danger",iconPos:"right",icon:"pi pi-times",onClick:n.confirmReject,class:"mx-2"},null,8,["onClick"])):b("",!0),s.item.status=="S"&&n.canPersetujuan?(c(),y(S,{key:2,label:"Approve",severity:"success",iconPos:"right",icon:"pi pi-check",onClick:n.confirmApprove},null,8,["onClick"])):b("",!0)])])]),d(ee,{ref:"op_select_all_pajak"},{default:k(()=>[d(N,{modelValue:s.selectedAllPajak,"onUpdate:modelValue":e[15]||(e[15]=l=>s.selectedAllPajak=l),options:s.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem",onChange:n.selectAllPajak},{option:k(l=>[a("div",xt,[a("div",Et,p(l.option.nama),1),a("div",Ft,p(l.option.nilai)+"%",1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},512),d(te,{visible:s.showPersetujuanDialog,"onUpdate:visible":e[19]||(e[19]=l=>s.showPersetujuanDialog=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:k(()=>[d(S,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:e[17]||(e[17]=l=>s.showPersetujuanDialog=!1)}),d(S,{label:t.isApprove?"Approve":"Reject",icon:"pi pi-check",class:"p-button-text",onClick:e[18]||(e[18]=l=>n.submitPersetujuan(t.isApprove))},null,8,["label"])]),default:k(()=>[Ut,d(q,{class:"w-full",modelValue:s.item.keterangan,"onUpdate:modelValue":e[16]||(e[16]=l=>s.item.keterangan=l),rows:"5",cols:"30",placeholder:"Optional"},null,8,["modelValue"])]),_:1},8,["visible"])])}const Rt=ne(ce,[["render",qt]]);export{Rt as default};
