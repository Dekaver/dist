import{a as V}from"./acckas-581f2fe3.js";import"./custom-zod-e9521e5d.js";import{a as j}from"./options-b2eb7ae6.js";import{A as J}from"./index-b9e295bc.js";import{_ as M,r as m,A as O,o as n,c as _,b as i,d as o,e as h,l as v,n as w,m as S,q as z,k as f,f as E,t as g,C as G,B as P}from"./index-11eb6111.js";import{z as a}from"./index-0ec66d4d.js";const L=a.object({id:a.number().nullish(),date:a.date(),reference:a.string().nullish(),akun:a.number().int(),description:a.string().nullish(),total:a.number().gte(0),kepada:a.string(),id_kepada:a.number().int(),type:a.string(),status:a.literal("D"),detail:a.array(a.object({id:a.number().nullish(),id_account:a.number().int(),desc:a.string().nullish(),amount:a.number().gte(0)}))}),W=L.extend({reference:a.string().nullish(),description:a.string().min(3),total:a.number().gt(0),status:a.literal("C"),detail:a.array(a.object({desc:a.string().min(3),amount:a.number().gt(0)}))}),H=a.discriminatedUnion("status",[L,W]),Q={data(){return{lKepada:[],filteredKepada:[],selectedKepada:null,id_kepada:null,item:{id:null,date:null,reference:null,akun:null,description:null,total:0,kepada:null,id_kepada:null,type:"O",status:null,detail:[{id_account:null,code_account:null,name_account:null,desc:null,amount:0}]},nullDetail:null,status:null,isClean:!0,columns:[{field:"desc",header:"Deskripsi",editor:!0},{field:"id_account",header:"Kode",error:"id_account",editor:!0},{field:"name_account",header:"Akun",editor:!1},{field:"amount",header:"Jumlah",type:"currency",editor:!0}]}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.item.date=new Date,this.getData().then(()=>{this.isEdit&&this.GetKasData()}).finally(()=>{this.$timeoutLoading()})},computed:{Total(){return this.item.detail.reduce((t,e)=>parseFloat(t)+parseFloat(e.amount),0)},FormItem(){return{...this.item,status:this.status,detail:this.item.detail.filter(t=>t.id_account!=null)}},FormError(){var t,e;return this.isClean?{}:((e=(t=H.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}}},methods:{selectKepada(t){this.item.id_kepada=t.value.id,this.item.kepada=t.value.nama},changeKepada(){this.item.id_kepada=null},searchKepada(t){setTimeout(()=>{this.filteredKepada=t.query.trim().length?this.lKepada.filter(e=>e.nama.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lKepada]},250)},selectAkunDetail(t,e){console.log(this.item.detail,t,e),this.item.detail[e].id_account=t.value.id,this.item.detail[e].name_account=t.value.name,this.item.detail[e].code_account=t.value.code},async getData(){await j.getCustomerPegawai().then(t=>{this.lKepada=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load nama Customer",life:3e3})})},async Save(t="D"){try{if(this.$isLoading.value=!0,this.isClean=!1,this.item.total=this.Total,this.status=t,Object.keys(this.FormError).length>0){this.$toast.add({severity:"warn",summary:"Warning!!",detail:"Validate error",life:3e3});return}this.isEdit?await V.update(this.item.id,this.FormItem).then(e=>{this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),this.item.status=e.data.data.status,e.data.data.status=="C"&&(this.item.detail=this.item.detail.filter(c=>c.id_account!=null))}).catch(e=>{this.$toast.add({severity:"error",summary:"Error",detail:e.response.data.message,life:3e3})}):await V.store(this.FormItem).then(e=>{this.item.id=e.data.data.id,this.item.reference=e.data.data.reference,this.item.status=e.data.data.status,e.data.data.status=="C"&&(this.item.detail=this.item.detail.filter(c=>c.id_account!=null)),this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),setTimeout(()=>{this.isEdit=!0,this.$router.replace({name:"kaskeluar.edit",params:{id:e.data.data.id}})},1e3)}).catch(e=>{this.$toast.add({severity:"error",summary:"Error",detail:e.response.data.message,life:3e3})}),this.isClean=!0}catch(e){e instanceof J&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})}finally{this.isClean=!1,this.$timeoutLoading()}},onCellEditComplete(t){let{data:e,newValue:c,field:C}=t;switch(C){case"id_account":if(typeof c=="string"||c==null)return;this.tambahKasDetail();break;default:e[C]=c;break}},tambahKasDetail(){this.item.detail.some(t=>t.id_account==null)||this.item.detail.push({...this.nullDetail})},hapusKasDetail(t){this.item.detail.length>1&&(this.item.detail=this.item.detail.filter(e=>e!==t))},async GetKasData(){await V.show(this.item.id).then(t=>{this.item=t.data.data,this.item.date=this.$h.Date(t.data.data.date),this.item.detail.forEach(e=>{e.amount=parseFloat(e.amount)})})}}},R={class:"grid"},X={class:"col-12"},Y={class:"card"},Z={class:"p-fluid formgrid grid justify-content-between"},$=i("div",{class:"field col-fixed"},[i("h5",null,"Kas Keluar")],-1),ee={class:"field col-fixed"},te={class:"p-fluid formgrid grid"},ae={class:"field col-12 md:col-3"},ie={class:"field col-12 md:col-3"},le={class:"field col-12 md:col-3"},se={class:"field col-12 md:col-3"},re={class:"field col-12 md:col-12"},oe={class:"col-12 my-4"},de={key:0},ne={key:1},ue={key:2},me={key:3},ce={class:"col-12"},he={class:"p-fluid formgrid grid"},pe=i("div",{class:"col-6 md:col-10 text-right"},[i("p",{class:"text-right"},"Total")],-1),_e={class:"col-6 md:col-2"},fe={class:"text-right"},ge=i("br",null,null,-1),ye={class:"grid"},ve=i("div",{class:"col-6"},[i("div",{class:"flex flex-wrap gap-3 justify-content-start"})],-1),ke={class:"col-6"},be={class:"flex flex-wrap gap-3 justify-content-end"};function Ce(t,e,c,C,s,r){const T=m("Tag"),k=m("Label"),D=m("InputText"),y=m("ErrorMsg"),x=m("Calendar"),K=m("AutoCompleteAkun"),A=m("AutoComplete"),I=m("InputNumber"),F=m("Column"),U=m("Button"),B=m("DataTable"),N=m("SubmitButton"),q=O("select-all-text");return n(),_("div",R,[i("div",X,[i("div",Y,[i("div",Z,[$,i("div",ee,[o(T,{icon:"pi pi-info-circle",style:{float:"right"},value:t.$h.getLabel(s.item.status)=="draft"?"Jurnal Belum Diposting":"Jurnal Sudah Diposting",severity:t.$h.getLabel(s.item.status)},null,8,["value","severity"])])]),i("div",te,[i("div",ae,[o(k,{required:t.isEdit,for:"reference"},{default:h(()=>[v("Nomor")]),_:1},8,["required"]),o(D,{id:"reference",type:"text",modelValue:s.item.reference,"onUpdate:modelValue":e[0]||(e[0]=l=>s.item.reference=l),disabled:""},null,8,["modelValue"]),o(y,{error:r.FormError.reference},null,8,["error"])]),i("div",ie,[o(k,{required:""},{default:h(()=>[v("Tanggal")]),_:1}),o(x,{modelValue:s.item.date,"onUpdate:modelValue":e[1]||(e[1]=l=>s.item.date=l),maxDate:t.$h.today,class:w(r.FormError.date&&"p-invalid")},null,8,["modelValue","maxDate","class"]),o(y,{error:r.FormError.date},null,8,["error"])]),i("div",le,[o(K,{modelValue:s.item.akun,"onUpdate:modelValue":e[2]||(e[2]=l=>s.item.akun=l),level:4,cashable:"",error:r.FormError.akun},null,8,["modelValue","error"])]),i("div",se,[o(k,{required:"",for:"kepada"},{default:h(()=>[v("Dibayarkan Kepada")]),_:1}),o(A,{modelValue:s.item.kepada,"onUpdate:modelValue":e[3]||(e[3]=l=>s.item.kepada=l),dropdown:"",suggestions:s.filteredKepada,onChange:r.changeKepada,onItemSelect:r.selectKepada,onComplete:r.searchKepada,optionLabel:"nama",class:w(r.FormError.kepada&&"p-invalid")},null,8,["modelValue","suggestions","onChange","onItemSelect","onComplete","class"]),o(y,{error:r.FormError.kepada},null,8,["error"])]),i("div",re,[o(k,{required:t.isEdit,for:"keterangan"},{default:h(()=>[v("Keterangan")]),_:1},8,["required"]),o(D,{id:"keterangan",type:"text",modelValue:s.item.description,"onUpdate:modelValue":e[4]||(e[4]=l=>s.item.description=l)},null,8,["modelValue"]),o(y,{error:r.FormError.description},null,8,["error"])]),i("div",oe,[o(B,{value:s.item.detail,editMode:"cell",onCellEditComplete:r.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto"},{default:h(()=>[(n(!0),_(S,null,z(s.columns,l=>(n(),f(F,{key:l.field,field:l.field,header:l.header},G({body:h(({data:u,field:d,index:b})=>[d=="id_account"?(n(),_("div",de,g(u.code_account),1)):l.type=="number"?(n(),_("div",ne,g(t.$h.formatNumber(u[d])),1)):l.type=="currency"?(n(),_("div",ue,g(t.$h.formatNumber(u[d])),1)):(n(),_("div",me,g(u[d]),1)),r.FormError.detail&&r.FormError.detail[b]?(n(),f(y,{key:4,error:r.FormError.detail[b][l.error?l.error:d]},null,8,["error"])):E("",!0)]),_:2},[l.editor?{name:"editor",fn:h(({data:u,field:d,index:b})=>[l.type=="currency"||l.type=="number"?P((n(),f(I,{key:0,modelValue:u[d],"onUpdate:modelValue":p=>u[d]=p,inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0},null,8,["modelValue","onUpdate:modelValue"])),[[q]]):d=="desc"?(n(),f(D,{key:1,modelValue:u[d],"onUpdate:modelValue":p=>u[d]=p},null,8,["modelValue","onUpdate:modelValue"])):d=="id_account"?(n(),f(K,{key:2,modelValue:u[d],"onUpdate:modelValue":p=>u[d]=p,onSelectItem:p=>r.selectAkunDetail(p,b),showLabel:!1,level:4},null,8,["modelValue","onUpdate:modelValue","onSelectItem"])):(n(),_(S,{key:3},[v(g(u[d]),1)],64))]),key:"0"}:void 0]),1032,["field","header"]))),128)),o(F,{header:"#",headerStyle:"width:5%;"},{body:h(({data:l})=>[s.item.status!="C"?(n(),f(U,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:u=>r.hapusKasDetail(l)},null,8,["onClick"])):E("",!0)]),_:1})]),_:1},8,["value","onCellEditComplete"])])]),i("div",ce,[i("div",he,[pe,i("div",_e,[i("p",fe,g(t.$h.formatNumber(r.Total)),1)])])]),ge,i("div",ye,[ve,i("div",ke,[i("div",be,[s.item.status!="C"?(n(),f(N,{key:0,loading:t.$isLoading.value,data:s.item,onClick:e[5]||(e[5]=l=>r.Save("D")),onClose:e[6]||(e[6]=l=>r.Save("C")),showClose:s.item.status==null||s.item.status=="D"},null,8,["loading","data","showClose"])):E("",!0)])])])])])])}const Se=M(Q,[["render",Ce]]);export{Se as default};
