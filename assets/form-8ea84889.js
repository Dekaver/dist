import{a as V}from"./api-d111cd5a.js";import"./custom-zod-e9521e5d.js";import{a as P}from"./options-b2eb7ae6.js";import{A as j}from"./index-b9e295bc.js";import{_ as q,r as c,A as J,o as d,c as p,b as i,d as h,e as y,l as v,n as z,m as w,q as M,k as g,f as E,t as _,C as O,B as G}from"./index-11eb6111.js";import{z as s}from"./index-0ec66d4d.js";const S=s.object({gl_date:s.date(),status:s.literal("D"),detail:s.array(s.object({id_account:s.number().int(),description:s.string().nullish(),kredit:s.number().gte(0).nullish(),debit:s.number().gte(0).nullish()}))}),W=S.extend({gl_date:s.date(),status:s.literal("C"),detail:s.array(s.object({id_account:s.number().int(),description:s.string().min(3),kredit:s.number().gte(0).nullish(),debit:s.number().gte(0).nullish()}))}),H=s.discriminatedUnion("status",[S,W]),Q={data(){return{lKepada:[],filteredKepada:[],selectedKepada:null,id_kepada:null,item:{gl_date:null,gl_number:null,reference:null,note:null,total:0,journal_code:null,is_posting:!1,detail:[{id_account:null,code_account:null,name_account:null,gl_number:null,is_debit:null,id_proyek:null,description:null,proyek:null,credit:0,debit:0}]},nullDetail:null,status:null,isClean:!0,lProyek:null,selectedProyek:null,filteredlProyek:[],columns:[{field:"description",header:"Deskripsi",editor:!0},{field:"id_account",header:"Kode",error:"id_account",editor:!0},{field:"name_account",header:"Akun",editor:!1},{field:"debit",header:"Debit",type:"currency",editor:!0},{field:"credit",header:"Kredit",type:"currency",editor:!0},{field:"selectedProyek",header:"Proyek",error:"id_proyek",editor:!0}]}},mounted(){this.item.gl_number=this.$route.params.gl_number,this.isEdit=!!this.$route.params.gl_number,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.item.gl_date=new Date,this.getData().then(()=>{this.isEdit&&this.GetJurnalUmumData()}).finally(()=>{this.$timeoutLoading()})},computed:{Total(){return this.item.detail.reduce((t,e)=>parseFloat(t)+(parseFloat(e.credit||0)-parseFloat(e.debit||0)),0)},FormItem(){return{...this.item,status:this.status,detail:this.item.detail.filter(t=>t.id_account!=null)}},FormError(){var t,e;return this.isClean?{}:((e=(t=H.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}}},methods:{selectAkunDetail(t,e){console.log(this.item.detail,t,e),this.item.detail[e].id_account=t.value.id,this.item.detail[e].name_account=t.value.name,this.item.detail[e].code_account=t.value.code},searchProyek(t){setTimeout(()=>{this.filteredlProyek=t.query.trim().length?this.lProyek.filter(e=>e.proyek.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProyek]},250)},searchAllProyek(){setTimeout(()=>{this.filteredlProyek=this.lProyek.filter(t=>!this.item.detail.some(e=>e.proyek==t.proyek))},250)},async getData(){await P.getCustomerPegawai().then(t=>{this.lKepada=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load nama Customer",life:3e3})}),await P.getProyek().then(t=>{this.lProyek=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Proyek",life:3e3})})},async Save(t){try{if(this.$isLoading.value=!0,this.isClean=!1,this.item.total=this.Total,this.status=t,t=="C"&&(this.item.is_posting=!0),Object.keys(this.FormError).length>0){this.$toast.add({severity:"warn",summary:"Warning!!",detail:"Validate error",life:3e3});return}this.isEdit?await V.update(this.item.gl_number,this.FormItem).then(e=>{this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),this.item.status=e.data.data.status,e.data.data.status=="C"&&(this.item.detail=this.item.detail.filter(u=>u.id_account!=null))}).catch(e=>{this.$toast.add({severity:"error",summary:"Error",detail:e.response.data.message,life:3e3})}):await V.store(this.FormItem).then(e=>{this.item.gl_number=e.data.data.gl_number,this.item.status=e.data.data.status,e.data.data.status=="C"&&(this.item.detail=this.item.detail.filter(u=>u.id_account!=null)),this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),setTimeout(()=>{this.isEdit=!0,this.$router.replace({name:"jurnal-umum.edit",params:{gl_number:e.data.data.gl_number}})},1e3)}).catch(e=>{this.$toast.add({severity:"error",summary:"Error",detail:e.response.data.message,life:3e3})}),this.isClean=!0}catch(e){e instanceof j&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})}finally{this.isClean=!1,this.$timeoutLoading()}},onCellEditComplete(t){let{data:e,newValue:u,field:f}=t;switch(f){case"id_account":if(typeof u=="string"||u==null)return;this.tambahKasDetail();break;case"selectedProyek":if(!u)return;e[f]=u,e.proyek=u.proyek,e.id_proyek=u.id;break;default:e[f]=u;break}},tambahKasDetail(){this.item.detail.some(t=>t.id_account==null)||this.item.detail.push({...this.nullDetail})},hapusKasDetail(t){this.item.detail.length>1&&(this.item.detail=this.item.detail.filter(e=>e!==t))},async GetJurnalUmumData(){await V.show(this.item.gl_number).then(t=>{this.item=t.data.data,this.item.gl_date=this.$h.Date(t.data.data.gl_date),this.item.detail.forEach(e=>{e.debit=parseFloat(e.debit),e.credit=parseFloat(e.credit)})})}}},R={class:"grid"},X={class:"col-12"},Y={class:"card"},Z={class:"p-fluid formgrid grid justify-content-between"},$=i("div",{class:"field col-fixed"},[i("h5",null,"Jurnal Umum")],-1),ee={class:"field col-fixed"},te={class:"p-fluid formgrid grid"},ie={class:"field col-12 md:col-3"},le={class:"field col-12 md:col-3"},ae={class:"field col-12 md:col-12"},se={class:"col-12 my-4"},oe={key:0},re={key:1},ne={key:2},de={key:3},ue={class:"flex flex-column"},me={key:4},ce={class:"flex flex-column"},he={class:""},_e={class:"col-12"},pe={class:"p-fluid formgrid grid"},ye=i("div",{class:"col-6 md:col-10 text-right"},[i("p",{class:"text-right"},"Selisih")],-1),ge={class:"col-6 md:col-2"},fe={class:"text-right"},ke=i("br",null,null,-1),be={class:"grid"},ve=i("div",{class:"col-6"},[i("div",{class:"flex flex-wrap gap-3 justify-content-start"})],-1),Ce={class:"col-6"},De={class:"flex flex-wrap gap-3 justify-content-end"};function Ve(t,e,u,f,o,r){const x=c("Tag"),C=c("Label"),D=c("InputText"),k=c("ErrorMsg"),L=c("Calendar"),U=c("InputNumber"),T=c("AutoCompleteAkun"),A=c("AutoComplete"),F=c("Column"),I=c("Button"),K=c("DataTable"),B=c("SubmitButton"),N=J("select-all-text");return d(),p(w,null,[i("div",R,[i("div",X,[i("div",Y,[i("div",Z,[$,i("div",ee,[h(x,{icon:"pi pi-info-circle",style:{float:"right"},value:t.$h.getLabel(o.item.is_posting)!="draft"?"Jurnal Sudah Diposting":"Jurnal Belum Diposting",severity:t.$h.getLabel(o.item.is_posting)},null,8,["value","severity"])])]),i("div",te,[i("div",ie,[h(C,{required:t.isEdit,for:"gl_number"},{default:y(()=>[v("Nomor")]),_:1},8,["required"]),h(D,{id:"gl_number",type:"text",modelValue:o.item.gl_number,"onUpdate:modelValue":e[0]||(e[0]=l=>o.item.gl_number=l),disabled:""},null,8,["modelValue"]),h(k,{error:r.FormError.gl_number},null,8,["error"])]),i("div",le,[h(C,{required:""},{default:y(()=>[v("Tanggal")]),_:1}),h(L,{modelValue:o.item.gl_date,"onUpdate:modelValue":e[1]||(e[1]=l=>o.item.gl_date=l),maxDate:t.$h.today,class:z(r.FormError.gl_date&&"p-invalid")},null,8,["modelValue","maxDate","class"]),h(k,{error:r.FormError.gl_date},null,8,["error"])]),i("div",ae,[h(C,{required:t.isEdit,for:"keterangan"},{default:y(()=>[v("Keterangan")]),_:1},8,["required"]),h(D,{id:"keterangan",type:"text",modelValue:o.item.note,"onUpdate:modelValue":e[2]||(e[2]=l=>o.item.note=l)},null,8,["modelValue"]),h(k,{error:r.FormError.note},null,8,["error"])]),i("div",se,[h(K,{value:o.item.detail,editMode:"cell",onCellEditComplete:r.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto"},{default:y(()=>[(d(!0),p(w,null,M(o.columns,l=>(d(),g(F,{key:l.field,field:l.field,header:l.header},O({body:y(({data:n,field:a,index:b})=>[a=="id_account"?(d(),p("div",oe,_(n.code_account),1)):l.type=="number"?(d(),p("div",re,_(t.$h.formatNumber(n[a])),1)):l.type=="currency"?(d(),p("div",ne,_(t.$h.formatNumber(n[a])),1)):a=="selectedProyek"?(d(),p("div",de,[i("span",ue,[i("span",null,_(n.proyek),1)])])):(d(),p("div",me,_(n[a]),1)),r.FormError.detail&&r.FormError.detail[b]?(d(),g(k,{key:5,error:r.FormError.detail[b][l.error?l.error:a]},null,8,["error"])):E("",!0)]),_:2},[l.editor?{name:"editor",fn:y(({data:n,field:a,index:b})=>[l.type=="currency"||l.type=="number"?G((d(),g(U,{key:0,modelValue:n[a],"onUpdate:modelValue":m=>n[a]=m,inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0},null,8,["modelValue","onUpdate:modelValue"])),[[N]]):a=="description"?(d(),g(D,{key:1,modelValue:n[a],"onUpdate:modelValue":m=>n[a]=m},null,8,["modelValue","onUpdate:modelValue"])):a=="id_account"?(d(),g(T,{key:2,modelValue:n[a],"onUpdate:modelValue":m=>n[a]=m,onSelectItem:m=>r.selectAkunDetail(m,b),showLabel:!1,level:4},null,8,["modelValue","onUpdate:modelValue","onSelectItem"])):a=="selectedProyek"?(d(),g(A,{key:3,modelValue:n[a],"onUpdate:modelValue":m=>n[a]=m,suggestions:o.filteredlProyek,optionLabel:"proyek",virtualScrollerOptions:{itemSize:50},onComplete:r.searchProyek,class:"min-w-max",dropdown:"",onDropdownClick:r.searchAllProyek},{option:y(m=>[i("div",ce,[i("small",null,_(m.option.kode),1),i("div",he,_(m.option.proyek),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(d(),p(w,{key:4},[v(_(n[a]),1)],64))]),key:"0"}:void 0]),1032,["field","header"]))),128)),h(F,{header:"#",headerStyle:"width:5%;"},{body:y(({data:l})=>[o.item.status!="C"?(d(),g(I,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:n=>r.hapusKasDetail(l)},null,8,["onClick"])):E("",!0)]),_:1})]),_:1},8,["value","onCellEditComplete"])])]),i("div",_e,[i("div",pe,[ye,i("div",ge,[i("p",fe,_(r.Total!=0?t.$h.formatNumber(r.Total):0),1)])])]),ke,i("div",be,[ve,i("div",Ce,[i("div",De,[o.item.is_posting!=!0?(d(),g(B,{key:0,loading:t.$isLoading.value,data:o.item,onClick:e[3]||(e[3]=l=>r.Save("D")),onClose:e[4]||(e[4]=l=>r.Save("C")),showClose:o.item.status==null||o.item.status=="D"},null,8,["loading","data","showClose"])):E("",!0)])])])])])]),i("pre",null,_(o.selectedProyek),1)],64)}const Le=q(Q,[["render",Ve]]);export{Le as default};
