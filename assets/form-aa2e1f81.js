import{a as L}from"./jeniskendaraan-ee8c8507.js";import{a as k}from"./internaltransfer-7aab9fa3.js";import{a as D}from"./internalorder-81a59869.js";/* empty css                             */import{_ as N,r as d,A as K,o as u,c as p,d as s,b as t,l as f,t as h,e as c,n as T,f as I,m as S,q as P,k as y,B as x}from"./index-11eb6111.js";const A={data(){return{item:{id:null,nomor:null,id_internal_order:null,nomor_internal_order:null,tanggal_internal_order:null,tanggal:null,id_pengirim:null,id_penerima:null,id_gudang_asal:null,id_gudang_tujuan:null,gudang_asal:null,gudang_tujuan:null,status:null,tanggal_kirim:null,jam_kirim:null,keterangan:null,telepon:null,nopol:null,id_jenis_kendaraan:null,driver:null,transporter:null,detail:[]},lInternalOrder:[],selectedInternalOrder:null,filteredInternalOrder:[],lProduk:[],lJeniskendaraan:[],selectedJenisKendaraan:null,columns:[{field:"nama_barang",header:"Product",width:"15%",class:"left"},{field:"kode_barang",header:"Code Product",width:"15%",class:"left"},{field:"qty",header:"Qty",width:"15%",class:"left"},{field:"satuan",header:"Unit",width:"15%",class:"left"},{field:"keterangan",header:"Remark",width:"15%",class:"left"}],tanggal:null,tanggal_kirim:null,tanggal_internal_order:null,filters:{},isMore:!1,isEdit:!1,isSubmit:!1}},computed:{invalid:function(){return!(this.item.tanggal!=null&&this.item.id_internal_order!=null&&this.item.id_gudang_asal!=null&&this.item.id_gudang_tujuan!=null)}},mounted(){this.isEdit=!!this.$route.params.id,this.item.id=this.$route.params.id?this.$route.params.id:null,this.tanggal=this.$serverTime,this.tanggal_kirim=this.$serverTime,this.item.tanggal=this.$h.Date(this.$date),this.item.tanggal_kirim=this.$h.Date(this.$date),this.item.status="D",this.getData().then(()=>{this.isEdit&&this.getInternalTransfer()})},methods:{onCellEditComplete(n){let{data:e,newValue:i,field:o}=n;switch(o){case"qty":e[o]=i;break;case"keterangan":e[o]=i;break}},async getData(){await L.index().then(n=>{this.lJeniskendaraan=n.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Jenis Kendaraan",life:3e3})}),await D.index({status:["O","P"]}).then(n=>{this.lInternalOrder=n.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Internal Order",life:3e3})})},async getInternalTransfer(){await k.show(this.item.id).then(n=>{this.item=n.data.data,this.tanggal=new Date(this.item.tanggal),this.tanggal_internal_order=new Date(this.item.tanggal_internal_order),this.item.tanggal=this.tanggal,this.selectedInternalOrder=this.item.nomor_internal_order,this.selectedJenisKendaraan=this.lJeniskendaraan.find(e=>e.id==this.item.id_jenis_kendaraan)})},selectDate(n){this.item.tanggal=this.$h.Date(n)},selectJenisKendaraan(n){this.item.id_jenis_kendaraan=n.value.id},selectInternalOrder(n){D.show(n.value.id).then(e=>{this.item.id_internal_order=e.data.data.id,this.item.id_gudang_asal=e.data.data.id_gudang_asal,this.item.id_gudang_tujuan=e.data.data.id_gudang_tujuan,this.item.gudang_asal=e.data.data.gudang_asal,this.item.gudang_tujuan=e.data.data.gudang_tujuan,this.item.id_pengirim=e.data.data.send_by,this.item.detail=e.data.data.detail.filter(i=>i.sisa!=0).map(i=>({...i,qty:parseFloat(i.sisa)})),this.tanggal_internal_order=this.$h.Date(e.data.data.tanggal)})},searchInternalOrder(n){setTimeout(()=>{n.query.trim().length?this.filteredInternalOrder=this.lInternalOrder.filter(e=>e.nomor.toLowerCase().includes(n.query.trim().toLowerCase())):this.filteredInternalOrder=[...this.lInternalOrder]},250)},async submitForm(n="D"){let e=this.item.status;try{if(this.isSubmit=!0,this.invalid)return;if(n=="S"){let i=!1;if(this.item.detail.forEach(o=>{o.id_barang==null&&(i=!0),o.id_barang==null&&(i=!0)}),i){this.$toast.add({severity:"warn",summary:"Warning!",detail:"Barang tidak boleh kosong",life:3e3});return}if(this.item.detail.reduce((o,a)=>o+parseFloat(a.qty),0)==0){this.$toast.add({severity:"warn",summary:"Warning!",detail:"Minimal ada 1 barang",life:3e3});return}}this.item.status=n,this.isEdit?(this.item.status!="X"&&(this.item.alasan=""),k.update(this.item.id,this.item).then(i=>{this.$toast.add({severity:"success",summary:"Successful",detail:i.data.message,life:3e3})}).catch(i=>{this.$toast.add({severity:"warn",summary:"Warning",detail:i.response.data.message,life:3e3})})):k.store(this.item).then(i=>{this.item.id=i.data.data.id,this.item.nomor=i.data.data.nomor,setTimeout(()=>{this.$router.push({name:"internal-transfer.edit",params:{id:i.data.data.id}})},1e3),this.isEdit=!0,this.$toast.add({severity:"success",summary:"Successful",detail:i.data.message,life:3e3})}).catch(i=>{this.$toast.add({severity:"error",summary:"Failed",detail:i.response.data.message,life:3e3})})}catch(i){this.$toast.add({severity:"error",summary:"Failed",detail:i.response.data.message,life:3e3})}finally{this.item.status=e,this.isSubmit=!1}},submitPosting(){this.submitForm("S").catch(()=>{this.item.status="D"})},buttons(){return[{label:"Posting",icon:"pi pi-refresh",command:()=>{this.submitPosting()}}]}}},M={class:"grid"},W={class:"col-12"},z={class:"card"},G={class:"p-fluid formgrid grid"},R={class:"field col-12 md:col-3"},Q=t("label",{for:"donumber"},"No. Internal Transfer",-1),X={class:"field col-12 md:col-3"},H={class:"p-float-label"},Y=t("p",{class:"mb-1"},"Tanggal",-1),Z={class:"field col-12 md:col-3"},$={class:"product-autocomplete"},ee={class:"kode"},te={class:"row"},ae={class:"col-12"},le={key:0,class:"p-invalid"},ie={class:"field col-12 md:col-3"},ne={class:"p-float-label"},se=t("p",{class:"mb-1"},"Tanggal Internal Order",-1),de={class:"field col-12 md:col-3"},oe={class:"field col-12 md:col-3"},re={class:"field col-12 md:col-3"},me={class:"p-float-label"},ue=t("p",{class:"mb-1"},"Transporter Date",-1),ce={class:"field col-12 md:col-3"},_e=t("label",{for:"transtime"},"Transporter Time",-1),ge={class:"field col-12 md:col-3"},he=t("label",{for:"transporter"},"Transporter",-1),pe={class:"field col-12 md:col-3"},fe=t("label",{for:"driver"},"Driver Name",-1),ye={class:"field col-12 md:col-3"},ve=t("label",{for:"jenis_kendaraan"},"Jenis Kendaraan",-1),be={class:"field col-12 md:col-3"},Ve=t("label",{for:"licplate"},"Nomor Plat",-1),ke={class:"col-12 my-4"},Ie=t("div",{class:"text-center"},"Empty",-1),we={key:2},Ce=t("br",null,null,-1),De={class:"grid"},Te={class:"col-6"},Se={class:"flex flex-wrap gap-3 justify-content-start"},xe={class:"col-6"},je={class:"flex flex-wrap gap-3 justify-content-end"};function Oe(n,e,i,o,a,_){const j=d("Toast"),O=d("Tag"),m=d("InputText"),v=d("Calendar"),b=d("Label"),U=d("AutoComplete"),F=d("Dropdown"),E=d("InputNumber"),B=d("Column"),J=d("DataTable"),w=d("Button"),q=d("SplitButton"),C=K("select-all-text");return u(),p(S,null,[s(j),t("div",M,[t("div",W,[t("div",z,[t("h5",null,[f(h(a.isEdit?"Edit":"Add")+" Internal Transfer ",1),s(O,{style:{float:"right"},value:n.$h.getLabel(a.item.status),severity:n.$h.getLabel(a.item.status)},null,8,["value","severity"])]),t("div",G,[t("div",R,[Q,s(m,{modelValue:a.item.nomor,"onUpdate:modelValue":e[0]||(e[0]=l=>a.item.nomor=l),id:"donumber",type:"text",readonly:""},null,8,["modelValue"])]),t("div",X,[t("span",H,[Y,s(v,{dateFormat:"dd-mm-yy",modelValue:a.tanggal,"onUpdate:modelValue":e[1]||(e[1]=l=>a.tanggal=l),inputId:"tanggal",onDateSelect:_.selectDate,showButtonBar:""},null,8,["modelValue","onDateSelect"])])]),t("div",Z,[s(b,{for:"itemnumber",required:""},{default:c(()=>[f("Nomor Internal Order")]),_:1}),s(U,{modelValue:a.selectedInternalOrder,"onUpdate:modelValue":e[2]||(e[2]=l=>a.selectedInternalOrder=l),suggestions:a.filteredInternalOrder,optionLabel:"nomor",virtualScrollerOptions:{itemSize:50},onComplete:_.searchInternalOrder,onItemSelect:_.selectInternalOrder,class:T({"p-invalid":a.isSubmit&&!a.item.id_so}),dropdown:""},{option:c(l=>[t("div",$,[t("div",ee,h(l.option.id),1),t("div",te,[t("div",ae,h(l.option.nomor),1)])])]),_:1},8,["modelValue","suggestions","onComplete","onItemSelect","class"]),a.isSubmit&&!a.item.id_so?(u(),p("small",le,"Required")):I("",!0)]),t("div",ie,[t("span",ne,[se,s(v,{readonly:"",dateFormat:"dd-mm-yy",modelValue:a.tanggal_internal_order,"onUpdate:modelValue":e[3]||(e[3]=l=>a.tanggal_internal_order=l),inputId:"tanggal_internal_order"},null,8,["modelValue"])])]),t("div",de,[s(b,{for:"gudang_asal"},{default:c(()=>[f("Gudang Asal")]),_:1}),s(m,{modelValue:a.item.gudang_asal,"onUpdate:modelValue":e[4]||(e[4]=l=>a.item.gudang_asal=l),id:"gudang_asal",type:"text",readonly:""},null,8,["modelValue"])]),t("div",oe,[s(b,{for:"gudang_tujuan"},{default:c(()=>[f("Gudang Tujuan")]),_:1}),s(m,{modelValue:a.item.gudang_tujuan,"onUpdate:modelValue":e[5]||(e[5]=l=>a.item.gudang_tujuan=l),id:"gudang_tujuan",type:"text",readonly:""},null,8,["modelValue"])]),t("div",re,[t("span",me,[ue,s(v,{dateFormat:"dd-mm-yy",modelValue:a.tanggal_kirim,"onUpdate:modelValue":e[6]||(e[6]=l=>a.tanggal_kirim=l),inputId:"datetransporter"},null,8,["modelValue"])])]),t("div",ce,[_e,s(m,{modelValue:a.item.jam_kirim,"onUpdate:modelValue":e[7]||(e[7]=l=>a.item.jam_kirim=l),id:"transtime",type:"text"},null,8,["modelValue"])]),t("div",ge,[he,s(m,{modelValue:a.item.transporter,"onUpdate:modelValue":e[8]||(e[8]=l=>a.item.transporter=l),id:"transporter",type:"text"},null,8,["modelValue"])]),t("div",pe,[fe,s(m,{modelValue:a.item.driver,"onUpdate:modelValue":e[9]||(e[9]=l=>a.item.driver=l),id:"driver",type:"text"},null,8,["modelValue"])]),t("div",ye,[ve,s(F,{id:"gudangitem",modelValue:a.selectedJenisKendaraan,"onUpdate:modelValue":e[10]||(e[10]=l=>a.selectedJenisKendaraan=l),options:a.lJeniskendaraan,optionLabel:"jenis_kendaraan",onChange:_.selectJenisKendaraan},null,8,["modelValue","options","onChange"])]),t("div",be,[Ve,s(m,{modelValue:a.item.nopol,"onUpdate:modelValue":e[11]||(e[11]=l=>a.item.nopol=l),id:"licplate",type:"text"},null,8,["modelValue"])]),t("div",ke,[s(J,{value:a.item.detail,editMode:"cell",onCellEditComplete:_.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{empty:c(()=>[Ie]),default:c(()=>[(u(!0),p(S,null,P(a.columns,l=>(u(),y(B,{key:l.field,field:l.field,header:l.header,headerStyle:l.width,class:T(l.class)},{body:c(({data:g,field:r})=>[t("div",null,h(g[r]),1)]),editor:c(({data:g,field:r})=>[r=="qty"?x((u(),y(E,{key:0,modelValue:g[r],"onUpdate:modelValue":V=>g[r]=V,id:"qty",minFractionDigits:1,maxFractionDigits:5},null,8,["modelValue","onUpdate:modelValue"])),[[C]]):r=="keterangan"?x((u(),y(m,{key:1,modelValue:g[r],"onUpdate:modelValue":V=>g[r]=V,id:"keterangan",type:"text"},null,8,["modelValue","onUpdate:modelValue"])),[[C]]):(u(),p("div",we,h(g[r]),1))]),_:2},1032,["field","header","headerStyle","class"]))),128))]),_:1},8,["value","onCellEditComplete"])])]),Ce,t("div",De,[t("div",Te,[t("div",Se,[s(w,{label:"Back",severity:"secondary",iconPos:"left",icon:"pi pi-arrow-left",onClick:e[12]||(e[12]=l=>this.$router.back())}),s(w,{label:"print",severity:"help",iconPos:"left",icon:"pi pi-print"})])]),t("div",xe,[t("div",je,[I("",!0),a.item.status=="D"?(u(),y(q,{key:1,label:"Save",onClick:e[14]||(e[14]=l=>_.submitForm()),model:_.buttons(),disabled:a.isSubmit},null,8,["model","disabled"])):I("",!0)])])])])])])],64)}const qe=N(A,[["render",Oe]]);export{qe as default};
