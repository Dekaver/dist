import{a as T}from"./options-b2eb7ae6.js";import{a as A}from"./assembly-a780fa93.js";import{_ as Q,X as z,r as y,o as m,c as k,b as n,d as u,l as p,t as c,e as b,n as B,m as C,q as x,k as f,f as g,C as N}from"./index-11eb6111.js";import{a as R}from"./produk-90d88791.js";import{A as H}from"./index-b9e295bc.js";import"./custom-zod-e9521e5d.js";/* empty css                             *//* empty css                                */import{z as r}from"./index-0ec66d4d.js";const E=r.object({id:r.number().optional().nullish(),nomor:r.string().optional(),tanggal:r.coerce.string(),tgl_dibutuhkan:r.coerce.string(),keterangan:r.string().optional().nullish(),persendiskon:r.coerce.number().optional(),status:r.string()}),D=r.object({nama_barang:r.string().nonempty(),id_barang:r.number().nullish().optional(),id_satuan:r.number(),id_pajak:r.string().nullish().optional(),qty:r.coerce.number().min(1).nonnegative(),harga:r.coerce.number().min(0),diskonpersen:r.coerce.number().min(0),diskonrp:r.coerce.number().min(0),persen_pajak:r.coerce.string().optional(),total:r.coerce.number().min(0)}),M=E.extend({status:r.literal("D"),detail:r.array(D)}),K=E.extend({status:r.literal("O"),detail:r.array(D).refine(t=>t.some(a=>a.qty>0),{message:"Qty harus lebih dari 0",path:["detail"]})}),X=E.extend({status:r.literal("S"),detail:r.array(D).refine(t=>t.some(a=>a.qty>0),{message:"Qty harus lebih dari 0",path:["detail"]})});r.discriminatedUnion("status",[M,K,X]);const Z={data(){return{selectedAccount:null,filteredAccount:[],lAccount:[],lGudang:[],selectedGudang:null,lJenis:[{label:"Rakitan",value:"R"},{label:"Penguraian",value:"P"}],selectedJenis:{label:"Rakitan",value:"R"},item:{tanggal:new Date(Date.now()),persendiskon:0,status:"D",jenis:"R",qty:1,biaya:[{id_account:null,account:null,biaya:0,modal:0}],bahan_baku:[{id_barang:null,nama_barang:null,qty:0,bahan:0,satuan:null,harga_beli:0,option_satuan:[]}]},FormError:{},isEdit:!1,isSubmitted:!1,lProduk:null,selectedProduk:null,filteredlProduk:[],selectedProdukDetail:null,filteredlProdukDetail:[],lSatuan:[],tanggal:null,tgl_dibutuhkan:null,columnsBahanBaku:[{field:"nama_produk",header:"Produk"},{field:"qty",header:"Kuantitas"},{field:"satuan",header:"Satuan"},{field:"harga_beli",header:"Harga Beli"},{field:"total",header:"Total"}],columnsBiaya:[{field:"account",header:"Akun"},{field:"biaya",header:"Biaya",type:"number"}],bahanBakuEmpty:{id_barang:null,nama_barang:null,qty:0,bahan:0,satuan:null,harga_beli:0,total:0},biayaEmpty:{id_account:null,account:null,biaya:0,modal:0}}},mounted(){this.id=this.$route.params.id?this.$route.params.id:null,this.item.id=this.id,this.isEdit=!!this.id,this.$isLoading.value=!1,this.getData().then(()=>{if(!this.id){this.lGudang.length==1&&(this.item.id_gudang=this.lGudang[0].id);return}this.isEdit=!0,this.getAssembly()})},methods:{removeBahanBaku(t){this.item.bahan_baku.length>1&&(this.item.bahan_baku=this.item.bahan_baku.filter(a=>a!==t))},removeBiaya(t){this.item.biaya.length>1&&(this.item.biaya=this.item.biaya.filter(a=>a!==t))},updatePerhitunganDetail(t){this.item.bahan_baku=this.item.bahan_baku?this.item.bahan_baku.map(a=>{const e=this.lProduk.find(h=>h.id==a.id_barang);return e?{...a,qty:a.bahan*this.item.qty,satuan:e.satuan,id_satuan:e.id_satuan,nama_barang:e.nama_barang,kode_barang:e.kode_barang,harga_beli:a.bahan*this.item.qty,total:a.qty*a.harga_beli*this.item.qty}:a}):[this.bahanBakuEmpty],this.item.biaya=this.item.biaya?this.item.biaya.map(a=>{const e=this.lAccount.find(h=>h.id==a.id_account);return e?{...a,biaya:a.modal*this.item.qty,account:e.name}:a}):[this.biayaEmpty]},selectBarangHeader(t){this.item.id_barang=t.value.id,this.item.bahan_baku=[],this.item.biaya=[],this.item.bahan_baku=t.value.bahan_baku?t.value.bahan_baku.map(a=>{const e=this.lProduk.find(h=>h.id==a.id_barang);return e?{...a,bahan:a.qty,qty:a.qty*this.item.qty,satuan:e.satuan,id_satuan:e.id_satuan,nama_barang:e.nama_barang,kode_barang:e.kode_barang,total:a.qty*a.harga_beli*this.item.qty}:a}):[this.bahanBakuEmpty],t.value.bahan_baku&&this.item.status!="A"&&this.item.bahan_baku.push(this.bahanBakuEmpty),this.item.biaya=t.value.biaya?t.value.biaya.map(a=>{const e=this.lAccount.find(h=>h.id==a.id_account);return e?{...a,biaya:a.biaya*this.item.qty,account:e.name,modal:a.biaya}:a}):[this.biayaEmpty],t.value.biaya&&this.item.status!="A"&&this.item.biaya.push(this.biayaEmpty)},searchAccount(t){setTimeout(()=>{t.query.trim().length?this.filteredAccount=this.lAccount.filter(a=>a.name.toLowerCase().includes(t.query.toLowerCase())||a.code.toLowerCase().includes(t.query.toLowerCase())):this.filteredAccount=[...this.lAccount]},250)},selectAccount(t){this.produk.id_account=t.value.id,this.produk.account=t.value.name},onCellBahanBakuEditComplete(t){let{data:a,newValue:e,field:h}=t;if(a.isNew=!1,console.log(e,"asdas"),e!=""&&e!=0&&e!=null){switch(h){case"nama_produk":a.id_satuan=e.id_satuan,a.satuan=e.satuan,a.kode_barang=e.kode_barang,a.harga_beli=e.harga_beli,a.id_barang=e.id,a.nama_barang=e.nama_barang,a[h]=e.nama_produk;break;case"qty":a.qty=e,a.total=a.qty*a.harga_beli;break;case"harga_beli":a[h]=e,a.total=a.qty*a.harga_beli;break}this.item.bahan_baku.every(d=>d.id_barang!=null)&&this.item.status!="A"&&a.id_barang!=null&&a.qty>0&&this.item.bahan_baku.push({id_barang:null,nama_barang:null,qty:null,satuan:null,harga_beli:null,bahan:null})}},onCellBiayaComplete(t){let{data:a,newValue:e,field:h}=t;if(a.isNew=!1,e!=""&&e!=0&&e!=null){switch(console.log(e,"console biayya"),h){case"account":a.id_account=e.id,a.account=e.name,a.kode_barang=e.kode_barang,a[h]=e.name;break;case"biaya":a.biaya=e;break}const i=this.item.biaya.every(d=>d.id_account!=null);console.log(this.item.biaya,"ASDAS"),i&&this.item.status!="A"&&a.id_account!=null&&a.biaya>0&&this.item.biaya.push({id_account:null,account:null,biaya:0,modal:0})}},async getAssembly(){await A.show(this.$route.params.id).then(t=>{this.item=t.data.data,console.log(this.item,"erzaaa"),this.item.tanggal=this.$h.Date(this.item.tanggal),this.item.id_gudang&&(this.selectedGudang=this.lGudang.find(a=>a.id==this.item.id_gudang)),this.item.jenis&&(this.selectedJenis=this.lJenis.find(a=>a.value==this.item.jenis)),this.item.id_barang&&(this.selectedProduk=this.lProduk.find(a=>a.id==this.item.id_barang),this.item.nama_barang=this.selectedProduk.nama_barang),this.item.bahan_baku=this.item.bahan_baku?this.item.bahan_baku.map(a=>{const e=this.lProduk.find(h=>h.id==a.id_barang);return e?{...a,satuan:e.satuan,id_satuan:e.id_satuan,nama_barang:e.nama_barang,kode_barang:e.kode_barang,total:a.qty*a.harga_beli}:a}):[this.bahanBakuEmpty],this.item.bahan_baku&&this.item.status!="A"&&this.item.bahan_baku.push(this.bahanBakuEmpty),this.item.biaya=this.item.biaya?this.item.biaya.map(a=>{const e=this.lAccount.find(h=>h.id==a.id_account);return e?{...a,account:e.name}:a}):[this.biayaEmpty],this.item.biaya&&this.item.status!="A"&&this.item.biaya.push(this.biayaEmpty)}).catch(t=>{console.log("first error",t),this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})})},async Save(t){let a=this.item.status;try{this.$isLoading.value=!0,this.item.status=t,this.item.created_by=this.$auth.id,this.isSubmitted=!0,this.item.grandtotal=this.grandTotal,this.item.harga_satuan=this.hargaSatuan,this.item.total_biaya=this.totalBiaya,this.item.total_material=this.totalBahanBaku,this.item.bahan_baku=this.item.bahan_baku.filter(e=>e.id_barang!=null),this.item.biaya=this.item.biaya.filter(e=>e.id_account!=null),this.isEdit?await A.update(this.item.id,this.item).then(e=>{this.FormError={},this.item.id=e.data.data.id,this.item.status=e.data.data.status,this.item.nomor=e.data.data.nomor,this.item.modified_by=e.data.data.modified_by,this.item.modified_date=e.data.data.modified_date,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3})}):await A.store(this.item).then(e=>{this.FormError={},this.item.id=e.data.data.id,this.item.status=e.data.data.status,this.item.nomor=e.data.data.nomor,this.item.modified_by=e.data.data.modified_by,this.item.modified_date=e.data.data.modified_date,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),this.isEdit=!0,setTimeout(()=>{this.$router.push({name:"assembly.edit",params:{id:this.item.id}}).then(()=>{t=="S"&&window.location.reload()})},1e3)}),this.isSubmitted=!1}catch(e){e instanceof r.ZodError?this.FormError=e.format():e instanceof H&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3}),this.item.status=a,console.log(e)}finally{this.isSubmitted=!1,this.$timeoutLoading()}},async getData(){await z.indexByTransaction().then(t=>{console.log(t.data.data,"data accountnya"),this.lAccount=t.data.data}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})}),await R.index().then(t=>{this.lProduk=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data produk",life:3e3})}),await T.getGudang().then(t=>{this.lGudang=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Gudang",life:3e3})}),await T.getSatuan().then(t=>{this.lSatuan=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})})},selectGudang(t){this.item.id_gudang=t.value.id,this.selectedGudang=t.value},selectJenis(t){console.log(t,"eventtnya"),this.item.jenis=t.value.value,this.selectedJenis=t.value},searchProdukDetail(t){setTimeout(()=>{t.query.trim().length?this.filteredlProdukDetail=this.lProduk.filter(a=>a.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())):this.filteredlProdukDetail=[...this.lProduk]},250)},searchAllProdukDetail(){setTimeout(()=>{this.item.bahan_baku!=null&&this.item.bahan_baku!=null?this.filteredlProduk=this.lProduk.filter(t=>!this.item.bahan_baku.some(a=>a.nama_barang==t.nama_barang)):this.filteredlProdukDetail=this.lProduk},250)},searchProduk(t){setTimeout(()=>{t.query.trim().length?this.filteredlProduk=this.lProduk.filter(a=>a.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())):this.filteredlProduk=[...this.lProduk]},250)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk},250)},filters:{pretty:function(t){return JSON.stringify(JSON.parse(t),null,2)}}},computed:{totalBahanBaku:function(){return this.item.bahan_baku.reduce((t,a)=>t+parseFloat(a.total||0),0)},totalQty:function(){return this.item.bahan_baku.reduce((t,a)=>t+parseFloat(a.qty||0),0)},totalBiaya:function(){return this.item.biaya.reduce((t,a)=>t+parseFloat(a.biaya||0),0)},grandTotal:function(){return this.totalBahanBaku+this.totalBiaya},hargaSatuan:function(){return this.grandTotal&&this.totalQty?this.grandTotal/this.totalQty:0}}},W={class:"grid"},Y={class:"col-12"},$={class:"card"},aa={class:"p-fluid formgrid grid"},ta={class:"field col-3 sm:col-2 md:col-2"},ea={class:"field col-3 sm:col-2 md:col-2"},ia={class:"field col-2 sm:col-2 md:col-2"},na=n("div",{class:"field col-6 sm:col-6 md:col-6"},null,-1),la={class:"field col-5 sm:col-4 md:col-4"},sa={class:"flex flex-column"},oa={class:""},ra={class:"field col-1 sm:col-1 md:col-1"},ua={class:"field col-3 sm:col-3 md:col-3"},da={class:"col-12 my-4"},ma=n("hr",null,null,-1),ha=n("p",null,"Bahan Baku",-1),ca={key:0,class:"flex flex-column"},ba={class:"text-green-500"},_a={class:"flex flex-column"},ga={class:""},ya=n("hr",null,null,-1),pa=n("p",null,"Biaya",-1),ka=n("div",{class:"md:col-6"},null,-1),fa={class:"col-12 md:col-6 col-span-4"},Ca={class:"grid py-3 justify-content-center align-items-center"},Ba=n("div",{class:"col-6"},"Grand Total",-1),qa={class:"col-6 text-right"},va={class:"grid py-3 justify-content-center align-items-center"},wa=n("div",{class:"col-12"},[n("hr")],-1),Sa=n("div",{class:"col-6"},"Harga Satuan",-1),Va={class:"col-6 text-right"},Aa=n("br",null,null,-1),Ea={class:"grid"},Da=n("div",{class:"col-6"},null,-1),Pa={class:"col-6"},Fa={class:"flex flex-wrap gap-3 justify-content-end"};function La(t,a,e,h,i,d){const U=y("Toast"),G=y("Tag"),q=y("Label"),J=y("Dropdown"),v=y("ErrorMsg"),j=y("Calendar"),P=y("InputText"),S=y("AutoComplete"),V=y("InputNumber"),O=y("AutoCompleteGudang"),w=y("Column"),F=y("Button"),L=y("DataTable"),I=y("SubmitButton");return m(),k("div",W,[n("div",Y,[u(U),n("div",$,[n("h5",null,[p(c(t.title)+" ",1),u(G,{style:{float:"right"},value:t.$h.getLabel(i.item.status),severity:t.$h.getLabel(i.item.status)},null,8,["value","severity"])]),n("div",aa,[n("div",ta,[u(q,{required:""},{default:b(()=>[p(" Jenis")]),_:1}),u(J,{id:"jenis",modelValue:i.selectedJenis,"onUpdate:modelValue":a[0]||(a[0]=l=>i.selectedJenis=l),options:i.lJenis,optionLabel:"label",placeholder:"Status",onChange:d.selectJenis},null,8,["modelValue","options","onChange"]),u(v,{error:i.FormError.tgl_dibutuhkan},null,8,["error"])]),n("div",ea,[u(q,{required:""},{default:b(()=>[p("Tanggal")]),_:1}),u(j,{dateFormat:"dd-mm-yy",modelValue:i.item.tanggal,"onUpdate:modelValue":a[1]||(a[1]=l=>i.item.tanggal=l),inputId:"tanggal",class:B(i.FormError.tanggal&&"p-invalid"),maxDate:t.$h.today},null,8,["modelValue","class","maxDate"]),u(v,{error:i.FormError.tanggal},null,8,["error"])]),n("div",ia,[u(q,{required:i.isEdit},{default:b(()=>[p("Nomor")]),_:1},8,["required"]),u(P,{readonly:"",id:"nomor",type:"text",modelValue:i.item.nomor,"onUpdate:modelValue":a[2]||(a[2]=l=>i.item.nomor=l),class:B(i.FormError.nomor&&"p-invalid")},null,8,["modelValue","class"]),u(v,{error:i.FormError.nomor},null,8,["error"])]),na,n("div",la,[u(q,{required:""},{default:b(()=>[p(" Barang")]),_:1}),u(S,{modelValue:i.item.nama_barang,"onUpdate:modelValue":a[3]||(a[3]=l=>i.item.nama_barang=l),suggestions:i.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:d.searchProduk,class:"min-w-max",dropdown:"",onItemSelect:d.selectBarangHeader,onDropdownClick:d.searchAllProduk},{option:b(l=>[n("div",sa,[n("small",{class:B(l.option.is_stok?"text-green-500":"text-blue-500")},c(l.option.kode_barang),3),n("div",oa,c(l.option.nama_barang),1)])]),_:1},8,["modelValue","suggestions","onComplete","onItemSelect","onDropdownClick"]),u(v,{error:i.FormError.tgl_dibutuhkan},null,8,["error"])]),n("div",ra,[u(q,{required:""},{default:b(()=>[p(" Qty")]),_:1}),u(V,{id:"qty",type:"text",modelValue:i.item.qty,"onUpdate:modelValue":[a[4]||(a[4]=l=>i.item.qty=l),d.updatePerhitunganDetail],class:B(i.FormError.qty&&"p-invalid")},null,8,["modelValue","onUpdate:modelValue","class"]),u(v,{error:i.FormError.tgl_dibutuhkan},null,8,["error"])]),n("div",ua,[u(O,{classField:"field mr-4 col-12 sm:col-12 md:col-12",modelValue:i.item.id_gudang,"onUpdate:modelValue":a[5]||(a[5]=l=>i.item.id_gudang=l)},null,8,["modelValue"])]),n("div",da,[ma,ha,u(L,{value:i.item.bahan_baku,editMode:"cell",onCellEditComplete:d.onCellBahanBakuEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"width:100%"},{default:b(()=>[(m(!0),k(C,null,x(i.columnsBahanBaku,l=>(m(),f(w,{key:l.field,field:l.field,header:l.header,style:{width:"25%"}},N({body:b(({data:o,field:s})=>[s=="nama_produk"?(m(),k("span",ca,[n("small",ba,c(o.kode_barang),1),n("span",null,c(o.nama_barang),1)])):g("",!0),s=="qty"&&o[s]>0?(m(),k(C,{key:1},[p(c(t.$h.formatNumber(o[s])),1)],64)):g("",!0),s=="satuan"?(m(),k(C,{key:2},[p(c(o.satuan),1)],64)):g("",!0),s=="harga_beli"&&o[s]>0?(m(),k(C,{key:3},[p(c(t.$h.formatNumber(o[s])),1)],64)):g("",!0),s=="total"&&o[s]>0?(m(),k(C,{key:4},[p(c(t.$h.formatNumber(o[s])),1)],64)):g("",!0)]),editor:b(({data:o,field:s})=>[s=="nama_produk"?(m(),f(S,{key:0,modelValue:o[s],"onUpdate:modelValue":_=>o[s]=_,suggestions:i.filteredlProdukDetail,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:d.searchProdukDetail,class:"min-w-max",dropdown:"",onDropdownClick:d.searchAllProdukDetail},{option:b(_=>[n("div",_a,[n("small",{class:B(_.option.is_stok?"text-green-500":"text-blue-500")},c(_.option.kode_barang),3),n("div",ga,c(_.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):g("",!0),s=="qty"?(m(),f(P,{key:1,modelValue:o.qty,"onUpdate:modelValue":_=>o.qty=_,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):g("",!0),s=="harga_beli"?(m(),f(V,{key:2,modelValue:o[s],"onUpdate:modelValue":_=>o[s]=_,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):g("",!0)]),_:2},[l.field=="total"?{name:"footer",fn:b(()=>[p(c(t.$h.formatNumber(this.totalBahanBaku)),1)]),key:"0"}:void 0]),1032,["field","header"]))),128)),i.item.status!="A"?(m(),f(w,{key:0,header:"#",headerStyle:"width:10%;"},{body:b(({data:l})=>[u(F,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:o=>d.removeBahanBaku(l)},null,8,["onClick"])]),_:1})):g("",!0)]),_:1},8,["value","onCellEditComplete"]),ya,pa,u(L,{value:i.item.biaya,class:"mt-5",editMode:"cell",onCellEditComplete:d.onCellBiayaComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"width:100%"},{default:b(()=>[(m(!0),k(C,null,x(i.columnsBiaya,l=>(m(),f(w,{key:l.field,field:l.field,header:l.header,style:{width:"25%"}},N({body:b(({data:o,field:s})=>[s=="account"?(m(),k(C,{key:0},[p(c(o.account),1)],64)):g("",!0),s=="biaya"&&o[s]>0?(m(),k(C,{key:1},[p(c(t.$h.formatNumber(o[s])),1)],64)):g("",!0)]),editor:b(({data:o,field:s})=>[s=="account"?(m(),f(S,{key:0,modelValue:o[s],"onUpdate:modelValue":_=>o[s]=_,optionLabel:"name",suggestions:i.filteredAccount,onComplete:d.searchAccount,class:B({"p-invalid":i.isSubmitted&&!i.item.account}),dropdown:""},{option:b(_=>[n("tr",null,[n("td",null,"["+c(_.option.code)+"]",1),n("td",null,c(_.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","class"])):g("",!0),s=="biaya"?(m(),f(V,{key:1,modelValue:o[s],"onUpdate:modelValue":_=>o[s]=_,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):g("",!0)]),_:2},[l.field=="biaya"?{name:"footer",fn:b(()=>[p(c(t.$h.formatNumber(this.totalBiaya)),1)]),key:"0"}:void 0]),1032,["field","header"]))),128)),i.item.status!="A"?(m(),f(w,{key:0,header:"#",headerStyle:"width:10%;"},{body:b(({data:l})=>[u(F,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:o=>d.removeBiaya(l)},null,8,["onClick"])]),_:1})):g("",!0)]),_:1},8,["value","onCellEditComplete"])]),ka,n("div",fa,[n("div",Ca,[Ba,n("div",qa,c(t.$h.formatNumber(d.grandTotal)),1)]),n("div",va,[wa,Sa,n("div",Va,c(t.$h.formatNumber(d.hargaSatuan)),1)])])]),Aa,n("div",Ea,[Da,n("div",Pa,[n("div",Fa,[i.item.status=="D"||i.item.status=="O"?(m(),f(I,{key:0,loading:t.$isLoading.value,data:i.item,onClick:a[6]||(a[6]=l=>d.Save("D")),onClose:a[7]||(a[7]=l=>d.Save("A")),showClose:i.item.status=="D"},null,8,["loading","data","showClose"])):g("",!0)])])])])])])}const Qa=Q(Z,[["render",La]]);export{Qa as default};
