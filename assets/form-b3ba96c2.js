import{a as E}from"./options-b2eb7ae6.js";import{a as ie}from"./pajak-69cfe91a.js";import{a as U}from"./api-f000d862.js";import{_ as oe,y as ne,r as k,A as re,o as u,c as _,b as a,d as n,l as f,t as h,e as g,n as v,m as x,q,B as D,f as V,k as y,C as de}from"./index-11eb6111.js";import{A as ue}from"./index-b9e295bc.js";import"./custom-zod-e9521e5d.js";/* empty css                                */import{z as c}from"./index-0ec66d4d.js";const H=c.object({nomor:c.string().max(30).nullish(),tanggal:c.date(),tanggal_referensi:c.date(),referensi:c.string().min(1).max(255),id_customer:c.number().int().positive(),id_quotation:c.number().nullish(),id_gudang:c.number(),id_salesman:c.number(),telepon:c.string().min(1).max(50),kepada:c.string().max(100).nullish(),hp:c.string().max(255).nullish(),email:c.string().min(1).email().max(100),top:c.number().gte(0),syarat:c.string().nullish(),deliverypoint:c.string().max(255).nullish()}),J=c.object({nama_barang:c.string().min(1).max(255),qty:c.number().gte(0),id_satuan:c.number(),harga:c.number().gte(0),diskonrp:c.number().gte(0),diskonpersen:c.number().gte(0),id_pajak:c.string().nullish(),note:c.string().max(255).nullish(),total:c.number().gte(0)}),me=H.extend({status:c.literal("D"),detail:c.array(J).min(1,"Produk/Jasa Tidak boleh kosong")}),Q=H.extend({status:c.literal("O"),detail:c.array(J.extend({qty:c.number().gt(0),harga:c.number().gt(0),total:c.number().gt(0)})).min(1,"Produk/Jasa Tidak boleh kosong")}),ce=Q.extend({status:c.literal("S")}),pe=c.discriminatedUnion("status",[me,Q,ce]),he={data(){return{settingStore:ne(),item:{id:null,nomor:null,tanggal:null,tanggal_referensi:null,referensi:null,id_customer:null,id_quotation:null,id_gudang:null,id_salesman:null,revisi_penawaran:null,customer:null,no_penawaran:null,status:null,email:null,kepada:null,keterangan:null,total:0,dpp:0,diskon_baris:0,diskonpersen:0,total_discount:0,grandtotal:0,detail:[{type:"produk",id_barang:null,nama_barang:null,note:null,qty:null,satuan:null,harga:null,diskonrp:null,diskonpersen:null,pajak:null,id_pajak:null,persen_pajak:null,total:null,id_satuan:null,selectedPajak:[],optionSatuan:[],id_proyek:null,proyek:null}]},quotation:null,lSalesman:[],selectedSalesman:null,filteredSalesman:[],lProduk:[],selectedProduk:null,filteredlProduk:[],lPajak:[],selectedAllPajak:null,lSatuan:[],lProyek:null,selectedProyek:null,filteredlProyek:[],columns:[{field:"nama_barang",header:"Produk/Jasa",width:"15%",class:"left"},{field:"note",header:"Deskripsi",width:"15%",class:"left"},{field:"qty",header:"Kuantitas",width:"15%",class:"left",type:"number"},{field:"selectedSatuan",header:"Satuan",width:"15%",class:"left"},{field:"harga",header:"Harga Satuan",width:"15%",class:"right",type:"currency"},{field:"diskonpersen",header:"Diskon %",width:"15%",class:"left"},{field:"selectedPajak",header:"Pajak",width:"15%",class:"right"},{field:"total",header:"Jumlah",width:"15%",class:"right",type:"currency"},{field:"selectedProyek",header:"Proyek",error:"id_proyek"}],showPersetujuanDialog:!1,isClean:!0,cancelDialog:!1,isEdit:!1,nullDetail:null,status:null}},computed:{subtotal(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total||0),0)},total_discount(){return this.subtotal*(this.item.diskonpersen??0)/100},dpp(){return this.subtotal-this.total_discount},grandtotal(){return this.dpp+this.selectedPajakDetail.reduce((t,e)=>t+e.nilai,0)},FormItem(){return{...this.item,status:this.status,detail:this.item.detail.filter(t=>t.nama_barang!=null)}},FormError(){var t,e;return this.isClean?{}:((e=(t=pe.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}},selectedPajakDetail(){const t=[];return this.item.detail.forEach(e=>{const s=e.total-(e.diskon?e.diskon:0)*e.qty;e.selectedPajak!=null&&e.selectedPajak.forEach(m=>{const l={};l.id=m.id,l.nama=m.nama,l.nilai=(s-s*(this.item.diskonpersen||0)/100)*m.nilai/100;let o=-1;for(let w=0;w<t.length;w++)if(t[w].nama===l.nama){o=w;break}o==-1?t.push(l):t[o].nilai+=l.nilai})}),t},canPersetujuan(){var s;const t=(s=this.item.persetujuan)==null?void 0:s.find(m=>m.id_pegawai==this.$auth.id&&m.tanggal_persetujuan==null),e=t?this.item.persetujuan.find(m=>m.urut<t.urut&&m.status===!0):null;return t&&(e||(t==null?void 0:t.urut)==1)},lPajakSelection(){return this.settingStore.penjualan.pajak=="b"?this.lPajak.filter(t=>this.settingStore.penjualan.id_pajak.some(e=>e==t.id)).map(t=>({...t,is_selected:t.is_selected||!1})):[]}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.getData().then(()=>{this.isEdit?(this.getSalesOrder(),this.status=this.item.status):(this.item.tanggal=new Date,this.getSalesman())}).finally(()=>{this.$timeoutLoading()}),this.item.created_name=this.$auth.nama},methods:{getColumnDetail(){return this.columns.filter(t=>t.field=="diskonpersen"?this.settingStore.pembelian.diskon_per_baris:t.field=="selectedPajak"?!!this.settingStore.pembelian.pajak:t.field=="selectedProyek"?!!this.settingStore.pembelian.proyek:!0)},onCellEditComplete(t){const{data:e,newValue:s,field:m}=t;switch(m){case"nama_barang":if(typeof s=="string"||s==null){e[m]=s,this.item.detail.some(l=>l.nama_barang==null)||this.tambahDetail();return}e.id_satuan=s.id_satuan,e.diskonpersen=0,e.diskonrp=0,e.qty=0,e.option_satuan=s.option_satuan,e.selectedSatuan=e.option_satuan.find(l=>l.id==s.id_satuan),e.harga=parseFloat(s.harga_jual),e.total=(e.harga-e.diskonrp)*e.qty,e.kode_barang=s.kode_barang,e.id_barang=s.id,e[m]=s.nama_barang,this.item.detail.some(l=>l.nama_barang==null)||this.tambahDetail();break;case"selectedProyek":if(!s)return;e[m]=s,e.proyek=s.proyek,e.id_proyek=s.id;break;case"selectedSatuan":if(!s)return;e[m]=s,e.id_satuan=s.id,e.harga=e.harga/s.konversi*(t.value?t.value.konversi:1),e.diskonrp=e.diskonpersen*e.harga/100,e.total=(e.harga-e.diskonrp)*e.qty;break;case"selectedPajak":e[m]=s,e.pajak=s.map(l=>l.nama).join(),e.id_pajak=s.map(l=>l.id).join(),e.persen_pajak=s.map(l=>l.nilai).join();break;case"qty":e[m]=s||0,e.total=e.harga*s;break;case"harga":e[m]=s||0,e.total=e.qty*s;break;case"diskonpersen":e[m]=s||0,e.diskonrp=e.harga*s/100,e.total=(e.harga-e.diskonrp)*e.qty;break;case"diskonrp":e[m]=s||0,e.diskonpersen=s/e.harga*100,e.total=(e.harga-e.diskonrp)*e.qty;break;default:e[m]=s;break}},async getSalesOrder(){this.isEdit&&await U.show(this.item.id).then(t=>{this.item=t.data.data,this.item.tanggal=new Date(this.item.tanggal),this.item.tanggal_referensi=this.item.tanggal_referensi==null?null:new Date(this.item.tanggal_referensi),this.item.id_salesman!=null&&(this.selectedSalesman=this.lSalesman.find(s=>s.id==this.item.id_salesman)),this.item.detail.forEach(s=>{if(s.id_barang){const m=this.lProduk.find(l=>l.id==s.id_barang);s.option_satuan=m.option_satuan,s.selectedSatuan=s.option_satuan.find(l=>l.id==s.id_satuan)}else s.option_satuan=[],s.selectedSatuan=this.lSatuan.find(m=>m.id==s.id_satuan);if(s.id_pajak){const m=this.lPajak.filter(l=>s.id_pajak.split(",").includes(l.id.toString()));s.selectedPajak=m,s.pajak=m.map(l=>l.nama).join(),s.id_pajak=m.map(l=>l.id).join(),s.persen_pajak=m.map(l=>l.nilai).join()}s.qty=parseFloat(s.qty),s.harga=parseFloat(s.harga),s.diskonpersen=parseFloat(s.diskonpersen),s.diskonrp=parseFloat(s.diskonrp),s.total=parseFloat(s.total)}),this.settingStore.penjualan.pajak=="b"&&(this.lPajak=this.lPajak.map(s=>{var m,l;return{...s,is_selected:(l=(m=this.item.detail[0])==null?void 0:m.selectedPajak)==null?void 0:l.some(o=>o.id==s.id)}})),(this.item.status=="D"||this.item.status=="O")&&this.tambahDetail(),this.item.detail.every(s=>s.nama_barang!=null&&s.nama_barang.trim()!=="")&&this.item.status=="O"&&this.item.detail.push({...this.nullDetail})})},async getData(){await E.getProyek().then(t=>{this.lProyek=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Proyek",life:3e3})}),await E.getPegawai().then(t=>{this.lSalesman=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Salesman",life:3e3})}),await E.getProduk().then(t=>{this.lProduk=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await E.getSatuan().then(t=>{this.lSatuan=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})}),await ie.index().then(t=>{this.lPajak=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Pajak",life:3e3})})},getSalesman(){this.selectedSalesman=this.lSalesman.find(t=>t.id==this.$auth.id),this.selectedSalesman!=null&&(this.item.id_salesman=this.selectedSalesman.id,this.item.salesman=this.selectedSalesman.name)},selectCustomer(t){console.log(t.value),this.item.id_customer=t.value.id,this.item.customer=t.value.kontak,this.item.telepon=t.value.telepon,this.item.kepada=t.value.attention,this.item.hp=t.value.hp,this.item.email=t.value.email,this.item.top=t.value.top,this.item.deliverypoint=t.value.alamat_kirim},selectSalesman(t){this.item.id_salesman=t.value.id},selectAllPajak(t){this.item.detail.forEach(e=>{e.selectedPajak=t.value,e.pajak=t.value.map(s=>s.nama).join(),e.id_pajak=t.value.map(s=>s.id).join(),e.persen_pajak=t.value.map(s=>s.nilai).join()})},changePajakSelection(){this.item.detail.forEach(t=>{const e=this.lPajakSelection.filter(s=>s.is_selected);t.selectedPajak=this.lPajakSelection.filter(s=>s.is_selected),t.pajak=e.map(s=>s.nama).join(),t.id_pajak=e.map(s=>s.id).join(),t.persen_pajak=e.map(s=>s.nilai).join()})},searchProyek(t){setTimeout(()=>{this.filteredlProyek=t.query.trim().length?this.lProyek.filter(e=>e.proyek.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProyek]},250)},searchAllProyek(){setTimeout(()=>{this.filteredlProyek=this.lProyek.filter(t=>!this.item.detail.some(e=>e.proyek==t.proyek))},250)},searchSalesman(t){setTimeout(()=>{this.filteredSalesman=t.query.trim().length?this.lSalesman.filter(e=>e.name.toLowerCase().includes(t.query.toLowerCase())):[...this.lSalesman]},250)},searchProduk(t){setTimeout(()=>{this.filteredlProduk=t.query.trim().length?this.lProduk.filter(e=>e.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProduk]},250)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(t=>!this.item.detail.some(e=>e.nama_barang==t.nama_barang))},250)},searchQuotation(t){setTimeout(()=>{this.filteredlQuotation=t.query.trim().length?this.lQuotation.filter(e=>e.nomor.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lQuotation]},250)},searchPajak(t){setTimeout(()=>{this.filteredlPajak=t.query.trim().length?this.lPajak.filter(e=>e.nama.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lPajak]},250)},toggleSelectAllPajak(t){this.$refs.op_select_all_pajak.toggle(t)},tambahDetail(){this.item.detail.push({...this.nullDetail})},switchType(t){const e=this.item.detail[t].type=this.item.detail[t].type=="produk"?"jasa":"produk";this.item.detail[t]={...this.nullDetail,type:e}},hapusDetail(t){this.item.detail.length!=1&&(this.item.detail=this.item.detail.filter(e=>e!==t))},async Save(t="D"){try{if(this.isClean=!1,this.$isLoading.value=!0,this.status=t,this.item.total=this.subtotal,this.item.diskonpersen=this.item.diskonpersen??0,this.item.total_discount=this.total_discount,this.item.grandtotal=this.grandtotal,this.item.pajak=this.selectedPajakDetail,Object.keys(this.FormError).length>0){this.$timeoutLoading();return}this.isEdit?await U.update(this.item.id,this.FormItem).then(e=>{this.item.status=e.data.data.status,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3})}):await U.store(this.FormItem).then(e=>{this.item.id=e.data.data.id,this.item.nomor=e.data.data.nomor,this.item.status=e.data.data.status,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),setTimeout(()=>{this.isEdit=!0,this.$router.replace({name:"so.edit",params:{id:this.item.id}})},1200),this.isEdit=!0})}catch(e){e instanceof ue&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})}finally{this.$timeoutLoading()}},async submitPersetujuan(t=!1){const e={id:this.item.id,status:t,keterangan:this.item.keterangan};this.$isLoading.value=!0,await U.updatePersetujuan(e).then(s=>{this.item.status=s.data.data.status_pr?s.data.data.status_pr:this.item.status,this.item.persetujuan.forEach(m=>{m.urut==s.data.data.urut&&(m.tanggal_persetujuan=s.data.data.tanggal_persetujuan,m.status=s.data.data.status,m.keterangan=s.data.data.keterangan)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Update persetujuan",life:3e3}),this.showPersetujuanDialog=!1}).catch(s=>{this.$toast.add({severity:"error",summary:"Error",detail:s,life:3e3})}).finally(()=>{this.$timeoutLoading()}),this.showPersetujuanDialog=!1},confirmApprove(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!0},confirmReject(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!1}}},ge={class:"grid"},_e={class:"col-12"},ke={class:"card"},ye={class:"p-fluid formgrid grid"},fe={class:"field col-12 sm:col-6 md:col-4 xl:col-2"},be={class:"field col-12 sm:col-6 md:col-3 xl:col-2"},je={class:"field col-12 sm:col-6 md:col-3 xl:col-2"},ve={class:"field col-12 sm:col-6 md:col-4 xl:col-2"},Pe={class:"field col-12 sm:col-6 md:col-3 xl:col-2"},Se={class:"field col-6 md:col-2"},Ve={class:"field col-12 sm:col-4 md:col-3 xl:col-2"},we={class:"field col-12 sm:col-6 md:col-3 xl:col-2"},xe={class:"field col-12 sm:col-6 md:col-3 xl:col-2"},Ce={class:"flex align-options-center"},De={class:"field col-12 sm:col-6 md:col-3 xl:col-2"},Fe={class:"field col-6 sm:col-3 md:col-3 xl:col-2"},Ee=a("div",{class:"field col-12"},null,-1),Ue={class:"col-12 my-4"},qe={class:"flex align-items-center gap-2"},Le={class:"capitalize"},Te={key:0},Ae={key:1},Ne={key:0,class:"flex flex-column"},Ie={class:"text-green-500"},Oe={key:2},Be={key:3},Me={class:"flex flex-column"},Re={key:4,style:{"text-align":"center"}},ze={key:5,style:{"text-align":"end"}},Ke={key:6},He={class:"flex flex-column"},Je={class:""},Qe={class:"flex flex-column"},Ye={class:""},Ge={key:4,class:"text-right"},We={class:"grid col pb-0"},Xe={class:"col py-1"},Ze={class:"col text-green-500 py-1"},$e={class:"col-12 md:col-6"},et=a("span",{class:"ql-formats"},[a("button",{class:"ql-bold",type:"button"}),a("button",{class:"ql-italic",type:"button"}),a("button",{class:"ql-underline",type:"button"})],-1),tt=a("span",{class:"ql-formats"},[a("button",{class:"ql-list",value:"ordered",type:"button"}),a("button",{class:"ql-list",value:"bullet",type:"button"}),a("select",{class:"ql-align"},[a("option",{defaultValue:""}),a("option",{value:"center"}),a("option",{value:"right"}),a("option",{value:"justify"})])],-1),at=a("br",null,null,-1),lt=a("br",null,null,-1),st=a("div",{class:"col"},null,-1),it={class:"col-12 md:col-6 xl:col-4"},ot={class:"grid py-3 justify-content-center align-items-center"},nt=a("div",{class:"col-7 md:col-6"},"Subtotal",-1),rt={class:"col-5 md:col-6 text-right"},dt={class:"grid py-3 justify-content-center align-items-center"},ut=a("div",{class:"col-3 sm:col-2 md:col-2 lg:col-2"},"Diskon",-1),mt={class:"col-5 sm:col-4 md:col-5 lg:col-4"},ct={class:"p-inputgroup p-0"},pt=a("span",{class:"p-inputgroup-addon"},[a("i",{class:"pi pi-percentage"})],-1),ht={class:"col-4 sm:col-6 md:col-5 lg:col-6 text-right"},gt={class:"grid py-3 justify-content-center align-items-center"},_t=a("div",{class:"col-7 md:col-6"},"Total Setelah Diskon",-1),kt={class:"col-5 md:col-6 text-right"},yt={key:0},ft={class:"col-4"},bt={class:"field col-4"},jt={class:"col-4 text-right"},vt={key:1},Pt={class:"col-6"},St={class:"col-6 text-right"},Vt={class:"grid py-3 justify-content-center align-items-center"},wt=a("div",{class:"col-12"},[a("hr")],-1),xt=a("div",{class:"col-6"},"Grand Total",-1),Ct={class:"col-6 text-right"},Dt={key:0,class:"p-datatable col-6"},Ft={class:"p-datatable-table p-datatable-striped"},Et=a("thead",{class:"p-datatable-thead"},[a("tr",{role:"row"},[a("th",{colspan:"7",class:"text-left"},"Harus Disetujui Oleh:")]),a("tr",null,[a("th",null,"No"),a("th",null,"Nama"),a("th",null,"Jabatan"),a("th",null,"Tanggal"),a("th",null,"Status"),a("th",null,"Keterangan")])],-1),Ut={class:"p-datatable-tbody"},qt={key:0},Lt={key:1},Tt={key:2},At={class:"grid"},Nt=a("div",{class:"col-6"},null,-1),It={class:"col-6"},Ot={class:"flex flex-wrap gap-3 justify-content-end"},Bt={class:"grid col pb-0"},Mt={class:"col py-1"},Rt={class:"col text-green-500 py-1"},zt=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"Enter the reason for canceling")],-1),Kt=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"Masukkan Catatan")],-1);function Ht(t,e,s,m,l,o){var M,R,z;const w=k("Toast"),Y=k("Tag"),G=k("AutoCompleteKontak"),b=k("Label"),P=k("InputText"),j=k("ErrorMsg"),W=k("InputTop"),N=k("Calendar"),L=k("AutoComplete"),X=k("AutoCompleteGudang"),F=k("Column"),S=k("Button"),I=k("Dropdown"),T=k("InputNumber"),O=k("MultiSelect"),Z=k("DataTable"),$=k("Editor"),A=k("Textarea"),ee=k("inputNumber"),te=k("Checkbox"),ae=k("SubmitButton"),le=k("OverlayPanel"),B=k("Dialog"),C=re("select-all-text");return u(),_("div",ge,[a("div",_e,[a("div",ke,[n(w),a("h5",null,[f(h(l.isEdit?"Ubah":"Tambah")+" Pesanan Penjualan ",1),n(Y,{style:{float:"right"},value:t.$h.getLabel(l.item.status),severity:t.$h.getLabel(l.item.status)},null,8,["value","severity"])]),a("div",ye,[a("div",fe,[n(G,{label:"Pelanggan",onSelectItem:o.selectCustomer,modelValue:l.item.id_customer,"onUpdate:modelValue":e[0]||(e[0]=i=>l.item.id_customer=i),error:o.FormError.id_customer},null,8,["onSelectItem","modelValue","error"])]),a("div",be,[n(b,{required:"",for:"phonenumber"},{default:g(()=>[f("Telepon")]),_:1}),n(P,{id:"phonenumber",type:"text",modelValue:l.item.telepon,"onUpdate:modelValue":e[1]||(e[1]=i=>l.item.telepon=i),class:v({"p-invalid":o.FormError.telepon})},null,8,["modelValue","class"]),n(j,{error:o.FormError.telepon},null,8,["error"])]),a("div",je,[n(b,{required:"",for:"email"},{default:g(()=>[f("Email")]),_:1}),n(P,{id:"email",type:"text",modelValue:l.item.email,"onUpdate:modelValue":e[2]||(e[2]=i=>l.item.email=i),class:v({"p-invalid":o.FormError.email})},null,8,["modelValue","class"]),n(j,{error:o.FormError.email},null,8,["error"])]),a("div",ve,[n(b,{for:"contact"},{default:g(()=>[f("Kepada")]),_:1}),n(P,{id:"contact",type:"text",modelValue:l.item.kepada,"onUpdate:modelValue":e[3]||(e[3]=i=>l.item.kepada=i),class:v({"p-invalid":o.FormError.kepada})},null,8,["modelValue","class"]),n(j,{error:o.FormError.kepada},null,8,["error"])]),a("div",Pe,[n(b,{for:"hp"},{default:g(()=>[f("HP")]),_:1}),n(P,{modelValue:l.item.hp,"onUpdate:modelValue":e[4]||(e[4]=i=>l.item.hp=i),id:"hp",type:"text",class:v({"p-invalid":o.FormError.hp})},null,8,["modelValue","class"]),n(j,{error:o.FormError.hp},null,8,["error"])]),a("div",Se,[n(W,{top:l.item.top,"onUpdate:top":e[5]||(e[5]=i=>l.item.top=i),id:l.item.id_top,"onUpdate:id":e[6]||(e[6]=i=>l.item.id_top=i),error:o.FormError.top},null,8,["top","id","error"])]),a("div",Ve,[n(b,{required:"",class:"mb-1"},{default:g(()=>[f("Tanggal")]),_:1}),n(N,{modelValue:l.item.tanggal,"onUpdate:modelValue":e[7]||(e[7]=i=>l.item.tanggal=i),maxDate:t.$h.today,inputId:"tanggal",class:v({"p-invalid":o.FormError.tanggal})},null,8,["modelValue","maxDate","class"]),n(j,{error:o.FormError.tanggal},null,8,["error"])]),a("div",we,[n(b,{generated:"",for:"sonumber"},{default:g(()=>[f("Nomor")]),_:1}),n(P,{id:"sonumber",type:"text",modelValue:l.item.nomor,"onUpdate:modelValue":e[8]||(e[8]=i=>l.item.nomor=i),class:v({"p-invalid":o.FormError.nomor}),disabled:""},null,8,["modelValue","class"]),n(j,{error:o.FormError.nomor},null,8,["error"])]),a("div",xe,[n(b,{required:"",for:"salesitem",class:"mb-2"},{default:g(()=>[f("Salesman")]),_:1}),n(L,{modelValue:l.selectedSalesman,"onUpdate:modelValue":e[9]||(e[9]=i=>l.selectedSalesman=i),optionLabel:"nama",suggestions:l.filteredSalesman,class:v({"p-invalid":o.FormError.id_salesman}),onComplete:o.searchSalesman,onItemSelect:o.selectSalesman,dropdown:""},{option:g(i=>[a("div",Ce,[a("div",null,h(i.option.nama),1)])]),_:1},8,["modelValue","suggestions","class","onComplete","onItemSelect"]),n(j,{error:o.FormError.id_salesman},null,8,["error"])]),n(X,{classField:"md:col-2",modelValue:l.item.id_gudang,"onUpdate:modelValue":e[10]||(e[10]=i=>l.item.id_gudang=i)},null,8,["modelValue"]),a("div",De,[n(b,{required:"",for:"ponumber"},{default:g(()=>[f("Referensi")]),_:1}),n(P,{id:"ponumber",type:"text",modelValue:l.item.referensi,"onUpdate:modelValue":e[11]||(e[11]=i=>l.item.referensi=i),class:v({"p-invalid":o.FormError.referensi})},null,8,["modelValue","class"]),n(j,{error:o.FormError.referensi},null,8,["error"])]),a("div",Fe,[n(b,{required:"",class:"mb-1"},{default:g(()=>[f("Tanggal Referensi")]),_:1}),n(N,{modelValue:l.item.tanggal_referensi,"onUpdate:modelValue":e[12]||(e[12]=i=>l.item.tanggal_referensi=i),inputId:"tanggal_referensi",maxDate:t.$h.today,class:v(o.FormError.tanggal_referensi&&"p-invalid")},null,8,["modelValue","maxDate","class"]),n(j,{error:o.FormError.tanggal_referensi},null,8,["error"])]),Ee,a("div",Ue,[n(Z,{value:l.item.detail,editMode:"cell",onCellEditComplete:o.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{default:g(()=>[n(F,{header:"#",headerStyle:"width:10px;"},{body:g(({index:i})=>[f(h(i+1),1)]),_:1}),n(F,{header:"Tipe",headerStyle:"width:5%;"},{body:g(({data:i,index:r})=>[a("div",qe,[n(S,{onClick:d=>o.switchType(r),icon:i.type=="produk"?"pi pi-box":"pi pi-briefcase",severity:i.type=="produk"?"primary":"secondary",disabled:l.item.status=="C"},null,8,["onClick","icon","severity","disabled"]),a("span",Le,h(i.type),1)])]),_:1}),(u(!0),_(x,null,q(o.getColumnDetail(),i=>(u(),y(F,{key:i.field,field:i.field,header:i.header,headerStyle:i.width,class:v(i.class)},de({body:g(({data:r,field:d,index:p})=>{var K;return[d=="selectedSatuan"?(u(),_("div",Te,h(r[d]&&r[d].satuan),1)):d=="nama_barang"?(u(),_("div",Ae,[r.type=="produk"?(u(),_("span",Ne,[a("small",Ie,h(r.kode_barang),1),a("span",null,h(r.nama_barang),1)])):(u(),y(P,{key:1,modelValue:r[d],"onUpdate:modelValue":se=>r[d]=se,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))])):d=="selectedPajak"?(u(),_("div",Oe,h((K=r.pajak)==null?void 0:K.toString()),1)):d=="selectedProyek"?(u(),_("div",Be,[a("span",Me,[a("span",null,h(r.proyek),1)])])):d=="qty"?(u(),_("div",Re,h(t.$h.formatNumber(r[d])),1)):i.type=="currency"?(u(),_("div",ze,h(t.$h.formatNumber(r[d])),1)):(u(),_("div",Ke,h(r[d]),1)),o.FormError.detail&&o.FormError.detail[p]?(u(),y(j,{key:7,error:o.FormError.detail[p][i.error?i.error:d]},null,8,["error"])):V("",!0)]}),header:g(()=>[i.header==="Pajak"?(u(),y(S,{key:0,icon:"pi pi-chevron-down",class:"p-button p-button-outlined",onClick:o.toggleSelectAllPajak},null,8,["onClick"])):V("",!0)]),_:2},[l.item.status!="C"?{name:"editor",fn:g(({data:r,field:d})=>[d=="nama_barang"?(u(),_(x,{key:0},[r.type=="produk"?(u(),y(L,{key:0,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,suggestions:l.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:o.searchProduk,class:"min-w-max",dropdown:"",onDropdownClick:o.searchAllProduk},{option:g(p=>[a("div",He,[a("small",{class:v(p.option.is_stok?"text-green-500":"text-blue-500")},h(p.option.kode_barang),3),a("div",Je,h(p.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(u(),y(P,{key:1,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))],64)):d=="selectedProyek"?(u(),y(L,{key:1,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,suggestions:l.filteredlProyek,optionLabel:"proyek",virtualScrollerOptions:{itemSize:50},onComplete:o.searchProyek,class:"min-w-max",dropdown:"",onDropdownClick:o.searchAllProyek},{option:g(p=>[a("div",Qe,[a("small",null,h(p.option.kode),1),a("div",Ye,h(p.option.proyek),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):d=="selectedSatuan"?(u(),_(x,{key:2},[r.type=="produk"?(u(),y(I,{key:0,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,id:"satuan",options:r.option_satuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"])):(u(),y(I,{key:1,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,id:"satuan",options:l.lSatuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"]))],64)):d=="note"?D((u(),y(P,{key:3,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,id:"note",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[C]]):d=="total"?(u(),_("div",Ge,h(t.$h.formatNumber(r[d])),1)):d=="qty"?D((u(),y(T,{key:5,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,id:"qty",minFractionDigits:1,maxFractionDigits:5,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[C]]):i.type=="currency"?D((u(),y(T,{key:6,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,mode:"currency",locale:"id-ID",currency:"IDR",onFocus:t.selectAllText,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","onFocus"])),[[C]]):d=="diskonpersen"?D((u(),y(T,{key:7,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,id:"diskonpersen",min:"0",max:"100",minFractionDigits:1,maxFractionDigits:5,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[C]]):d=="selectedPajak"?(u(),y(O,{key:8,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,options:l.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem"},{option:g(p=>[a("div",We,[a("div",Xe,h(p.option.nama),1),a("div",Ze,h(p.option.nilai)+"%",1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])):V("",!0)]),key:"0"}:void 0]),1032,["field","header","headerStyle","class"]))),128)),n(F,{header:"#",headerStyle:"width:5%;"},{body:g(({data:i})=>[n(S,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:r=>o.hapusDetail(i)},null,8,["onClick"])]),_:1})]),_:1},8,["value","onCellEditComplete"]),n(j,{error:o.FormError.detail},null,8,["error"])]),a("div",$e,[n(b,{for:"description"},{default:g(()=>[f("Syarat dan Ketentuan")]),_:1}),n($,{id:"syarat",rows:"5",modelValue:l.item.syarat,"onUpdate:modelValue":e[13]||(e[13]=i=>l.item.syarat=i),editorStyle:o.FormError.syarat&&"border: 1px red solid !important"},{toolbar:g(()=>[et,tt]),_:1},8,["modelValue","editorStyle"]),at,lt,n(b,{for:"description",class:"mt-3"},{default:g(()=>[f("Delivery Point")]),_:1}),n(A,{id:"description",required:"true",rows:"3",modelValue:l.item.deliverypoint,"onUpdate:modelValue":e[14]||(e[14]=i=>l.item.deliverypoint=i)},null,8,["modelValue"])]),st,a("div",it,[a("div",ot,[nt,a("div",rt,h(t.$h.formatNumber(o.subtotal)),1)]),a("div",dt,[ut,a("div",mt,[a("div",ct,[D(n(ee,{placeholder:"0",modelValue:l.item.diskonpersen,"onUpdate:modelValue":e[15]||(e[15]=i=>l.item.diskonpersen=i),min:0,max:100,minFractionDigits:0,maxFractionDigits:2},null,8,["modelValue"]),[[C]]),pt])]),a("div",ht,h(t.$h.formatNumber(o.total_discount)),1)]),a("div",gt,[_t,a("div",kt,h(t.$h.formatNumber(o.dpp)),1)]),l.settingStore.penjualan.pajak=="b"?(u(),_("div",yt,[(u(!0),_(x,null,q(o.lPajakSelection,(i,r)=>{var d;return u(),_("div",{key:i,class:"grid py-3 justify-content-center align-items-center"},[a("div",ft,h(i.nama),1),a("div",bt,[n(te,{modelValue:i.is_selected,"onUpdate:modelValue":p=>i.is_selected=p,binary:!0,onChange:o.changePajakSelection},null,8,["modelValue","onUpdate:modelValue","onChange"])]),a("div",jt,h(t.$h.formatNumber((d=o.selectedPajakDetail[r])==null?void 0:d.nilai)),1)])}),128))])):V("",!0),l.settingStore.penjualan.pajak=="a"?(u(),_("div",vt,[(u(!0),_(x,null,q(o.selectedPajakDetail,i=>(u(),_("div",{key:i,class:"grid py-3 justify-content-center align-items-center"},[a("div",Pt,h(i.nama),1),a("div",St,h(t.$h.formatNumber(i.nilai)),1)]))),128))])):V("",!0),a("div",Vt,[wt,xt,a("div",Ct,h(t.$h.formatNumber(o.grandtotal)),1)])])]),((M=l.item.persetujuan)==null?void 0:M.length)>0&&!this.$route.query.revisi?(u(),_("div",Dt,[a("table",Ft,[Et,a("tbody",Ut,[(u(!0),_(x,null,q(l.item.persetujuan,(i,r)=>(u(),_("tr",{key:r},[a("td",null,h(r+1),1),a("td",null,h(i.nama),1),a("td",null,h(i.jabatan),1),a("td",null,h(t.$h.formatDate(i.tanggal_persetujuan,"DD-MM-YYYY HH:mm:ss")),1),i.tanggal_persetujuan!=null&&!i.status?(u(),_("td",qt,"Reject")):i.tanggal_persetujuan!=null&&i.status?(u(),_("td",Lt,"Approve")):(u(),_("td",Tt,"Menunggu Persetujuan")),a("td",null,h(i.keterangan),1)]))),128))])])])):V("",!0),a("div",At,[Nt,a("div",It,[a("div",Ot,[!o.canPersetujuan&&!((z=(R=l.item.persetujuan)==null?void 0:R[0])!=null&&z.tanggal_persetujuan)&&l.item.status!="C"?(u(),y(ae,{key:0,loading:t.$isLoading.value,data:l.item,onClick:e[16]||(e[16]=i=>{var r;return o.Save((r=l.settingStore.penjualan.persetujuan.salesorder)!=null&&r.persetujuan1?"S":"O")}),onDraft:e[17]||(e[17]=i=>o.Save("D")),showDraft:l.item.status=="D"||l.item.status==null},null,8,["loading","data","showDraft"])):V("",!0),l.item.status=="S"&&o.canPersetujuan?(u(),y(S,{key:1,label:"Reject",severity:"danger",iconPos:"right",icon:"pi pi-times",onClick:o.confirmReject,class:"mx-2"},null,8,["onClick"])):V("",!0),l.item.status=="S"&&o.canPersetujuan?(u(),y(S,{key:2,label:"Approve",severity:"success",iconPos:"right",icon:"pi pi-check",onClick:o.confirmApprove},null,8,["onClick"])):V("",!0)])])]),n(le,{ref:"op_select_all_pajak"},{default:g(()=>[n(O,{modelValue:l.selectedAllPajak,"onUpdate:modelValue":e[18]||(e[18]=i=>l.selectedAllPajak=i),options:l.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem",onChange:o.selectAllPajak},{option:g(i=>[a("div",Bt,[a("div",Mt,h(i.option.nama),1),a("div",Rt,h(i.option.nilai)+"%",1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},512),n(B,{visible:l.cancelDialog,"onUpdate:visible":e[21]||(e[21]=i=>l.cancelDialog=i),style:{width:"450px"},header:"Confirm",modal:!0},{footer:g(()=>[n(S,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:e[20]||(e[20]=i=>l.cancelDialog=!1)}),n(S,{label:"Submit",icon:"pi pi-check",class:"p-button-text",onClick:t.submitCancel},null,8,["onClick"])]),default:g(()=>[zt,n(A,{class:"w-full",modelValue:l.item.alasan,"onUpdate:modelValue":e[19]||(e[19]=i=>l.item.alasan=i),rows:"5",cols:"30"},null,8,["modelValue"])]),_:1},8,["visible"]),n(B,{visible:l.showPersetujuanDialog,"onUpdate:visible":e[25]||(e[25]=i=>l.showPersetujuanDialog=i),style:{width:"450px"},header:"Confirm",modal:!0},{footer:g(()=>[n(S,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:e[23]||(e[23]=i=>l.showPersetujuanDialog=!1)}),n(S,{label:t.isApprove?"Approve":"Reject",icon:"pi pi-check",class:"p-button-text",onClick:e[24]||(e[24]=i=>o.submitPersetujuan(t.isApprove))},null,8,["label"])]),default:g(()=>[Kt,n(A,{class:"w-full",modelValue:l.item.keterangan,"onUpdate:modelValue":e[22]||(e[22]=i=>l.item.keterangan=i),rows:"5",cols:"30",placeholder:"Optional"},null,8,["modelValue"])]),_:1},8,["visible"])])])])}const ea=oe(he,[["render",Ht]]);export{ea as default};
