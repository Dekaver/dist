import{D as f,_ as T,F as k,a2 as B,r as m,o as d,c as u,b as i,d as o,l as g,e as r,t as c,m as U,q as E,k as V,f as D}from"./index-11eb6111.js";import{a as I}from"./proposalap-fc9fa4f8.js";const P={index(){return f.get("/acc-ap-faktur/")},indexByDate(s){return f.get(`/acc-ap-faktur/tanggal/${s}`)},indexBySupplier(s){return f.get(`/acc-ap-faktur?id_kontak=${s}`)},store(s){return f.post("/acc-ap-faktur/",s)},update(s,e){return f.patch("/acc-ap-faktur/"+s,e)},show(s){return f.get("/acc-ap-faktur/"+s)},destroy(s){return f.delete("/acc-ap-faktur/"+s)}},L={data(){return{columns:[{field:"amount",header:"Total",type:"currency"}],hari:7,item:{nomor:null,tanggal:new Date(Date.now()),keterangan:null,status:"D",detail:[]},lItem:[],selectedItem:[],lApFaktur:[],selectedApFaktur:[],isSubmitted:!1,isEdit:!1,closingDialog:!1,filters:{global:{value:null,matchMode:k.CONTAINS},invoice_number:{value:null,matchMode:k.CONTAINS},kontak:{value:null,matchMode:k.CONTAINS},due_date:{value:null,matchMode:k.CONTAINS}},splitButtonClossing:[{label:"Save Permanent",icon:"pi pi-refresh",command:()=>{this.closingDialog="true"}}]}},methods:{async getData(){await P.indexByDate(B(new Date(Date.now()+parseInt(this.hari)*24*60*60*1e3)).format("DD-MM-YYYY")).then(s=>{if(this.lApFaktur=s.data.data,console.log(this.isEdit,"this.isEdit"),this.isEdit){const e=new Set(this.lItem.map(_=>_.id));console.log(e,"uniqueIds");const p=this.lApFaktur.filter(_=>!e.has(_.id));console.log(p,"filteredLApFaktur"),this.lItem=[...this.lItem,...p],console.log(this.lItem,"this.lItem")}else this.lItem=this.lApFaktur}).catch(s=>{this.$toast.add({severity:"error",summary:"Failed",detail:s.response.data.message,life:3e3})})},Save(s="D"){try{this.isSubmitted=!0,this.$isLoading.value=!0,this.isEdit?(this.item.status=s,this.item.detail=this.selectedItem,I.update(this.item.id,this.item).then(e=>{this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),this.item=e.data.data}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})):I.store({...this.item,detail:this.selectedItem}).then(e=>{this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),this.item.id=e.data.data.id,this.item.nomor=e.data.data.nomor,this.item.tanggal=new Date(e.data.data.tanggal),this.isEdit=!0,setTimeout(()=>{this.$router.push({name:"proposalap.edit",params:{id:e.data.data.id}})},1e3)}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})}catch{this.item.status="D"}finally{this.isSubmitted=!1,this.closingDialog=!1,this.$timeoutLoading()}},Destroy(s){this.selectedApFaktur=this.selectedApFaktur.filter(e=>e.id!=s.id),this.lApFaktur=this.lApFaktur.filter(e=>e.id!=s.id)},async getProposalAp(){await I.show(this.id).then(s=>{this.item=s.data.data,this.item.tanggal=new Date(this.item.tanggal),s.data.data.detail.map(e=>{const p=this.lApFaktur.find(_=>_.invoice_number==e.invoice_number);p&&(this.lItem.push(p),this.selectedItem.push(p))})}).catch(s=>{this.$toast.add({severity:"error",summary:"Failed",detail:s.response.data.message,life:3e3})})}},mounted(){this.id=this.$route.params.id?this.$route.params.id:null,this.item.id=this.id,this.isEdit=!!this.id,this.$isLoading.value=!1,this.getData().then(()=>{this.id&&this.getProposalAp()})}},M={class:"grid"},O={class:"col-12"},Y={class:"card"},j={class:"p-fluid formgrid grid"},q={class:"field col-3"},$=i("label",{for:"noproposal"},"Proposal Number",-1),z={class:"field col-2"},J={class:"p-float-label"},G=i("p",{class:"mb-1"},"Tanggal Proposal",-1),H={class:"field col-4"},K=i("label",{for:"Notes"},"Notes",-1),Q=i("div",{class:"col-12"},null,-1),R={class:"field col-1"},W=i("label",{for:"hari"},"Hari",-1),X={class:"field col-fixed flex align-items-end"},Z={class:"col-12 my-4"},ee={class:"flex justify-content-end w-2 ml-auto"},te={class:"p-input-icon-left"},se=i("i",{class:"pi pi-search"},null,-1),le={key:0},ie={key:1},oe={key:0,class:"product-badge status-lowstock"},ae={key:1,class:"product-badge status-instock"},ne={key:2},de={key:3,class:"text-right"},re={key:4},ue={class:"grid"},me={class:"col-6"},ce={class:"flex flex-wrap gap-3 justify-content-start"},pe={class:"col-6"},he={key:0,class:"flex flex-wrap gap-3 justify-content-end"},fe={class:"flex flex-column align-items-center justify-content-center"},ge=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),_e={key:0};function ye(s,e,p,_,l,b){const C=m("Toast"),S=m("Tag"),y=m("InputText"),w=m("Calendar"),A=m("InputNumber"),v=m("Button"),h=m("Column"),x=m("DataTable"),F=m("SplitButton"),N=m("Dialog");return d(),u("div",M,[i("div",O,[i("div",Y,[o(C),i("h5",null,[g(" Proposal Payment AP "),o(S,{style:{float:"right"},value:s.$h.getLabel(l.item.status),severity:s.$h.getLabel(l.item.status)},null,8,["value","severity"])]),i("div",j,[i("div",q,[$,o(y,{modelValue:l.item.nomor,"onUpdate:modelValue":e[0]||(e[0]=t=>l.item.nomor=t),modelModifiers:{trim:!0},id:"noproposal",readonly:""},null,8,["modelValue"])]),i("div",z,[i("span",J,[G,o(w,{dateFormat:"dd-mm-yy",modelValue:l.item.tanggal,"onUpdate:modelValue":e[1]||(e[1]=t=>l.item.tanggal=t),inputId:"tglproposal"},null,8,["modelValue"])])]),i("div",H,[K,o(y,{modelValue:l.item.keterangan,"onUpdate:modelValue":e[2]||(e[2]=t=>l.item.keterangan=t),modelModifiers:{trim:!0},id:"Notes"},null,8,["modelValue"])]),Q,i("div",R,[W,o(A,{modelValue:l.hari,"onUpdate:modelValue":e[3]||(e[3]=t=>l.hari=t),modelModifiers:{number:!0},inputId:"minmax",min:0},null,8,["modelValue"])]),i("div",X,[o(v,{label:"Search",icon:"pi pi-search",severity:"primary",size:"medium",iconPos:"left",onClick:e[4]||(e[4]=t=>b.getData())})]),i("div",Z,[o(x,{filters:l.filters,"onUpdate:filters":e[6]||(e[6]=t=>l.filters=t),filterDisplay:"row",globalFilterFields:["invoice_number","kontak","due_date"],value:l.lItem,selection:l.selectedItem,"onUpdate:selection":e[7]||(e[7]=t=>l.selectedItem=t),compareSelectionBy:"deepEquals",editMode:"cell",onCellEditComplete:s.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{header:r(()=>[i("div",ee,[i("span",te,[se,o(y,{modelValue:l.filters.global.value,"onUpdate:modelValue":e[5]||(e[5]=t=>l.filters.global.value=t),placeholder:"Global Search"},null,8,["modelValue"])])])]),default:r(()=>[o(h,{selectionMode:"multiple"}),o(h,{header:"#",headerStyle:"width:10px"},{body:r(t=>[g(c(t.index+1),1)]),_:1}),o(h,{field:"kontak",header:"Vendor",style:{"min-width":"12rem"}},{body:r(({data:t})=>[g(c(t.kontak),1)]),filter:r(({filterModel:t,filterCallback:n})=>[o(y,{modelValue:t.value,"onUpdate:modelValue":a=>t.value=a,type:"text",onInput:a=>n(),class:"p-column-filter",placeholder:"Search by Vendor"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),o(h,{field:"invoice_number",header:"Invoice",style:{"min-width":"12rem"}},{body:r(({data:t})=>[g(c(t.invoice_number),1)]),filter:r(({filterModel:t,filterCallback:n})=>[o(y,{modelValue:t.value,"onUpdate:modelValue":a=>t.value=a,type:"text",onInput:a=>n(),class:"p-column-filter",placeholder:"Search by Invoice"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),o(h,{field:"due_date",header:"Tanggal Jatuh Tempo",style:{"min-width":"12rem"}},{body:r(({data:t})=>[g(c(s.$h.formatDate(t.due_date)),1)]),filter:r(({filterModel:t,filterCallback:n})=>[o(y,{modelValue:t.value,"onUpdate:modelValue":a=>t.value=a,type:"text",onInput:a=>n(),class:"p-column-filter",placeholder:"Search by Tanggal Jatuh Tempo"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),(d(!0),u(U,null,E(l.columns,t=>(d(),V(h,{key:t.field,field:t.field,header:t.header},{body:r(({data:n,field:a})=>[a=="icon"?(d(),u("div",le,[o(v,{icon:n[a],class:"p-button-rounded p-button-outlined p-button-icon"},null,8,["icon"])])):a=="status"?(d(),u("div",ie,[n[a]=="D"?(d(),u("span",oe,"Draft")):n[a]=="O"?(d(),u("span",ae,"Open")):D("",!0)])):t.type=="date"?(d(),u("div",ne,c(s.$h.formatDate(n[a])),1)):t.type=="currency"?(d(),u("div",de,c(s.$h.formatNumber(n[a])),1)):(d(),u("div",re,c(n[a]),1))]),_:2},1032,["field","header"]))),128)),o(h,{header:"#",headerStyle:"width:5%;"},{body:r(({data:t})=>[o(v,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:n=>b.Destroy(t)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","selection","onCellEditComplete"])])]),i("div",ue,[i("div",me,[i("div",ce,[l.isEdit?(d(),V(v,{key:0,label:"Print",severity:"help",icon:"pi pi-print",iconPos:"left"})):D("",!0)])]),i("div",pe,[l.item.status=="D"?(d(),u("div",he,[o(F,{label:"Save Draft",onClick:e[8]||(e[8]=t=>b.Save("D")),model:l.splitButtonClossing,loading:s.$isLoading.value,disabled:s.$isLoading.value},null,8,["model","loading","disabled"])])):D("",!0)])]),o(N,{visible:l.closingDialog,"onUpdate:visible":e[11]||(e[11]=t=>l.closingDialog=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:r(()=>[o(v,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[9]||(e[9]=t=>l.closingDialog=!1)}),o(v,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:e[10]||(e[10]=t=>b.Save("C"))})]),default:r(()=>[i("div",fe,[ge,l.item?(d(),u("span",_e,[g("Are you sure you want to close this "),i("b",null,c(l.item.nomor),1),g("?")])):D("",!0)])]),_:1},8,["visible"])])])])}const ke=T(L,[["render",ye]]);export{ke as default};
