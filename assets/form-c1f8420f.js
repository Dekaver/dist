import{a as U}from"./options-b2eb7ae6.js";import{a as le}from"./pajak-69cfe91a.js";import{a as C}from"./api-646607e4.js";import{_ as ie,y as se,D as oe,r as g,A as ne,o as d,c as _,b as a,d as u,l as f,t as p,e as k,n as V,m as S,q as F,k as y,f as b,B as A}from"./index-11eb6111.js";import{A as re}from"./index-b9e295bc.js";import"./custom-zod-e9521e5d.js";import{z as c}from"./index-0ec66d4d.js";const J=c.object({id:c.number().nullish(),nomor:c.string().nullish(),tanggal:c.date(),telepon:c.string().nullish(),email:c.string(),referensi:c.string(),tanggal_referensi:c.date(),top:c.number(),persendiskon:c.number().nullish(),syarat:c.string().min(1),alamat_kirim:c.string().nullish(),status:c.string(),id_supplier:c.number().positive(),id_gudang:c.number().positive()}),z=c.object({nama_barang:c.string().min(1).max(255),id_barang:c.number().nullish().nullish(),id_satuan:c.number(),id_pajak:c.string().nullish().nullish(),harga:c.number().min(0),diskonpersen:c.number().min(0),diskonrp:c.number().min(0),persen_pajak:c.string().nullish(),total:c.number().min(0)}),de=J.extend({status:c.literal("D"),detail:c.array(z.extend({qty:c.number().gte(0)})).min(1,"Produk/Jasa Required")}),L=J.extend({status:c.literal("O"),detail:c.array(z.extend({qty:c.number().gt(0)})).min(1,"Produk/Jasa Required")}),ue=L.extend({status:c.literal("S")}),me=L.extend({status:c.literal("A")}),ce=c.discriminatedUnion("status",[de,L,ue,me]),pe={data(){return{settingStore:se(),item:{tanggal:null,referensi:null,tanggal_referensi:null,persendiskon:null,status:null,top:null,id_gudang:null,id_supplier:null,alamat_kirim:null,telepon:null,email:null,keterangan:null,id_top:null,detail:[{type:"produk",nama_barang:null,kode_barang:null,qty:null,harga:null,diskonpersen:null,diskonrp:null,pajak:null,id_pajak:null,persen_pajak:null,total:null,id_barang:null,id_satuan:null,selectedPajak:[],option_satuan:[],id_proyek:null,proyek:null}],persetujuan:[]},lProduk:[],filteredlProduk:[],selectedProduk:null,lPajak:[],selectedAllPajak:[],lProyek:[],selectedProyek:null,filteredlProyek:[],lSatuan:[],columns:[{field:"nama_barang",header:"Produk/Jasa"},{field:"keterangan",header:"Deskripsi"},{field:"nomor_pr",header:"No Permintaan"},{field:"qty",header:"Kuantitas",type:"number"},{field:"selectedSatuan",header:"Satuan",error:"id_satuan"},{field:"harga",header:"Harga Satuan",type:"currency"},{field:"diskonpersen",header:"Diskon %",type:"number"},{field:"selectedPajak",header:"Pajak",class:"right",error:"id_pajak"},{field:"total",header:"Jumlah",type:"currency"},{field:"selectedProyek",header:"Proyek",error:"id_proyek"}],nullDetail:null,status:null,showPersetujuanDialog:!1,isEdit:!1,isClean:!0}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.getData().then(()=>{this.isEdit?this.GetPO():this.item.tanggal=new Date}).finally(()=>{this.$timeoutLoading()})},methods:{selectDisetujui(t){this.item.persetujuan=this.item.persetujuan.filter(e=>e.urut!=2),this.item.persetujuan.push({id_pegawai:t.value.id,urut:2})},selectDiketahui(t){this.item.persetujuan=this.item.persetujuan.filter(e=>e.urut!=1),this.item.persetujuan.push({id_pegawai:t.value.id,urut:1})},async submitPersetujuan(t=!1){const e={id:this.item.id,status:t,keterangan:this.item.keterangan};this.$isLoading.value=!0,await C.updatePersetujuan(e).then(i=>{this.item.status=i.data.data.status_pp?i.data.data.status_pp:this.item.status,this.item.persetujuan.forEach(r=>{r.urut==i.data.data.urut&&(r.tanggal_persetujuan=i.data.data.tanggal_persetujuan,r.status=i.data.data.status,r.keterangan=i.data.data.keterangan)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Update persetujuan",life:3e3}),this.showPersetujuanDialog=!1}).catch(i=>{this.$toast.add({severity:"error",summary:"Error",detail:i,life:3e3})}).finally(()=>{this.$timeoutLoading(),this.showPersetujuanDialog=!1}),this.showPersetujuanDialog=!1},confirmApprove(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!0},confirmReject(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!1},getColumnDetail(){return this.columns.filter(t=>t.field=="nomor_pr"?this.item.detail.some(e=>e.id_pr!=null):t.field=="diskonpersen"?this.settingStore.pembelian.diskon_per_baris:t.field=="selectedPajak"?this.settingStore.pembelian.pajak=="a":t.field=="selectedProyek"?!!this.settingStore.pembelian.proyek:!0)},onCellEditComplete(t){let{data:e,newValue:i,field:r}=t;switch(r){case"nama_barang":if(typeof i=="string"||i==null){e.type=="jasa"&&(e[r]=i,this.tambahDetail());return}e.id_satuan=i.id_satuan,e.diskonpersen=0,e.diskonrp=0,e.option_satuan=i.option_satuan,e.selectedSatuan=e.option_satuan.find(l=>l.id==i.id_satuan),e.qty=0,e.harga=parseFloat(i.harga_beli),e.total=e.qty*e.harga-e.diskonrp,e.kode_barang=i.kode_barang,e.id_barang=i.id,e[r]=i.nama_barang,this.tambahDetail();break;case"selectedSatuan":if(!i)return;e[r]=i,e.id_satuan=i.id,e.harga=e.harga/i.konversi*(t.value?t.value.konversi:1),e.diskonrp=e.qty*e.harga*(e.diskonpersen/100),e.total=e.qty*e.harga-e.diskonrp;break;case"selectedProyek":if(!i)return;e[r]=i,e.proyek=i.proyek,e.id_proyek=i.id;break;case"selectedPajak":if(!i||!i)return;e[r]=i,e.pajak=i.map(l=>l.nama).join(),e.id_pajak=i.map(l=>l.id).join(),e.persen_pajak=i.map(l=>l.nilai).join();break;case"qty":if(i==null){e[r]=0;return}e[r]=i,e.total=i*e.harga-e.diskonrp;break;case"harga":e[r]=i||0,e.total=e.qty*e.harga-e.diskonrp;break;case"diskonpersen":e[r]=i||0,e.diskonrp=e.qty*e.harga*(i/100),e.total=e.qty*e.harga-e.diskonrp;break;case"diskonrp":e[r]=i||0,e.diskonpersen=i/e.harga*100,e.total=e.qty*e.harga-e.diskonrp;break;default:e[r]=i;break}},async GetPO(){await C.show(this.$route.params.id).then(async t=>{this.item=t.data.data,this.item.tanggal=new Date(this.item.tanggal),this.item.tanggal_referensi=this.item.tanggal_referensi?new Date(this.item.tanggal_referensi):null,this.item.persendiskon=parseFloat(this.item.persendiskon),this.item.id_proyek&&(this.item.selectedProyek=this.lProyek.find(e=>e.id==this.item.id_proyek)),this.item.detail.forEach(e=>{if(e.id_barang){const r=this.lProduk.find(l=>l.id==e.id_barang);e.option_satuan=r.option_satuan,e.selectedSatuan=e.option_satuan.find(l=>l.id==e.id_satuan)}else e.option_satuan=[],e.selectedSatuan=this.lSatuan.find(r=>r.id==e.id_satuan);if(e.qty=parseFloat(e.qty),e.harga=parseFloat(e.harga),e.diskonrp=parseFloat(e.diskonrp),e.diskonpersen=parseFloat(e.diskonpersen),e.total=parseFloat(e.total),!e.id_pajak)return;const i=this.lPajak.filter(r=>e.id_pajak.split(",").includes(r.id.toString()));e.selectedPajak=i,e.pajak=i.map(r=>r.nama).join(),e.id_pajak=i.map(r=>r.id).join(),e.persen_pajak=i.map(r=>r.nilai).join()}),this.settingStore.pembelian.pajak=="b"&&(this.lPajak=this.lPajak.map(e=>{var i,r;return{...e,is_selected:(r=(i=this.item.detail[0])==null?void 0:i.selectedPajak)==null?void 0:r.some(l=>l.id==e.id)}})),this.tambahDetail()}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})})},async Save(t){try{if(this.$isLoading.value=!0,this.status=t,this.item.total=this.subtotal,this.item.total_discount=this.total_discount,this.item.dpp=this.dpp,this.item.grandtotal=this.grandtotal,this.item.persendiskon=parseFloat(this.item.persendiskon||0),this.item.pajak=this.selectedPajakDetail,this.isClean=!1,Object.keys(this.FormError).length>0){console.error(this.FormError),this.$timeoutLoading();return}this.isEdit?await C.update(this.item.id,this.FormItem).then(e=>{this.FormError={},this.item.id=e.data.data.id,this.item.status=e.data.data.status,this.item.nomor=e.data.data.nomor,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3})}):await C.store(this.FormItem).then(e=>{this.item.id=e.data.data.id,this.item.status=e.data.data.status,this.item.nomor=e.data.data.nomor,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),this.isEdit=!0,setTimeout(()=>{this.$router.replace({name:"po.edit",params:{id:this.item.id}})},1e3)})}catch(e){e instanceof re&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})}finally{this.$timeoutLoading()}},async getData(){await U.getProyek().then(t=>{this.lProyek=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Proyek",life:3e3})}),await U.getProduk().then(t=>{this.lProduk=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await le.index().then(t=>{this.lPajak=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Pajak",life:3e3})}),await U.getSatuan().then(t=>{this.lSatuan=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})}),await oe.get("/date").then(t=>{this.tanggal=t.data.date,this.item.tanggal=t.data.date})},searchProyek(t){setTimeout(()=>{this.filteredlProyek=t.query.trim().length?this.lProyek.filter(e=>e.proyek.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProyek]},250)},searchAllProyek(){setTimeout(()=>{this.filteredlProyek=this.lProyek.filter(t=>!this.item.detail.some(e=>e.proyek==t.proyek))},250)},selectSupplier(t){this.item.id_supplier=t.value.id,this.selectedSupplier=t.value,this.item.telepon=t.value.telepon,this.item.email=t.value.email,this.item.top=t.value.top,this.item.alamat_kirim=t.value.alamat_kirim,this.item.keterangan=`Purchase Order Kepada ${t.value.kontak}`},searchProduk(t){setTimeout(()=>{this.filteredlProduk=t.query.trim().length?this.lProduk.filter(e=>e.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProduk]},250)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(t=>!this.item.detail.some(e=>e.nama_barang==t.nama_barang))},250)},searchPajak(t){setTimeout(()=>{this.filteredlPajak=t.query.trim().length?this.lPajak.filter(e=>e.nama.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lPajak]},250)},tambahDetail(){this.item.detail.some(t=>t.nama_barang==null)||this.item.detail.push({...this.nullDetail})},selectAllPajak(t){this.item.detail.forEach(e=>{e.selectedPajak=t.value,e.pajak=t.value.map(i=>i.nama).join(),e.id_pajak=t.value.map(i=>i.id).join(),e.persen_pajak=t.value.map(i=>i.nilai).join()})},changePajakSelection(){this.item.detail.forEach(t=>{const e=this.lPajakSelection.filter(i=>i.is_selected);t.selectedPajak=this.lPajakSelection.filter(i=>i.is_selected),t.pajak=e.map(i=>i.nama).join(),t.id_pajak=e.map(i=>i.id).join(),t.persen_pajak=e.map(i=>i.nilai).join()})},toggleSelectAllPajak(t){this.$refs.op_select_all_pajak.toggle(t)},switchType(t){const e=this.item.detail[t].type=this.item.detail[t].type=="produk"?"jasa":"produk";this.item.detail[t]={...this.nullDetail,type:e}},removeDetail(t){this.item.detail.length>1&&(this.item.detail=this.item.detail.filter(e=>e!==t))},cetakPDF(){this.$router.push({name:"po.cetak",params:this.item.id})},filters:{pretty(t){return JSON.stringify(JSON.parse(t),null,2)}}},computed:{subtotal_diskon(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.qty)*parseFloat(e.harga)*parseFloat(e.diskonpersen)/100,0)},subtotal(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total||0),0)},diskon(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total-this.subtotal_diskon),0)},total_discount(){return this.subtotal*(this.item.persendiskon??0)/100},dpp(){return this.subtotal-this.total_discount},grandtotal(){return this.dpp+this.selectedPajakDetail.reduce((t,e)=>t+e.nilai,0)},selectedPajakDetail(){const t=[];return this.item.detail.forEach(e=>{const i=e.total-(e.diskon?e.diskon:0)*e.qty;e.selectedPajak!=null&&e.selectedPajak.forEach(r=>{const l={};l.id=r.id,l.nama=r.nama,l.nilai=(i-i*(this.item.persendiskon||0)/100)*r.nilai/100;let o=-1;for(let D=0;D<t.length;D++)if(t[D].nama===l.nama){o=D;break}o==-1?t.push(l):t[o].nilai+=l.nilai})}),t},FormItem(){return{...this.item,status:this.status,detail:this.item.detail.filter(t=>t.nama_barang!=null)}},FormError(){var t,e;return this.isClean?{}:((e=(t=ce.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}},canPersetujuan(){var i;const t=(i=this.item.persetujuan)==null?void 0:i.find(r=>r.id_pegawai==this.$auth.id&&r.tanggal_persetujuan==null),e=t?this.item.persetujuan.find(r=>r.urut<t.urut&&r.status===!0):null;return t&&(e||(t==null?void 0:t.urut)==1)},lPajakSelection(){return this.settingStore.pembelian.pajak=="b"?this.lPajak.filter(t=>this.settingStore.pembelian.id_pajak.some(e=>e==t.id)).map(t=>({...t,is_selected:t.is_selected||!1})):[]}}},he={class:"grid"},_e={class:"col-12"},ke={class:"card"},ge={class:"p-fluid formgrid grid"},ye={class:"field col-12 sm:col-6 md:col-4 lg:col-4 xl:col-3"},fe={class:"field col-12 sm:col-4 md:col-3 lg:col-3 xl:col-2"},be={class:"field col-6 md:col-3"},je=a("div",{class:"col-12"},null,-1),Pe={class:"field col-12 sm:col-6 md:col-2 lg:col-2 xl:col-2"},ve={class:"field col-12 sm:col-6 md:col-3 lg:col-3 xl:col-2"},Ve={class:"field col-12 sm:col-4 md:col-3 lg:col-3 xl:col-2"},Se={class:"field col-12 sm:col-5 md:col-4 lg:col-4 xl:col-2"},De={class:"col-12 md:col-12 mb-2"},we={class:"col-12 my-4"},xe={class:"text-center"},Ce={class:"flex align-items-center gap-2"},Fe={key:0},Ee={key:1},qe={key:2},Ue={class:"flex flex-column"},Ae={key:3,style:{"text-align":"end"}},Le={key:5},Te={key:0,class:"flex flex-column"},Ne={class:"text-green-500"},Oe={key:6},Ie={class:"flex flex-column"},Be={class:""},Re={class:"flex flex-column"},Me={class:""},Ke={class:"grid col pb-0"},Je={class:"col py-1"},ze={class:"col text-green-500 py-1"},Ge={class:"col-12 md:col-6 xl:col-6 mb-2"},He=a("span",{class:"ql-formats"},[a("button",{class:"ql-bold",type:"button"}),a("button",{class:"ql-italic",type:"button"}),a("button",{class:"ql-underline",type:"button"})],-1),Ye=a("span",{class:"ql-formats"},[a("button",{class:"ql-list",value:"ordered",type:"button"}),a("button",{class:"ql-list",value:"bullet",type:"button"}),a("select",{class:"ql-align"},[a("option",{defaultValue:""}),a("option",{value:"center"}),a("option",{value:"right"}),a("option",{value:"justify"})])],-1),Qe=a("div",{class:"field col-12"},null,-1),We=a("div",{class:"col"},null,-1),Xe={class:"col-12 md:col-4 xl:col-4 col-span-4"},Ze={class:"grid py-3 justify-content-center align-items-center"},$e=a("div",{class:"col-7 md:col-6"},"Subtotal",-1),et={class:"col-5 md:col-6 text-right"},tt={class:"grid py-3 justify-content-center align-items-center"},at=a("div",{class:"col-3 md:col-3 lg:col-2"},"Diskon",-1),lt={class:"col-5 md:col-3 lg:col-4"},it={class:"p-inputgroup"},st=a("span",{class:"p-inputgroup-addon"},[a("i",{class:"pi pi-percentage"})],-1),ot={class:"col-4 sm:col-6 md:col-5 lg:col-6 text-right"},nt={key:0,class:"grid py-3 justify-content-center align-items-center"},rt=a("div",{class:"col-6"},"DPP",-1),dt={class:"col-6 text-right"},ut={key:1},mt={class:"col-4"},ct={class:"field col-4"},pt={class:"col-4 text-right"},ht={key:2},_t={class:"col-6"},kt={class:"col-6 text-right"},gt={class:"grid py-3 justify-content-center align-items-center"},yt=a("div",{class:"col-12"},[a("hr")],-1),ft=a("div",{class:"col-6"},"Grand Total",-1),bt={class:"col-6 text-right"},jt=a("br",null,null,-1),Pt={key:0,class:"p-datatable col-6"},vt={class:"p-datatable-table p-datatable-striped"},Vt=a("thead",{class:"p-datatable-thead"},[a("tr",{role:"row"},[a("th",{colspan:"7",class:"text-left"},"Harus Disetujui Oleh:")]),a("tr",null,[a("th",null,"No"),a("th",null,"Nama"),a("th",null,"Jabatan"),a("th",null,"Tanggal"),a("th",null,"Status"),a("th",null,"Keterangan")])],-1),St={class:"p-datatable-tbody"},Dt={key:0},wt={key:1},xt={key:2},Ct={class:"grid"},Ft={class:"col-6"},Et={class:"flex flex-wrap gap-3 justify-content-start"},qt={class:"col-6"},Ut={class:"flex flex-wrap gap-3 justify-content-end"},At={class:"grid col pb-0"},Lt={class:"col py-1"},Tt={class:"col text-green-500 py-1"},Nt=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"Masukkan Catatan")],-1);function Ot(t,e,i,r,l,o){var R,M,K;const D=g("Toast"),G=g("Tag"),H=g("AutoCompleteKontak"),v=g("Label"),w=g("InputText"),j=g("ErrorMsg"),Y=g("InputTop"),T=g("Calendar"),Q=g("AutoCompleteGudang"),E=g("Textarea"),P=g("Button"),x=g("Column"),N=g("AutoComplete"),O=g("Dropdown"),I=g("MultiSelect"),B=g("InputNumber"),W=g("DataTable"),X=g("Editor"),Z=g("Checkbox"),$=g("SubmitButton"),ee=g("OverlayPanel"),te=g("Dialog"),q=ne("select-all-text");return d(),_("div",he,[a("div",_e,[u(D),a("div",ke,[a("h5",null,[f(p(l.isEdit?"Ubah":"Tambah")+" Purchase Order ",1),u(G,{style:{float:"right"},value:t.$h.getLabel(l.item.status),severity:t.$h.getLabel(l.item.status)},null,8,["value","severity"])]),a("div",ge,[a("div",ye,[u(H,{modelValue:l.item.id_supplier,"onUpdate:modelValue":e[0]||(e[0]=s=>l.item.id_supplier=s),onSelectItem:o.selectSupplier,label:"Supplier","is-supplier":"",error:o.FormError.id_supplier},null,8,["modelValue","onSelectItem","error"])]),a("div",fe,[u(v,{required:""},{default:k(()=>[f("E-mail")]),_:1}),u(w,{id:"email",type:"email",modelValue:l.item.email,"onUpdate:modelValue":e[1]||(e[1]=s=>l.item.email=s),class:V(o.FormError.email&&"p-invalid")},null,8,["modelValue","class"]),u(j,{error:o.FormError.email},null,8,["error"])]),a("div",be,[u(Y,{top:l.item.top,"onUpdate:top":e[2]||(e[2]=s=>l.item.top=s),id:l.item.id_top,"onUpdate:id":e[3]||(e[3]=s=>l.item.id_top=s),error:o.FormError.top,"id-top":l.item.id_top},null,8,["top","id","error","id-top"])]),je,a("div",Pe,[u(v,{required:""},{default:k(()=>[f("Tanggal")]),_:1}),u(T,{dateFormat:"dd-mm-yy",modelValue:l.item.tanggal,"onUpdate:modelValue":e[4]||(e[4]=s=>l.item.tanggal=s),inputId:"tanggal",class:V(o.FormError.tanggal&&"p-invalid"),maxDate:t.$h.today},null,8,["modelValue","class","maxDate"]),u(j,{error:o.FormError.tanggal},null,8,["error"])]),a("div",ve,[u(v,{required:l.isEdit},{default:k(()=>[f("Nomor")]),_:1},8,["required"]),u(w,{disabled:"",id:"nomor",type:"text",modelValue:l.item.nomor,"onUpdate:modelValue":e[5]||(e[5]=s=>l.item.nomor=s),class:V(o.FormError.nomor&&"p-invalid")},null,8,["modelValue","class"]),u(j,{error:o.FormError.nomor},null,8,["error"])]),a("div",Ve,[u(v,{required:""},{default:k(()=>[f("No. Referensi")]),_:1}),u(w,{id:"quotation_number",modelValue:l.item.referensi,"onUpdate:modelValue":e[6]||(e[6]=s=>l.item.referensi=s),class:V(o.FormError.referensi&&"p-invalid")},null,8,["modelValue","class"]),u(j,{error:o.FormError.referensi},null,8,["error"])]),a("div",Se,[u(v,{required:""},{default:k(()=>[f("Tgl. Referensi")]),_:1}),u(T,{dateFormat:"dd-mm-yy",modelValue:l.item.tanggal_referensi,"onUpdate:modelValue":e[7]||(e[7]=s=>l.item.tanggal_referensi=s),inputId:"tanggal_referensi",class:V(o.FormError.tanggal_referensi&&"p-invalid"),maxDate:t.$h.today},null,8,["modelValue","class","maxDate"]),u(j,{error:o.FormError.tanggal_referensi},null,8,["error"])]),u(Q,{modelValue:l.item.id_gudang,"onUpdate:modelValue":e[8]||(e[8]=s=>l.item.id_gudang=s),error:o.FormError.id_gudang},null,8,["modelValue","error"]),a("div",De,[u(v,{for:"syarat"},{default:k(()=>[f("Keterangan")]),_:1}),u(E,{id:"keterangan",type:"text",modelValue:l.item.keterangan,"onUpdate:modelValue":e[9]||(e[9]=s=>l.item.keterangan=s),class:V(o.FormError.keterangan&&"p-invalid")},null,8,["modelValue","class"])]),a("div",we,[u(W,{value:l.item.detail,editMode:"cell",onCellEditComplete:o.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{empty:k(()=>[a("div",xe,[u(P,{onClick:o.tambahDetail,severity:"info",outlined:"",label:"Tambah"},null,8,["onClick"])])]),default:k(()=>[u(x,{header:"#",headerStyle:"width:10px;"},{body:k(({index:s})=>[f(p(s+1),1)]),_:1}),u(x,{header:"Tipe",headerStyle:"width:5%;"},{body:k(({data:s,index:n})=>[a("div",Ce,[u(P,{onClick:m=>o.switchType(n),icon:s.type=="produk"?"pi pi-box":"pi pi-briefcase",severity:s.type=="produk"?"primary":"secondary"},null,8,["onClick","icon","severity"])])]),_:1}),(d(!0),_(S,null,F(o.getColumnDetail(),s=>(d(),y(x,{key:s.field,field:s.field,header:s.header},{body:k(({data:n,field:m,index:h})=>[m=="selectedSatuan"?(d(),_("div",Fe,p(n[m]&&n[m].satuan),1)):m=="selectedPajak"?(d(),_("div",Ee,p(n.pajak==null?null:n.pajak.toString()),1)):m=="selectedProyek"?(d(),_("div",qe,[a("span",Ue,[a("span",null,p(n.proyek),1)])])):s.type=="currency"&&n[m]>0?(d(),_("div",Ae,p(t.$h.formatNumber(n[m])),1)):m=="qty"&&n[m]>0?(d(),_(S,{key:4},[f(p(t.$h.formatNumber(n[m])),1)],64)):m=="nama_barang"?(d(),_("div",Le,[n.type=="produk"?(d(),_("span",Te,[a("small",Ne,p(n.kode_barang),1),a("span",null,p(n.nama_barang),1)])):(d(),y(w,{key:1,modelValue:n[m],"onUpdate:modelValue":ae=>n[m]=ae,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))])):(d(),_("div",Oe,p(n[m]),1)),o.FormError.detail&&o.FormError.detail[h]?(d(),y(j,{key:7,error:o.FormError.detail[h][s.error?s.error:m]},null,8,["error"])):b("",!0)]),header:k(()=>[s.header==="Pajak"?(d(),y(P,{key:0,icon:"pi pi-chevron-down",class:"p-button p-button-outlined",onClick:o.toggleSelectAllPajak},null,8,["onClick"])):b("",!0)]),editor:k(({data:n,field:m})=>[m=="nama_barang"?(d(),_(S,{key:0},[n.type=="produk"?(d(),y(N,{key:0,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,suggestions:l.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:o.searchProduk,class:"min-w-max",dropdown:"",onDropdownClick:o.searchAllProduk},{option:k(h=>[a("div",Ie,[a("small",{class:V(h.option.is_stok?"text-green-500":"text-blue-500")},p(h.option.kode_barang),3),a("div",Be,p(h.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(d(),y(w,{key:1,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))],64)):m=="selectedProyek"?(d(),y(N,{key:1,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,suggestions:l.filteredlProyek,optionLabel:"proyek",virtualScrollerOptions:{itemSize:50},onComplete:o.searchProyek,class:"min-w-max",dropdown:"",onDropdownClick:o.searchAllProyek},{option:k(h=>[a("div",Re,[a("small",null,p(h.option.kode),1),a("div",Me,p(h.option.proyek),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):m=="selectedSatuan"?(d(),_(S,{key:2},[n.type=="produk"?(d(),y(O,{key:0,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,id:"satuan",options:n.option_satuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"])):(d(),y(O,{key:1,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,id:"satuan",options:l.lSatuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"]))],64)):m=="keterangan"?A((d(),y(w,{key:3,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,autofocus:"",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[q]]):m=="selectedPajak"?(d(),y(I,{key:4,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,options:l.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem"},{option:k(h=>[a("div",Ke,[a("div",Je,p(h.option.nama),1),a("div",ze,p(h.option.nilai)+"%",1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])):s.type=="number"||s.type=="currency"?A((d(),y(B,{key:5,modelValue:n[m],"onUpdate:modelValue":h=>n[m]=h,autofocus:"",inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[q]]):(d(),_(S,{key:6},[f(p(n[m]),1)],64))]),_:2},1032,["field","header"]))),128)),this.item.status!="A"&&this.item.status!="R"&&this.item.status!="S"?(d(),y(x,{key:0,header:"#",headerStyle:"width:5%;"},{body:k(({data:s})=>[u(P,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:n=>o.removeDetail(s)},null,8,["onClick"])]),_:1})):b("",!0)]),_:1},8,["value","onCellEditComplete"]),u(j,{error:o.FormError.detail},null,8,["error"])]),a("div",Ge,[u(v,{for:"syarat"},{default:k(()=>[f("Syarat dan Ketentuan")]),_:1}),u(X,{id:"syarat",rows:"5",modelValue:l.item.syarat,"onUpdate:modelValue":e[10]||(e[10]=s=>l.item.syarat=s),editorStyle:o.FormError.syarat&&"border: 1px red solid !important"},{toolbar:k(()=>[He,Ye]),_:1},8,["modelValue","editorStyle"]),u(j,{error:o.FormError.syarat},null,8,["error"]),Qe,u(v,{for:"alamat_kirim"},{default:k(()=>[f("Alamat Kirim")]),_:1}),u(E,{id:"alamat_kirim",rows:"3",modelValue:l.item.alamat_kirim,"onUpdate:modelValue":e[11]||(e[11]=s=>l.item.alamat_kirim=s),class:V(o.FormError.alamat_kirim&&"p-invalid")},null,8,["modelValue","class"]),u(j,{error:o.FormError.alamat_kirim},null,8,["error"])]),We,a("div",Xe,[a("div",Ze,[$e,a("div",et,p(t.$h.formatNumber(o.subtotal)),1)]),a("div",tt,[at,a("div",lt,[a("div",it,[A(u(B,{placeholder:"Discount",modelValue:l.item.persendiskon,"onUpdate:modelValue":e[12]||(e[12]=s=>l.item.persendiskon=s),min:0,max:100,minFractionDigits:0,maxFractionDigits:3},null,8,["modelValue"]),[[q]]),st])]),a("div",ot,p(t.$h.formatNumber(o.total_discount)),1)]),o.selectedPajakDetail.length>0&&o.total_discount>0?(d(),_("div",nt,[rt,a("div",dt,p(t.$h.formatNumber(o.dpp)),1)])):b("",!0),l.settingStore.pembelian.pajak=="b"?(d(),_("div",ut,[(d(!0),_(S,null,F(o.lPajakSelection,(s,n)=>{var m;return d(),_("div",{key:s,class:"grid py-3 justify-content-center align-items-center"},[a("div",mt,p(s.nama),1),a("div",ct,[u(Z,{modelValue:s.is_selected,"onUpdate:modelValue":h=>s.is_selected=h,binary:!0,onChange:o.changePajakSelection},null,8,["modelValue","onUpdate:modelValue","onChange"])]),a("div",pt,p(t.$h.formatNumber((m=o.selectedPajakDetail[n])==null?void 0:m.nilai)),1)])}),128))])):b("",!0),l.settingStore.pembelian.pajak=="a"?(d(),_("div",ht,[(d(!0),_(S,null,F(o.selectedPajakDetail,s=>(d(),_("div",{key:s,class:"grid py-3 justify-content-center align-items-center"},[a("div",_t,p(s.nama),1),a("div",kt,p(t.$h.formatNumber(s.nilai)),1)]))),128))])):b("",!0),a("div",gt,[yt,ft,a("div",bt,p(t.$h.formatNumber(o.grandtotal)),1)])])]),jt,((R=l.item.persetujuan)==null?void 0:R.length)>0&&!this.$route.query.revisi?(d(),_("div",Pt,[a("table",vt,[Vt,a("tbody",St,[(d(!0),_(S,null,F(l.item.persetujuan,(s,n)=>(d(),_("tr",{key:n},[a("td",null,p(n+1),1),a("td",null,p(s.nama),1),a("td",null,p(s.jabatan),1),a("td",null,p(t.$h.formatDate(s.tanggal_persetujuan,"DD-MM-YYYY HH:mm:ss")),1),s.tanggal_persetujuan!=null&&!s.status?(d(),_("td",Dt,"Reject")):s.tanggal_persetujuan!=null&&s.status?(d(),_("td",wt,"Approve")):(d(),_("td",xt,"Menunggu Persetujuan")),a("td",null,p(s.keterangan),1)]))),128))])])])):b("",!0),a("div",Ct,[a("div",Ft,[a("div",Et,[l.isEdit?(d(),y(P,{key:0,label:"Print",severity:"help",icon:"pi pi-print",iconPos:"left",onClick:o.cetakPDF},null,8,["onClick"])):b("",!0)])]),a("div",qt,[a("div",Ut,[!o.canPersetujuan&&!((K=(M=l.item.persetujuan)==null?void 0:M[0])!=null&&K.tanggal_persetujuan)?(d(),y($,{key:0,loading:t.$isLoading.value,data:l.item,onClick:e[13]||(e[13]=s=>{var n;return o.Save((n=l.settingStore.pembelian.persetujuan.pesanan)!=null&&n.persetujuan1?"S":"O")}),onDraft:e[14]||(e[14]=s=>o.Save("D")),showDraft:l.item.status==null||l.item.status=="D"},null,8,["loading","data","showDraft"])):b("",!0),l.item.status=="S"&&o.canPersetujuan?(d(),y(P,{key:1,label:"Reject",severity:"danger",iconPos:"right",icon:"pi pi-times",onClick:o.confirmReject,class:"mx-2"},null,8,["onClick"])):b("",!0),l.item.status=="S"&&o.canPersetujuan?(d(),y(P,{key:2,label:"Approve",severity:"success",iconPos:"right",icon:"pi pi-check",onClick:o.confirmApprove},null,8,["onClick"])):b("",!0)])])]),u(ee,{ref:"op_select_all_pajak"},{default:k(()=>[u(I,{modelValue:l.selectedAllPajak,"onUpdate:modelValue":e[15]||(e[15]=s=>l.selectedAllPajak=s),options:l.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem",onChange:o.selectAllPajak},{option:k(s=>[a("div",At,[a("div",Lt,p(s.option.nama),1),a("div",Tt,p(s.option.nilai)+"%",1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},512),u(te,{visible:l.showPersetujuanDialog,"onUpdate:visible":e[19]||(e[19]=s=>l.showPersetujuanDialog=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:k(()=>[u(P,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:e[17]||(e[17]=s=>l.showPersetujuanDialog=!1)}),u(P,{label:t.isApprove?"Approve":"Reject",icon:"pi pi-check",class:"p-button-text",onClick:e[18]||(e[18]=s=>o.submitPersetujuan(t.isApprove))},null,8,["label"])]),default:k(()=>[Nt,u(E,{class:"w-full",modelValue:l.item.keterangan,"onUpdate:modelValue":e[16]||(e[16]=s=>l.item.keterangan=s),rows:"5",cols:"30",placeholder:"Optional"},null,8,["modelValue"])]),_:1},8,["visible"])])])])}const Gt=ie(pe,[["render",Ot]]);export{Gt as default};
