import{a as L}from"./options-b2eb7ae6.js";import{a as ae}from"./produk-90d88791.js";import{a as E}from"./api-a685b482.js";import{a as ie}from"./pajak-69cfe91a.js";import{a as le}from"./satuan-84ad7de8.js";import{M as ne}from"./ModalJurnal-5f84a831.js";import{A as se}from"./index-b9e295bc.js";import{_ as oe,v as re,x as ue,j as de,E as me,y as ce,r as k,A as he,o as c,c as _,d as r,b as i,l as S,t as p,f as b,e as g,n as P,m as V,q as U,k as y,B as F,C as pe}from"./index-11eb6111.js";import{z as m}from"./index-0ec66d4d.js";const H=m.object({nomor:m.string().min(1).max(30).nullish(),tanggal:m.date(),id_kontak:m.number().positive(),id_gudang:m.number().nullish(),id_top:m.number().positive(),faktur:m.string().max(50).nullish(),keterangan:m.string().max(100).nullish(),id_salesman:m.number().positive(),total_pajak:m.number().nullish(),total:m.number().positive(),total_discount:m.number().nullish(),dpp:m.number().positive().nullish(),grandtotal:m.number().positive().nullish(),diskonpersen:m.number().nullish(),top:m.number().int().positive(),referensi:m.string().max(50).nullish(),status:m.string().length(1).nullish(),tanggal_jatuh_tempo:m.date(),check_biaya_lain:m.boolean(),detail:m.array(m.object({nama_barang:m.string().min(1).max(255),id_barang:m.number().positive().nullish(),id_satuan:m.number().positive(),qty:m.number(),harga:m.number(),total:m.number(),harga_asli:m.number().nullish(),diskonrp:m.number().nullish(),diskonpersen:m.number().nullish(),id_pajak:m.string().nullish(),persen_pajak:m.string().nullish(),id_do:m.number().positive().nullish(),keterangan:m.string().nullish(),id_proyek:m.number().positive().nullish()})).min(1,{message:"Minimal Terdapat 1 Produk/Jasa"})}),_e=H.extend({status:m.literal("D"),total:m.number().gte(0),dpp:m.number().gte(0),grandtotal:m.number().gte(0)}),z=H.extend({status:m.literal("S"),detail:m.array(m.object({qty:m.number().gt(0)})).min(1,{message:"Minimal Terdapat 1 Produk/Jasa"})}),ge=z.extend({status:m.literal("O")}),ke=m.discriminatedUnion("status",[_e,z,ge]),ye={data(){return{akuntansiStore:re(),akunStore:ue(),gudangStore:de(),kantorStore:me(),settingStore:ce(),item:{id:null,nomor:null,tanggal:null,id_kontak:null,id_so:null,id_gudang:null,id_top:null,kepada:null,keterangan:null,total:null,total_discount:null,tanggal_jatuh_tempo:null,id_salesman:null,total_pajak:null,pajak:null,dpp:null,grandtotal:null,diskonpersen:0,top:null,referensi:null,status:null,faktur:null,tgl_transporter:null,gudang:null,salesman:null,customer:null,diskon_baris:null,biaya_lain:0,check_biaya_lain:!1,detail:[{type:"produk",id_barang:null,is_stok:null,nama_barang:null,kode_barang:null,qty:null,harga:null,diskonpersen:null,diskonrp:null,total:null,id_satuan:null,option_satuan:[],id_proyek:null,proyek:null}]},sales_order:null,lSalesman:[],selectedSalesman:null,filteredSalesman:[],lPajak:[],selectedAllPajak:[],biayaLainDialog:!1,lSatuan:null,lProduk:null,filteredlProduk:[],lProyek:null,selectedProyek:null,filteredlProyek:[],columns:[{field:"nama_barang",header:"Produk/Jasa",width:"15%",class:"left",editor:!0},{field:"keterangan",header:"Deskripsi",width:"15%",class:"left",editor:!0},{field:"qty",header:"Kuantitas",width:"15%",class:"left",type:"number",editor:!0},{field:"selectedSatuan",header:"Satuan",width:"15%",class:"left",editor:!0},{field:"harga",header:"Harga Satuan",width:"15%",class:"right",type:"currency",editor:!0},{field:"diskonpersen",header:"Diskon %",width:"15%",class:"left",editor:!0},{field:"selectedPajak",header:"Pajak",width:"15%",class:"right",editor:!0},{field:"total",header:"Total",width:"15%",class:"right",editor:!1},{field:"selectedProyek",header:"Proyek",error:"id_proyek",editor:!0}],jurnalDialog:!1,showPersetujuanDialog:!1,nullDetail:null,status:!0,isClean:!0,isEdit:!1,filters:{}}},computed:{subtotal(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total||0),0)},FormItem(){return{...this.item,status:this.status,jurnal:this.jurnal,detail:this.item.detail.filter(t=>t.nama_barang!=null)}},total_discount(){return this.subtotal*(this.item.diskonpersen??0)/100},dpp(){return this.subtotal-this.total_discount},total_pajak(){return this.selectedPajakDetail.reduce((t,e)=>t+e.nilai||0,0)||0},grandtotal(){return this.dpp+this.total_pajak+parseFloat(this.item.biaya_lain||0)},tanggal_jatuh_tempo(){return new Date(new Date(this.item.tanggal).getTime()+24*60*60*1e3*parseInt(this.item.top||0))},FormError(){var t,e;return this.isClean?{}:((e=(t=ke.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}},selectedPajakDetail(){const t=[];return this.item.detail.forEach(e=>{const l=e.total-(parseFloat(e.diskonrp)?parseFloat(e.diskonrp):0)*parseFloat(e.qty);e.selectedPajak!=null&&e.selectedPajak.forEach(o=>{const a={};a.nama=o.nama,a.id=o.id,a.nilai=(l-l*(this.item.diskonpersen||0)/100)*o.nilai/100;let s=-1;for(let f=0;f<t.length;f++)if(t[f].nama===a.nama){s=f;break}s==-1?t.push(a):t[s].nilai=t[s].nilai+a.nilai})}),t},nomorDeliveryOrder(){return this.item.detail.reduce((t,e)=>e.nomor_do&&!t.includes(e.nomor_do)?t+(t.length>0?", ":"")+e.nomor_do:t,"")},canPersetujuan(){var l;const t=(l=this.item.persetujuan)==null?void 0:l.find(o=>o.id_pegawai==this.$auth.id&&o.tanggal_persetujuan==null),e=t?this.item.persetujuan.find(o=>o.urut<t.urut&&o.status===!0):null;return t&&(e||(t==null?void 0:t.urut)==1)},lPajakSelection(){return this.settingStore.penjualan.pajak=="b"?this.lPajak.filter(t=>this.settingStore.penjualan.id_pajak.some(e=>e==t.id)).map(t=>({...t,is_selected:t.is_selected||!1})):[]},jurnal(){var l;if(this.akunStore.count==0)return[];const t=[];if(this.grandtotal&&(l=this.item)!=null&&l.akun_piutang){const o=this.akunStore.getAkunById(this.item.akun_piutang);t.push({id_account:o.id,account_name:o.name,account_code:o.code,is_debit:!0,amount:this.grandtotal})}const e=this.item.detail.reduce((o,a)=>{if(!a.is_stok)return o;if(a.id_account!==null){const s=o.find(f=>f.id_account===a.id_account&&f.id_proyek===a.id_proyek);s?s.hpp=parseFloat(s.hpp)+parseFloat(a.hpp)*parseFloat(a.qty):o.push({...a,hpp:parseFloat(a.hpp)*parseFloat(a.qty)})}return o},[]);for(const o of e)if(o&&o.id_account){const a=this.akunStore.getAkunById(241);t.push({id_account:a.id,id_proyek:o.id_proyek,account_name:a.name,account_code:a.code,is_debit:!0,amount:o.hpp})}if(this.total_discount){const o=this.akunStore.getAkunById(245);t.push({id_account:o.id,account_name:o.name,account_code:o.code,is_debit:!0,amount:this.total_discount})}for(const o of e)if(o&&o.id_account){const a=this.akunStore.getAkunById(o.id_account);t.push({id_account:a.id,id_proyek:o.id_proyek,account_name:a.name,account_code:a.code,is_debit:!1,amount:o.hpp})}if(this.total_pajak)for(const o of this.selectedPajakDetail){const a=this.lPajak.find(f=>f.id==o.id),s=this.akunStore.getAkunById(a.akun_penjualan);t.push({id_account:s.id,account_name:s.name,account_code:s.code,is_debit:!1,amount:o.nilai})}if(this.item.detail.reduce((o,a)=>o+a.total,0)){const o=this.akunStore.getAkunById(243);t.push({id_account:o.id,id_proyek:null,account_name:o.name,account_code:o.code,is_debit:!1,amount:this.subtotal})}if(parseFloat(this.item.biaya_lain)){const o=this.akunStore.getAkunById(this.item.id_akun_biaya_lain);t.push({id_account:o.id,id_proyek:null,account_name:o.name,account_code:o.code,is_debit:!1,amount:this.item.biaya_lain})}return t}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.getData().then(()=>{this.isEdit?this.getInvoice():(this.selectedSalesman=this.lSalesman.find(t=>t.id==this.$auth.id),this.selectedSalesman&&(this.item.id_salesman=this.selectedSalesman.id),this.datetransporter=new Date,this.item.tanggal=this.$serverTime),this.$timeoutLoading()})},methods:{getColumnDetail(){return this.columns.filter(t=>t.field=="diskonpersen"?this.settingStore.penjualan.diskon_per_baris:t.field=="selectedPajak"?this.settingStore.penjualan.pajak=="a":t.field=="selectedProyek"?!!this.settingStore.penjualan.proyek:!0).map(t=>this.item.detail.some(e=>e.nomor_do)?["nama_barang","qty","keterangan","selectedSatuan"].includes(t.field)?{...t,editor:!1}:{...t}:this.item.id_so?["nama_barang","keterangan","selectedSatuan"].includes(t.field)?{...t,editor:!1}:{...t}:t)},searchProyek(t){setTimeout(()=>{this.filteredlProyek=t.query.trim().length?this.lProyek.filter(e=>e.proyek.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProyek]},250)},searchAllProyek(){setTimeout(()=>{this.filteredlProyek=this.lProyek.filter(t=>!this.item.detail.some(e=>e.proyek==t.proyek))},250)},selectCustomer(t){this.item.id_kontak=t.value.id,this.item.customer=t.value.kontak,this.item.telepon=t.value.telepon,this.item.kepada=t.value.attention,this.item.hp=t.value.hp,this.item.akun_piutang=t.value.akun_piutang,this.item.email=t.value.email,this.item.id_top=t.value.id_top,this.item.top=t.value.top,this.item.keterangan=`Faktur Penjualan ${t.value.kontak}`},searchCustomer(t){setTimeout(()=>{this.filteredCustomer=t.query.trim().length?this.lCustomer.filter(e=>e.text.toLowerCase().includes(t.query.toLowerCase())):[...this.lCustomer]},250)},searchProduk(t){setTimeout(()=>{this.filteredlProduk=t.query.trim().length?this.lProduk.filter(e=>e.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProduk]},250)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(t=>!this.item.detail.some(e=>e.nama_barang==t.nama_barang))},250)},switchType(t){const e=this.item.detail[t].type=this.item.detail[t].type=="produk"?"jasa":"produk";this.item.detail[t]={...this.nullDetail,type:e}},removeDetail(t){this.item.detail=this.item.detail.filter(e=>e!=t)},tambahDetail(){this.item.status!="C"&&(this.item.detail.some(t=>t.nama_barang==null)||this.item.detail.push({...this.nullDetail}))},selectIdAccountDetail(t,e){if(e.is_stok){if(this.akuntansiStore.pendapatan=="a"){if(this.gudangStore.count==1)t.id_account=this.gudangStore.gudang.account_persediaan,t.akun=this.gudangStore.gudang.akun_persediaan;else if(this.item.id_gudang){const l=this.gudangStore.getGudangById(this.item.id_gudang),o=this.akunStore.getAkunById(l.account_persediaan);t.id_account=o.id,t.akun=o.name}}else if(this.akuntansiStore.pendapatan=="b"){const l=this.akunStore.getAkunById(e.id_account_kategori);t.id_account=l.id,t.akun=l.name}}else{const l=this.akunStore.getAkunById(e.id_account_harga_beli);t.id_account=l.id,t.akun=l.name}},async onCellEditComplete(t){const{data:e,newValue:l,field:o,index:a}=t;switch(o){case"nama_barang":if(l==null||l==""){e.nama_barang=l,this.item.detail[a]={...this.nullDetail,type:e.type};return}if(typeof l=="string"){if(this.tambahDetail(),e.type=="produk")return;e[o]=l,e.diskonpersen=0,e.qty=0,e.harga=0,e.total=0;return}if(typeof l=="object"&&l!=null){if(l.is_stok&&this.item.id_gudang==null){this.$toast.add({severity:"error",summary:"Failed",detail:"Pilih Gudang Terlebih Dahulu",life:3e3});return}e.id_barang=l.id,await ae.getHppByIdBarang({id_barang:e.id_barang,id_gudang:this.item.id_gudang}).then(s=>{e.hpp=s.data.data,e.nama_barang=l.nama_barang,e.kode_barang=l.kode_barang,e.id_satuan=l.id_satuan,e.is_stok=l.is_stok,e.option_satuan=l.option_satuan,e.harga=parseFloat(l.harga_beli),e.harga_asli=parseFloat(l.harga_beli),e.total=0,e.selectedSatuan=l.option_satuan.find(f=>f.id==e.id_satuan),e.qty=0,e.diskonpersen=0,e.diskonrp=0,e.id_kantor=this.gudangStore.gudang.id_kantor})}this.selectIdAccountDetail(e,l),this.tambahDetail();break;case"selectedProyek":if(!l)return;e[o]=l,e.proyek=l.proyek,e.id_proyek=l.id;break;case"selectedSatuan":if(!l)return;e[o]=l,e.id_satuan=l.id,e.harga=e.harga/l.konversi*(t.value?t.value.konversi:1),e.diskonrp=e.diskonpersen*e.harga/100,e.total=e.qty*(e.harga-e.diskonrp);break;case"qty":e[o]=l,e.total=parseFloat(e.harga)*parseFloat(e.qty);break;case"selectedPajak":if(!l)return;e[o]=l,e.pajak=l.map(s=>s.nama).join(),e.id_pajak=l.map(s=>s.id).join(),e.persen_pajak=l.map(s=>s.nilai).join();break;case"diskonpersen":e[o]=l,e.diskonrp=e.harga*l/100;break;case"diskonrp":e[o]=l,e.diskonpersen=l/e.harga*100;break;case"keterangan":e[o]=l;break;case"harga":e[o]=l,e.total=l*e.qty;break}this.item.id_do==null&&this.item.detail.every(f=>f.nama_barang!=null&&f.nama_barang.trim()!=="")&&this.item.detail.push({...this.nullDetail,type:"produk"})},async getData(){await L.getProyek().then(t=>{this.lProyek=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Proyek",life:3e3})}),await L.getPegawai().then(t=>{this.lSalesman=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Salesman",life:3e3})}),await L.getProduk().then(t=>{this.lProduk=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await ie.index().then(t=>{this.lPajak=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Pajak",life:3e3})}),await le.index().then(t=>{this.lSatuan=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})})},getSalesman(){!this.isEdit&&this.$auth.id!=null&&this.$auth.id!=0&&(this.selectedSalesman=this.lSalesman.find(t=>t.id==this.$auth.id),this.selectedSalesman!=null&&(this.item.id_salesman=this.selectedSalesman.id,this.item.salesman=this.selectedSalesman.name))},selectSalesman(t){this.item.id_salesman=t.value.id},async getInvoice(){await E.show(this.item.id).then(async t=>{this.item=t.data.data,this.item.diskonpersen=parseFloat(t.data.data.diskonpersen),this.item.tanggal=new Date(this.item.tanggal),this.item.id_salesman!=null&&(this.selectedSalesman=this.lSalesman.find(e=>e.id==this.item.id_salesman)),this.item.detail.forEach(e=>{if(e.id_barang){let l=this.lProduk.find(o=>o.id==e.id_barang);e.option_satuan=l.option_satuan,e.selectedSatuan=e.option_satuan.find(o=>o.id==e.id_satuan)}else e.option_satuan=[],e.selectedSatuan=this.lSatuan.find(l=>l.id==e.id_satuan);if(e.id_account==null&&e.id_barang&&this.selectIdAccountDetail(e,e),e.harga=parseFloat(e.harga),e.total=parseFloat(e.total),e.harga_asli=parseFloat(e.harga_asli),e.diskonpersen=parseFloat(e.diskonpersen),e.diskonrp=parseFloat(e.diskonrp),e.qty=parseFloat(e.qty),e.id_pajak){let l=this.lPajak.filter(o=>e.id_pajak.split(",").includes(o.id.toString()));e.selectedPajak=l,e.pajak=l.map(o=>o.nama).join(),e.id_pajak=l.map(o=>o.id).join(),e.persen_pajak=l.map(o=>o.nilai).join()}}),this.settingStore.penjualan.pajak=="b"&&(this.lPajak=this.lPajak.map(e=>{var l,o;return{...e,is_selected:(o=(l=this.item.detail[0])==null?void 0:l.selectedPajak)==null?void 0:o.some(a=>a.id==e.id)}})),this.item.status!="C"&&this.item.detail.push({...this.nullDetail,type:"produk"}),this.item.check_biaya_lain=this.item.biaya_lain!=null&&this.item.id_akun_biaya_lain!=null})},selectAllPajak(t){this.item.detail.forEach(e=>{e.selectedPajak=t.value,e.pajak=t.value.map(l=>l.nama).join(),e.id_pajak=t.value.map(l=>l.id).join(),e.persen_pajak=t.value.map(l=>l.nilai).join()})},changePajakSelection(){this.item.detail.forEach(t=>{const e=this.lPajakSelection.filter(l=>l.is_selected);t.selectedPajak=e,t.pajak=e.map(l=>l.nama).join(),t.id_pajak=e.map(l=>l.id).join(),t.persen_pajak=e.map(l=>l.nilai).join()})},searchSalesman(t){setTimeout(()=>{this.filteredSalesman=t.query.trim().length?this.lSalesman.filter(e=>e.name.toLowerCase().includes(t.query.toLowerCase())):[...this.lSalesman]},250)},async Save(t){try{if(this.$isLoading.value=!0,this.status=t,this.item.total=this.subtotal,this.item.dpp=this.dpp,this.item.total_pajak=this.total_pajak,this.item.grandtotal=this.grandtotal,this.item.total_discount=this.total_discount,this.item.pajak=this.selectedPajakDetail,this.item.is_stok=!0,this.item.tanggal_jatuh_tempo=this.tanggal_jatuh_tempo,this.item.id_kantor=this.gudangStore.gudang.id_kantor,this.item.check_biaya_lain||(this.item.biaya_lain=0,this.item.id_akun_biaya_lain=null),this.isClean=!1,Object.keys(this.FormError).length>0){console.error(this.FormError);return}this.isEdit?await E.update(this.item.id,this.FormItem).then(e=>{this.item.status=e.data.data.status,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3})}):await E.store(this.FormItem).then(e=>{this.item.id=e.data.data.id,this.item.status=e.data.data.status,this.item.nomor=e.data.data.nomor,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),setTimeout(()=>{this.$router.replace({name:"invoice.edit",params:{id:e.data.data.id}})},1e3),this.isEdit=!0})}catch(e){e instanceof se&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})}finally{this.$timeoutLoading()}this.item.id_so==null&&this.item.detail.every(l=>l.nama_barang!=null&&l.nama_barang.trim()!=="")&&this.item.detail.push({...this.nullDetail,type:"produk"})},async submitPersetujuan(t=!1){const e={id:this.item.id,status:t,keterangan:this.item.keterangan};this.$isLoading.value=!0,await E.updatePersetujuan(e).then(l=>{this.item.status=l.data.data.update_status||this.item.status,this.item.persetujuan.forEach(o=>{o.urut==l.data.data.urut&&(o.tanggal_persetujuan=l.data.data.tanggal_persetujuan,o.status=l.data.data.status,o.keterangan=l.data.data.keterangan)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Update persetujuan",life:3e3}),this.showPersetujuanDialog=!1}).catch(l=>{this.$toast.add({severity:"error",summary:"Error",detail:l,life:3e3})}).finally(()=>{this.$timeoutLoading()}),this.showPersetujuanDialog=!1},confirmApprove(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!0},confirmReject(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!1},toggleSelectAllPajak(t){this.$refs.op_select_all_pajak.toggle(t)},cetakPDF(){this.$router.push({name:"invoice.cetak",params:this.item.id})},cetakJurnal(){this.$router.push({name:"invoice.jurnal",params:this.item.id})},selectGudang(t){if(this.akuntansiStore.pendapatan=="a")for(const e of this.item.detail)e.nama_barang&&this.selectIdAccountDetail(e,e)},showAccountBiayaLain(){this.biayaLainDialog=!0},simpanAkunBiayaLain(){this.biayaLainDialog=!1,this.item.check_biaya_lain=!!(this.item.id_akun_biaya_lain&&this.item.biaya_lain)}},components:{ModalJurnal:ne}},fe={class:"card"},be={key:0},je={key:1},ve={key:2},Se={class:"p-fluid formgrid grid"},Pe={class:"field col-12 md:col-3"},De={class:"field col-12 sm:col-4 md:col-3 lg:col-2"},Ve={class:"field col-12 md:col-4 lg:col-3 xl:col-3"},Ce={class:"field col-6 md:col-2"},we={class:"field col-6 md:col-2"},Fe=i("div",{class:"col-12"},null,-1),xe={class:"field col-12 md:col-3"},Ae={class:"flex align-options-center"},Ee={class:"field col-12 md:col-3 lg:col-3 xl:col-2"},Ue={class:"field col-12 md:col-3 lg:col-3"},Ie={class:"col-12"},Le={class:"col-12 my-4"},Be={class:"text-center"},Te={class:"flex align-items-center gap-2"},qe={class:"capitalize"},Ne={key:1},Me={key:2,style:{"text-align":"end"}},Oe={key:3},Je={class:"flex flex-column"},Ge={key:4,class:"text-right"},Re={key:5},He={class:"flex flex-column"},ze={class:"text-green-500"},Ke={key:6},Ye={class:"flex flex-column"},Qe={class:""},We={class:"flex flex-column"},Xe={class:""},Ze={class:"grid col pb-0"},$e={class:"col py-1"},et={class:"col text-green-500 py-1"},tt={key:9},at=i("div",{class:"col-12 md:col-4"},null,-1),it=i("div",{class:"col-12 md:col-4"},null,-1),lt={class:"col-12 md:col-4"},nt={class:"grid py-3 justify-content-center align-items-center"},st=i("div",{class:"col-7 md:col-6"},"Subtotal",-1),ot={class:"col-5 md:col-6 text-right"},rt={class:"grid py-3 justify-content-center align-items-center"},ut=i("div",{class:"col-3 sm:col-2 md:col-2 lg:col-2"},"Diskon",-1),dt={class:"col-5 sm:col-4 md:col-5 lg:col-4"},mt={class:"p-inputgroup"},ct=i("span",{class:"p-inputgroup-addon"},[i("i",{class:"pi pi-percentage"})],-1),ht={class:"col-4 md:col-5 lg:col-6 text-right"},pt={class:"grid py-3 justify-content-center align-items-center"},_t=i("div",{class:"col-7 md:col-6"},"Total Setelah Diskon",-1),gt={class:"col-5 md:col-6 text-right"},kt={key:0},yt={class:"col-4"},ft={class:"field col-4"},bt={class:"col-4 text-right"},jt={key:1},vt={class:"col-6"},St={class:"col-6 text-right"},Pt={class:"grid py-3 justify-content-center align-items-center"},Dt=i("div",{class:"col-4"},"Biaya lain-lain",-1),Vt={class:"col-4"},Ct={class:"col-4 text-right"},wt={class:"grid py-3 justify-content-center align-items-center"},Ft=i("div",{class:"col-12"},[i("hr")],-1),xt=i("div",{class:"col-6"},"Grand Total",-1),At={class:"col-6 text-right"},Et=i("br",null,null,-1),Ut={key:3,class:"p-datatable col-6"},It={class:"p-datatable-table p-datatable-striped"},Lt=i("thead",{class:"p-datatable-thead"},[i("tr",{role:"row"},[i("th",{colspan:"7",class:"text-left"},"Harus Disetujui Oleh:")]),i("tr",null,[i("th",null,"No"),i("th",null,"Nama"),i("th",null,"Jabatan"),i("th",null,"Tanggal"),i("th",null,"Status"),i("th",null,"Keterangan")])],-1),Bt={class:"p-datatable-tbody"},Tt={key:0},qt={key:1},Nt={key:2},Mt={class:"grid"},Ot={class:"col-6"},Jt={class:"flex flex-wrap gap-3 justify-content-start"},Gt={class:"col-6"},Rt={class:"flex flex-wrap gap-3 justify-content-end"},Ht={class:"grid col pb-0"},zt={class:"col py-1"},Kt={class:"col text-green-500 py-1"},Yt={class:"p-fluid formgrid grid"},Qt={class:"field col-12"},Wt={class:"field col-12"},Xt=i("div",{class:"flex align-items-center justify-content-center"},[i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),i("span",null,"Masukkan Catatan")],-1);function Zt(t,e,l,o,a,s){var J,G,R;const f=k("Toast"),K=k("Tag"),Y=k("AutoCompleteKontak"),D=k("Label"),B=k("Calendar"),j=k("ErrorMsg"),x=k("InputText"),Q=k("InputTop"),I=k("AutoComplete"),W=k("AutoCompleteGudang"),T=k("Textarea"),v=k("Button"),A=k("Column"),q=k("Dropdown"),C=k("InputNumber"),N=k("MultiSelect"),X=k("DataTable"),M=k("Checkbox"),Z=k("SubmitButton"),$=k("OverlayPanel"),ee=k("AutoCompleteAkun"),O=k("Dialog"),te=k("ModalJurnal"),w=he("select-all-text");return c(),_(V,null,[r(f),i("div",fe,[i("h5",null,[S(p(a.isEdit?"Ubah":"Tambah")+" Invoice ",1),r(K,{style:{float:"right"},value:t.$h.getLabel(a.item.status),severity:t.$h.getLabel(a.item.status)},null,8,["value","severity"])]),a.item.nomor_so!=null?(c(),_("p",be,"Nomor Pesanan : "+p(a.item.nomor_so),1)):b("",!0),a.item.detail.some(n=>n.id_do!=null)?(c(),_("span",je," Nomor Penerimaan: "+p(s.nomorDeliveryOrder),1)):b("",!0),a.item.nomor_so!=null?(c(),_("hr",ve)):b("",!0),i("div",Se,[i("div",Pe,[r(Y,{modelValue:a.item.id_kontak,"onUpdate:modelValue":e[0]||(e[0]=n=>a.item.id_kontak=n),onSelectItem:s.selectCustomer,error:s.FormError.id_kontak,label:"Pelanggan","is-customer":""},null,8,["modelValue","onSelectItem","error"])]),i("div",De,[r(D,{for:"tanggal"},{default:g(()=>[S(" Tanggal ")]),_:1}),r(B,{dateFormat:"dd-mm-yy",modelValue:a.item.tanggal,"onUpdate:modelValue":e[1]||(e[1]=n=>a.item.tanggal=n),inputId:"tanggal",maxDate:t.$h.today,class:P(s.FormError.tanggal&&"p-invalid"),showButtonBar:"",showIcon:"",iconDisplay:"input"},null,8,["modelValue","maxDate","class"]),r(j,{error:s.FormError.tanggal},null,8,["error"])]),i("div",Ve,[r(D,{for:"nomor"},{default:g(()=>[S("Nomor")]),_:1}),r(x,{modelValue:a.item.nomor,"onUpdate:modelValue":e[2]||(e[2]=n=>a.item.nomor=n),id:"nomor",class:P(s.FormError.nomor&&"p-invalid"),readonly:""},null,8,["modelValue","class"]),r(j,{error:s.FormError.nomor},null,8,["error"])]),i("div",Ce,[r(Q,{top:a.item.top,"onUpdate:top":e[3]||(e[3]=n=>a.item.top=n),id:a.item.id_top,"onUpdate:id":e[4]||(e[4]=n=>a.item.id_top=n),error:s.FormError.id_top},null,8,["top","id","error"])]),i("div",we,[r(D,{for:"tanggal_jatuh_tempo"},{default:g(()=>[S("Tanggal Jatuh Tempo")]),_:1}),r(B,{dateFormat:"dd-mm-yy",id:"tanggal_jatuh_tempo",modelValue:s.tanggal_jatuh_tempo,"onUpdate:modelValue":e[5]||(e[5]=n=>s.tanggal_jatuh_tempo=n),class:P(s.FormError.tanggal_jatuh_tempo&&"p-invalid"),readonly:""},null,8,["modelValue","class"]),r(j,{error:s.FormError.tanggal_jatuh_tempo},null,8,["error"])]),Fe,i("div",xe,[r(D,{required:"",for:"salesitem",class:"mb-2"},{default:g(()=>[S("Salesman")]),_:1}),r(I,{modelValue:a.selectedSalesman,"onUpdate:modelValue":e[6]||(e[6]=n=>a.selectedSalesman=n),optionLabel:"nama",suggestions:a.filteredSalesman,onComplete:s.searchSalesman,onItemSelect:s.selectSalesman,dropdown:""},{option:g(n=>[i("div",Ae,[i("div",null,p(n.option.nama),1)])]),_:1},8,["modelValue","suggestions","onComplete","onItemSelect"]),r(j,{error:s.FormError.id_salesman},null,8,["error"])]),r(W,{classField:"md:col-2",modelValue:a.item.id_gudang,"onUpdate:modelValue":e[7]||(e[7]=n=>a.item.id_gudang=n),error:s.FormError.id_gudang,onSelectItem:s.selectGudang},null,8,["modelValue","error","onSelectItem"]),i("div",Ee,[r(D,{for:"faktur"},{default:g(()=>[S("No Faktur")]),_:1}),r(x,{modelValue:a.item.faktur,"onUpdate:modelValue":e[8]||(e[8]=n=>a.item.faktur=n),id:"faktur",class:P(s.FormError.faktur&&"p-invalid")},null,8,["modelValue","class"]),r(j,{error:s.FormError.faktur},null,8,["error"])]),i("div",Ue,[r(D,{for:"referensi"},{default:g(()=>[S("No Referensi")]),_:1}),r(x,{modelValue:a.item.referensi,"onUpdate:modelValue":e[9]||(e[9]=n=>a.item.referensi=n),id:"referensi",inputId:"referensi",class:P(s.FormError.referensi&&"p-invalid")},null,8,["modelValue","class"]),r(j,{error:s.FormError.referensi},null,8,["error"])]),i("div",Ie,[r(D,{for:"notes"},{default:g(()=>[S("Keterangan")]),_:1}),r(T,{modelValue:a.item.keterangan,"onUpdate:modelValue":e[10]||(e[10]=n=>a.item.keterangan=n),id:"notes",class:P(s.FormError.keterangan&&"p-invalid")},null,8,["modelValue","class"]),r(j,{error:s.FormError.keterangan},null,8,["error"])]),i("div",Le,[r(X,{value:a.item.detail,editMode:"cell",onCellEditComplete:s.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{empty:g(()=>[i("div",Be,[r(v,{onClick:s.tambahDetail,severity:"info",outlined:"",label:"Tambah"},null,8,["onClick"])])]),default:g(()=>[r(A,{header:"#",headerStyle:"width:10px;"},{body:g(({index:n})=>[S(p(n+1),1)]),_:1}),r(A,{header:"Tipe",headerStyle:"width:5%;"},{body:g(({data:n,index:d})=>[i("div",Te,[r(v,{onClick:u=>s.switchType(d),icon:n.type=="produk"?"pi pi-box":"pi pi-briefcase",severity:n.type=="produk"?"primary":"secondary",disabled:a.item.id_so},null,8,["onClick","icon","severity","disabled"]),i("span",qe,p(n.type),1)])]),_:1}),(c(!0),_(V,null,U(s.getColumnDetail(),n=>(c(),y(A,{key:n.field,field:n.field,header:n.header,headerStyle:n.width,class:P(n.class)},pe({body:g(({data:d,field:u,index:h})=>[u=="selectedSatuan"?(c(),_(V,{key:0},[i("div",null,p(d[u]&&d[u].satuan),1),r(j,{error:s.FormError.detail&&s.FormError.detail[h]&&s.FormError.detail[h].id_satuan},null,8,["error"])],64)):u=="selectedPajak"?(c(),_("div",Ne,p(d.pajak==null?null:d.pajak.toString()),1)):(u==="harga"||u==="diskonrp")&&d[u]>0?(c(),_("div",Me,p(t.$h.formatNumber(d[u])),1)):u=="selectedProyek"?(c(),_("div",Oe,[i("span",Je,[i("span",null,p(d.proyek),1)])])):u=="total"&&d[u]>0?(c(),_("div",Ge,p(t.$h.formatNumber(d[u])),1)):u=="nama_barang"?(c(),_("div",Re,[i("span",He,[i("small",ze,p(d.kode_barang),1),i("span",null,p(d.nama_barang),1)])])):(c(),_("div",Ke,p(d[u]),1)),r(j,{error:s.FormError.detail&&s.FormError.detail[h]&&s.FormError.detail[h][u]},null,8,["error"])]),header:g(()=>[n.header==="Tax"?(c(),y(v,{key:0,icon:"pi pi-chevron-down",class:"p-button p-button-outlined",onClick:s.toggleSelectAllPajak},null,8,["onClick"])):b("",!0)]),_:2},[this.item.status!="C"&&n.editor?{name:"editor",fn:g(({data:d,field:u})=>[u=="nama_barang"?(c(),_(V,{key:0},[d.type=="produk"?(c(),y(I,{key:0,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,suggestions:a.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:s.searchProduk,class:"min-w-max",dropdown:"",onDropdownClick:s.searchAllProduk},{option:g(h=>[i("div",Ye,[i("small",{class:P(h.option.is_stok?"text-green-500":"text-blue-500")},p(h.option.kode_barang),3),i("div",Qe,p(h.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(c(),y(x,{key:1,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))],64)):u=="selectedProyek"?(c(),y(I,{key:1,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,suggestions:a.filteredlProyek,optionLabel:"proyek",virtualScrollerOptions:{itemSize:50},onComplete:s.searchProyek,class:"min-w-max",dropdown:"",onDropdownClick:s.searchAllProyek},{option:g(h=>[i("div",We,[i("small",null,p(h.option.kode),1),i("div",Xe,p(h.option.proyek),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):u=="keterangan"?F((c(),y(x,{key:2,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,autofocus:"",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[w]]):u=="selectedSatuan"?(c(),_(V,{key:3},[d.type=="produk"?(c(),y(q,{key:0,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,id:"satuan",options:d.option_satuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"])):(c(),y(q,{key:1,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,id:"satuan",options:a.lSatuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"]))],64)):n.type=="number"||n.type=="currency"?F((c(),y(C,{key:4,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,autofocus:"",inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[w]]):u=="harga"?F((c(),y(C,{key:5,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,id:"harga",mode:"currency",locale:"id-ID",currency:"IDR",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[w]]):u=="diskonrp"?F((c(),y(C,{key:6,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,id:"diskonrp",mode:"currency",locale:"id-ID",currency:"IDR",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[w]]):u=="diskonpersen"?(c(),y(C,{key:7,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,id:"diskonpersen",minFractionDigits:1,maxFractionDigits:5,class:"min-w-max",min:"0",max:"100"},null,8,["modelValue","onUpdate:modelValue"])):u=="selectedPajak"?(c(),y(N,{key:8,modelValue:d[u],"onUpdate:modelValue":h=>d[u]=h,options:a.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem"},{option:g(h=>[i("div",Ze,[i("div",$e,p(h.option.nama),1),i("div",et,p(h.option.nilai)+"%",1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])):(c(),_("div",tt,p(d[u]),1))]),key:"0"}:void 0]),1032,["field","header","headerStyle","class"]))),128)),(a.item.status=="D"||a.item.status==null||a.item.status=="O")&&!a.item.id_so?(c(),y(A,{key:0,header:"#",headerStyle:"width:5%;"},{body:g(({data:n})=>[r(v,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:d=>s.removeDetail(n)},null,8,["onClick"])]),_:1})):b("",!0)]),_:1},8,["value","onCellEditComplete"]),r(j,{error:s.FormError.detail},null,8,["error"])]),at,it,i("div",lt,[i("div",nt,[st,i("div",ot,p(t.$h.formatNumber(s.subtotal)),1)]),i("div",rt,[ut,i("div",dt,[i("div",mt,[F(r(C,{placeholder:"Discount",modelValue:a.item.diskonpersen,"onUpdate:modelValue":e[11]||(e[11]=n=>a.item.diskonpersen=n),min:0,max:100,minFractionDigits:1,maxFractionDigits:2},null,8,["modelValue"]),[[w]]),ct])]),i("div",ht,p(t.$h.formatNumber(s.total_discount)),1)]),i("div",pt,[_t,i("div",gt,p(t.$h.formatNumber(s.dpp)),1)]),a.settingStore.penjualan.pajak=="b"?(c(),_("div",kt,[(c(!0),_(V,null,U(s.lPajakSelection,(n,d)=>{var u;return c(),_("div",{key:n,class:"grid py-3 justify-content-center align-items-center"},[i("div",yt,p(n.nama),1),i("div",ft,[r(M,{modelValue:n.is_selected,"onUpdate:modelValue":h=>n.is_selected=h,binary:!0,onChange:s.changePajakSelection},null,8,["modelValue","onUpdate:modelValue","onChange"])]),i("div",bt,p(t.$h.formatNumber((u=s.selectedPajakDetail[d])==null?void 0:u.nilai)),1)])}),128))])):b("",!0),a.settingStore.penjualan.pajak=="a"?(c(),_("div",jt,[(c(!0),_(V,null,U(s.selectedPajakDetail,n=>(c(),_("div",{key:n,class:"grid py-3 justify-content-center align-items-center"},[i("div",vt,p(n.nama),1),i("div",St,p(t.$h.formatNumber(n.nilai)),1)]))),128))])):b("",!0),i("div",Pt,[Dt,i("div",Vt,[r(M,{modelValue:a.item.check_biaya_lain,"onUpdate:modelValue":e[12]||(e[12]=n=>a.item.check_biaya_lain=n),onClick:s.showAccountBiayaLain,binary:!0},null,8,["modelValue","onClick"])]),i("div",Ct,p(t.$h.formatNumber(a.item.biaya_lain)),1)]),i("div",wt,[Ft,xt,i("div",At,p(t.$h.formatNumber(s.grandtotal)),1)])])]),Et,((J=a.item.persetujuan)==null?void 0:J.length)>0&&!this.$route.query.revisi?(c(),_("div",Ut,[i("table",It,[Lt,i("tbody",Bt,[(c(!0),_(V,null,U(a.item.persetujuan,(n,d)=>(c(),_("tr",{key:d},[i("td",null,p(d+1),1),i("td",null,p(n.nama),1),i("td",null,p(n.jabatan),1),i("td",null,p(t.$h.formatDate(n.tanggal_persetujuan,"DD-MM-YYYY HH:mm:ss")),1),n.tanggal_persetujuan!=null&&!n.status?(c(),_("td",Tt,"Reject")):n.tanggal_persetujuan!=null&&n.status?(c(),_("td",qt,"Approve")):(c(),_("td",Nt,"Menunggu Persetujuan")),i("td",null,p(n.keterangan),1)]))),128))])])])):b("",!0),i("div",Mt,[i("div",Ot,[i("div",Jt,[a.item.status=="C"?(c(),y(v,{key:0,label:"Print",severity:"help",iconPos:"left",icon:"pi pi-print",onClick:s.cetakPDF},null,8,["onClick"])):b("",!0),r(v,{style:{float:"right"},label:"Jurnal",class:P(["p-button mx-2",{"p-button-block":a.jurnalDialog,"p-button-outlined":!a.jurnalDialog}]),onClick:e[13]||(e[13]=n=>a.jurnalDialog=!a.jurnalDialog)},null,8,["class"])])]),i("div",Gt,[i("div",Rt,[!s.canPersetujuan&&!((R=(G=a.item.persetujuan)==null?void 0:G[0])!=null&&R.tanggal_persetujuan)&&a.item.status!="C"?(c(),y(Z,{key:0,loading:t.$isLoading.value,data:a.item,onClick:e[14]||(e[14]=n=>{var d;return s.Save((d=a.settingStore.penjualan.persetujuan.invoice)!=null&&d.persetujuan1?"S":"O")}),onDraft:e[15]||(e[15]=n=>s.Save("D")),showDraft:a.item.status==null||a.item.status=="D"},null,8,["loading","data","showDraft"])):b("",!0),a.item.status=="S"&&s.canPersetujuan?(c(),y(v,{key:1,label:"Reject",severity:"danger",iconPos:"right",icon:"pi pi-times",onClick:s.confirmReject,class:"mx-2"},null,8,["onClick"])):b("",!0),a.item.status=="S"&&s.canPersetujuan?(c(),y(v,{key:2,label:"Approve",severity:"success",iconPos:"right",icon:"pi pi-check",onClick:s.confirmApprove},null,8,["onClick"])):b("",!0)])])]),r($,{ref:"op_select_all_pajak"},{default:g(()=>[r(N,{modelValue:a.selectedAllPajak,"onUpdate:modelValue":e[16]||(e[16]=n=>a.selectedAllPajak=n),options:a.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem",onChange:s.selectAllPajak},{option:g(n=>[i("div",Ht,[i("div",zt,p(n.option.nama),1),i("div",Kt,p(n.option.nilai)+"%",1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},512)]),r(O,{visible:a.biayaLainDialog,"onUpdate:visible":e[19]||(e[19]=n=>a.biayaLainDialog=n),modal:"",header:"Pilih Akun Biaya Lain-lain",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},position:"bottom",onHide:s.simpanAkunBiayaLain},{footer:g(()=>[r(v,{label:"Ok",icon:"pi pi-check",onClick:s.simpanAkunBiayaLain,autofocus:""},null,8,["onClick"])]),default:g(()=>[i("div",Yt,[i("div",Qt,[r(ee,{modelValue:a.item.id_akun_biaya_lain,"onUpdate:modelValue":e[17]||(e[17]=n=>a.item.id_akun_biaya_lain=n),head:1,level:4},null,8,["modelValue"])]),i("div",Wt,[r(D,null,{default:g(()=>[S("Jumlah")]),_:1}),F(r(C,{placeholder:"0.0",modelValue:a.item.biaya_lain,"onUpdate:modelValue":e[18]||(e[18]=n=>a.item.biaya_lain=n),min:0,minFractionDigits:1,maxFractionDigits:2},null,8,["modelValue"]),[[w]]),r(j,{error:s.FormError.biaya_lain},null,8,["error"])])])]),_:1},8,["visible","onHide"]),r(O,{visible:a.showPersetujuanDialog,"onUpdate:visible":e[23]||(e[23]=n=>a.showPersetujuanDialog=n),style:{width:"450px"},header:"Confirm",modal:!0},{footer:g(()=>[r(v,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:e[21]||(e[21]=n=>a.showPersetujuanDialog=!1)}),r(v,{label:t.isApprove?"Approve":"Reject",icon:"pi pi-check",class:"p-button-text",onClick:e[22]||(e[22]=n=>s.submitPersetujuan(t.isApprove))},null,8,["label"])]),default:g(()=>[Xt,r(T,{class:"w-full",modelValue:a.item.keterangan,"onUpdate:modelValue":e[20]||(e[20]=n=>a.item.keterangan=n),rows:"5",cols:"30",placeholder:"Optional"},null,8,["modelValue"])]),_:1},8,["visible"]),r(te,{visible:a.jurnalDialog,"onUpdate:visible":e[24]||(e[24]=n=>a.jurnalDialog=n),value:s.jurnal,"onUpdate:value":e[25]||(e[25]=n=>s.jurnal=n)},null,8,["visible","value"])],64)}const ra=oe(ye,[["render",Zt]]);export{ra as default};
