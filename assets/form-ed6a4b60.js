import{a as A}from"./api-0e438e31.js";import{a as G}from"./options-b2eb7ae6.js";import{a as se}from"./satuan-84ad7de8.js";import{a as oe}from"./uangmuka-9a822cf6.js";import{a as re}from"./pajak-69cfe91a.js";import"./custom-zod-e9521e5d.js";import{A as ue}from"./index-b9e295bc.js";import{M as de}from"./ModalJurnal-5f84a831.js";import{_ as me,v as ce,j as pe,x as he,y as ge,z as _e,r as _,A as ke,o as u,c as h,b as n,d as m,l as j,t as c,f as b,e as k,n as P,B as T,m as V,q as U,k as f,C as ye}from"./index-11eb6111.js";import{z as g}from"./index-0ec66d4d.js";const K=g.object({tanggal:g.date(),id_supplier:g.number(),id_gudang:g.number(),top:g.number().nonnegative(),referensi:g.string(),no_faktur_pajak:g.string().nullish(),tanggal_jatuh_tempo:g.date().nullish(),tanggal_referensi:g.date()}),H=g.object({id_barang:g.number().nullish(),nama_barang:g.string().min(1),id_satuan:g.number(),harga:g.number().nonnegative().gte(0),qty:g.number().nonnegative().gte(0),diskonpersen:g.number().nonnegative(),diskonrp:g.number().nonnegative(),id_pajak:g.string().nullish()}),fe=K.extend({status:g.literal("D"),detail:g.array(H)}),Y=K.extend({status:g.literal("S"),detail:g.array(H.extend({harga:g.number().nonnegative().gt(0),qty:g.number().nonnegative().gt(0),id_account:g.number().nonnegative()})).refine(t=>t.some(e=>e.qty>0),{message:"Minimal 1 Qty harus lebih dari 0",path:["detail"]})}),be=Y.extend({status:g.literal("O")}),je=g.discriminatedUnion("status",[fe,be,Y]),ve={components:{MyJurnal:de},data(){return{akuntansiStore:ce(),gudangStore:pe(),akunStore:he(),settingStore:ge(),item:{tanggal:null,nomor:null,referensi:null,tanggal_referensi:null,tanggal_jatuh_tempo:null,tanggal_pengiriman:null,persendiskon:0,grandtotal:0,total:0,id_gudang:null,status:null,detail:[{type:"produk",nama_barang:null,kode_barang:null,qty:null,harga:null,diskonpersen:null,diskonrp:null,total:null,id_barang:null,id_satuan:null,option_satuan:[],is_manual:!0,id_proyek:null,id_account:null,proyek:null}],uang_muka:{grandtotal:0},pajak:{}},columns:[{field:"nama_barang",header:"Produk/Jasa",editor:!0},{field:"keterangan",header:"Deskripsi",editor:!0},{field:"qty",header:"Kuantitas",type:"number",editor:!0},{field:"selectedSatuan",header:"Satuan",error:"id_satuan",editor:!0},{field:"harga",header:"Harga Satuan",type:"currency",editor:!0},{field:"diskonpersen",header:"Diskon %",type:"number",editor:!0},{field:"selectedPajak",header:"Pajak",class:"right",error:"id_pajak",editor:!0},{field:"total",header:"Jumlah",type:"currency",editor:!0},{field:"id_account",header:"Akun",error:"id_account",editor:!0},{field:"selectedProyek",header:"Proyek",error:"id_proyek",editor:!0}],nullDetail:null,isClean:!0,isEdit:!1,closingDialog:!1,jurnalDialog:!1,lProduk:[],filteredlProduk:[],lPajak:[],selectedAllPajak:[],lSatuan:[],lProyek:[],selectedProyek:null,filteredlProyek:[],status:null,tes:null}},mounted(){this.item.id=this.$route.params.id,this.isEdit=!!this.$route.params.id,this.$isLoading.value=!0,this.nullDetail={...this.item.detail[0]},this.getData().then(()=>{if(this.isEdit){this.getAp();return}this.item.tanggal=this.$h.today}).finally(()=>{this.$timeoutLoading()})},methods:{getColumnDetail(){return this.columns.filter(t=>t.field=="nomor_pr"?this.item.detail.some(e=>e.id_pr!=null):t.field=="diskonpersen"?this.settingStore.pembelian.diskon_per_baris:t.field=="selectedPajak"?this.settingStore.pembelian.pajak=="a":t.field=="selectedProyek"?!!this.settingStore.pembelian.proyek:!0).map(t=>this.item.detail.some(e=>e.nomor_pb)?["nama_barang","qty","keterangan","selectedSatuan"].includes(t.field)?{...t,editor:!1}:{...t}:this.item.id_po?["nama_barang","keterangan","selectedSatuan"].includes(t.field)?{...t,editor:!1}:{...t}:t)},changePajakSelection(){this.item.detail.forEach(t=>{const e=this.lPajakSelection.filter(a=>a.is_selected);t.selectedPajak=this.lPajakSelection.filter(a=>a.is_selected),t.pajak=e.map(a=>a.nama).join(),t.id_pajak=e.map(a=>a.id).join(),t.persen_pajak=e.map(a=>a.nilai).join()})},selectIdAccountDetail(t,e,a=!0){if(t.id_account==null){if(e.is_stok){if(this.akuntansiStore.persediaan_hpp=="a")if(this.gudangStore.count==1)t.id_account=this.gudangStore.gudang.account_persediaan,t.akun=this.gudangStore.gudang.akun_persediaan;else if(this.item.id_gudang){const s=this.gudangStore.getGudangById(this.item.id_gudang),i=this.akunStore.getAkunById(s.account_persediaan);console.log(s),t.id_account=i.id,t.akun=i.name}else t.id_account=null;else if(this.akuntansiStore.persediaan_hpp=="b"){const s=this.akunStore.getAkunById(e.id_account_kategori);t.id_account=s.id,t.akun=s.name}}else if(e.id_barang){const s=this.akunStore.getAkunById(e.id_account_harga_beli);t.id_account=s.id,t.akun=s.name}}},onCellEditComplete(t){const{data:e,newValue:a,field:s,index:i,value:o}=t;switch(s){case"nama_barang":if(a==null||a==""){e.nama_barang=a,this.item.detail[i]={...this.nullDetail,type:e.type};return}if(typeof a=="string"&&e.type=="jasa"){e[s]=a,this.tambahDetail();return}if(typeof a=="object"&&a!=null){if(a.is_stok&&this.item.id_gudang==null){this.$toast.add({severity:"error",summary:"Failed",detail:"Pilih Gudang Terlebih Dahulu",life:3e3});return}e.id_barang=a.id,e.nama_barang=a.nama_barang,e.kode_barang=a.kode_barang,e.id_satuan=a.id_satuan,e.option_satuan=a.option_satuan,e.harga=parseFloat(a.harga_beli),e.selectedSatuan=a.option_satuan.find(y=>y.id==e.id_satuan),e.qty=0,e.diskonpersen=0,e.diskonrp=0}this.selectIdAccountDetail(e,a),this.tambahDetail();break;case"keterangan":e[s]=a;break;case"selectedSatuan":if(!a)return;e[s]=a,e.id_satuan=a.id,e.satuan=a.satuan,e.type=="produk"&&(e.harga=parseFloat(e.harga)/o.konversi*a.konversi,e.total=parseFloat(e.harga)*parseFloat(e.qty));break;case"selectedProyek":e[s]=a,e.id_proyek=a==null?void 0:a.id,e.proyek=a==null?void 0:a.proyek;break;case"qty":e.qty=a,e.total=(e.harga-e.diskonrp)*e.qty;break;case"selectedPajak":if(!a)return;e[s]=a,e.pajak=a.map(y=>y.nama).join(),e.id_pajak=a.map(y=>y.id).join(),e.persen_pajak=a.map(y=>y.nilai).join();break;case"diskonpersen":e.diskonpersen=a,e.diskonrp=e.diskonpersen*e.harga/100,e.total=(e.harga-e.diskonrp)*e.qty;break;case"harga":e.harga=a,e.total=(e.harga-e.diskonrp)*e.qty;break;default:e[s]=a;break}},async Save(t="D"){try{if(this.$isLoading.value=!0,this.item.tanggal_jatuh_tempo=this.tanggal_jatuh_tempo,this.item.total=this.subtotal,this.item.dpp=this.dpp,this.item.grandtotal=this.grandtotal,this.item.total_discount=this.total_discount,this.item.pajak=this.selectedPajakDetail,this.item.jurnal=this.jurnal,this.status=t,this.isClean=!1,Object.keys(this.FormError).length>0){this.$toast.add({severity:"warn",summary:"Warning!!",detail:"Validate error",life:3e3});return}this.isEdit?await A.update(this.item.id,this.FormItem).then(e=>{this.item.status=e.data.data.status,this.item.persetujuan=e.data.data.persetujuan,this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3})}):await A.store(this.FormItem).then(e=>{this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),this.item.id=e.data.data.id,this.item.status=e.data.data.status,this.item.nomor=e.data.data.nomor,this.item.persetujuan=e.data.data.persetujuan,this.isEdit=!0,setTimeout(()=>{this.isEdit=!0,this.$router.replace({name:"ap.edit",params:{id:e.data.data.id}})},1e3)})}catch(e){e instanceof ue&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3}),this.item.status="D"}finally{this.$timeoutLoading(),this.closingDialog=!1}this.item.id_po==null&&this.item.detail.every(a=>a.nama_barang!=null&&a.nama_barang.trim()!=="")&&this.item.detail.push({...this.nullDetail})},async submitPersetujuan(t=!1){const e={id:this.item.id,status:t,keterangan:this.item.keterangan};this.$isLoading.value=!0,await A.updatePersetujuan(e).then(a=>{this.item.status=a.data.data.update_status||this.item.status,this.item.persetujuan.forEach(s=>{s.urut==a.data.data.urut&&(s.tanggal_persetujuan=a.data.data.tanggal_persetujuan,s.status=a.data.data.status,s.keterangan=a.data.data.keterangan)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Update persetujuan",life:3e3}),this.showPersetujuanDialog=!1}).catch(a=>{this.$toast.add({severity:"error",summary:"Error",detail:a,life:3e3})}).finally(()=>{this.$timeoutLoading()}),this.showPersetujuanDialog=!1},confirmApprove(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!0},confirmReject(){this.showPersetujuanDialog=!0,this.item.keterangan="",this.isApprove=!1},async getAp(){await A.show(this.item.id).then(async t=>{this.item=t.data.data,this.item.tanggal=new Date(this.item.tanggal),this.item.tanggal_referensi=this.item.tanggal_referensi?new Date(this.item.tanggal_referensi):null,this.item.tanggal_pengiriman=this.item.tanggal_pengiriman?new Date(this.item.tanggal_pengiriman):null,this.item.tanggal_jatuh_tempo=this.item.tanggal_jatuh_tempo?new Date(this.item.tanggal_jatuh_tempo):null,this.item.detail.forEach(e=>{if(e.qty=parseFloat(e.qty),e.diskonrp=parseFloat(e.diskonrp),e.diskonpersen=parseFloat(e.diskonpersen),e.harga=parseFloat(e.harga),this.item.status=="D"&&e.id_barang&&this.selectIdAccountDetail(e,e),e.id_barang){const a=this.lProduk.find(s=>s.id==e.id_barang);e.option_satuan=a.option_satuan,e.selectedSatuan=e.option_satuan.find(s=>s.id==e.id_satuan)}else e.option_satuan=[],e.selectedSatuan=this.lSatuan.find(a=>a.id==e.id_satuan);if(e.id_proyek&&(e.selectedProyek=this.lProyek.find(a=>a.id==e.id_proyek)),e.id_pajak){const a=this.lPajak.filter(s=>e.id_pajak.split(",").includes(s.id.toString()));e.selectedPajak=a,e.pajak=a.map(s=>s.nama).join(),e.id_pajak=a.map(s=>s.id).join(),e.persen_pajak=a.map(s=>s.nilai).join()}}),this.item.id_uang_muka!=null&&await oe.show(this.item.id_uang_muka).then(e=>{e.data.data==null?this.item.uang_muka=null:(this.item.uang_muka=e.data.data,this.item.id_uang_muka=e.data.data.id)}),this.settingStore.pembelian.pajak=="b"&&(this.lPajak=this.lPajak.map(e=>{var a,s;return{...e,is_selected:(s=(a=this.item.detail[0])==null?void 0:a.selectedPajak)==null?void 0:s.some(i=>i.id==e.id)}})),this.item.id_po==null&&this.item.status=="D"&&this.tambahDetail()})},async getData(){var t;(t=this.settingStore.pembelian)!=null&&t.proyek&&await G.getProyek().then(e=>{this.lProyek=e.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Proyek",life:3e3})}),await G.getProduk().then(e=>{this.lProduk=e.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await re.index().then(e=>{this.lPajak=e.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Pajak",life:3e3})}),await se.index().then(e=>{this.lSatuan=e.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})})},Cetak(){this.$router.push({name:"ap.print",params:{id:this.item.id}})},searchProyek(t){setTimeout(()=>{this.filteredlProyek=t.query.trim().length?this.lProyek.filter(e=>e.proyek.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProyek]},250)},selectAllPajak(t){this.item.detail.forEach(e=>{e.selectedPajak=t.value,e.pajak=t.value.map(a=>a.nama).join(),e.id_pajak=t.value.map(a=>a.id).join(),e.persen_pajak=t.value.map(a=>a.nilai).join()})},toggleSelectAllPajak(t){this.$refs.op_select_all_pajak.toggle(t)},selectSupplier(t){this.item.top=t.value.top,this.item.akun_hutang=t.value.akun_hutang,this.item.keterangan=`Faktur Pembelian ${t.value.kontak}`},searchProduk(t){setTimeout(()=>{this.filteredlProduk=t.query.trim().length?this.lProduk.filter(e=>e.nama_barang.toLowerCase().includes(t.query.trim().toLowerCase())):[...this.lProduk]},250)},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(t=>!this.item.detail.some(e=>e.nama_barang==t.nama_barang))},250)},switchType(t){const e=this.item.detail[t].type=this.item.detail[t].type=="produk"?"jasa":"produk";this.item.detail[t]={...this.nullDetail,type:e,harga:0,qty:0,diskonpersen:0,diskonrp:0}},tambahDetail(){this.item.detail.some(t=>t.nama_barang==null)||this.item.detail.push({...this.nullDetail})},removeApDetail(t){this.item.detail=this.item.detail.filter(e=>e.nama_barang!=t.nama_barang)},selectAkun(t,e){this.item.detail[e].akun=t.value.name}},computed:{subtotal_diskon(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.qty)*parseFloat(e.harga)*parseFloat(e.diskonpersen)/100,0)},diskon(){return this.item.detail.reduce(()=>parseFloat(this.subtotal-this.subtotal_diskon),0)},subtotal(){return this.item.detail.reduce((t,e)=>t+parseFloat(e.total||0),0)},total_discount(){return this.subtotal*(this.item.persendiskon??0)/100},dpp(){return this.subtotal-this.total_discount},total_pajak(){return this.selectedPajakDetail.reduce((t,e)=>t+e.nilai,0)},grandtotal(){const t=parseFloat(this.dpp),e=parseFloat(this.total_pajak);let a=this.item.uang_muka?parseFloat(this.item.uang_muka.bayar):0;return isNaN(a)&&(a=0),t+e-a},tanggal_jatuh_tempo(){return _e(this.item.tanggal).add(this.item.top,"days").toDate()},selectedPajakDetail(){const t=[];return this.item.detail.forEach(e=>{const a=e.total;e.selectedPajak!=null&&e.selectedPajak.forEach(s=>{const i={};i.nama=s.nama,i.id=s.id,i.nilai=(a-a*(this.item.persendiskon||0)/100)*s.nilai/100;let o=-1;for(let y=0;y<t.length;y++)if(t[y].nama===i.nama){o=y;break}o==-1?t.push(i):t[o].nilai+=i.nilai})}),t},jurnal(){var a;const t=[],e=this.item.detail.reduce((s,i)=>{if(i.id_account!==null){const o=s.find(y=>y.id_account===i.id_account&&y.id_proyek===i.id_proyek);o?o.total=parseFloat(o.total)+parseFloat(i.total):s.push({...i})}return s},[]);for(const s of e)if(s&&s.id_account){const i=this.akunStore.getAkunById(s.id_account);t.push({id_account:i.id,id_proyek:s.id_proyek,account_name:i.name,account_code:i.code,is_debit:!0,amount:s.total})}if(this.total_pajak)for(const s of this.selectedPajakDetail){const i=this.lPajak.find(y=>y.id==s.id),o=this.akunStore.getAkunById(i.akun_pembelian);t.push({id_account:o.id,account_name:o.name,account_code:o.code,is_debit:!0,amount:s.nilai})}if(this.total_discount){const s=this.akunStore.getAkunById(246);t.push({id_account:s.id,account_name:s.name,account_code:s.code,is_debit:!1,amount:this.total_discount})}if(this.grandtotal&&(a=this.item)!=null&&a.akun_hutang){const s=this.akunStore.getAkunById(this.item.akun_hutang);t.push({id_account:s.id,account_name:s.name,account_code:s.code,is_debit:!1,amount:this.grandtotal})}return t},nomorPenerimaanBarang(){return this.item.penerimaan_barang.reduce((t,e)=>e.nomor&&!t.includes(e.nomor)?(t.length>0?`${t}, `:t)+e.nomor:t,"")},FormItem(){return{...this.item,status:this.status,detail:this.item.detail.filter(t=>t.nama_barang!=null)}},FormError(){if(this.isClean==!0)return{};try{return je.parse(this.FormItem),{}}catch(t){return console.error(t),t.format()}},canPersetujuan(){var a;const t=(a=this.item.persetujuan)==null?void 0:a.find(s=>s.id_pegawai==this.$auth.id&&s.tanggal_persetujuan==null),e=t?this.item.persetujuan.find(s=>s.urut<t.urut&&s.status===!0):null;return t&&(e||(t==null?void 0:t.urut)==1)},lPajakSelection(){return this.settingStore.pembelian.pajak=="b"?this.lPajak.filter(t=>{var e,a;return(a=(e=this.settingStore.pembelian)==null?void 0:e.id_pajak)==null?void 0:a.some(s=>s==t.id)}).map(t=>({...t,is_selected:t.is_selected||!1})):[]}}},Pe={class:"grid"},Se={class:"col-12"},De={class:"card"},Ve={key:0},Ce={key:1},we={key:2},xe={class:"p-fluid formgrid grid"},Fe={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-3"},Ae={class:"field col-12 sm:col-6 md:col-2 lg:col-2 xl:col-2"},Ue={class:"field col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2"},Ee=n("div",{class:"col-12"},null,-1),Te={class:"field col-12 md:col-3"},Ie={class:"field col-12 sm:col-6 md:col-3 lg:col-2 xl:col-2"},Be={class:"field col-6 md:col-2"},Le={class:"field col-12 md:col-2"},qe={class:"field col-12 md:col-3"},Ne={class:"field col-12"},Me={class:"col-12 my-4"},Oe={class:"text-center"},Je={class:"flex align-items-center gap-2"},ze={class:"capitalize"},Re={key:0},Ge={key:1},Ke={key:2},He={class:"flex flex-column"},Ye={key:3},Qe={key:4,style:{"text-align":"end"}},We={key:5},Xe={class:"flex flex-column"},Ze={class:"text-green-500"},$e={key:6},et={class:"flex flex-column"},tt={class:""},at={class:"flex flex-column"},it={class:""},nt={class:"product-autocomplete"},lt={class:"kode"},st={class:"row"},ot={class:"col-12"},rt=n("div",{class:"col-12 md:col-6 xl:col-5 mb-2"},null,-1),ut=n("div",{class:"xl:col-2"},null,-1),dt={class:"col-12 md:col-6 xl:col-5"},mt={class:"grid py-3 justify-content-center align-items-center"},ct=n("div",{class:"col-7 md:col-6"},"Sub Total",-1),pt={class:"col-5 md:col-6 text-right"},ht={class:"grid py-3 justify-content-center align-items-center"},gt=n("div",{class:"col-3 sm:col-2 md:col-2 lg:col-2"},"Diskon",-1),_t={class:"col-5 sm:col-4 md:col-5 lg:col-4"},kt={class:"p-inputgroup"},yt=n("span",{class:"p-inputgroup-addon"},[n("i",{class:"pi pi-percentage"})],-1),ft={class:"col-4 sm:col-6 md:col-5 lg:col-6 text-right"},bt={key:0,class:"grid py-3 justify-content-center align-items-center"},jt=n("div",{class:"col-6"},"DPP",-1),vt={class:"col-6 text-right"},Pt={key:1},St={class:"col-4"},Dt={class:"field col-4"},Vt={class:"col-4 text-right"},Ct={key:2},wt={class:"col-6"},xt={class:"col-6 text-right"},Ft={key:3,class:"grid py-3 justify-content-center align-items-center"},At=n("div",{class:"col-7 md:col-6"},"Uang Muka",-1),Ut={class:"col-5 md:col-6 text-right"},Et={class:"grid py-3 justify-content-center align-items-center"},Tt=n("div",{class:"col-12"},[n("hr")],-1),It=n("div",{class:"col-6"},"Grand Total",-1),Bt={class:"col-6 text-right"},Lt={key:3,class:"p-datatable col-6"},qt={class:"p-datatable-table p-datatable-striped"},Nt=n("thead",{class:"p-datatable-thead"},[n("tr",{role:"row"},[n("th",{colspan:"7",class:"text-left"},"Harus Disetujui Oleh:")]),n("tr",null,[n("th",null,"No"),n("th",null,"Nama"),n("th",null,"Jabatan"),n("th",null,"Tanggal"),n("th",null,"Status"),n("th",null,"Keterangan")])],-1),Mt={class:"p-datatable-tbody"},Ot={key:0},Jt={key:1},zt={key:2},Rt={class:"grid"},Gt={class:"col-6"},Kt={class:"flex flex-wrap gap-3 justify-content-start"},Ht={class:"col-6"},Yt={class:"flex flex-wrap gap-3 justify-content-end"},Qt={class:"grid col pb-0"},Wt={class:"col py-1"},Xt={class:"col text-green-500 py-1"},Zt=n("div",{class:"flex align-items-center justify-content-center"},[n("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),n("span",null,"Masukkan Catatan")],-1);function $t(t,e,a,s,i,o){var M,O,J,z,R;const y=_("Toast"),Q=_("Tag"),W=_("AutoCompleteKontak"),S=_("Label"),w=_("Calendar"),D=_("ErrorMsg"),x=_("InputText"),X=_("AutoCompleteGudang"),Z=_("InputTop"),I=_("Textarea"),v=_("Button"),F=_("Column"),B=_("AutoComplete"),L=_("Dropdown"),$=_("AutoCompleteAkun"),q=_("MultiSelect"),N=_("InputNumber"),ee=_("DataTable"),te=_("Checkbox"),ae=_("SubmitButton"),ie=_("OverlayPanel"),ne=_("Dialog"),le=_("MyJurnal"),E=ke("select-all-text");return u(),h("div",Pe,[n("div",Se,[n("div",De,[m(y),n("h5",null,[j(" Faktur Pembelian "),m(Q,{style:{float:"right"},value:t.$h.getLabel(i.item.status),severity:t.$h.getLabel(i.item.status)},null,8,["value","severity"])]),i.item.nomor_po!=null?(u(),h("p",Ve,"Nomor Pesanan : "+c(i.item.nomor_po),1)):b("",!0),i.item.detail.some(l=>l.id_pb!=null)?(u(),h("span",Ce," Nomor Penerimaan: "+c(o.nomorPenerimaanBarang),1)):b("",!0),i.item.nomor_po!=null?(u(),h("hr",we)):b("",!0),n("div",xe,[n("div",Fe,[m(W,{label:"Supplier",onSelectItem:o.selectSupplier,modelValue:i.item.id_supplier,"onUpdate:modelValue":e[0]||(e[0]=l=>i.item.id_supplier=l),error:o.FormError.id_supplier,"is-supplier":""},null,8,["onSelectItem","modelValue","error"])]),n("div",Ae,[m(S,{required:""},{default:k(()=>[j("Tanggal")]),_:1}),m(w,{dateFormat:"dd-mm-yy",modelValue:i.item.tanggal,"onUpdate:modelValue":e[1]||(e[1]=l=>i.item.tanggal=l),onDateSelect:t.selectTanggal,maxDate:t.$h.today,class:P({"p-invalid":o.FormError.tanggal}),showButtonBar:"",showIcon:"",iconDisplay:"input"},null,8,["modelValue","onDateSelect","maxDate","class"]),m(D,{error:o.FormError.tanggal},null,8,["error"])]),n("div",Ue,[m(S,{for:"apnumber"},{default:k(()=>[j("Nomor")]),_:1}),m(x,{modelValue:i.item.nomor,"onUpdate:modelValue":e[2]||(e[2]=l=>i.item.nomor=l),disabled:"",id:"apnumber"},null,8,["modelValue"])]),m(X,{"class-field":"md:col-2",modelValue:i.item.id_gudang,"onUpdate:modelValue":e[3]||(e[3]=l=>i.item.id_gudang=l),disabled:(M=i.item.penerimaan_barang)==null?void 0:M.length},null,8,["modelValue","disabled"]),Ee,n("div",Te,[m(S,{for:"referensiinvoice",required:""},{default:k(()=>[j("No Referensi")]),_:1}),m(x,{modelValue:i.item.referensi,"onUpdate:modelValue":e[4]||(e[4]=l=>i.item.referensi=l),inputId:"referensiinvoice",class:P({"p-invalid":o.FormError.referensi})},null,8,["modelValue","class"]),m(D,{error:o.FormError.referensi},null,8,["error"])]),n("div",Ie,[m(S,{for:"tanggal_referensi",required:""},{default:k(()=>[j("Tanggal Referensi")]),_:1}),m(w,{modelValue:i.item.tanggal_referensi,"onUpdate:modelValue":e[5]||(e[5]=l=>i.item.tanggal_referensi=l),class:P({"p-invalid":o.FormError.tanggal_referensi}),inputId:"tanggal_referensi",maxDate:t.$h.today},null,8,["modelValue","class","maxDate"]),m(D,{error:o.FormError.tanggal_referensi},null,8,["error"])]),n("div",Be,[m(Z,{top:i.item.top,"onUpdate:top":e[6]||(e[6]=l=>i.item.top=l),id:i.item.id_top,"onUpdate:id":e[7]||(e[7]=l=>i.item.id_top=l),error:o.FormError.top},null,8,["top","id","error"])]),n("div",Le,[m(S,{required:""},{default:k(()=>[j("Tgl Jatuh Tempo")]),_:1}),m(w,{dateFormat:"dd-mm-yy",modelValue:o.tanggal_jatuh_tempo,"onUpdate:modelValue":e[8]||(e[8]=l=>o.tanggal_jatuh_tempo=l),class:P({"p-invalid":o.FormError.tanggal_jatuh_tempo}),inputId:"tanggal_jatuh_tempo",showButtonBar:"",showIcon:"",iconDisplay:"input",disabled:""},null,8,["modelValue","class"]),m(D,{error:o.FormError.tanggal_jatuh_tempo},null,8,["error"])]),n("div",qe,[m(S,null,{default:k(()=>[j("Tgl Terima Barang")]),_:1}),m(w,{dateFormat:"dd-mm-yy",modelValue:i.item.tanggal_pengiriman,"onUpdate:modelValue":e[9]||(e[9]=l=>i.item.tanggal_pengiriman=l),onDateSelect:t.selectTanggalPengiriman,class:P({"p-invalid":o.FormError.tanggal_pengiriman}),inputId:"item.tanggal_pengiriman",showButtonBar:"",showIcon:"",iconDisplay:"input"},null,8,["modelValue","onDateSelect","class"]),m(D,{error:o.FormError.tanggal_pengiriman},null,8,["error"])]),n("div",Ne,[m(S,{for:"keterangan"},{default:k(()=>[j("Keterangan")]),_:1}),T(m(I,{modelValue:i.item.keterangan,"onUpdate:modelValue":e[10]||(e[10]=l=>i.item.keterangan=l),id:"keterangan",class:P(o.FormError.keterangan&&"p-invalid")},null,8,["modelValue","class"]),[[E]])]),n("div",Me,[m(ee,{value:i.item.detail,editMode:"cell",onCellEditComplete:o.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{empty:k(()=>[n("div",Oe,[m(v,{onClick:o.tambahDetail,severity:"info",outlined:"",label:"Tambah"},null,8,["onClick"])])]),default:k(()=>[m(F,{header:"#",headerStyle:"width:10px;"},{body:k(({index:l})=>[j(c(l+1),1)]),_:1}),m(F,{header:"Tipe",headerStyle:"width:5%;"},{body:k(({data:l,index:r})=>[n("div",Je,[m(v,{onClick:d=>o.switchType(r),icon:l.type=="produk"?"pi pi-box":"pi pi-briefcase",severity:l.type=="produk"?"primary":"secondary",disabled:i.item.status=="C"||i.item.id_po},null,8,["onClick","icon","severity","disabled"]),n("span",ze,c(l.type),1)])]),_:1}),(u(!0),h(V,null,U(o.getColumnDetail(),l=>(u(),f(F,{key:l.field,field:l.field,header:l.header},ye({body:k(({data:r,field:d,index:C})=>[d=="selectedSatuan"?(u(),h("div",Re,c(r[d]&&r[d].satuan),1)):d=="selectedPajak"?(u(),h("div",Ge,c(r.pajak==null?null:r.pajak.toString()),1)):d=="selectedProyek"?(u(),h("div",Ke,[n("span",He,[n("span",null,c(r.proyek),1)])])):d=="id_account"?(u(),h("div",Ye,c(r.id_account&&r.akun),1)):l.type=="currency"?(u(),h("div",Qe,c(r[d]?t.$h.formatNumber(r[d]):null),1)):d=="nama_barang"?(u(),h("div",We,[n("span",Xe,[n("small",Ze,c(r.kode_barang),1),n("span",null,c(r.nama_barang),1)])])):(u(),h("div",$e,c(r[d]),1)),o.FormError.detail&&o.FormError.detail[C]?(u(),f(D,{key:7,error:o.FormError.detail[C][l.error?l.error:d]},null,8,["error"])):b("",!0)]),header:k(()=>[l.header==="Pajak"?(u(),f(v,{key:0,icon:"pi pi-chevron-down",class:"p-button p-button-outlined",onClick:o.toggleSelectAllPajak},null,8,["onClick"])):b("",!0)]),_:2},[i.item.status!="C"&&l.editor?{name:"editor",fn:k(({data:r,field:d,index:C})=>[d=="nama_barang"?(u(),h(V,{key:0},[r.type=="produk"?(u(),f(B,{key:0,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,suggestions:i.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:o.searchProduk,class:"min-w-max",dropdown:"",onDropdownClick:o.searchAllProduk},{option:k(p=>[n("div",et,[n("small",{class:P(p.option.is_stok?"text-green-500":"text-blue-500")},c(p.option.kode_barang),3),n("div",tt,c(p.option.nama_barang),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):(u(),f(x,{key:1,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,name:"nama_barang",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"]))],64)):d=="selectedSatuan"?(u(),h(V,{key:1},[r.type=="produk"?(u(),f(L,{key:0,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,id:"satuan",options:r.option_satuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"])):(u(),f(L,{key:1,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,id:"satuan",options:i.lSatuan,optionLabel:"satuan",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue","options"]))],64)):d=="id_account"?(u(),f($,{key:2,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,onSelectItem:p=>o.selectAkun(p,C),showLabel:!1,level:4},null,8,["modelValue","onUpdate:modelValue","onSelectItem"])):d=="selectedProyek"?(u(),f(B,{key:3,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,suggestions:i.filteredlProyek,optionLabel:"proyek",virtualScrollerOptions:{itemSize:50},onComplete:o.searchProyek,class:"min-w-max",dropdown:""},{option:k(p=>[n("div",at,[n("small",null,c(p.option.kode),1),n("div",it,c(p.option.proyek),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete"])):d=="keterangan"?T((u(),f(x,{key:4,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,autofocus:"",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[E]]):d=="selectedPajak"?(u(),f(q,{key:5,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,options:i.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem"},{option:k(p=>[n("div",nt,[n("div",lt,c(p.option.nilai)+"%",1),n("div",st,[n("div",ot,c(p.option.nama),1)])])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])):l.type=="number"||l.type=="currency"?T((u(),f(N,{key:6,modelValue:r[d],"onUpdate:modelValue":p=>r[d]=p,autofocus:"",inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[E]]):(u(),h(V,{key:7},[j(c(r[d]),1)],64))]),key:"0"}:void 0]),1032,["field","header"]))),128)),i.item.status=="D"||i.item.status==null?(u(),f(F,{key:0,header:"#",headerStyle:"width:5%;"},{body:k(({data:l})=>[this.item.id_po==null?(u(),f(v,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:r=>o.removeApDetail(l)},null,8,["onClick"])):b("",!0)]),_:1})):b("",!0)]),_:1},8,["value","onCellEditComplete"]),m(D,{error:(O=o.FormError.detail)==null?void 0:O.detail},null,8,["error"])]),rt,ut,n("div",dt,[n("div",mt,[ct,n("div",pt,c(t.$h.formatNumber(o.subtotal)),1)]),n("div",ht,[gt,n("div",_t,[n("div",kt,[m(N,{modelValue:i.item.persendiskon,"onUpdate:modelValue":e[11]||(e[11]=l=>i.item.persendiskon=l),placeholder:"Discount",min:0,max:100,minFractionDigits:0,maxFractionDigits:3},null,8,["modelValue"]),yt])]),n("div",ft,c(t.$h.formatNumber(o.total_discount)),1)]),this.selectedPajakDetail.length>0||this.total_discount>0?(u(),h("div",bt,[jt,n("div",vt,c(t.$h.formatNumber(o.dpp)),1)])):b("",!0),i.settingStore.pembelian.pajak=="b"?(u(),h("div",Pt,[(u(!0),h(V,null,U(o.lPajakSelection,(l,r)=>{var d;return u(),h("div",{key:l,class:"grid py-3 justify-content-center align-items-center"},[n("div",St,c(l.nama),1),n("div",Dt,[m(te,{modelValue:l.is_selected,"onUpdate:modelValue":C=>l.is_selected=C,binary:!0,onChange:o.changePajakSelection},null,8,["modelValue","onUpdate:modelValue","onChange"])]),n("div",Vt,c(t.$h.formatNumber((d=o.selectedPajakDetail[r])==null?void 0:d.nilai)),1)])}),128))])):b("",!0),i.settingStore.pembelian.pajak=="a"?(u(),h("div",Ct,[(u(!0),h(V,null,U(o.selectedPajakDetail,l=>(u(),h("div",{key:l,class:"grid py-3 justify-content-center align-items-center"},[n("div",wt,c(l.nama),1),n("div",xt,c(t.$h.formatNumber(l.nilai)),1)]))),128))])):b("",!0),i.item.uang_muka!=null&&i.item.uang_muka.bayar>0?(u(),h("div",Ft,[At,n("div",Ut,c(t.$h.formatNumber(i.item.uang_muka.bayar)),1)])):b("",!0),n("div",Et,[Tt,It,n("div",Bt,c(t.$h.formatNumber(o.grandtotal)),1)])])]),((J=i.item.persetujuan)==null?void 0:J.length)>0&&!this.$route.query.revisi?(u(),h("div",Lt,[n("table",qt,[Nt,n("tbody",Mt,[(u(!0),h(V,null,U(i.item.persetujuan,(l,r)=>(u(),h("tr",{key:r},[n("td",null,c(r+1),1),n("td",null,c(l.nama),1),n("td",null,c(l.jabatan),1),n("td",null,c(t.$h.formatDate(l.tanggal_persetujuan,"DD-MM-YYYY HH:mm:ss")),1),l.tanggal_persetujuan!=null&&!l.status?(u(),h("td",Ot,"Reject")):l.tanggal_persetujuan!=null&&l.status?(u(),h("td",Jt,"Approve")):(u(),h("td",zt,"Menunggu Persetujuan")),n("td",null,c(l.keterangan),1)]))),128))])])])):b("",!0),n("div",Rt,[n("div",Gt,[n("div",Kt,[m(v,{style:{float:"right"},label:"Jurnal",class:P(["p-button mx-2",{"p-button-block":i.jurnalDialog,"p-button-outlined":!i.jurnalDialog}]),onClick:e[12]||(e[12]=l=>i.jurnalDialog=!i.jurnalDialog)},null,8,["class"])])]),n("div",Ht,[n("div",Yt,[!o.canPersetujuan&&!((R=(z=i.item.persetujuan)==null?void 0:z[0])!=null&&R.tanggal_persetujuan)&&i.item.status!="C"?(u(),f(ae,{key:0,loading:t.$isLoading.value,data:i.item,onClick:e[13]||(e[13]=l=>{var r;return o.Save((r=i.settingStore.pembelian.persetujuan.faktur)!=null&&r.persetujuan1?"S":"O")}),onDraft:e[14]||(e[14]=l=>o.Save("D")),showDraft:i.item.status==null||i.item.status=="D"},null,8,["loading","data","showDraft"])):b("",!0),i.item.status=="S"&&o.canPersetujuan?(u(),f(v,{key:1,label:"Reject",severity:"danger",iconPos:"right",icon:"pi pi-times",onClick:o.confirmReject,class:"mx-2"},null,8,["onClick"])):b("",!0),i.item.status=="S"&&o.canPersetujuan?(u(),f(v,{key:2,label:"Approve",severity:"success",iconPos:"right",icon:"pi pi-check",onClick:o.confirmApprove},null,8,["onClick"])):b("",!0)])])]),m(ie,{ref:"op_select_all_pajak"},{default:k(()=>[m(q,{modelValue:i.selectedAllPajak,"onUpdate:modelValue":e[15]||(e[15]=l=>i.selectedAllPajak=l),options:i.lPajak,optionLabel:"nama",placeholder:"Pajak",maxSelectedLabels:3,class:"w-full md:w-20rem",onChange:o.selectAllPajak},{option:k(l=>[n("div",Qt,[n("div",Wt,c(l.option.nama),1),n("div",Xt,c(l.option.nilai)+"%",1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},512),m(ne,{visible:t.showPersetujuanDialog,"onUpdate:visible":e[19]||(e[19]=l=>t.showPersetujuanDialog=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:k(()=>[m(v,{label:"Close",icon:"pi pi-times",class:"p-button-text text-red-500",onClick:e[17]||(e[17]=l=>t.showPersetujuanDialog=!1)}),m(v,{label:t.isApprove?"Approve":"Reject",icon:"pi pi-check",class:"p-button-text",onClick:e[18]||(e[18]=l=>o.submitPersetujuan(t.isApprove))},null,8,["label"])]),default:k(()=>[Zt,m(I,{class:"w-full",modelValue:i.item.keterangan,"onUpdate:modelValue":e[16]||(e[16]=l=>i.item.keterangan=l),rows:"5",cols:"30",placeholder:"Optional"},null,8,["modelValue"])]),_:1},8,["visible"]),m(le,{visible:i.jurnalDialog,"onUpdate:visible":e[20]||(e[20]=l=>i.jurnalDialog=l),value:o.jurnal,"onUpdate:value":e[21]||(e[21]=l=>o.jurnal=l)},null,8,["visible","value"])])])])}const da=me(ve,[["render",$t]]);export{da as default};
