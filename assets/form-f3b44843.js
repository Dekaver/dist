import{a as V}from"./acckas-581f2fe3.js";import{a as q}from"./options-b2eb7ae6.js";import"./custom-zod-e9521e5d.js";import{A as j}from"./index-b9e295bc.js";import{_ as M,r as m,A as J,o as d,c as _,b as a,d as r,e as h,l as v,n as K,m as S,q as z,k as f,f as w,t as g,B as G}from"./index-11eb6111.js";import{z as o}from"./index-0ec66d4d.js";const O=o.object({date:o.coerce.string().nullable(),reference:o.coerce.string(),akun:o.number(),description:o.string().min(3),total:o.number(),kepada:o.string(),type:o.string(),status:o.string(),detail:o.array(o.object({id:o.number().nullable(),id_account:o.number(),code_account:o.string().nullable(),name_account:o.string().nullable(),desc:o.string().min(3),amount:o.number().min(1)}))}),P=O,W={data(){return{lKepada:[],filteredKepada:[],selectedKepada:null,id_kepada:null,date:new Date(Date.now()),item:{id:null,date:new Date(Date.now()),reference:null,akun:null,description:"",total:0,kepada:null,type:"I",status:"D",detail:[{id:null,id_account:null,code_account:null,name_account:null,desc:"",amount:0}]},isClean:!0,columns:[{field:"desc",header:"Deskripsi"},{field:"id_account",header:"Kode",error:"id_account"},{field:"name_account",header:"Akun"},{field:"amount",header:"Jumlah",type:"currency"}]}},methods:{selectKepada(t){this.item.id_kepada=t.value.id,this.item.kepada=t.value.nama},changeKepada(){this.item.id_kepada=null},searchKepada(t){t.query.trim().length?this.filteredKepada=this.lKepada.filter(e=>e.nama.toLowerCase().includes(t.query.trim().toLowerCase())):this.filteredKepada=[...this.lKepada]},async getData(){await q.getCustomerPegawai().then(t=>{this.lKepada=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load nama Customer",life:3e3})})},async Save(t="D"){try{if(this.$isLoading.value=!0,this.item.status=t,this.item.total=this.Total,this.isClean=!1,Object.keys(this.FormError).length>0){this.$toast.add({severity:"warn",summary:"Warning!!",detail:"Validate error",life:3e3});return}this.isEdit?await V.update(this.item.id,this.FormItem).then(e=>{this.item.status=e.data.data.status,this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),e.data.data.status=="C"&&(this.item.detail=this.item.detail.filter(c=>c.id_account!=null))}):await V.store(this.FormItem).then(e=>{this.item.id=e.data.data.id,this.item.reference=e.data.data.reference,this.$toast.add({severity:"success",summary:"Success",detail:e.data.message,life:3e3}),this.isEdit=!0,e.data.data.status=="C"&&(this.item.detail=this.item.detail.filter(c=>c.id_account!=null)),setTimeout(()=>{this.$router.replace({name:"kasmasuk.edit",params:{id:e.data.data.id}})},1e3)}),this.isClean=!0}catch(e){e instanceof j&&this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3}),this.item.status="D"}finally{this.$timeoutLoading()}},selectAkunDetail(t,e){this.item.detail[e].id_account=t.value.id,this.item.detail[e].name_account=t.value.name,this.item.detail[e].code_account=t.value.code},onCellEditComplete(t){let{data:e,newValue:c,field:C}=t;switch(C){case"id_account":if(typeof c=="string"||c==null)return;this.tambahKasDetail();break;default:e[C]=c;break}},tambahKasDetail(){this.item.detail.push({id:null,id_account:null,code_account:null,name_account:null,desc:null,amount:0})},hapusKasDetail(t){this.item.detail.length>1&&(this.item.detail=this.item.detail.filter(e=>e!==t))},selectTanggal(t){this.item.date=this.$h.Date(t)},async GetKasData(){await V.show(this.item.id).then(t=>{this.item=t.data.data,this.date=this.$h.Date(t.data.data.date),this.item.date=this.$h.Date(t.data.data.date),this.item.total=parseFloat(this.item.total),this.item.detail.forEach(e=>{e.amount=parseFloat(e.amount)})})}},mounted(){this.isEdit=!!this.$route.params.id,this.item.id=this.$route.params.id,this.$isLoading.value=!1,this.getData().then(()=>{this.isEdit&&this.GetKasData()})},computed:{Total(){return this.item.detail.reduce((t,e)=>parseFloat(t)+parseFloat(e.amount),0)},FormItem(){return{...this.item,detail:this.item.detail.filter(t=>t.id_account!=null)}},FormError(){if(this.isClean==!0)return{};try{return P.parse(this.FormItem),{}}catch(t){return console.error(t),t.format()}}}},H={class:"grid"},Q={class:"col-12"},R={class:"card"},X={class:"p-fluid formgrid grid justify-content-between"},Y=a("div",{class:"field col-fixed"},[a("h5",null,"Kas Masuk")],-1),Z={class:"field col-fixed"},$={class:"p-fluid formgrid grid"},ee={class:"field col-12 md:col-3"},te={class:"field col-12 md:col-3"},ae={class:"field col-12 md:col-3"},ie={class:"field col-12 md:col-3"},le={class:"field col-12 md:col-12"},se={class:"col-12 my-4"},oe={key:0},re={key:1},ne={key:2},de={key:3},ue={class:"col-12"},me={class:"p-fluid formgrid grid"},ce=a("div",{class:"col-6 md:col-10 text-right"},[a("p",{class:"text-right"},"Total")],-1),he={class:"col-6 md:col-2"},pe={class:"text-right"},_e=a("br",null,null,-1),fe={class:"grid"},ge=a("div",{class:"col-6"},[a("div",{class:"flex flex-wrap gap-3 justify-content-start"})],-1),ye={class:"col-6"},ve={class:"flex flex-wrap gap-3 justify-content-end"};function be(t,e,c,C,l,s){const x=m("Tag"),b=m("Label"),D=m("InputText"),y=m("ErrorMsg"),T=m("Calendar"),E=m("AutoCompleteAkun"),I=m("AutoComplete"),L=m("InputNumber"),F=m("Column"),A=m("Button"),B=m("DataTable"),U=m("SubmitButton"),N=J("select-all-text");return d(),_("div",H,[a("div",Q,[a("div",R,[a("div",X,[Y,a("div",Z,[r(x,{icon:"pi pi-info-circle",style:{float:"right"},value:t.$h.getLabel(l.item.status)=="draft"?"Jurnal Belum Diposting":"Jurnal Sudah Diposting",severity:t.$h.getLabel(l.item.status)},null,8,["value","severity"])])]),a("div",$,[a("div",ee,[r(b,{required:t.isEdit,for:"receipt"},{default:h(()=>[v("Nomor")]),_:1},8,["required"]),r(D,{disabled:"",id:"receipt",type:"text",modelValue:l.item.reference,"onUpdate:modelValue":e[0]||(e[0]=i=>l.item.reference=i)},null,8,["modelValue"]),r(y,{error:s.FormError.reference},null,8,["error"])]),a("div",te,[r(b,{required:"",class:"mb-2"},{default:h(()=>[v("Tanggal")]),_:1}),r(T,{dateFormat:"dd-mm-yy",modelValue:l.date,"onUpdate:modelValue":e[1]||(e[1]=i=>l.date=i),onDateSelect:s.selectTanggal,maxDate:t.$h.today},null,8,["modelValue","onDateSelect","maxDate"]),r(y,{error:s.FormError.date},null,8,["error"])]),a("div",ae,[r(E,{modelValue:l.item.akun,"onUpdate:modelValue":e[2]||(e[2]=i=>l.item.akun=i),level:4,cashable:"",error:s.FormError.akun},null,8,["modelValue","error"])]),a("div",ie,[r(b,{required:"",for:"kepada"},{default:h(()=>[v("Kepada")]),_:1}),r(I,{modelValue:l.item.kepada,"onUpdate:modelValue":e[3]||(e[3]=i=>l.item.kepada=i),dropdown:"",suggestions:l.filteredKepada,onChange:s.changeKepada,onItemSelect:s.selectKepada,onComplete:s.searchKepada,optionLabel:"nama",class:K(s.FormError.kepada&&"p-invalid")},null,8,["modelValue","suggestions","onChange","onItemSelect","onComplete","class"]),r(y,{error:s.FormError.kepada},null,8,["error"])]),a("div",le,[r(b,{required:t.isEdit,for:"keterangan"},{default:h(()=>[v("Keterangan")]),_:1},8,["required"]),r(D,{id:"keterangan",type:"text",modelValue:l.item.description,"onUpdate:modelValue":e[4]||(e[4]=i=>l.item.description=i),class:K(s.FormError.description&&"p-invalid")},null,8,["modelValue","class"]),r(y,{error:s.FormError.description},null,8,["error"])]),a("div",se,[r(B,{value:l.item.detail,editMode:"cell",onCellEditComplete:s.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{default:h(()=>[(d(!0),_(S,null,z(l.columns,i=>(d(),f(F,{key:i.field,field:i.field,header:i.header},{body:h(({data:u,field:n,index:k})=>[n=="id_account"?(d(),_("div",oe,g(u.code_account),1)):i.type=="number"?(d(),_("div",re,g(t.$h.formatNumber(u[n])),1)):i.type=="currency"?(d(),_("div",ne,g(t.$h.formatNumber(u[n])),1)):(d(),_("div",de,g(u[n]),1)),s.FormError.detail&&s.FormError.detail[k]?(d(),f(y,{key:4,error:s.FormError.detail[k][i.error?i.error:n]},null,8,["error"])):w("",!0)]),editor:h(({data:u,field:n,index:k})=>[i.type=="currency"||i.type=="number"?G((d(),f(L,{key:0,modelValue:u[n],"onUpdate:modelValue":p=>u[n]=p,inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:2,min:0,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[N]]):n=="desc"?(d(),f(D,{key:1,modelValue:u[n],"onUpdate:modelValue":p=>u[n]=p,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])):n=="id_account"?(d(),f(E,{key:2,modelValue:u[n],"onUpdate:modelValue":p=>u[n]=p,onSelectItem:p=>s.selectAkunDetail(p,k),showLabel:!1,level:4},null,8,["modelValue","onUpdate:modelValue","onSelectItem"])):(d(),_(S,{key:3},[v(g(u[n]),1)],64))]),_:2},1032,["field","header"]))),128)),l.item.status!="C"?(d(),f(F,{key:0,header:"#",headerStyle:"width:5%;"},{body:h(({data:i})=>[r(A,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:u=>s.hapusKasDetail(i)},null,8,["onClick"])]),_:1})):w("",!0)]),_:1},8,["value","onCellEditComplete"])])]),a("div",ue,[a("div",me,[ce,a("div",he,[a("p",pe,g(t.$h.formatNumber(s.Total)),1)])])]),_e,a("div",fe,[ge,a("div",ye,[a("div",ve,[l.item.status!="C"?(d(),f(U,{key:0,loading:t.$isLoading.value,data:l.item,onClick:e[5]||(e[5]=i=>s.Save("D")),onClose:e[6]||(e[6]=i=>s.Save("C")),showClose:l.item.status==null||l.item.status=="D"},null,8,["loading","data","showClose"])):w("",!0)])])])])])])}const Fe=M(W,[["render",be]]);export{Fe as default};
