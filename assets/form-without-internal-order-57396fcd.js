import{a as L}from"./jeniskendaraan-ee8c8507.js";import{a as C}from"./internaltransfer-7aab9fa3.js";import{a as T}from"./options-b2eb7ae6.js";import{a as P}from"./produk-90d88791.js";/* empty css                             */import{_ as q,r as c,A as J,o as m,c as h,d as o,b as a,l as j,t as k,n as D,f as p,e as v,m as B,q as K,k as b,B as G}from"./index-11eb6111.js";const N={data(){return{item:{id:null,nomor:null,tanggal:null,id_pengirim:null,id_penerima:null,id_gudang_asal:null,id_gudang_tujuan:null,gudang_asal:null,gudang_tujuan:null,status:null,tanggal_kirim:null,tanggal_terima:null,jam_kirim:null,jam_terima:null,keterangan:null,telepon:null,nopol:null,id_jenis_kendaraan:null,driver:null,transporter:null,detail:[{nama_barang:null,kode_barang:null,id_barang:null,id_satuan:null,qty:0,keterangan:"",satuan:"-",optionSatuan:[]}]},lGudang:[],selectedGudangAsal:null,selectedGudangTujuan:null,lProduk:[],selectedProduk:null,filteredlProduk:[],lJeniskendaraan:[],selectedJenisKendaraan:null,lSatuan:[],columns:[{field:"nama_barang",header:"Product",width:"15%",class:"left"},{field:"kode_barang",header:"Code Product",width:"15%",class:"left"},{field:"qty",header:"Qty",width:"15%",class:"left"},{field:"satuan",header:"Unit",width:"15%",class:"left"},{field:"keterangan",header:"Remark",width:"15%",class:"left"}],tanggal:null,tanggal_kirim:null,tanggal_terima:null,filters:{},isMore:!1,isEdit:!1,isSubmit:!1}},computed:{invalid:function(){return!(this.item.tanggal!=null&&this.item.id_gudang_asal!=null&&this.item.id_gudang_tujuan!=null)}},mounted(){this.isEdit=!!this.$route.params.id,this.item.id=this.$route.params.id?this.$route.params.id:null,this.tanggal=this.$serverTime,this.tanggal_kirim=this.$serverTime,this.tanggal_terima=this.$serverTime,this.item.tanggal=this.$h.Date(this.$date),this.item.tanggal_kirim=this.$h.Date(this.$date),this.item.tanggal_terima=this.$h.Date(this.$date),this.item.status="D",this.getData().then(()=>{this.isEdit&&this.getInternalTransfer()})},methods:{onCellEditComplete(i){let{data:e,newValue:n,field:r}=i;switch(r){case"nama_barang":if(typeof n=="string"||n==null)return;if(n.id){let t={};t=this.lSatuan.find(s=>s.id==n.id_satuan),e.satuan=t,P.getSatuanBarang(n.id).then(s=>{n.optionSatuan=[],t.konversi=1,n.optionSatuan.push(t),s.data.data.forEach(f=>{t=this.lSatuan.find(V=>V.id==f.id_satuan_kanan),t.konversi=f.konversi,n.optionSatuan.push(t)}),e.optionSatuan=n.optionSatuan,e.id_barang=n.id,e.id_satuan=n.id_satuan})}e[r]=n.nama_barang,e.optionSatuan=n.optionSatuan,e.kode_barang=n.kode_barang;break;case"qty":e[r]=n;break;case"satuan":e.id_satuan=n.id,e[r]=n;break;case"keterangan":e[r]=n;break}},async getData(){await T.getGudang().then(i=>{this.lGudang=i.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Gudang",life:3e3})}),await L.index().then(i=>{this.lJeniskendaraan=i.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Jenis Kendaraan",life:3e3})}),await T.getProduk().then(i=>{this.lProduk=i.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Barang",life:3e3})}),await T.getSatuan().then(i=>{this.lSatuan=i.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Satuan Barang",life:3e3})})},async getInternalTransfer(){await C.show(this.item.id).then(i=>{this.item=i.data.data,this.tanggal=new Date(this.item.tanggal),this.tanggal_internal_order=new Date(this.item.tanggal_internal_order),this.item.tanggal=this.tanggal,this.selectedInternalOrder=this.item.nomor_internal_order,this.selectedJenisKendaraan=this.lJeniskendaraan.find(e=>e.id==this.item.id_jenis_kendaraan),this.selectedGudangAsal=this.lGudang.find(e=>e.id==this.item.id_gudang_asal),this.selectedGudangTujuan=this.lGudang.find(e=>e.id==this.item.id_gudang_tujuan),this.item.detail.map(async e=>{if(e.kode_barang){let n=this.lProduk.find(r=>r.id==e.id_barang);P.getSatuanBarang(n.id).then(r=>{n.optionSatuan=[];let t={};t=this.lSatuan.find(s=>s.id==n.id_satuan),t.konversi=1,e.harga=parseFloat(e.harga),e.total=e.harga*e.qty,n.optionSatuan.push(t),r.data.data.forEach(s=>{t=this.lSatuan.find(f=>f.id==s.id_satuan_kanan),t.konversi=s.konversi,n.optionSatuan.push(t)}),e.optionSatuan=n.optionSatuan,e.kode_barang=n.kode_barang,e.satuan=e.optionSatuan.find(s=>s.id==e.id_satuan)}),e.produk=e.nama_barang}return{...e}})})},selectDate(i){this.item.tanggal=this.$h.Date(i)},selectJenisKendaraan(i){this.item.id_jenis_kendaraan=i.value.id},searchAllProduk(){setTimeout(()=>{this.filteredlProduk=this.lProduk.filter(i=>!this.item.detail.map(e=>e.id_barang).includes(i.id))},250)},searchProduk(i){setTimeout(()=>{i.query.trim().length?this.filteredlProduk=this.lProduk.filter(e=>e.nama_barang.toLowerCase().includes(i.query.trim().toLowerCase())&&!this.item.detail.map(n=>n.id_barang).includes(e.id)):this.filteredlProduk=[...this.lProduk]},250)},tambahBarisDetail(){this.item.detail.push({nama_barang:null,kode_barang:null,id_barang:null,id_satuan:null,qty:0,keterangan:"",satuan:"-",optionSatuan:[]})},selectGudangAsal(i){this.item.id_gudang_asal=i.value.id},selectGudangTujuan(i){this.item.id_gudang_tujuan=i.value.id},async submitForm(i="D"){let e=this.item.status;try{if(this.isSubmit=!0,this.invalid)return;if(i=="S"){let n=!1;if(this.item.detail.forEach(r=>{r.id_barang==null&&(n=!0),r.id_barang==null&&(n=!0)}),n){this.$toast.add({severity:"warn",summary:"Warning!",detail:"Barang tidak boleh kosong",life:3e3});return}if(this.item.detail.reduce((r,t)=>r+parseFloat(t.qty),0)==0){this.$toast.add({severity:"warn",summary:"Warning!",detail:"Minimal ada 1 barang",life:3e3});return}}this.item.status=i,this.isEdit?(this.item.status!="X"&&(this.item.alasan=""),C.update(this.item.id,this.item).then(n=>{this.$toast.add({severity:"success",summary:"Successful",detail:n.data.message,life:3e3})}).catch(n=>{this.$toast.add({severity:"warn",summary:"Warning",detail:n.response.data.message,life:3e3})})):C.store(this.item).then(n=>{this.item.id=n.data.data.id,this.item.nomor=n.data.data.nomor,setTimeout(()=>{this.$router.push({name:"internal-transfer.edit",params:{id:n.data.data.id}})},1e3),this.isEdit=!0,this.$toast.add({severity:"success",summary:"Successful",detail:n.data.message,life:3e3})}).catch(n=>{this.$toast.add({severity:"error",summary:"Failed",detail:n.response.data.message,life:3e3})})}catch(n){this.$toast.add({severity:"error",summary:"Failed",detail:n.response.data.message,life:3e3})}finally{this.item.status=e,this.isSubmit=!1}},submitPosting(){this.submitForm("S").catch(()=>{this.item.status="D"})},buttons(){return[{label:"Posting",icon:"pi pi-refresh",command:()=>{this.submitPosting()}}]}}},R={class:"grid"},O={class:"col-12"},W={class:"card"},z={class:"p-fluid formgrid grid"},M={class:"field col-12 md:col-3"},Q=a("label",{for:"donumber"},"No. Internal Transfer",-1),X={class:"field col-12 md:col-3"},H={class:"p-float-label"},Y=a("p",{class:"mb-1"},"Tanggal",-1),Z={class:"field col-12 md:col-3"},$=a("label",{for:"gudang",class:"mb-2"},[j("Gudang Asal"),a("small",{class:"text-red-500"},"*")],-1),ee={key:0,class:"p-invalid"},te={class:"field col-12 md:col-3"},ae=a("label",{for:"gudang",class:"mb-2"},[j("Gudang Tujuan"),a("small",{class:"text-red-500"},"*")],-1),ne={key:0,class:"p-invalid"},le={class:"field col-12 md:col-3"},ie={class:"p-float-label"},se=a("p",{class:"mb-1"},"Transporter Date",-1),oe={class:"field col-12 md:col-3"},de=a("label",{for:"transtime"},"Transporter Time",-1),re={class:"field col-12 md:col-3"},ue=a("label",{for:"transporter"},"Transporter",-1),me={key:0,class:"field col-12 md:col-3"},ce={class:"p-float-label"},ge=a("p",{class:"mb-1"},"Receive Date",-1),_e={key:1,class:"field col-12 md:col-3"},he=a("label",{for:"transtime"},"Receive Time",-1),pe={class:"field col-12 md:col-3"},fe=a("label",{for:"driver"},"Driver Name",-1),be={class:"field col-12 md:col-3"},ke=a("label",{for:"jenis_kendaraan"},"Jenis Kendaraan",-1),ve={class:"field col-12 md:col-3"},ye=a("label",{for:"licplate"},"Nomor Plat",-1),Ve={class:"field col-12 md:col-12"},Se=a("label",{for:"keterangan"},"Keterangan",-1),we=a("div",{class:"field col-12 md:col-12"},null,-1),Ce={class:"field col-6 md:col-2"},Te={class:"col-12 my-4"},De=a("div",{class:"text-center"},"Empty",-1),je={key:0},xe={key:1},Pe={class:"product-autocomplete"},Be={class:"kode"},Ge={class:"row"},Ue={class:"col-12"},Fe=a("br",null,null,-1),Ee={class:"grid"},Ae={class:"col-6"},Ie={class:"flex flex-wrap gap-3 justify-content-start"},Le={class:"col-6"},qe={class:"flex flex-wrap gap-3 justify-content-end"};function Je(i,e,n,r,t,s){const f=c("Toast"),V=c("Tag"),_=c("InputText"),S=c("Calendar"),y=c("Dropdown"),w=c("Button"),U=c("AutoComplete"),F=c("InputNumber"),E=c("Column"),A=c("DataTable"),I=c("SplitButton"),x=J("select-all-text");return m(),h(B,null,[o(f),a("div",R,[a("div",O,[a("div",W,[a("h5",null,[j(k(t.isEdit?"Edit":"Add")+" Internal Transfer ",1),o(V,{style:{float:"right"},value:i.$h.getLabel(t.item.status),severity:i.$h.getLabel(t.item.status)},null,8,["value","severity"])]),a("div",z,[a("div",M,[Q,o(_,{modelValue:t.item.nomor,"onUpdate:modelValue":e[0]||(e[0]=l=>t.item.nomor=l),id:"donumber",type:"text",readonly:""},null,8,["modelValue"])]),a("div",X,[a("span",H,[Y,o(S,{dateFormat:"dd-mm-yy",modelValue:t.tanggal,"onUpdate:modelValue":e[1]||(e[1]=l=>t.tanggal=l),inputId:"tanggal",onDateSelect:s.selectDate,showButtonBar:""},null,8,["modelValue","onDateSelect"])])]),a("div",Z,[$,o(y,{id:"gudangitem",modelValue:t.selectedGudangAsal,"onUpdate:modelValue":e[2]||(e[2]=l=>t.selectedGudangAsal=l),options:t.lGudang,optionLabel:"gudang",class:D({"p-invalid":t.isSubmit&&!t.item.id_gudang_asal}),onChange:s.selectGudangAsal},null,8,["modelValue","options","class","onChange"]),t.isSubmit&&!t.item.id_gudang_asal?(m(),h("small",ee,"Required")):p("",!0)]),a("div",te,[ae,o(y,{id:"gudangitem",modelValue:t.selectedGudangTujuan,"onUpdate:modelValue":e[3]||(e[3]=l=>t.selectedGudangTujuan=l),options:t.lGudang,optionLabel:"gudang",class:D({"p-invalid":t.isSubmit&&!t.item.id_gudang_tujuan}),onChange:s.selectGudangTujuan},null,8,["modelValue","options","class","onChange"]),t.isSubmit&&!t.item.id_gudang_tujuan?(m(),h("small",ne,"Required")):p("",!0)]),a("div",le,[a("span",ie,[se,o(S,{dateFormat:"dd-mm-yy",modelValue:t.tanggal_kirim,"onUpdate:modelValue":e[4]||(e[4]=l=>t.tanggal_kirim=l),inputId:"datetransporter"},null,8,["modelValue"])])]),a("div",oe,[de,o(_,{modelValue:t.item.jam_kirim,"onUpdate:modelValue":e[5]||(e[5]=l=>t.item.jam_kirim=l),id:"transtime",type:"text"},null,8,["modelValue"])]),a("div",re,[ue,o(_,{modelValue:t.item.transporter,"onUpdate:modelValue":e[6]||(e[6]=l=>t.item.transporter=l),id:"transporter",type:"text"},null,8,["modelValue"])]),i.$setting.internal_receive?p("",!0):(m(),h("div",me,[a("span",ce,[ge,o(S,{dateFormat:"dd-mm-yy",modelValue:t.tanggal_terima,"onUpdate:modelValue":e[7]||(e[7]=l=>t.tanggal_terima=l),inputId:"tanggal_terima"},null,8,["modelValue"])])])),i.$setting.internal_receive?p("",!0):(m(),h("div",_e,[he,o(_,{modelValue:t.item.jam_terima,"onUpdate:modelValue":e[8]||(e[8]=l=>t.item.jam_terima=l),id:"transtime",type:"text"},null,8,["modelValue"])])),a("div",pe,[fe,o(_,{modelValue:t.item.driver,"onUpdate:modelValue":e[9]||(e[9]=l=>t.item.driver=l),id:"driver",type:"text"},null,8,["modelValue"])]),a("div",be,[ke,o(y,{id:"gudangitem",modelValue:t.selectedJenisKendaraan,"onUpdate:modelValue":e[10]||(e[10]=l=>t.selectedJenisKendaraan=l),options:t.lJeniskendaraan,optionLabel:"jenis_kendaraan",onChange:s.selectJenisKendaraan},null,8,["modelValue","options","onChange"])]),a("div",ve,[ye,o(_,{modelValue:t.item.nopol,"onUpdate:modelValue":e[11]||(e[11]=l=>t.item.nopol=l),id:"licplate",type:"text"},null,8,["modelValue"])]),a("div",Ve,[Se,o(_,{modelValue:t.item.keterangan,"onUpdate:modelValue":e[12]||(e[12]=l=>t.item.keterangan=l),id:"keterangan",type:"text"},null,8,["modelValue"])]),we,a("div",Ce,[o(w,{label:"Add",size:"small",icon:"pi pi-plus",onClick:s.tambahBarisDetail},null,8,["onClick"])]),a("div",Te,[o(A,{value:t.item.detail,editMode:"cell",onCellEditComplete:s.onCellEditComplete,tableClass:"editable-cells-table p-datatable-small",tableStyle:"table-layout: auto;"},{empty:v(()=>[De]),default:v(()=>[(m(!0),h(B,null,K(t.columns,l=>(m(),b(E,{key:l.field,field:l.field,header:l.header,headerStyle:l.width,class:D(l.class)},{body:v(({data:u,field:d})=>[d=="satuan"?(m(),h("div",je,k(u[d]==null?u[d]:u[d].satuan),1)):(m(),h("div",xe,k(u[d]),1))]),editor:v(({data:u,field:d})=>[d=="nama_barang"?(m(),b(U,{key:0,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,suggestions:t.filteredlProduk,optionLabel:"nama_barang",virtualScrollerOptions:{itemSize:50},onComplete:s.searchProduk,onDropdownClick:s.searchAllProduk,class:"min-w-max",dropdown:""},{option:v(g=>[a("div",Pe,[a("div",Be,k(g.option.id_barang),1),a("div",Ge,[a("div",Ue,k(g.option.nama_barang),1)])])]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","onDropdownClick"])):d=="keterangan"?G((m(),b(_,{key:1,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,id:"note",class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[x]]):d=="qty"?G((m(),b(F,{key:2,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,id:"qty",minFractionDigits:1,maxFractionDigits:5,class:"min-w-max"},null,8,["modelValue","onUpdate:modelValue"])),[[x]]):d=="satuan"?(m(),b(y,{key:3,modelValue:u[d],"onUpdate:modelValue":g=>u[d]=g,id:"satuan",options:u.optionSatuan,optionLabel:"satuan",class:"min-w-max",disabled:u.optionSatuan.length==1},null,8,["modelValue","onUpdate:modelValue","options","disabled"])):p("",!0)]),_:2},1032,["field","header","headerStyle","class"]))),128))]),_:1},8,["value","onCellEditComplete"])])]),Fe,a("div",Ee,[a("div",Ae,[a("div",Ie,[o(w,{label:"Back",severity:"secondary",iconPos:"left",icon:"pi pi-arrow-left",onClick:e[13]||(e[13]=l=>this.$router.back())}),o(w,{label:"print",severity:"help",iconPos:"left",icon:"pi pi-print"})])]),a("div",Le,[a("div",qe,[p("",!0),t.item.status=="D"?(m(),b(I,{key:1,label:"Save",onClick:e[15]||(e[15]=l=>s.submitForm()),model:s.buttons(),disabled:t.isSubmit},null,8,["model","disabled"])):p("",!0)])])])])])])],64)}const Me=q(N,[["render",Je]]);export{Me as default};
