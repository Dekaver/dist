import{_ as R,s as x,F as M,r,o as m,c as _,b as s,d as o,e as n,n as S,k as V,f as L,t as h,l as b,m as B,q as z,p as H,g as G}from"./index-11eb6111.js";import{a as y}from"./api-f000d862.js";import{a as I}from"./api-e3a7587b.js";import{a as O}from"./options-b2eb7ae6.js";const K={data(){return{lSalesman:[],filteredSalesman:[],selectedSalesman:null,lDibuat:[],filteredDibuat:[],selectedDibuat:null,lCustomer:[],filteredCustomer:[],selectedCustomer:null,isSalesOrder:!1,id_salesman:null,id_customer:null,created_by:null,items:[{nomor:null,tanggal:null,id_so:null,id_customer:null,id_salesman:"",id_gudang:"",kepada:"",keterangan:"",alamat:"",status:"",telepon:"",email:"",deliverypoint:"",create_by:"",modified_by:"",create_date:"",modified_date:""}],lSalesOrder:[],salesorder:null,periode:{awal:null,akhir:null},products:null,product:{},selectedProducts:null,f:{awal:null,akhir:null,selectedStatus:{label:"All",value:""}},statuses:[{label:"All",value:""},{label:"Draft",value:"D"},{label:"Open",value:"O"},{label:"Close",value:"C"},{label:"Cancel",value:"X"}],selectedColumns:[{field:"tanggal",header:"Tanggal",class:"text-left",type:"date"},{field:"nomor",header:"Nomor",class:"text-left"},{field:"customer",header:"Pelanggan",class:"text-left"},{field:"referensi",header:"Referensi",class:"text-left"},{field:"no_quotation",header:"No. Penawaran",class:"text-left"},{field:"salesman",header:"Salesman",class:"text-left"},{field:"grandtotal",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status",class:"text-left"}],Columns:[{field:"tanggal",header:"Tanggal",class:"text-left",type:"date"},{field:"nomor",header:"Nomor",class:"text-left"},{field:"customer",header:"Pelanggan",class:"text-left"},{field:"gudang",header:"Gudang",class:"text-left"},{field:"salesman",header:"Salesman",class:"text-left"},{field:"no_quotation",header:"No. Penawaran",class:"text-left"},{field:"referensi",header:"PO No",class:"text-left"},{field:"grandtotal",header:"Total",class:"text-left",type:"currency"},{field:"created_name",header:"Dibuat Oleh",class:"text-left"},{field:"status",header:"Status",class:"text-left"}],deleteDialog:!1,filter:!1,filters:null,loading:!1,penawaranDialog:!1,lPenawaran:[],getPenawaranIncluded:!1,selectedPenawaran:[],lPersetujuan:[]}},created(){this.initFilters()},mounted(){this.getData(),this.getDataPersetujuan(),x.on("update-persetujuan-sales-order",()=>{this.getDataPersetujuan()})},beforeUnmount(){x.off("update-persetujuan-sales-order")},computed:{filteredItems:function(){return this.lSalesOrder.filter(e=>(this.f.selectedStatus.value==""?!0:this.f.selectedStatus.value==e.status)&&(this.f.awal==null?!0:this.f.awal.toLocaleDateString()<=new Date(e.tanggal).toLocaleDateString())&&(this.f.akhir==null?!0:this.f.akhir.toLocaleDateString()>=new Date(e.tanggal).toLocaleDateString())&&(this.id_customer==null?!0:this.id_customer==e.id_customer)&&(this.id_salesman==null?!0:this.id_salesman==e.id_salesman)&&(this.created_by==null?!0:this.created_by==e.created_by))},filteredPurchaseRequest:function(){return this.lPenawaran.filter(e=>this.isSalesOrder==!1?this.isSalesOrder==e.is_so:!0)}},methods:{getSalesman(){if(!this.isEdit&&this.$auth.id!=null&&this.$auth.id!=0){if(this.selectedSalesman=this.lSalesman.find(e=>e.id==this.$auth.id),this.selectedSalesman==null)return;this.item.id_salesman=this.selectedSalesman.id,this.item.salesman=this.selectedSalesman.name}},searchSalesman(e){setTimeout(()=>{e.query.trim().length?this.filteredSalesman=this.lSalesman.filter(a=>a.nama.toLowerCase().includes(e.query.toLowerCase())):this.filteredSalesman=[...this.lSalesman]},250)},searchDibuat(e){setTimeout(()=>{e.query.trim().length?this.filteredDibuat=this.lDibuat.filter(a=>a.nama.toLowerCase().includes(e.query.toLowerCase())):this.filteredDibuat=[...this.lDibuat]},250)},searchCustomer(e){setTimeout(()=>{e.query.trim().length?this.filteredCustomer=this.lCustomer.filter(a=>a.text.toLowerCase().includes(e.query.toLowerCase())):this.filteredCustomer=[...this.lCustomer]},250)},selectCustomer(e){this.id_customer=e.value.id},unselectCustomer(){this.id_customer=null},selectSalesman(e){this.id_salesman=e.value.id},unselectSalesman(){this.id_salesman=null},selectDibuat(e){this.created_by=e.value.id},unselectDibuat(){this.created_by=null},async getQuotationAll(){this.getPenawaranIncluded||await I.index({type:"option",option:{module:"sales-order",is_so:!0}}).then(e=>{this.getPenawaranIncluded=!0,this.lPenawaran=[...this.lPenawaran,...e.data.data]}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load Invoice",life:3e3})})},async showPenawaranDialog(){this.penawaranDialog=!0,this.getPenawaranIncluded=!1,this.isSalesOrder=!1,await I.index({type:"option",option:{module:"sales-order",is_so:!1}}).then(e=>{this.lPenawaran=e.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load Invoice",life:3e3})})},async CreateSalesOrder(){if(this.purchaseRequestDialog=!0,this.$isLoading.value=!0,this.isClean=!1,this.selectedPenawaran.length==0){this.$timeoutLoading();return}await y.storeWithPO(this.selectedPenawaran).then(e=>{setTimeout(()=>{this.$router.push({name:"so.edit",params:{id:e.data.data.id}}),this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3})},1e3),this.$timeoutLoading()})},getData(){this.loading=!0,O.getPegawai().then(e=>{this.lSalesman=e.data.data,this.lDibuat=e.data.data}).catch(()=>{}),O.getKontakCustomer().then(e=>{this.lCustomer=e.data.data}).catch(()=>{}),y.index().then(e=>{this.lSalesOrder=e.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load Sales Order",life:3e3})}).finally(()=>{this.loading=!1})},async getDataPersetujuan(){await y.getPersetujuan().then(e=>{this.lPersetujuan=e.data.data}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})},confirmDelete(e){this.salesorder=e,this.deleteDialog=!0},async submitDelete(){await y.destroy(this.salesorder.id).then(()=>{this.deleteDialog=!1,this.lSalesOrder=this.lSalesOrder.filter(e=>e.id!=this.salesorder.id),this.$toast.add({severity:"success",summary:"Successful",detail:"Sales Order Deleted",life:3e3})}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})},FormEdit(e){this.$router.push(`/sales-order/${e.id}/edit`)},onDblClick(e){this.$router.push(`/sales-order/${e.data.id}/edit`)},showHideFilter(){this.filter=!this.filter},exportCSV(){this.$refs.dt.exportCSV()},initFilters(){this.filters={global:{value:null,matchMode:M.CONTAINS}}}}},d=e=>(H("data-v-6039905e"),e=e(),G(),e),Q={class:"grid crud-demo"},Y={class:"col-12"},W={class:"card"},X={class:"my-2"},J=d(()=>s("h5",{class:"mbe-4"},"Filter Sales Order",-1)),Z={class:"p-fluid formgrid grid"},$={class:"field col-2"},ee={class:"p-float-label"},te=d(()=>s("p",{class:"mb-1"},"Periode Awal",-1)),le={class:"field col-2"},se={class:"p-float-label"},ae=d(()=>s("p",{class:"mb-1"},"Periode Akhir",-1)),oe={class:"field col-2"},ie={class:"p-float-label"},ne=d(()=>s("p",{class:"mb-1"},"Salesman",-1)),re={class:"field col-2"},de={class:"p-float-label"},ue=d(()=>s("p",{class:"mb-1"},"Pelanggan",-1)),ce={class:"product-autocomplete"},me={class:"kode"},he={class:"row"},fe={class:"col-12"},pe={class:"field col-2"},_e={class:"p-float-label"},ge=d(()=>s("p",{class:"mb-1"},"Dibuat Oleh",-1)),be={class:"field col-2 d-flex justifiy-content-center align-items-end mb-0"},ye=d(()=>s("label",{for:"salesquotation",class:"mb-1"},"Status",-1)),we={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Se=d(()=>s("h5",{class:"m-0"},"Pesanan Penjualan",-1)),ve={class:"flex gap-2 col-12 md:col-5"},Ce={class:"block p-input-icon-left w-full"},De=d(()=>s("i",{class:"pi pi-search"},null,-1)),Pe={key:0},ke={key:1},xe={key:2},Ve={key:3,class:"text-right"},Le={key:4},Ie={class:"flex align-items-center justify-content-center"},Oe=d(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Te={key:0},Fe={class:"p-fluid formgrid grid"},je={class:"col-12"},Ne=d(()=>s("div",null,"Empty",-1)),Ue={class:"flex md:align-items-center justify-content-between"},qe=d(()=>s("h5",{class:"m-0"},"Penawaran",-1)),Ae={class:"mt-2 md:mt-0 p-input-icon-left",style:{width:"fit-content"}},Ee=d(()=>s("i",{class:"pi pi-search"},null,-1)),Re={class:"text-right"},Me={class:"col-12 mb-3 text-left pl-0"},Be=d(()=>s("label",{for:"switch1",style:{position:"relative",bottom:"8px",left:"8px"}},"Termasuk Yang Sudah Dibuat Sales Order",-1));function ze(e,a,He,Ge,l,i){const T=r("Toast"),f=r("Button"),v=r("router-link"),F=r("MyExport"),j=r("Toolbar"),C=r("Calendar"),w=r("AutoComplete"),N=r("Dropdown"),D=r("InputText"),U=r("MultiSelect"),u=r("Column"),q=r("Tag"),A=r("ActionButton"),P=r("DataTable"),k=r("Dialog"),E=r("InputSwitch");return m(),_("div",Q,[s("div",Y,[s("div",W,[o(T),o(j,{class:"mb-4"},{start:n(()=>{var t;return[s("div",X,[o(v,{to:"/sales-order/create",class:"btn btn-added me-2"},{default:n(()=>[o(f,{label:"Tambah",icon:"pi pi-plus",class:"p-button-primary mr-2"})]),_:1}),o(f,{icon:"pi pi-filter",label:"Filter",class:S(["p-button mx-2",{"p-button-block":l.filter,"p-button-outlined":!l.filter}]),onClick:i.showHideFilter},null,8,["onClick","class"]),(t=l.lPersetujuan)!=null&&t.length?(m(),V(v,{key:0,to:"/sales-order/persetujuan",class:"btn btn-added mx-2"},{default:n(()=>[o(f,{icon:"pi pi-shield",class:"p-button p-button-outlined",label:"Persetujuan",badge:l.lPersetujuan.length,severity:"warning",badgeSeverity:"warning"},null,8,["badge"])]),_:1})):L("",!0)])]}),end:n(()=>[o(f,{label:"Penawaran",icon:"pi pi-plus",class:"p-button-primary mr-2",onClick:i.showPenawaranDialog},null,8,["onClick"]),o(F,{value:i.filteredItems,selectedColumns:l.selectedColumns,title:"Export Sales Order"},null,8,["value","selectedColumns"])]),_:1}),s("div",{class:S(["card fadein",{hidden:!l.filter}])},[J,s("div",Z,[s("div",$,[s("span",ee,[te,o(C,{dateFormat:"dd-mm-yy",modelValue:l.f.awal,"onUpdate:modelValue":a[0]||(a[0]=t=>l.f.awal=t),inputId:"periodeawal"},null,8,["modelValue"])])]),s("div",le,[s("span",se,[ae,o(C,{dateFormat:"dd-mm-yy",modelValue:l.f.akhir,"onUpdate:modelValue":a[1]||(a[1]=t=>l.f.akhir=t),inputId:"periodeakhir"},null,8,["modelValue"])])]),s("div",oe,[s("span",ie,[ne,o(w,{modelValue:l.selectedSalesman,"onUpdate:modelValue":a[2]||(a[2]=t=>l.selectedSalesman=t),optionLabel:"nama",suggestions:l.filteredSalesman,onComplete:i.searchSalesman,onClear:i.unselectSalesman,onItemSelect:i.selectSalesman,dropdown:"",forceSelection:""},null,8,["modelValue","suggestions","onComplete","onClear","onItemSelect"])])]),s("div",re,[s("span",de,[ue,o(w,{modelValue:l.selectedCustomer,"onUpdate:modelValue":a[3]||(a[3]=t=>l.selectedCustomer=t),optionLabel:"kontak",suggestions:l.filteredCustomer,onComplete:i.searchCustomer,dropdown:"",onClear:i.unselectCustomer,forceSelection:"",onItemSelect:i.selectCustomer},{option:n(t=>[s("div",ce,[s("div",me,h(t.option.inisial),1),s("div",he,[s("div",fe,h(t.option.kontak),1)])])]),_:1},8,["modelValue","suggestions","onComplete","onClear","onItemSelect"])])]),s("div",pe,[s("span",_e,[ge,o(w,{clear:"",modelValue:l.selectedDibuat,"onUpdate:modelValue":a[4]||(a[4]=t=>l.selectedDibuat=t),optionLabel:"nama",suggestions:l.filteredDibuat,onComplete:i.searchDibuat,onItemSelect:i.selectDibuat,onClear:i.unselectDibuat,dropdown:"",forceSelection:""},null,8,["modelValue","suggestions","onComplete","onItemSelect","onClear"])])]),s("div",be,[ye,o(N,{id:"salesquotation",modelValue:l.f.selectedStatus,"onUpdate:modelValue":a[5]||(a[5]=t=>l.f.selectedStatus=t),options:l.statuses,optionLabel:"label",placeholder:"All"},null,8,["modelValue","options"])])])],2),o(P,{ref:"dt",value:i.filteredItems,selection:l.selectedProducts,"onUpdate:selection":a[8]||(a[8]=t=>l.selectedProducts=t),dataKey:"id",selectionMode:"single",paginator:!0,rows:10,filters:l.filters,onRowDblclick:i.onDblClick,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Pesanan Penjualan",responsiveLayout:"scroll"},{header:n(()=>[s("div",we,[Se,s("div",ve,[s("span",Ce,[De,o(D,{modelValue:l.filters.global.value,"onUpdate:modelValue":a[6]||(a[6]=t=>l.filters.global.value=t),placeholder:"Search...",class:"w-full"},null,8,["modelValue"])]),o(U,{modelValue:l.selectedColumns,"onUpdate:modelValue":a[7]||(a[7]=t=>l.selectedColumns=t),options:l.Columns,optionLabel:"header",placeholder:"Select Column",class:"w-3rem"},null,8,["modelValue","options"])])])]),default:n(()=>[o(u,{header:"#",headerStyle:"width:10px;"},{body:n(({index:t})=>[b(h(t+1),1)]),_:1}),(m(!0),_(B,null,z(l.selectedColumns,(t,g)=>(m(),V(u,{field:t.field,header:t.header,class:S(t.class),key:t.field+"_"+g,sortable:!0},{body:n(({data:p,field:c})=>[c=="icon"?(m(),_("div",Pe,[o(f,{icon:p[c],class:"p-button-rounded p-button-outlined p-button-icon"},null,8,["icon"])])):c=="status"?(m(),_("div",ke,[o(q,{value:e.$h.getLabel(p[c]),severity:e.$h.getLabel(p[c])},null,8,["value","severity"])])):c=="tanggal"?(m(),_("div",xe,h(e.$h.formatDate(p[c])),1)):c=="grandtotal"?(m(),_("div",Ve,h(e.$h.formatNumber(p[c])),1)):(m(),_("div",Le,h(p[c]),1))]),_:2},1032,["field","header","class"]))),128)),o(u,{header:"Aksi",headerStyle:"width:6%; max-width:1rem;"},{body:n(({data:t,index:g})=>[o(A,{data:t,index:g,onEdit:p=>i.FormEdit(t),onDelete:p=>i.confirmDelete(t),onPrint:e.Cetak,showDelete:t.status!="C",showPrint:!1},null,8,["data","index","onEdit","onDelete","onPrint","showDelete"])]),_:1})]),_:1},8,["value","selection","filters","onRowDblclick"])]),o(k,{visible:l.deleteDialog,"onUpdate:visible":a[10]||(a[10]=t=>l.deleteDialog=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[o(f,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[9]||(a[9]=t=>l.deleteDialog=!1)}),o(f,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:i.submitDelete},null,8,["onClick"])]),default:n(()=>[s("div",Ie,[Oe,l.salesorder?(m(),_("span",Te,[b("Are you sure you want to delete "),s("b",null,h(l.salesorder.nomor),1),b("?")])):L("",!0)])]),_:1},8,["visible"]),o(k,{visible:l.penawaranDialog,"onUpdate:visible":a[15]||(a[15]=t=>l.penawaranDialog=t),style:{width:"70%"},header:"Pilih Penawaran",modal:!0,maximizable:!0},{footer:n(()=>[s("div",Me,[o(E,{modelValue:l.isSalesOrder,"onUpdate:modelValue":a[13]||(a[13]=t=>l.isSalesOrder=t),"input-id":"switch1",onChange:i.getQuotationAll},null,8,["modelValue","onChange"]),Be]),o(f,{label:"PILIH",icon:"pi pi-check",class:"p-button-outlined",onClick:a[14]||(a[14]=t=>i.CreateSalesOrder()),loading:e.$isLoading.value},null,8,["loading"])]),default:n(()=>[s("div",Fe,[s("div",je,[o(P,{value:i.filteredPurchaseRequest,filters:l.filters,style:{"margin-top":"20px"},selection:l.selectedPenawaran,"onUpdate:selection":a[12]||(a[12]=t=>l.selectedPenawaran=t),rows:10,responsiveLayout:"scroll"},{empty:n(()=>[Ne]),header:n(()=>[s("div",Ue,[qe,s("span",Ae,[Ee,o(D,{modelValue:l.filters.global.value,"onUpdate:modelValue":a[11]||(a[11]=t=>l.filters.global.value=t),placeholder:"Search..."},null,8,["modelValue"])])])]),default:n(()=>[o(u,{selectionMode:"single",headerStyle:"width: 3rem"}),o(u,{field:"tanggal",header:"Tanggal"},{body:n(({data:t,field:g})=>[b(h(e.$h.formatDate(t[g])),1)]),_:1}),o(u,{field:"nomor",header:"Nomor"}),o(u,{field:"customer",header:"Customer"}),o(u,{field:"gudang",header:"Gudang"}),o(u,{field:"pegawai",header:"Dibuat oleh"}),o(u,{field:"grandtotal",header:"Total"},{body:n(({data:t,field:g})=>[s("div",Re,h(e.$h.formatNumber(t[g])),1)]),_:1})]),_:1},8,["value","filters","selection"])])])]),_:1},8,["visible"])])])}const Xe=R(K,[["render",ze],["__scopeId","data-v-6039905e"]]);export{Xe as default};
