import{_ as O,s as C,F as U,r as i,o as u,c,b as a,d as o,e as d,n as g,k as S,f as P,l as y,t as b,m as B,q as E,p as M,g as K}from"./index-11eb6111.js";import{a as D}from"./api-c6c36a80.js";import{a as z}from"./options-b2eb7ae6.js";const H={data(){return{lDibuat:[],filteredDibuat:[],selectedDibuat:null,created_by:null,lItem:[],selectedItem:null,item:null,lPersetujuan:[],deleteDialog:!1,selectedColumns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"tgl_dibutuhkan",header:"Tanggal Dibutuhkan",type:"date"},{field:"keterangan",header:"Keterangan"},{field:"pegawai",header:"Dibuat Oleh"},{field:"total",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status"}],Columns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"tgl_dibutuhkan",header:"Tanggal Dibutuhkan",type:"date"},{field:"keterangan",header:"Keterangan"},{field:"pegawai",header:"Dibuat Oleh"},{field:"total",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status"}],filter:!1,filters:{},f:{awal:null,akhir:null,selectedStatus:{label:"All",value:""}},statuses:[{label:"All",value:""},{label:"Draft",value:"D"},{label:"Open",value:"O"},{label:"Close",value:"C"},{label:"Waiting",value:"S"},{label:"Reject",value:"R"}]}},created(){this.initFilters()},mounted(){this.getData(),this.getDataPersetujuan(),C.on("update-persetujuan-purchase-request",()=>{this.getDataPersetujuan()})},beforeUnmount(){C.off("update-persetujuan-purchase-request")},computed:{filteredItems(){return this.lItem.filter(e=>(this.f.selectedStatus.value==""?!0:this.f.selectedStatus.value==e.status)&&(this.f.awal==null?!0:this.f.awal.toLocaleDateString()<=new Date(e.tanggal).toLocaleDateString())&&(this.f.akhir==null?!0:this.f.akhir.toLocaleDateString()>=new Date(e.tanggal).toLocaleDateString())&&(this.created_by==null?!0:this.created_by==e.created_by))}},methods:{searchDibuat(e){setTimeout(()=>{this.filteredDibuat=e.query.trim().length?this.lDibuat.filter(s=>s.nama.toLowerCase().includes(e.query.toLowerCase())):[...this.lDibuat]},250)},selectDibuat(e){this.created_by=e.value.id},unselectDibuat(){this.created_by=null},async getData(){await z.getPegawai().then(e=>{this.lDibuat=e.data.data}).catch(()=>{}),await D.index().then(e=>{this.lItem=e.data.data}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})},async getDataPersetujuan(){await D.getPersetujuan().then(e=>{this.lPersetujuan=e.data.data}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})},async Destroy(e){await D.destroy(e.id).then(s=>{this.$toast.add({severity:"success",summary:"Success",detail:s.data.message,life:3e3}),this.lItem=this.lItem.filter(v=>v.id!==e.id)}).catch(s=>{this.$toast.add({severity:"error",summary:"Failed",detail:s.response.data.message,life:3e3})}).finally(()=>{this.deleteDialog=!1,this.item=null})},showHideFilter(){this.filter=!this.filter},exportCSV(){this.$refs.dt.exportCSV()},initFilters(){this.filters={global:{value:null,matchMode:U.CONTAINS}}},onRowDblclick(e){this.$router.push({name:"pr.edit",params:{id:e.data.id}})},FormEdit(e){this.$router.push({name:"pr.edit",params:{id:e.id}})},Cetak(e){this.$router.push({name:"pr.cetak",params:{id:e.id}})},confirmDelete(e){this.deleteDialog=!0,this.item={...e}}}},h=e=>(M("data-v-17e78841"),e=e(),K(),e),W={class:"grid crud-demo"},Y={class:"col-12"},G={class:"card"},J={class:"my-2"},Q=h(()=>a("h5",{class:"mbe-4"},"Pencarian Purchase Request",-1)),X={class:"p-fluid formgrid grid"},Z={class:"field col-2"},$={class:"p-float-label"},ee=h(()=>a("p",{class:"mb-1"},"Periode Awal",-1)),te={class:"field col-2"},le={class:"p-float-label"},se=h(()=>a("p",{class:"mb-1"},"Periode Akhir",-1)),ae={class:"field col-2"},oe={class:"p-float-label"},ie=h(()=>a("p",{class:"mb-1"},"Dibuat Oleh",-1)),ne={class:"field col-2 d-flex justifiy-content-center align-items-end mb-0"},re=h(()=>a("label",{for:"status",class:"mb-1"},"Status",-1)),ue={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},de=h(()=>a("h5",{class:"m-0"},"Purchase Request",-1)),ce={class:"flex gap-2 col-12 md:col-5"},me={class:"block p-input-icon-left w-full"},he=h(()=>a("i",{class:"pi pi-search"},null,-1)),pe={key:0},be={key:1},fe={key:2},_e={key:3},ge={key:4,class:"text-right"},ye={key:5},De={class:"flex align-items-center justify-content-center"},ve=h(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),we={key:0};function ke(e,s,v,Ce,l,r){const x=i("Toast"),p=i("Button"),w=i("router-link"),T=i("MyExport"),V=i("Toolbar"),k=i("Calendar"),I=i("AutoComplete"),L=i("Dropdown"),j=i("InputText"),F=i("MultiSelect"),f=i("Column"),R=i("Tag"),q=i("ActionButton"),A=i("DataTable"),N=i("Dialog");return u(),c("div",W,[a("div",Y,[a("div",G,[o(x),o(V,{class:"mb-4"},{start:d(()=>{var t;return[a("div",J,[o(w,{to:"request/create",class:"btn btn-added me-2"},{default:d(()=>[o(p,{label:"Tambah",icon:"pi pi-plus",class:"p-button-primary mr-2"})]),_:1}),o(p,{icon:"pi pi-filter",class:g(["p-button mx-2",{"p-button-block":e.showTableSatuan,"p-button-outlined":!e.showTableSatuan}]),label:"Filter",onClick:r.showHideFilter},null,8,["onClick","class"]),(t=l.lPersetujuan)!=null&&t.length?(u(),S(w,{key:0,to:"/purchase/request/persetujuan",class:"btn btn-added mx-2"},{default:d(()=>[o(p,{icon:"pi pi-shield",class:"p-button p-button-outlined",label:"Persetujuan",badge:l.lPersetujuan.length,severity:"warning",badgeSeverity:"warning"},null,8,["badge"])]),_:1})):P("",!0)])]}),end:d(()=>[o(T,{value:r.filteredItems,selectedColumns:l.selectedColumns,title:"Export Purchase Request"},null,8,["value","selectedColumns"])]),_:1}),a("div",{class:g(["px-3 py-4 mb-4 fadein",{hidden:!l.filter}])},[Q,a("div",X,[a("div",Z,[a("span",$,[ee,o(k,{dateFormat:"dd-mm-yy",modelValue:l.f.awal,"onUpdate:modelValue":s[0]||(s[0]=t=>l.f.awal=t),inputId:"f.awal"},null,8,["modelValue"])])]),a("div",te,[a("span",le,[se,o(k,{dateFormat:"dd-mm-yy",modelValue:l.f.akhir,"onUpdate:modelValue":s[1]||(s[1]=t=>l.f.akhir=t),inputId:"f.akhir"},null,8,["modelValue"])])]),a("div",ae,[a("span",oe,[ie,o(I,{clear:"",modelValue:l.selectedDibuat,"onUpdate:modelValue":s[2]||(s[2]=t=>l.selectedDibuat=t),optionLabel:"nama",suggestions:l.filteredDibuat,onComplete:r.searchDibuat,onItemSelect:r.selectDibuat,onClear:r.unselectDibuat,dropdown:"",forceSelection:""},null,8,["modelValue","suggestions","onComplete","onItemSelect","onClear"])])]),a("div",ne,[re,o(L,{id:"status",modelValue:l.f.selectedStatus,"onUpdate:modelValue":s[3]||(s[3]=t=>l.f.selectedStatus=t),options:l.statuses,optionLabel:"label",placeholder:"Status"},null,8,["modelValue","options"])])])],2),o(A,{style:{"margin-top":"20px"},ref:"dt",selection:l.selectedItem,"onUpdate:selection":s[6]||(s[6]=t=>l.selectedItem=t),value:r.filteredItems,dataKey:"id",selectionMode:"single",paginator:!0,rows:10,onRowDblclick:r.onRowDblclick,filters:l.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Purchase Request",responsiveLayout:"scroll"},{header:d(()=>[a("div",ue,[de,a("div",ce,[a("span",me,[he,o(j,{modelValue:l.filters.global.value,"onUpdate:modelValue":s[4]||(s[4]=t=>l.filters.global.value=t),placeholder:"Search...",class:"w-full"},null,8,["modelValue"])]),o(F,{modelValue:l.selectedColumns,"onUpdate:modelValue":s[5]||(s[5]=t=>l.selectedColumns=t),options:l.Columns,optionLabel:"header",placeholder:"Select Column",class:"w-3rem"},null,8,["modelValue","options"])])])]),default:d(()=>[o(f,{header:"#",headerStyle:"width:10px"},{body:d(t=>[y(b(t.index+1),1)]),_:1}),(u(!0),c(B,null,E(l.selectedColumns,(t,_)=>(u(),S(f,{field:t.field,header:t.header,class:g(t.class),key:t.field+"_"+_,sortable:!0},{body:d(({data:m,field:n})=>[n=="icon"?(u(),c("div",pe,[o(p,{icon:m[n],class:"p-button-rounded p-button-outlined p-button-icon"},null,8,["icon"])])):n=="status"?(u(),c("div",be,[o(R,{value:e.$h.getLabel(m[n]),severity:e.$h.getLabel(m[n])},null,8,["value","severity"])])):n=="tanggal"?(u(),c("div",fe,b(e.$h.formatDate(m[n])),1)):n=="tgl_dibutuhkan"?(u(),c("div",_e,b(e.$h.formatDate(m[n])),1)):n=="total"?(u(),c("div",ge,b(e.$h.formatNumber(m[n])),1)):(u(),c("div",ye,b(m[n]),1))]),_:2},1032,["field","header","class"]))),128)),o(f,{header:"Aksi",headerStyle:"width:6%; max-width:1rem;"},{body:d(({data:t,index:_})=>[o(q,{data:t,index:_,onEdit:r.FormEdit,onPrint:r.Cetak,onDelete:m=>r.confirmDelete(t),showDelete:t.status=="D"||t.status=="O",showPrint:t.status=="O"},null,8,["data","index","onEdit","onPrint","onDelete","showDelete","showPrint"])]),_:1})]),_:1},8,["selection","value","onRowDblclick","filters"]),o(N,{visible:l.deleteDialog,"onUpdate:visible":s[9]||(s[9]=t=>l.deleteDialog=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[o(p,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[7]||(s[7]=t=>l.deleteDialog=!1)}),o(p,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:s[8]||(s[8]=t=>r.Destroy(l.item))})]),default:d(()=>[a("div",De,[ve,l.item?(u(),c("span",we,[y("Are you sure you want to delete "),a("b",null,b(l.item.nomor),1),y("?")])):P("",!0)])]),_:1},8,["visible"])])])])}const Te=O(H,[["render",ke],["__scopeId","data-v-17e78841"]]);export{Te as default};
