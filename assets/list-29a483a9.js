import{a as g}from"./api-e3a7587b.js";import{a as w}from"./options-b2eb7ae6.js";import{_ as N,s as k,F as U,r as n,o as d,c as m,b as s,d as o,e as r,n as y,k as P,f as C,t as h,l as D,m as E,q as M}from"./index-11eb6111.js";const B={data(){return{lSalesman:[],filteredSalesman:[],selectedSalesman:null,lDibuat:[],filteredDibuat:[],selectedDibuat:null,lCustomer:[],filteredCustomer:[],selectedCustomer:null,lQuotation:[],selectedQuotation:null,quotation:null,deleteDialog:!1,filters:null,filter:!1,id_salesman:null,id_customer:null,created_by:null,selectedColumns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"customer",header:"Pelanggan"},{field:"keterangan",header:"Keterangan"},{field:"kepada",header:"Salesman"},{field:"created_name",header:"Dibuat Oleh"},{field:"grandtotal",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status"}],Columns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"customer",header:"Pelanggan"},{field:"keterangan",header:"Keterangan"},{field:"kepada",header:"Marketing"},{field:"created_name",header:"Dibuat Oleh"},{field:"grandtotal",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status"}],f:{awal:null,akhir:null,selectedStatus:{label:"All",value:""}},statuses:[{label:"All",value:""},{label:"Draft",value:"D"},{label:"Open",value:"O"},{label:"Close",value:"C"},{label:"Cancel",value:"X"}],lPersetujuan:[]}},created(){this.initFilters()},mounted(){this.getData(),this.getDataPersetujuan(),k.on("update-persetujuan-quotation",()=>{this.getDataPersetujuan()})},beforeUnmount(){k.off("unmount-persetujuan-quotation")},computed:{filteredItems:function(){return this.lQuotation.filter(e=>(this.f.selectedStatus.value==""?!0:this.f.selectedStatus.value==e.status)&&(this.f.awal==null?!0:this.f.awal.toLocaleDateString()<=new Date(e.tanggal).toLocaleDateString())&&(this.f.akhir==null?!0:this.f.akhir.toLocaleDateString()>=new Date(e.tanggal).toLocaleDateString())&&(this.id_customer==null?!0:this.id_customer==e.id_customer)&&(this.id_salesman==null?!0:this.id_salesman==e.id_salesman)&&(this.created_by==null?!0:this.created_by==e.created_by))}},methods:{getSalesman(){if(!this.isEdit&&this.$auth.id!=null&&this.$auth.id!=0){if(this.selectedSalesman=this.lSalesman.find(e=>e.id==this.$auth.id),this.selectedSalesman==null)return;this.item.id_salesman=this.selectedSalesman.id,this.item.salesman=this.selectedSalesman.name}},searchSalesman(e){setTimeout(()=>{e.query.trim().length?this.filteredSalesman=this.lSalesman.filter(a=>a.nama.toLowerCase().includes(e.query.toLowerCase())):this.filteredSalesman=[...this.lSalesman]},250)},searchDibuat(e){setTimeout(()=>{e.query.trim().length?this.filteredDibuat=this.lDibuat.filter(a=>a.nama.toLowerCase().includes(e.query.toLowerCase())):this.filteredDibuat=[...this.lDibuat]},250)},searchCustomer(e){setTimeout(()=>{e.query.trim().length?this.filteredCustomer=this.lCustomer.filter(a=>a.text.toLowerCase().includes(e.query.toLowerCase())):this.filteredCustomer=[...this.lCustomer]},250)},selectCustomer(e){this.id_customer=e.value.id},unselectCustomer(){this.id_customer=null},selectSalesman(e){this.id_salesman=e.value.id},unselectSalesman(){this.id_salesman=null},selectDibuat(e){this.created_by=e.value.id},unselectDibuat(){this.created_by=null},async getData(){await g.index().then(e=>{this.lQuotation=e.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load Quotation",life:3e3})}),await w.getPegawai().then(e=>{this.lSalesman=e.data.data,this.lDibuat=e.data.data}).catch(()=>{}),await w.getKontakCustomer().then(e=>{this.lCustomer=e.data.data}).catch(()=>{})},async getDataPersetujuan(){await g.getPersetujuan().then(e=>{this.lPersetujuan=e.data.data}).catch(e=>{this.$toast.add({severity:"error",summary:"Failed",detail:e.response.data.message,life:3e3})})},lMenu(e){return[{label:"Add",icon:"pi pi-pencil",command:()=>{this.$toast.add({severity:"info",summary:"Add",detail:e})}},{label:"Delete",icon:"pi pi-trash",command:()=>{this.$toast.add({severity:"error",summary:"Delete",detail:"Data Deleted"})}}]},Cetak(e){this.$router.push(`/quotation/${e.id}/Cetak`)},FormEdit(e){this.$router.push(`/quotation/${e.id}/edit`)},ondblclick(e){this.$router.push(`/quotation/${e.data.id}/edit`)},confirmDelete(e){this.quotation=e,this.deleteDialog=!0},Destroy(){let e=!0;g.delete(this.quotation.id).then(()=>{this.$toast.add({severity:"success",summary:"Successful",detail:"Quotation Deleted",life:3e3})}).catch(()=>{e=!1,this.$toast.add({severity:"error",summary:"Failed",detail:"Delete Quotation",life:3e3})}).finally(()=>{e&&(this.lQuotation=this.lQuotation.filter(a=>a.id!=this.quotation.id)),this.deleteDialog=!1})},exportCSV(){this.$refs.dt.exportCSV()},confirmDeleteSelected(){this.deleteQuotationDialog=!0},deleteSelectedQuotation(){this.quotations=this.quotations.filter(e=>!this.selectedQuotation.includes(e)),this.deleteDialog=!1,this.selectedQuotation=null,this.$toast.add({severity:"success",summary:"Successful",detail:"Quotation Deleted",life:3e3})},initFilters(){this.filters={global:{value:null,matchMode:U.CONTAINS}}},showHideFilter(){this.filter=!this.filter}}},O={class:"grid crud-demo"},R={class:"col-12"},K={class:"card"},z={class:"my-2"},H=s("h5",{class:"mbe-4"},"Filter Penawaran",-1),X={class:"p-fluid formgrid grid"},Y={class:"field col-2"},G={class:"p-float-label"},J=s("p",{class:"mb-1"},"Periode Awal",-1),W={class:"field col-2"},Z={class:"p-float-label"},$=s("p",{class:"mb-1"},"Periode Akhir",-1),ee={class:"field col-2"},te={class:"p-float-label"},le=s("p",{class:"mb-1"},"Salesman",-1),se={class:"field col-2"},ae={class:"p-float-label"},oe=s("p",{class:"mb-1"},"Pelanggan",-1),ie={class:"product-autocomplete"},ne={class:"kode"},re={class:"row"},de={class:"col-12"},ue={class:"field col-2"},ce={class:"p-float-label"},me=s("p",{class:"mb-1"},"Dibuat Oleh",-1),he={class:"field col-2 d-flex justifiy-content-center align-items-end mb-0"},pe=s("label",{for:"salesquotation",class:"mb-1"},"Status",-1),fe=s("div",null,"Empty",-1),_e={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},be=s("h5",{class:"m-0"},"Penawaran",-1),ge={class:"flex gap-2 col-12 md:col-5"},ye={class:"block p-input-icon-left w-full"},Ce=s("i",{class:"pi pi-search"},null,-1),De={key:0},ve={key:1},Se={key:2},we={key:3,class:"text-right"},ke={key:4},Pe={class:"flex align-items-center justify-content-center"},xe=s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Ve={key:0};function Le(e,a,qe,Te,l,i){const x=n("Toast"),p=n("Button"),v=n("router-link"),V=n("MyExport"),L=n("Toolbar"),S=n("Calendar"),f=n("AutoComplete"),q=n("Dropdown"),T=n("InputText"),F=n("MultiSelect"),_=n("Column"),Q=n("Tag"),j=n("ActionButton"),A=n("DataTable"),I=n("Dialog");return d(),m("div",O,[s("div",R,[s("div",K,[o(x),o(L,{class:"mb-4"},{start:r(()=>{var t;return[s("div",z,[o(v,{to:"/quotation/create",class:"btn btn-added me-2"},{default:r(()=>[o(p,{label:"Tambah",icon:"pi pi-plus",class:"p-button-primary mr-2"})]),_:1}),o(p,{icon:"pi pi-filter",class:y(["p-button mx-2",{"p-button-block":l.filter,"p-button-outlined":!l.filter}]),label:"Filter",onClick:i.showHideFilter},null,8,["onClick","class"]),(t=l.lPersetujuan)!=null&&t.length?(d(),P(v,{key:0,to:"/quotation/persetujuan",class:"btn btn-added mx-2"},{default:r(()=>[o(p,{icon:"pi pi-shield",class:"p-button p-button-outlined",label:"Persetujuan",badge:l.lPersetujuan.length,severity:"warning",badgeSeverity:"warning"},null,8,["badge"])]),_:1})):C("",!0)])]}),end:r(()=>[o(V,{value:i.filteredItems,selectedColumns:l.selectedColumns,title:"Export Quotation"},null,8,["value","selectedColumns"])]),_:1}),s("div",{class:y(["card fadein",{hidden:!l.filter}])},[H,s("div",X,[s("div",Y,[s("span",G,[J,o(S,{dateFormat:"dd-mm-yy",modelValue:l.f.awal,"onUpdate:modelValue":a[0]||(a[0]=t=>l.f.awal=t),inputId:"periodeawal"},null,8,["modelValue"])])]),s("div",W,[s("span",Z,[$,o(S,{dateFormat:"dd-mm-yy",modelValue:l.f.akhir,"onUpdate:modelValue":a[1]||(a[1]=t=>l.f.akhir=t),inputId:"periodeakhir"},null,8,["modelValue"])])]),s("div",ee,[s("span",te,[le,o(f,{modelValue:l.selectedSalesman,"onUpdate:modelValue":a[2]||(a[2]=t=>l.selectedSalesman=t),optionLabel:"nama",suggestions:l.filteredSalesman,onComplete:i.searchSalesman,onClear:i.unselectSalesman,onItemSelect:i.selectSalesman,dropdown:"",forceSelection:""},null,8,["modelValue","suggestions","onComplete","onClear","onItemSelect"])])]),s("div",se,[s("span",ae,[oe,o(f,{modelValue:l.selectedCustomer,"onUpdate:modelValue":a[3]||(a[3]=t=>l.selectedCustomer=t),optionLabel:"kontak",suggestions:l.filteredCustomer,onComplete:i.searchCustomer,dropdown:"",onClear:i.unselectCustomer,forceSelection:"",onItemSelect:i.selectCustomer},{option:r(t=>[s("div",ie,[s("div",ne,h(t.option.inisial),1),s("div",re,[s("div",de,h(t.option.kontak),1)])])]),_:1},8,["modelValue","suggestions","onComplete","onClear","onItemSelect"])])]),s("div",ue,[s("span",ce,[me,o(f,{clear:"",modelValue:l.selectedDibuat,"onUpdate:modelValue":a[4]||(a[4]=t=>l.selectedDibuat=t),optionLabel:"nama",suggestions:l.filteredDibuat,onComplete:i.searchDibuat,onItemSelect:i.selectDibuat,onClear:i.unselectDibuat,dropdown:"",forceSelection:""},null,8,["modelValue","suggestions","onComplete","onItemSelect","onClear"])])]),s("div",he,[pe,o(q,{id:"salesquotation",modelValue:l.f.selectedStatus,"onUpdate:modelValue":a[5]||(a[5]=t=>l.f.selectedStatus=t),options:l.statuses,optionLabel:"label",placeholder:"All"},null,8,["modelValue","options"])])])],2),o(A,{ref:"dt",value:i.filteredItems,selection:l.selectedQuotation,"onUpdate:selection":a[8]||(a[8]=t=>l.selectedQuotation=t),dataKey:"id",selectionMode:"single",paginator:!0,rows:10,onRowDblclick:i.ondblclick,filters:l.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Penawaran",responsiveLayout:"scroll"},{empty:r(()=>[fe]),header:r(()=>[s("div",_e,[be,s("div",ge,[s("span",ye,[Ce,o(T,{modelValue:l.filters.global.value,"onUpdate:modelValue":a[6]||(a[6]=t=>l.filters.global.value=t),placeholder:"Search...",class:"w-full"},null,8,["modelValue"])]),o(F,{modelValue:l.selectedColumns,"onUpdate:modelValue":a[7]||(a[7]=t=>l.selectedColumns=t),options:l.Columns,optionLabel:"header",placeholder:"Select Column",class:"w-3rem"},null,8,["modelValue","options"])])])]),default:r(()=>[o(_,{header:"#",headerStyle:"width:10px"},{body:r(t=>[D(h(t.index+1),1)]),_:1}),(d(!0),m(E,null,M(l.selectedColumns,(t,b)=>(d(),P(_,{field:t.field,header:t.header,class:y(t.class),key:t.field+"_"+b,sortable:!0},{body:r(({data:u,field:c})=>[c=="icon"?(d(),m("div",De,[o(p,{icon:u[c],class:"p-button-rounded p-button-outlined p-button-icon"},null,8,["icon"])])):C("",!0),c=="status"?(d(),m("div",ve,[o(Q,{value:e.$h.getLabel(u[c]),severity:e.$h.getLabel(u[c])},null,8,["value","severity"])])):t.type=="date"?(d(),m("div",Se,h(e.$h.formatDate(u[c])),1)):t.type=="currency"?(d(),m("div",we,h(e.$h.formatNumber(u[c])),1)):(d(),m("div",ke,h(u[c]),1))]),_:2},1032,["field","header","class"]))),128)),o(_,{header:"Aksi",headerStyle:"width:6%; max-width:1rem;"},{body:r(({data:t,index:b})=>[o(j,{data:t,index:b,onEdit:u=>i.FormEdit(t),onDelete:u=>i.confirmDelete(t),onPrint:u=>i.Cetak(t),showDelete:t.status!="C",showPrint:t.status!="D"},null,8,["data","index","onEdit","onDelete","onPrint","showDelete","showPrint"])]),_:1})]),_:1},8,["value","selection","onRowDblclick","filters"])]),o(I,{visible:l.deleteDialog,"onUpdate:visible":a[11]||(a[11]=t=>l.deleteDialog=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:r(()=>[o(p,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[9]||(a[9]=t=>l.deleteDialog=!1)}),o(p,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:a[10]||(a[10]=t=>i.Destroy())})]),default:r(()=>[s("div",Pe,[xe,l.quotation?(d(),m("span",Ve,[D("Are you sure you want to delete "),s("b",null,h(l.quotation.nomor),1),D("?")])):C("",!0)])]),_:1},8,["visible"])])])}const Ae=N(B,[["render",Le]]);export{Ae as default};
