import{_ as A,j as E,s as L,F as M,r as d,o as c,c as _,b as i,d as l,e as n,n as k,k as S,f as C,l as g,t as f,m as I,q}from"./index-11eb6111.js";import{a as v}from"./api-a685b482.js";import{a as G}from"./options-b2eb7ae6.js";import{a as z}from"./api-917068af.js";import{a as H}from"./api-f000d862.js";const W={data(){return{gudangStore:E(),lSalesman:[],filteredSalesman:[],selectedSalesman:null,lDibuat:[],filteredDibuat:[],selectedDibuat:null,id_customer:null,selectedItem:null,salesOrderDialog:!1,isClean:!0,selectedDeliveryReceipt:null,item:null,Invoice:[],f:{selectedStatus:{label:"All",value:""},id_customer:null,id_salesman:null,created_by:null,awal:null,akhir:null},selectedStatus:{label:"All",value:""},statuses:[{label:"All",value:""},{label:"Draft",value:"D"},{label:"Approve",value:"A"}],selectedColumns:[{field:"tanggal",header:"Tanggal",class:"text-left",type:"date"},{field:"nomor",header:"Nomor",class:"text-left"},{field:"customer",header:"Pelanggan",class:"text-left"},{field:"referensi",header:"Referensi",class:"text-left"},{field:"created_name",header:"Salesman",class:"text-left"},{field:"gudang",header:"Gudang",class:"text-left"},{field:"status",header:"Status",class:"text-left"}],Columns:[{field:"tanggal",header:"Tanggal",class:"text-left",type:"date"},{field:"nomor",header:"Nomor",class:"text-left"},{field:"customer",header:"Pelanggan",class:"text-left"},{field:"created_name",header:"Salesman",class:"text-left"},{field:"gudang",header:"Gudang",class:"text-left"},{field:"referensi",header:"Telepon",class:"text-left"},{field:"grandtotal",header:"Grandtotal",class:"text-left",type:"currency"},{field:"status",header:"Status",class:"text-left"}],expandedRows:[],lPersetujuan:[],filter:!1,deleteDialog:!1,filters:{},lSalesOrder:[],selectedSalesOrder:[],lPengirimanBarang:[],selectedPengirimanBarang:[],pengirimanBarangDialog:!1}},productService:null,created(){this.initFilters()},computed:{filteredItems(){return this.Invoice.filter(t=>(this.f.selectedStatus.value==""?!0:this.f.selectedStatus.value==t.status)&&(this.f.id_customer==null?!0:this.f.id_customer.id==t.id_kontak)&&(this.f.awal==null?!0:this.f.awal.toLocaleDateString()<=new Date(t.tanggal).toLocaleDateString())&&(this.f.akhir==null?!0:this.f.akhir.toLocaleDateString()>=new Date(t.tanggal).toLocaleDateString())&&(this.f.id_salesman==null?!0:this.f.id_salesman==t.id_salesman)&&(this.f.created_by==null?!0:this.f.created_by==t.created_by))},filteredPengirimanBarang(){return this.id_customer==null?this.lPengirimanBarang:this.lPengirimanBarang.filter(t=>t.id_customer==this.id_customer)}},mounted(){this.getData(),this.getDataPersetujuan(),L.on("update-persetujuan-invoice",()=>{this.getDataPersetujuan()})},beforeUnmount(){L.off("update-persetujuan-invoice")},methods:{searchSalesman(t){setTimeout(()=>{this.filteredSalesman=t.query.trim().length?this.lSalesman.filter(s=>s.nama.toLowerCase().includes(t.query.toLowerCase())):[...this.lSalesman]},250)},searchDibuat(t){setTimeout(()=>{this.filteredDibuat=t.query.trim().length?this.lDibuat.filter(s=>s.nama.toLowerCase().includes(t.query.toLowerCase())):[...this.lDibuat]},250)},selectSalesman(t){this.f.id_salesman=t.value.id},unselectSalesman(){this.f.id_salesman=null},selectDibuat(t){this.created_by=t.value.id},unselectDibuat(){this.created_by=null},async showSalesOrderDialog(){this.salesOrderDialog=!0,await H.index({type:"option",module:"invoice"}).then(t=>{this.lSalesOrder=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load Invoice",life:3e3})})},async CreatePurchaseOrder(){if(this.$isLoading.value=!0,this.purchaseRequestDialog=!0,this.isClean=!1,this.selectedSalesOrder.length==0){this.$timeoutLoading();return}await v.storeWithSO(this.selectedSalesOrder).then(t=>{setTimeout(()=>{this.$router.push({name:"invoice.edit",params:{id:t.data.data.id}}),this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3})},1e3)}).finally(()=>{this.$timeoutLoading()})},async getData(){await v.index().then(t=>{this.Invoice=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load Invoice",life:3e3})}),await G.getPegawai().then(t=>{this.lSalesman=t.data.data,this.lDibuat=t.data.data}).catch(()=>{})},async getDataPersetujuan(){await v.getPersetujuan().then(t=>{this.lPersetujuan=t.data.data}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})})},confirmDelete(t){this.item={...t},this.deleteDialog=!0},async submitDelete(){await v.destroy(this.item.id).then(()=>{this.Invoice=this.Invoice.filter(t=>t.id!=this.item.id),this.$toast.add({severity:"success",summary:"Successful",detail:"Invoice Deleted",life:3e3})}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})}).finally(()=>{this.deleteDialog=!1})},ondblclick(t){this.$router.push(`/invoice/${t.data.id}/edit`)},FormEdit(t){this.$router.push(`/invoice/${t.id}/edit`)},Cetak(t){this.$router.push(`/invoice/${t.id}/cetak`)},cetakJurnal(t){this.$router.push({name:"invoice.jurnal",params:{id:t.id}})},async showPengirimanBarangDialog(){this.pengirimanBarangDialog=!0,this.id_customer=null,await z.index({type:"option",module:"invoice"}).then(t=>{this.lPengirimanBarang=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load Delivery Order",life:3e3})})},rowSelectPengirimanBarang(t){this.selectedPengirimanBarang.some(s=>s.id_so!=t.data.id_so)&&(this.$toast.add({severity:"error",summary:"Failed",detail:"SO Berbeda ",life:3e3}),this.selectedPengirimanBarang=this.selectedPengirimanBarang.filter(s=>s.id_so!=t.data.id_so))},async CreateInvoiceWithPengirimanBarang(){if(console.log("create"),this.$isLoading.value=!0,this.selectedPengirimanBarang.length==0){this.$timeoutLoading();return}await v.storeWithPengirimanBarang({list_pengiriman_barang:this.selectedPengirimanBarang}).then(t=>{setTimeout(()=>{this.$router.push({name:"invoice.edit",params:{id:t.data.data.id}}),this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3})},1e3)}).finally(()=>{this.$timeoutLoading()})},showHideFilter(){this.filter=!this.filter},exportCSV(){this.$refs.dt.exportCSV()},initFilters(){this.filters={global:{value:null,matchMode:M.CONTAINS}}}}},K={class:"card"},J={class:"my-2"},Y=i("h5",{class:"mbe-4"},"Pencarian Invoice",-1),Q={class:"p-fluid formgrid grid"},X={class:"field col-2"},Z={class:"field col-2"},$={class:"field col-2"},ee={class:"field col-2"},te={class:"field col-2"},le={class:"field col-2 d-flex justifiy-content-center align-items-end mb-0"},ae={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},se=i("h5",{class:"m-0"},"Faktur Penjualan",-1),ie={class:"flex gap-2 col-12 md:col-5"},ne={class:"block p-input-icon-left w-full"},oe=i("i",{class:"pi pi-search"},null,-1),re=i("div",{class:"text-center"},"Empty",-1),de={key:0},ue={key:1},ce={key:2},me={key:3,class:"text-right"},ge={key:4},fe={class:"flex align-items-center justify-content-center"},he=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),pe={key:0},_e={class:"p-fluid formgrid grid"},be={class:"field col-12 md:col-6"},ve={class:"col-12"},ye={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Se=i("div",{class:"col-6"},null,-1),Ce={class:"col-6"},we={class:"block mt-2 md:mt-0 p-input-icon-left"},De=i("i",{class:"pi pi-search"},null,-1),Pe={class:"text-right"},ke={class:"p-fluid formgrid grid"},xe={class:"field col-12 md:col-6"},Ve={class:"flex align-options-center"},Be={class:"col-12"},Le={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Ie=i("div",{class:"col-6"},null,-1),Te={class:"col-6"},Oe={class:"block mt-2 md:mt-0 p-input-icon-left"},je=i("i",{class:"pi pi-search"},null,-1);function Ue(t,s,Fe,Re,a,r){const T=d("Toast"),m=d("Button"),x=d("router-link"),O=d("MyExport"),j=d("Toolbar"),b=d("Label"),V=d("Calendar"),B=d("AutoComplete"),w=d("AutoCompleteKontak"),U=d("Dropdown"),D=d("InputText"),F=d("MultiSelect"),o=d("Column"),R=d("Tag"),N=d("ActionButton"),y=d("DataTable"),P=d("Dialog");return c(),_(I,null,[i("div",K,[l(T),l(j,{class:"mb-4"},{start:n(()=>[i("div",J,[l(x,{to:"/invoice/create",class:"btn btn-added me-2"},{default:n(()=>[l(m,{label:"Tambah",icon:"pi pi-plus",class:"p-button-primary mr-2"})]),_:1}),l(m,{icon:"pi pi-filter",label:"Filter",class:k(["p-button mx-2",{"p-button-block":a.filter,"p-button-outlined":!a.filter}]),onClick:r.showHideFilter},null,8,["onClick","class"]),a.lPersetujuan.length>0?(c(),S(x,{key:0,to:"/invoice/persetujuan",class:"btn btn-added me-2"},{default:n(()=>[l(m,{icon:"pi pi-shield",class:"p-button mx-2 p-button-outlined",label:"Persetujuan",badge:a.lPersetujuan.length,severity:"warning",badgeSeverity:"warning"},null,8,["badge"])]),_:1})):C("",!0)])]),end:n(()=>[l(m,{label:"Pesanan Penjualan",icon:"pi pi-plus",class:"p-button-primary mr-2",onClick:r.showSalesOrderDialog},null,8,["onClick"]),l(m,{label:"Pengiriman Barang",icon:"pi pi-plus",class:"p-button-primary mr-2",onClick:r.showPengirimanBarangDialog},null,8,["onClick"]),l(O,{value:r.filteredItems,selectedColumns:a.selectedColumns,title:"Export Invoice"},null,8,["value","selectedColumns"])]),_:1}),i("div",{class:k(["card fadein",{hidden:!a.filter}])},[Y,i("div",Q,[i("div",X,[l(b,null,{default:n(()=>[g("Periode Awal")]),_:1}),l(V,{modelValue:a.f.awal,"onUpdate:modelValue":s[0]||(s[0]=e=>a.f.awal=e),inputId:"periodeawal"},null,8,["modelValue"])]),i("div",Z,[l(b,null,{default:n(()=>[g("Periode Akhir")]),_:1}),l(V,{modelValue:a.f.akhir,"onUpdate:modelValue":s[1]||(s[1]=e=>a.f.akhir=e),inputId:"periodeakhir"},null,8,["modelValue"])]),i("div",$,[l(b,null,{default:n(()=>[g("Salesman")]),_:1}),l(B,{modelValue:a.selectedSalesman,"onUpdate:modelValue":s[2]||(s[2]=e=>a.selectedSalesman=e),optionLabel:"nama",suggestions:a.filteredSalesman,onComplete:r.searchSalesman,onClear:r.unselectSalesman,onItemSelect:r.selectSalesman,dropdown:"",forceSelection:""},null,8,["modelValue","suggestions","onComplete","onClear","onItemSelect"])]),i("div",ee,[l(b,null,{default:n(()=>[g("Pelanggan")]),_:1}),l(w,{modelValue:a.f.id_customer,"onUpdate:modelValue":s[3]||(s[3]=e=>a.f.id_customer=e),"is-customer":""},null,8,["modelValue"])]),i("div",te,[l(b,null,{default:n(()=>[g("Dibuat Oleh")]),_:1}),l(B,{clear:"",modelValue:a.selectedDibuat,"onUpdate:modelValue":s[4]||(s[4]=e=>a.selectedDibuat=e),optionLabel:"nama",suggestions:a.filteredDibuat,onComplete:r.searchDibuat,onItemSelect:r.selectDibuat,onClear:r.unselectDibuat,dropdown:"",forceSelection:""},null,8,["modelValue","suggestions","onComplete","onItemSelect","onClear"])]),i("div",le,[l(b,{for:"status"},{default:n(()=>[g("Status")]),_:1}),l(U,{id:"status",modelValue:a.f.selectedStatus,"onUpdate:modelValue":s[5]||(s[5]=e=>a.f.selectedStatus=e),options:a.statuses,optionLabel:"label",placeholder:"Status"},null,8,["modelValue","options"])])])],2),l(y,{ref:"dt",value:r.filteredItems,selection:a.selectedItem,"onUpdate:selection":s[8]||(s[8]=e=>a.selectedItem=e),dataKey:"id",selectionMode:"single",onRowDblclick:r.ondblclick,paginator:!0,rows:10,filters:a.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Faktur Penjualan",responsiveLayout:"scroll"},{header:n(()=>[i("div",ae,[se,i("div",ie,[i("span",ne,[oe,l(D,{modelValue:a.filters.global.value,"onUpdate:modelValue":s[6]||(s[6]=e=>a.filters.global.value=e),placeholder:"Search...",class:"w-full"},null,8,["modelValue"])]),l(F,{modelValue:a.selectedColumns,"onUpdate:modelValue":s[7]||(s[7]=e=>a.selectedColumns=e),options:a.Columns,optionLabel:"header",placeholder:"Select Column",class:"w-3rem"},null,8,["modelValue","options"])])])]),empty:n(()=>[re]),default:n(()=>[l(o,{header:"#",headerStyle:"width:10px"},{body:n(e=>[g(f(e.index+1),1)]),_:1}),(c(!0),_(I,null,q(a.gudangStore.count>1?a.selectedColumns:a.selectedColumns.filter(e=>e.field!="gudang"),(e,u)=>(c(),S(o,{field:e.field,header:e.header,class:k(e.class),key:e.field+"_"+u,sortable:!0},{body:n(({data:h,field:p})=>[p=="icon"?(c(),_("div",de,[l(m,{icon:h[p],class:"p-button-rounded p-button-outlined p-button-icon"},null,8,["icon"])])):p=="status"?(c(),_("div",ue,[l(R,{value:t.$h.getLabel(h.status),severity:t.$h.getLabel(h.status)},null,8,["value","severity"])])):p=="tanggal"?(c(),_("div",ce,f(t.$h.formatDate(h[p])),1)):p=="grandtotal"?(c(),_("div",me,f(t.$h.formatNumber(h[p])),1)):(c(),_("div",ge,f(h[p]),1))]),_:2},1032,["field","header","class"]))),128)),l(o,{header:"Aksi",headerStyle:"width:6%; max-width:1rem;"},{body:n(({data:e,index:u})=>[l(N,{data:e,index:u,onEdit:h=>r.FormEdit(e),onDelete:h=>r.confirmDelete(e),onPrint:r.Cetak,showDelete:e.status!="C",showPrint:e.status!="D"},null,8,["data","index","onEdit","onDelete","onPrint","showDelete","showPrint"])]),_:1})]),_:1},8,["value","selection","onRowDblclick","filters"])]),l(P,{visible:a.deleteDialog,"onUpdate:visible":s[10]||(s[10]=e=>a.deleteDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[l(m,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[9]||(s[9]=e=>a.deleteDialog=!1)}),l(m,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:r.submitDelete},null,8,["onClick"])]),default:n(()=>[i("div",fe,[he,a.item?(c(),_("span",pe,[g("Are you sure you want to delete "),i("b",null,f(a.item.nomor),1),g("?")])):C("",!0)])]),_:1},8,["visible"]),l(P,{visible:a.salesOrderDialog,"onUpdate:visible":s[15]||(s[15]=e=>a.salesOrderDialog=e),style:{width:"70%"},header:"Pilih Pesanan Penjualan",modal:!0,maximizable:!0},{footer:n(()=>[l(m,{label:"PILIH",icon:"pi pi-check",class:"p-button-outlined",onClick:s[14]||(s[14]=e=>r.CreatePurchaseOrder()),loading:t.$isLoading.value},null,8,["loading"])]),default:n(()=>[i("div",_e,[i("div",be,[l(w,{modelValue:a.id_customer,"onUpdate:modelValue":s[11]||(s[11]=e=>a.id_customer=e),required:!1,label:"Pelanggan"},null,8,["modelValue"])]),i("div",ve,[l(y,{value:a.lSalesOrder,style:{"margin-top":"20px"},selection:a.selectedSalesOrder,"onUpdate:selection":s[13]||(s[13]=e=>a.selectedSalesOrder=e),rows:10,filters:a.filters,responsiveLayout:"scroll",editMode:"cell",onCellEditComplete:t.onCellEditComplete},{header:n(()=>[i("div",ye,[Se,i("div",Ce,[i("span",we,[De,l(D,{modelValue:a.filters.global.value,"onUpdate:modelValue":s[12]||(s[12]=e=>a.filters.global.value=e),placeholder:"Search..."},null,8,["modelValue"])])])])]),default:n(()=>[l(o,{selectionMode:"single",headerStyle:"width: 3rem"}),l(o,{field:"tanggal",header:"Tanggal"},{body:n(({data:e,field:u})=>[g(f(t.$h.formatDate(e[u])),1)]),_:1}),l(o,{field:"nomor",header:"Nomor"}),l(o,{field:"customer",header:"Customer"}),l(o,{field:"referensi",header:"Referensi"}),a.gudangStore.count>1?(c(),S(o,{key:0,field:"gudang",header:"Gudang"})):C("",!0),l(o,{field:"no_quotation",header:"No. Penawaran"}),l(o,{field:"grandtotal",header:"Total"},{body:n(({data:e,field:u})=>[i("div",Pe,f(t.$h.formatNumber(e[u])),1)]),_:1})]),_:1},8,["value","selection","filters","onCellEditComplete"])])])]),_:1},8,["visible"]),l(P,{visible:a.pengirimanBarangDialog,"onUpdate:visible":s[22]||(s[22]=e=>a.pengirimanBarangDialog=e),style:{width:"70%"},header:"Pilih Pengiriman Barang",modal:!0,maximizable:!0},{footer:n(()=>[l(m,{label:"TUTUP",icon:"pi pi-times",class:"p-button-text",saverity:"danger",onClick:s[20]||(s[20]=e=>a.pengirimanBarangDialog=!1)}),l(m,{label:"PILIH",icon:"pi pi-check",class:"p-button-outlined",onClick:s[21]||(s[21]=e=>r.CreateInvoiceWithPengirimanBarang()),loading:t.$isLoading.value},null,8,["loading"])]),default:n(()=>[i("div",ke,[i("div",xe,[l(w,{modelValue:a.id_customer,"onUpdate:modelValue":s[16]||(s[16]=e=>a.id_customer=e),label:"Pelanggan",suggestions:t.filteredCustomer,onChange:t.changeCustomerPengirimanBarang,onComplete:t.searchCustomer,dropdown:"",forceSelection:""},{option:n(e=>[i("div",Ve,[i("div",null,f(e.option.kontak),1)])]),_:1},8,["modelValue","suggestions","onChange","onComplete"])]),i("div",Be,[l(y,{expandedRows:a.expandedRows,"onUpdate:expandedRows":s[18]||(s[18]=e=>a.expandedRows=e),value:r.filteredPengirimanBarang,style:{"margin-top":"20px"},selection:a.selectedPengirimanBarang,"onUpdate:selection":s[19]||(s[19]=e=>a.selectedPengirimanBarang=e),paginator:!0,rows:10,filters:a.filters,responsiveLayout:"scroll",editMode:"cell",onRowSelect:r.rowSelectPengirimanBarang,onCellEditComplete:t.onCellEditComplete},{header:n(()=>[i("div",Le,[Ie,i("div",Te,[i("span",Oe,[je,l(D,{modelValue:a.filters.global.value,"onUpdate:modelValue":s[17]||(s[17]=e=>a.filters.global.value=e),placeholder:"Search..."},null,8,["modelValue"])])])])]),expansion:n(e=>[l(y,{value:e.data.detail,size:"small",class:"text-xs md:text-base"},{default:n(()=>[l(o,{field:"nama_barang",header:"Nama Barang"}),l(o,{field:"dipesan",header:"Dipesan"}),l(o,{field:"sisa",header:"Sisa"}),l(o,{field:"qty",header:"Dikirim"})]),_:2},1032,["value"])]),default:n(()=>[l(o,{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(o,{expander:"",style:{width:"5rem"}}),l(o,{field:"no_so",header:"No. Pesanan"}),l(o,{field:"tanggal",header:"Tanggal"},{body:n(({data:e,field:u})=>[g(f(t.$h.formatDate(e[u])),1)]),_:1}),l(o,{field:"nomor",header:"No. Pengiriman"}),l(o,{field:"customer",header:"Customer"},{body:n(({data:e,field:u})=>[i("p",null,f(e[u]),1)]),_:1}),l(o,{field:"referensi",header:"Referensi"},{body:n(({data:e,field:u})=>[i("p",null,f(e[u]),1)]),_:1}),a.gudangStore.count>1?(c(),S(o,{key:0,field:"gudang",header:"Gudang"})):C("",!0)]),_:1},8,["expandedRows","value","selection","filters","onRowSelect","onCellEditComplete"])])])]),_:1},8,["visible"])],64)}const Ge=A(W,[["render",Ue]]);export{Ge as default};
