import{_ as O,r as c,o as m,c as P,d as n,j as q,s as j,F as z,b as i,e as s,n as N,k as V,f as A,l as _,t as p,m as W,q as H}from"./index-11eb6111.js";import{a as M}from"./options-b2eb7ae6.js";import{a as J}from"./api-646607e4.js";import{a as G}from"./api-b68fe7dd.js";import{a as I}from"./api-0e438e31.js";import{x as y}from"./xlsx.min-b21a3818.js";const K={props:{value:{type:Array,required:!0},selectedColumns:{type:Array,required:!0},title:{type:String,default:"exported_data"}},methods:{exportToExcel(){const t=this.value,l=this.selectedColumns,S=[this.title],E={font:{bold:!0,sz:20},alignment:{vertical:"center",horizontal:"center"}},a=Array(l.length+1).fill(""),o=["No",...l.map(h=>h.header)],C=t.map((h,w)=>[w+1,...l.map(f=>this.formatData(h,f))]),r=y.utils.aoa_to_sheet([S,a,o,...C]);r["!rows"]=[{hpt:20,hidden:!1},...Array(t.length+3).fill({hpt:15,hidden:!1})],r["!cols"]=[{width:9},...Array(l.length).fill({width:20})],r["!merges"]=[{s:{c:0,r:0},e:{c:l.length,r:0}}],r.A1=Object.assign({},r.A1,{s:E});const k=y.utils.decode_range(r["!ref"]),L={row:2,col:1},T={border:{top:{style:"thin",color:{auto:1}},bottom:{style:"thin",color:{auto:1}},left:{style:"thin",color:{auto:1}},right:{style:"thin",color:{auto:1}}}};console.log(k,"Ini all range");for(let h=L.row;h<=k.e.r;h++)for(let w=L.col-1;w<=k.e.c;w++){const f=y.utils.encode_cell({r:h,c:w});if(f=="A3"){const R=y.utils.encode_range({s:{c:0,r:2},e:{c:o.length-1,r:2}}),d=y.utils.decode_range(`${R}`);for(let x=d.s.r;x<=d.e.r;x++)for(let D=d.s.c;D<=d.e.c;D++){const B=y.utils.encode_cell({r:x,c:D});r[B].s={...T,font:{bold:!0}}}break}else r[f]||(r[f]={t:"s",v:""}),r[f].s=T}const v=y.utils.book_new();y.utils.book_append_sheet(v,r,"Sheet1"),y.writeFile(v,`${this.title}_${new Date().getTime()}.xlsx`)},formatData(t,l){switch(l.type){case"date":return this.$h.formatDate(t[l.field]);case"currency":return this.$h.formatNumber(t[l.field]);case"number":return this.$h.formatNumber(t[l.field]);default:return t[l.field]}}}};function Y(t,l,S,E,a,o){const C=c("Button");return m(),P("div",null,[n(C,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:o.exportToExcel},null,8,["onClick"])])}const Q=O(K,[["render",Y],["__scopeId","data-v-6d1a2cd1"]]),X={components:{MyExportExcel:Q},data(){return{gudangStore:q(),lItem:[],selectedItem:null,item:null,selectedColumns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"nomor_po",header:"Nomor PO"},{field:"supplier",header:"Supplier"},{field:"referensi",header:"Referensi"},{field:"grandtotal",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status"}],Columns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"nomor_po",header:"Nomor PO"},{field:"supplier",header:"Supplier"},{field:"referensi",header:"Referensi"},{field:"grandtotal",header:"Total",type:"currency"},{field:"status",header:"Status"}],deleteDialog:!1,lSupplier:[],filteredSupplier:[],selectedSupplier:null,lPesananPembelian:[],pesananPembelianDialog:!1,selectedPesananPembelian:null,lPenerimaanBarang:[],penerimaanBarangDialog:!1,selectedPenerimaanBarang:[],filter:!1,filters:{},f:{awal:null,akhir:null,selectedStatus:{label:"All",value:""}},statuses:[{label:"All",value:""},{label:"Draft",value:"D"},{label:"Close",value:"C"}],isClean:!0}},created(){this.initFilters()},mounted(){this.$isLoading.value=!0,this.getData().finally(()=>{this.$timeoutLoading()}),j.on("update-persetujuan-payment-ap",()=>{this.getDataPersetujuan()})},beforeUnmount(){j.off("update-persetujuan-payment-ap")},computed:{filteredItems(){return this.lItem.filter(t=>(this.f.selectedStatus.value==""?!0:this.f.selectedStatus.value==t.status)&&(this.f.awal==null?!0:this.f.awal.toLocaleDateString()<=new Date(t.tanggal).toLocaleDateString())&&(this.f.akhir==null?!0:this.f.akhir.toLocaleDateString()>=new Date(t.tanggal).toLocaleDateString())&&(this.selectedAkun?this.selectedAkun.id==t.akun:!0))},filteredPesananPembelian(){return this.selectedSupplier==null||typeof this.selectedSupplier=="string"?this.lPesananPembelian:this.lPesananPembelian.filter(t=>t.id_supplier==this.selectedSupplier.id)},filteredPenerimaanBarang(){return this.selectedSupplier==null?this.lPenerimaanBarang:this.lPenerimaanBarang.filter(t=>t.id_supplier==this.selectedSupplier.id)}},methods:{async getData(){await I.index().then(t=>{this.lItem=t.data.data}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})})},async Destroy(t){await I.destroy(t.id).then(l=>{this.$toast.add({severity:"success",summary:"Success",detail:l.data.message,life:3e3}),this.lItem=this.lItem.filter(S=>S.id!==t.id)}).catch(l=>{this.$toast.add({severity:"error",summary:"Failed",detail:l.response.data.message,life:3e3})}).finally(()=>{this.deleteDialog=!1,this.item=null,this.getData()})},onRowDblclick(t){this.$router.push({name:"ap.edit",params:{id:t.data.id}})},FormEdit(t){this.$router.push({name:"ap.edit",params:{id:t.id}})},confirmDelete(t){this.deleteDialog=!0,this.item={...t}},jurnal(t){this.$router.push({name:"ap.print",params:{id:t.id}})},showHideFilter(){this.filter=!this.filter},initFilters(){this.filters={global:{value:null,matchMode:z.CONTAINS}}},searchSupplier(t){setTimeout(()=>{this.filteredSupplier=t.query.trim().length?this.lSupplier.filter(l=>l.kontak.toLowerCase().includes(t.query.toLowerCase())):[...this.lSupplier]},250)},changeSupplierPenerimaanBarang(){this.selectedPenerimaanBarang=null},changeSupplierPesananPembelian(){this.selectedPesananPembelian=null},async showPesananPembelianDialog(){this.pesananPembelianDialog=!0,this.selectedSupplier=null,await J.index({type:"option",module:"ap"}).then(t=>{this.lPesananPembelian=t.data.data}),await M.getKontakSupplier().then(t=>{this.lSupplier=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Customer",life:3e3})})},async CreatePurchaseOrder(){this.$isLoading.value=!0,await I.storeWithPesananPembelian({purchase_order:this.selectedPesananPembelian}).then(t=>{setTimeout(()=>{this.$router.push({name:"ap.edit",params:{id:t.data.data.id}}),this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3})},1e3)}).finally(()=>{this.$timeoutLoading()})},onRowClickPesananPembelian(t){this.selectedPesananPembelian=t.data},async showPenerimaanBarangDialog(){this.penerimaanBarangDialog=!0,this.selectedSupplier=null,await G.index({type:"option",module:"ap"}).then(t=>{this.lPenerimaanBarang=t.data.data}),await M.getKontakSupplier().then(t=>{this.lSupplier=t.data.data}).catch(()=>{this.$toast.add({severity:"error",summary:"Failed",detail:"Load data Customer",life:3e3})})},async CreateApWithPenerimaanBarang(){if(this.$isLoading.value=!0,this.selectedPenerimaanBarang.length==0){this.$timeoutLoading();return}await I.storeWithPenerimaanBarang({list_penerimaan_barang:this.selectedPenerimaanBarang}).then(t=>{setTimeout(()=>{this.$router.push({name:"ap.edit",params:{id:t.data.data.id}}),this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3})},1e3)}).finally(()=>{this.$timeoutLoading()})},rowSelectPenerimaanBarang(t){this.selectedPenerimaanBarang.some(l=>l.id_po!=t.data.id_po)&&(this.$toast.add({severity:"error",summary:"Failed",detail:"PO Berbeda ",life:3e3}),this.selectedPenerimaanBarang=this.selectedPenerimaanBarang.filter(l=>l.id_po!=t.data.id_po))}}},Z={class:"grid crud-demo"},$={class:"col-12"},ee={class:"card"},te={class:"my-2"},le=i("h5",{class:"mbe-4"},"Pencarian Faktur Pembelian",-1),ae={class:"p-fluid formgrid grid"},ne={class:"field col-2"},ie={class:"field col-2"},se={class:"field col-2 d-flex justifiy-content-center align-items-end mb-0"},oe=i("label",{for:"status",class:"mb-1"},"Status",-1),re={class:"field col-auto",style:{display:"flex","align-items":"flex-end","align-content":"flex-end"}},de={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ue=i("h5",{class:"m-0"},"Faktur Pembelian",-1),ce={class:"flex gap-2 col-12 md:col-5"},pe={class:"block p-input-icon-left w-full"},me=i("i",{class:"pi pi-search"},null,-1),he={key:0},fe={key:1},ge={key:2},be={key:3,class:"text-right"},_e={key:4},ye={class:"flex align-items-center justify-content-center"},Pe=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ve={key:0},we={class:"p-fluid formgrid grid"},ke={class:"field col-12 md:col-6"},Se={class:"flex align-options-center"},Ce={class:"col-12"},xe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},De=i("div",{class:"col-6"},null,-1),Be={class:"col-6"},Le={class:"block mt-2 md:mt-0 p-input-icon-left"},Te=i("i",{class:"pi pi-search"},null,-1),Ve={class:"text-right"},Ae={class:"p-fluid formgrid grid"},Ie={class:"field col-12 md:col-6"},Ee={class:"flex align-options-center"},Re={class:"col-12"},Fe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Ne=i("div",{class:"col-6"},null,-1),Ue={class:"col-6"},je={class:"block mt-2 md:mt-0 p-input-icon-left"},Me=i("i",{class:"pi pi-search"},null,-1);function Oe(t,l,S,E,a,o){const C=c("Toast"),r=c("Button"),k=c("router-link"),L=c("MyExportExcel"),T=c("Toolbar"),v=c("Label"),h=c("Calendar"),w=c("Dropdown"),f=c("InputText"),R=c("MultiSelect"),d=c("Column"),x=c("Tag"),D=c("ActionButton"),B=c("DataTable"),F=c("Dialog"),U=c("AutoComplete");return m(),P("div",Z,[i("div",$,[i("div",ee,[n(C),n(T,{class:"mb-4"},{start:s(()=>{var e;return[i("div",te,[n(k,{to:"/faktur-pembelian/create",class:"btn btn-added me-2"},{default:s(()=>[n(r,{label:"Tambah",icon:"pi pi-plus",class:"p-button-primary mr-2"})]),_:1}),n(r,{icon:"pi pi-filter",label:"Filter",class:N(["p-button mx-2",{"p-button-block":a.filter,"p-button-outlined":!a.filter}]),onClick:o.showHideFilter},null,8,["onClick","class"]),(e=t.lPersetujuan)!=null&&e.length?(m(),V(k,{key:0,to:"/faktur-pembelian/persetujuan",class:"btn btn-added mx-2"},{default:s(()=>[n(r,{icon:"pi pi-shield",class:"p-button p-button-outlined",label:"Persetujuan",badge:t.lPersetujuan.length,severity:"warning",badgeSeverity:"warning"},null,8,["badge"])]),_:1})):A("",!0)])]}),end:s(()=>[n(r,{label:"Pesanan Pembelian",icon:"pi pi-plus",class:"p-button-primary mr-2",onClick:o.showPesananPembelianDialog},null,8,["onClick"]),n(r,{label:"Penerimaan Barang",icon:"pi pi-plus",class:"p-button-primary mr-2",onClick:o.showPenerimaanBarangDialog},null,8,["onClick"]),n(L,{value:o.filteredItems,selectedColumns:a.selectedColumns,title:"Export Faktur Pembelian"},null,8,["value","selectedColumns"])]),_:1}),i("div",{class:N(["card fadein",{hidden:!a.filter}])},[le,i("div",ae,[i("div",ne,[n(v,null,{default:s(()=>[_("Periode Awal")]),_:1}),n(h,{modelValue:a.f.awal,"onUpdate:modelValue":l[0]||(l[0]=e=>a.f.awal=e),inputId:"f.awal"},null,8,["modelValue"])]),i("div",ie,[n(v,null,{default:s(()=>[_("Periode Akhir")]),_:1}),n(h,{modelValue:a.f.akhir,"onUpdate:modelValue":l[1]||(l[1]=e=>a.f.akhir=e),inputId:"f.akhir"},null,8,["modelValue"])]),i("div",se,[oe,n(w,{id:"status",modelValue:a.f.selectedStatus,"onUpdate:modelValue":l[2]||(l[2]=e=>a.f.selectedStatus=e),options:a.statuses,optionLabel:"label",placeholder:"Status"},null,8,["modelValue","options"])]),i("div",re,[n(r,{label:"Search"})])])],2),n(B,{ref:"dt",value:o.filteredItems,selection:a.selectedItem,"onUpdate:selection":l[5]||(l[5]=e=>a.selectedItem=e),dataKey:"id",paginator:!0,selectionMode:"single",rows:10,filters:a.filters,onRowDblclick:o.onRowDblclick,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Faktur Pembelian",responsiveLayout:"scroll",tableStyle:"table-layout:auto"},{header:s(()=>[i("div",de,[ue,i("div",ce,[i("span",pe,[me,n(f,{modelValue:a.filters.global.value,"onUpdate:modelValue":l[3]||(l[3]=e=>a.filters.global.value=e),placeholder:"Search...",class:"w-full"},null,8,["modelValue"])]),n(R,{modelValue:a.selectedColumns,"onUpdate:modelValue":l[4]||(l[4]=e=>a.selectedColumns=e),options:a.Columns,optionLabel:"header",placeholder:"Select Column",class:"w-3rem"},null,8,["modelValue","options"])])])]),default:s(()=>[n(d,{header:"#",headerStyle:"width:10px"},{body:s(e=>[_(p(e.index+1),1)]),_:1}),(m(!0),P(W,null,H(a.selectedColumns,(e,u)=>(m(),V(d,{field:e.field,header:e.header,class:N(e.class),key:e.field+"_"+u,sortable:!0},{body:s(({data:g,field:b})=>[b=="icon"?(m(),P("div",he,[n(r,{icon:g[b],class:"p-button-rounded p-button-outlined p-button-icon"},null,8,["icon"])])):b=="status"?(m(),P("div",fe,[n(x,{value:t.$h.getLabel(g[b]),severity:t.$h.getLabel(g[b])},null,8,["value","severity"])])):b=="tanggal"?(m(),P("div",ge,p(t.$h.formatDate(g[b])),1)):e.type=="currency"?(m(),P("div",be,p(t.$h.formatNumber(g[b])),1)):(m(),P("div",_e,p(g[b]),1))]),_:2},1032,["field","header","class"]))),128)),n(d,{header:"Aksi",headerStyle:"width:6%; max-width:1rem;"},{body:s(({data:e,index:u})=>[n(D,{data:e,index:u,onEdit:g=>o.FormEdit(e),onDelete:g=>o.confirmDelete(e),onJurnal:g=>o.jurnal(e),showDelete:e.status!="C",showJurnal:e.status!="D"||e.status!="S"},null,8,["data","index","onEdit","onDelete","onJurnal","showDelete","showJurnal"])]),_:1})]),_:1},8,["value","selection","filters","onRowDblclick"]),n(F,{visible:a.deleteDialog,"onUpdate:visible":l[8]||(l[8]=e=>a.deleteDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:s(()=>[n(r,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:l[6]||(l[6]=e=>a.deleteDialog=!1)}),n(r,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:l[7]||(l[7]=e=>o.Destroy(a.item))})]),default:s(()=>[i("div",ye,[Pe,a.item?(m(),P("span",ve,[_("Are you sure you want to delete "),i("b",null,p(a.item.nomor),1),_("?")])):A("",!0)])]),_:1},8,["visible"]),n(F,{visible:a.pesananPembelianDialog,"onUpdate:visible":l[14]||(l[14]=e=>a.pesananPembelianDialog=e),style:{width:"70%"},header:"Pilih Pesanan Pembelian",modal:!0,maximizable:!0},{footer:s(()=>[n(r,{label:"TUTUP",icon:"pi pi-times",class:"p-button-text",saverity:"danger",onClick:l[12]||(l[12]=e=>a.pesananPembelianDialog=!1)}),n(r,{label:"PILIH",icon:"pi pi-check",class:"p-button-outlined",onClick:l[13]||(l[13]=e=>o.CreatePurchaseOrder()),loading:t.$isLoading.value},null,8,["loading"])]),default:s(()=>[i("div",we,[i("div",ke,[n(v,{required:"",class:"mb-1"},{default:s(()=>[_("Supplier")]),_:1}),n(U,{modelValue:a.selectedSupplier,"onUpdate:modelValue":l[9]||(l[9]=e=>a.selectedSupplier=e),optionLabel:"kontak",suggestions:a.filteredSupplier,onChange:o.changeSupplierPesananPembelian,onComplete:o.searchSupplier,dropdown:"",forceSelection:""},{option:s(e=>[i("div",Se,[i("div",null,p(e.option.kontak),1)])]),_:1},8,["modelValue","suggestions","onChange","onComplete"])]),i("div",Ce,[n(B,{value:o.filteredPesananPembelian,style:{"margin-top":"20px"},selection:a.selectedPesananPembelian,"onUpdate:selection":l[11]||(l[11]=e=>a.selectedPesananPembelian=e),paginator:!0,rows:10,filters:a.filters,responsiveLayout:"scroll",editMode:"cell",onRowClick:o.onRowClickPesananPembelian,onCellEditComplete:t.onCellEditComplete},{header:s(()=>[i("div",xe,[De,i("div",Be,[i("span",Le,[Te,n(f,{modelValue:a.filters.global.value,"onUpdate:modelValue":l[10]||(l[10]=e=>a.filters.global.value=e),placeholder:"Search..."},null,8,["modelValue"])])])])]),default:s(()=>[n(d,{selectionMode:"single",headerStyle:"width: 3rem"}),n(d,{field:"tanggal",header:"Tanggal"},{body:s(({data:e,field:u})=>[_(p(t.$h.formatDate(e[u])),1)]),_:1}),n(d,{field:"nomor",header:"No. Pesanan"}),n(d,{field:"supplier",header:"Supplier"},{body:s(({data:e,field:u})=>[i("p",null,p(e[u]),1)]),_:1}),n(d,{field:"referensi",header:"Referensi"},{body:s(({data:e,field:u})=>[i("p",null,p(e[u]),1)]),_:1}),a.gudangStore.count>1?(m(),V(d,{key:0,field:"gudang",header:"Gudang"})):A("",!0),n(d,{field:"grandtotal",header:"Total"},{body:s(({data:e,field:u})=>[i("div",Ve,p(t.$h.formatNumber(e[u])),1)]),_:1})]),_:1},8,["value","selection","filters","onRowClick","onCellEditComplete"])])])]),_:1},8,["visible"]),n(F,{visible:a.penerimaanBarangDialog,"onUpdate:visible":l[20]||(l[20]=e=>a.penerimaanBarangDialog=e),style:{width:"70%"},header:"Pilih Penerimaan Barang",modal:!0,maximizable:!0},{footer:s(()=>[n(r,{label:"TUTUP",icon:"pi pi-times",class:"p-button-text",saverity:"danger",onClick:l[18]||(l[18]=e=>a.penerimaanBarangDialog=!1)}),n(r,{label:"PILIH",icon:"pi pi-check",class:"p-button-outlined",onClick:l[19]||(l[19]=e=>o.CreateApWithPenerimaanBarang()),loading:t.$isLoading.value},null,8,["loading"])]),default:s(()=>[i("div",Ae,[i("div",Ie,[n(v,{required:"",class:"mb-1"},{default:s(()=>[_("Supplier")]),_:1}),n(U,{modelValue:a.selectedSupplier,"onUpdate:modelValue":l[15]||(l[15]=e=>a.selectedSupplier=e),optionLabel:"kontak",suggestions:a.filteredSupplier,onChange:o.changeSupplierPenerimaanBarang,onComplete:o.searchSupplier,dropdown:"",forceSelection:""},{option:s(e=>[i("div",Ee,[i("div",null,p(e.option.kontak),1)])]),_:1},8,["modelValue","suggestions","onChange","onComplete"])]),i("div",Re,[n(B,{value:o.filteredPenerimaanBarang,style:{"margin-top":"20px"},selection:a.selectedPenerimaanBarang,"onUpdate:selection":l[17]||(l[17]=e=>a.selectedPenerimaanBarang=e),paginator:!0,rows:10,filters:a.filters,responsiveLayout:"scroll",editMode:"cell",onRowSelect:o.rowSelectPenerimaanBarang,onCellEditComplete:t.onCellEditComplete},{header:s(()=>[i("div",Fe,[Ne,i("div",Ue,[i("span",je,[Me,n(f,{modelValue:a.filters.global.value,"onUpdate:modelValue":l[16]||(l[16]=e=>a.filters.global.value=e),placeholder:"Search..."},null,8,["modelValue"])])])])]),default:s(()=>[n(d,{selectionMode:"multiple",headerStyle:"width: 3rem"}),n(d,{field:"nomor_po",header:"No. Pesanan"}),n(d,{field:"tanggal",header:"Tanggal"},{body:s(({data:e,field:u})=>[_(p(t.$h.formatDate(e[u])),1)]),_:1}),n(d,{field:"nomor",header:"No. Penerimaan"}),n(d,{field:"supplier",header:"Supplier"},{body:s(({data:e,field:u})=>[i("p",null,p(e[u]),1)]),_:1}),n(d,{field:"referensi",header:"Referensi"},{body:s(({data:e,field:u})=>[i("p",null,p(e[u]),1)]),_:1}),a.gudangStore.count>1?(m(),V(d,{key:0,field:"gudang",header:"Gudang"})):A("",!0)]),_:1},8,["value","selection","filters","onRowSelect","onCellEditComplete"])])])]),_:1},8,["visible"])])])])}const Ke=O(X,[["render",Oe]]);export{Ke as default};
