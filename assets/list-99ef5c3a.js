import{_ as M,F as K,r as o,o as c,c as h,b as r,d as l,e as a,m as A,q as j,n as g,f as v,l as b,t as I,k as N}from"./index-11eb6111.js";import{A as U}from"./index-b9e295bc.js";import{a as u}from"./permission-1fb3dbe3.js";import"./custom-zod-e9521e5d.js";import{z as p}from"./index-0ec66d4d.js";const B=p.object({parent:p.number().int().nullish(),permission:p.string().min(2).max(50),keterangan:p.string().min(3).max(50),level:p.number().int().max(10)}),L={data(){return{lPermission:[],item:{permission:null,parent:null,is_parent:!1},selectedPermission:null,expandedKeys:null,lParent:[],selectedParent:null,filteredParent:null,filters:{},selectedColumns:[{header:"Permission",field:"permission",class:"w-20rem",expander:!0},{header:"Keterangan",field:"keterangan",class:"w-20rem",expander:!1}],Columns:[{header:"Permission",field:"permission",class:"w-20rem",expander:!0},{header:"Keterangan",field:"keterangan",class:"w-20rem",expander:!1}],isClean:!0,isEdit:!1,formDialog:!1,deleteFormDialog:!1}},created(){this.initFilters()},mounted(){this.getData().then(()=>{const t=this.getAllKeysWithChildren(this.lPermission),e=new Map(t.map(m=>[m.toString(),!0]));this.expandedKeys=Object.fromEntries(e)})},computed:{FormItem(){return{...this.item,level:this.level}},FormError(){var t,e;return this.isClean?{}:((e=(t=B.safeParse(this.FormItem))==null?void 0:t.error)==null?void 0:e.format())||{}},level(){return this.item.parent?this.lParent.find(e=>e.id==this.item.parent).level+1:1}},methods:{async getData(){await u.index({type:"tree"}).then(t=>{this.lPermission=t.data.data}),await u.index().then(t=>{this.lParent=t.data.data})},async Save(){try{if(this.isClean=!1,Object.keys(this.FormError).length>0)return;this.isEdit?(this.item.parent=this.selectedParent?this.selectedParent.id:null,await u.update(this.item.id,this.FormItem).then(t=>{this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3}),this.formDialog=!1,this.item={},this.selectedParent={},this.getData()})):await u.store(this.FormItem).then(t=>{this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3}),this.formDialog=!1,this.item={},this.getData()})}catch(t){t instanceof U&&this.$toast.add({severity:"success",summary:"Successful",detail:t.response.data.message,life:3e3})}},async Destroy(t){await u.destroy(t.id).then(e=>{this.$toast.add({severity:"success",summary:"Successful",detail:e.data.message,life:3e3}),this.deleteFormDialog=!1,this.getData()})},getAllKeysWithChildren(t){const e=[];return t.forEach(m=>{m.children.length>0&&(e.push(m.key),e.push(...this.getAllKeysWithChildren(m.children)))}),e},initFilters(){this.filters={global:{value:null,matchMode:K.CONTAINS}}},exportCSV(){this.$refs.dt.exportCSV()},FormNew(){this.isClean=!0,this.item={permission:null},this.formDialog=!0,this.isEdit=!1,this.selectedParent=null},FormEdit(t){this.item={...t},this.isClean=!0,this.formDialog=!0,this.isEdit=!0,this.selectedParent=this.lParent.find(e=>e.id==t.parent)},confirmDelete(t){this.item={...t},this.deleteFormDialog=!0},HideDialog(){this.formDialog=!1},searchParent(t){setTimeout(()=>{this.filteredParent=t.query.trim().length?this.lParent.filter(e=>e.permission.toLowerCase().startsWith(t.query.toLowerCase())):[...this.lParent]},250)},selectParent(t){this.isEdit||(this.item.permission=t.value.permission),this.item.parent=t.value.id}}},W={class:"grid crud-demo"},q={class:"col-12"},z={class:"card"},O={class:"my-2"},H={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Y=r("h5",{class:"m-0"},"Manajemen Permission",-1),G={class:"flex gap-2 col-12 md:col-5"},J={class:"block p-input-icon-left w-full"},Q=r("i",{class:"pi pi-search"},null,-1),R={class:"formgrid grid"},X={key:0,class:"field col-12 d-flex justifiy-content-center align-items-end"},Z=r("label",{for:"permissionparent"},"Parent",-1),$={class:"field col-12 d-flex justifiy-content-center align-items-end"},ee=r("label",{for:"permission"},"Permission",-1),te={class:"field col-12 d-flex justifiy-content-center align-items-end"},se=r("label",{for:"keterangan"},"Permission",-1),ie={class:"flex align-items-center justify-content-center"},le=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),re={key:0};function ne(t,e,m,oe,s,n){const C=o("Toast"),d=o("Button"),P=o("MyExport"),k=o("Toolbar"),_=o("InputText"),D=o("MultiSelect"),x=o("Column"),F=o("ActionButton"),E=o("TreeTable"),w=o("AutoComplete"),f=o("ErrorMsg"),V=o("Textarea"),y=o("Dialog");return c(),h("div",W,[r("div",q,[r("div",z,[l(C),l(k,{class:"mb-4"},{start:a(()=>[r("div",O,[l(d,{label:"Tambah",icon:"pi pi-plus",class:"p-button-primary mr-2",onClick:n.FormNew},null,8,["onClick"])])]),end:a(()=>[l(P,{value:s.lPermission,selectedColumns:s.selectedColumns,title:"Export Permission"},null,8,["value","selectedColumns"])]),_:1}),l(E,{expandedKeys:s.expandedKeys,"onUpdate:expandedKeys":e[2]||(e[2]=i=>s.expandedKeys=i),value:s.lPermission},{header:a(()=>[r("div",H,[Y,r("div",G,[r("span",J,[Q,l(_,{modelValue:s.filters.global.value,"onUpdate:modelValue":e[0]||(e[0]=i=>s.filters.global.value=i),placeholder:"Search...",class:"w-full"},null,8,["modelValue"])]),l(D,{modelValue:s.selectedColumns,"onUpdate:modelValue":e[1]||(e[1]=i=>s.selectedColumns=i),options:s.Columns,optionLabel:"header",placeholder:"Select Column",class:"w-3rem"},null,8,["modelValue","options"])])])]),default:a(()=>[(c(!0),h(A,null,j(s.selectedColumns,i=>(c(),N(x,{field:i.field,header:i.header,key:i,expander:i.expander,sortable:!0},null,8,["field","header","expander"]))),128)),l(x,{header:"Aksi",headerStyle:"width:5%; max-width:1rem;"},{body:a(({node:i,index:S})=>[l(F,{data:i.data,index:S,onEdit:T=>n.FormEdit(i.data),onDelete:T=>n.confirmDelete(i.data)},null,8,["data","index","onEdit","onDelete"])]),_:1})]),_:1},8,["expandedKeys","value"]),l(y,{visible:s.formDialog,"onUpdate:visible":e[6]||(e[6]=i=>s.formDialog=i),style:{width:"450px"},header:(s.isEdit?"Ubah":"Tambah")+" Permission",modal:!0,class:"p-fluid"},{footer:a(()=>[l(d,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:n.HideDialog},null,8,["onClick"]),l(d,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:n.Save},null,8,["onClick"])]),default:a(()=>[r("div",R,[s.item.is_parent?v("",!0):(c(),h("div",X,[Z,l(w,{modelValue:s.selectedParent,"onUpdate:modelValue":e[3]||(e[3]=i=>s.selectedParent=i),dropdown:"",optionLabel:"permission",suggestions:s.filteredParent,onComplete:n.searchParent,onItemSelect:n.selectParent,class:g(n.FormError.parent&&"p-invalid")},null,8,["modelValue","suggestions","onComplete","onItemSelect","class"]),l(f,{error:n.FormError.parent},null,8,["error"])])),r("div",$,[ee,l(_,{id:"permission",modelValue:s.item.permission,"onUpdate:modelValue":e[4]||(e[4]=i=>s.item.permission=i),modelModifiers:{trim:!0},autofocus:"",class:g(n.FormError.permission&&"p-invalid")},null,8,["modelValue","class"]),l(f,{error:n.FormError.permission},null,8,["error"])]),r("div",te,[se,l(V,{id:"keterangan",modelValue:s.item.keterangan,"onUpdate:modelValue":e[5]||(e[5]=i=>s.item.keterangan=i),modelModifiers:{trim:!0},class:g(n.FormError.keterangan&&"p-invalid")},null,8,["modelValue","class"]),l(f,{error:n.FormError.keterangan},null,8,["error"])])])]),_:1},8,["visible","header"]),l(y,{visible:s.deleteFormDialog,"onUpdate:visible":e[9]||(e[9]=i=>s.deleteFormDialog=i),style:{width:"450px"},header:"Confirm",modal:!0},{footer:a(()=>[l(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[7]||(e[7]=i=>s.deleteFormDialog=!1)}),l(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:e[8]||(e[8]=i=>n.Destroy(s.item))})]),default:a(()=>[r("div",ie,[le,s.item?(c(),h("span",re,[b("Are you sure you want to delete "),r("b",null,I(s.item.permission),1),b("?")])):v("",!0)])]),_:1},8,["visible"])])])])}const pe=M(L,[["render",ne]]);export{pe as default};
