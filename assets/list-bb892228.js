import{_ as z,s as T,F as H,r,A as K,o as m,c as g,b as i,d as l,e as o,n as D,k as w,f as C,l as f,t as u,m as W,q as J,B as Y}from"./index-11eb6111.js";import{a as v}from"./api-646607e4.js";import{a as G}from"./api-c6c36a80.js";import"./custom-zod-e9521e5d.js";import{z as b}from"./index-0ec66d4d.js";const Q=b.object({id_supplier:b.number().positive().gt(0),purchase_request_detail:b.array(b.object({nama_barang:b.string().min(1),qty:b.number().gt(0)})).min(1)}),X={data(){return{item:null,lItem:[],selectedItem:null,deleteDialog:!1,selectedColumns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"kontak",header:"Supplier"},{field:"referensi",header:"Referensi"},{field:"tanggal_referensi",header:"Tanggal Referensi",type:"date"},{field:"keterangan",header:"Deskripsi"},{field:"total",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status"}],Columns:[{field:"tanggal",header:"Tanggal",type:"date"},{field:"nomor",header:"Nomor"},{field:"kontak",header:"Supplier"},{field:"referensi",header:"Referensi"},{field:"tanggal_referensi",header:"Tanggal Referensi",type:"date"},{field:"pegawai",header:"Dibuat Oleh"},{field:"top_keterangan",header:"Syarat Pembayaran"},{field:"keterangan",header:"Deskripsi"},{field:"total",header:"Total",class:"text-right",type:"currency"},{field:"status",header:"Status"}],id_supplier:null,filter:!1,filters:{},f:{awal:null,akhir:null,selectedStatus:{label:"All",value:""}},statuses:[{label:"All",value:""},{label:"Draft",value:"D"},{label:"Open",value:"O"},{label:"Close",value:"C"},{label:"Waiting",value:"S"},{label:"Reject",value:"R"}],lPersetujuan:[],lPurchaseRequest:[],selectedPurchaseRequest:[],purchaseRequestDialog:!1,isClean:!0}},created(){this.initFilters()},mounted(){this.getData(),this.getDataPersetujuan(),T.on("update-persetujuan-purchase-order",()=>{this.getDataPersetujuan()})},beforeUnmount(){T.off("update-persetujuan-purchase-order")},computed:{filteredItems(){return this.lItem.filter(t=>(this.f.selectedStatus.value==""?!0:this.f.selectedStatus.value==t.status)&&(this.f.id_supplier==null?!0:this.f.id_supplier==t.id_supplier)&&(this.f.awal==null?!0:this.f.awal.toLocaleDateString()<=new Date(t.tanggal).toLocaleDateString())&&(this.f.akhir==null?!0:this.f.akhir.toLocaleDateString()>=new Date(t.tanggal).toLocaleDateString()))},FormPermintaan(){return{id_supplier:this.id_supplier,purchase_request_detail:this.selectedPurchaseRequest}},FormErrorPermintaan(){var t,s;return this.isClean?{}:((s=(t=Q.safeParse(this.FormPermintaan))==null?void 0:t.error)==null?void 0:s.format())||{}}},methods:{onCellEditComplete(t){let{data:s,newValue:y,field:k}=t;switch(k){case"qty":s[k]=y;break}},async getData(){await v.index().then(t=>{this.lItem=t.data.data}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})})},getDataPersetujuan(){v.getPersetujuan().then(t=>{this.lPersetujuan=t.data.data}).catch(t=>{this.$toast.add({severity:"error",summary:"Failed",detail:t.response.data.message,life:3e3})})},async Destroy(t){await v.destroy(t.id).then(s=>{this.$toast.add({severity:"success",summary:"Success",detail:s.data.message,life:3e3}),this.lItem=this.lItem.filter(y=>y.id!==t.id)}).catch(s=>{this.$toast.add({severity:"error",summary:"Failed",detail:s.response.data.message,life:3e3})}).finally(()=>{this.deleteDialog=!1,this.item=null})},showHideFilter(){this.filter=!this.filter},initFilters(){this.filters={global:{value:null,matchMode:H.CONTAINS}}},onRowDblclick(t){this.$router.push({name:"po.edit",params:{id:t.data.id}})},FormEdit(t){this.$router.push({name:"po.edit",params:{id:t.id}})},Cetak(t){this.$router.push({name:"po.cetak",params:{id:t.id}})},confirmDelete(t){this.deleteDialog=!0,this.item={...t}},async showPurchaseRequestDialog(){this.purchaseRequestDialog=!0,await G.indexDetail({type:"option",module:"po"}).then(t=>{this.lPurchaseRequest=t.data.data.map(s=>({...s,qty_pesanan:s.qty,qty:0}))})},async CreatePurchaseOrder(){this.purchaseRequestDialog=!0,this.$isLoading.value=!0,this.isClean=!1,!(this.id_supplier==null||this.selectedPurchaseRequest.length==0||this.selectedPurchaseRequest.some(t=>t.qty==0))&&await v.storeWithPurchaseRequest({id_supplier:this.id_supplier,purchase_request_detail:this.selectedPurchaseRequest}).then(t=>{setTimeout(()=>{this.$router.push({name:"po.edit",params:{id:t.data.data.id}}),this.$toast.add({severity:"success",summary:"Successful",detail:t.data.message,life:3e3})},1e3)}).finally(()=>{this.$timeoutLoading()})}}},Z={class:"grid crud-demo"},$={class:"col-12"},ee={class:"card"},te={class:"my-2"},le=i("h5",{class:"mbe-4"},"Pencarian Pesanan Pembelian",-1),se={class:"p-fluid formgrid grid"},ae={class:"field col-2"},ie={class:"field col-2"},oe={class:"field col-2"},ne={class:"field col-2 d-flex justifiy-content-center align-items-end mb-0"},re={class:"field col-auto",style:{display:"flex","align-items":"flex-end","align-content":"flex-end"}},ue={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},de=i("h5",{class:"m-0"},"Pesanan Pembelian",-1),ce={class:"flex gap-2 col-12 md:col-5"},pe={class:"block p-input-icon-left w-full"},me=i("i",{class:"pi pi-search"},null,-1),he={key:0},fe={key:1},_e={key:2},ge={key:3,class:"text-right"},be={key:4},ye={class:"flex align-items-center justify-content-center"},ve=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ke={key:0},Pe={class:"p-fluid formgrid grid"},De={class:"field col-12 md:col-6"},we={class:"flex align-options-center"},Ce={class:"col-12"},xe={class:"text-right"},Re={class:"text-green-700"},Se={class:"text-center"},qe={class:"text-center"},Ve={class:"text-center"},Te={class:"text-center"};function Ie(t,s,y,k,a,p){const I=r("Toast"),h=r("Button"),x=r("router-link"),L=r("MyExport"),F=r("Toolbar"),P=r("Label"),R=r("Calendar"),S=r("AutoCompleteKontak"),N=r("Dropdown"),j=r("InputText"),E=r("MultiSelect"),d=r("Column"),U=r("Tag"),A=r("ActionButton"),q=r("DataTable"),V=r("Dialog"),M=r("ErrorMsg"),B=r("InputNumber"),O=K("select-all-text");return m(),g("div",Z,[i("div",$,[i("div",ee,[l(I),l(F,{class:"mb-4"},{start:o(()=>[i("div",te,[l(x,{to:"/purchase/order/create",class:"btn btn-added me-2"},{default:o(()=>[l(h,{label:"Tambah",icon:"pi pi-plus",class:"p-button-primary mr-2"})]),_:1}),l(h,{icon:"pi pi-filter",class:D(["p-button mx-2",{"p-button-block":t.showTableSatuan,"p-button-outlined":!t.showTableSatuan}]),label:"Filter",onClick:p.showHideFilter},null,8,["onClick","class"]),a.lPersetujuan.length>0?(m(),w(x,{key:0,to:"/purchase/order/persetujuan",class:"btn btn-added me-2"},{default:o(()=>[l(h,{icon:"pi pi-shield",class:"p-button mx-2 p-button-outlined",label:"Persetujuan",badge:a.lPersetujuan.length,severity:"warning",badgeSeverity:"warning"},null,8,["badge"])]),_:1})):C("",!0)])]),end:o(()=>[l(h,{label:"Purchase Request",icon:"pi pi-plus",class:"p-button-primary mr-2",onClick:p.showPurchaseRequestDialog},null,8,["onClick"]),l(L,{value:p.filteredItems,selectedColumns:a.selectedColumns,title:"Export Pesanan Pembelian"},null,8,["value","selectedColumns"])]),_:1}),i("div",{class:D(["px-3 py-4 mb-4 fadein",{hidden:!a.filter}])},[le,i("div",se,[i("div",ae,[l(P,null,{default:o(()=>[f("Periode Awal")]),_:1}),l(R,{modelValue:a.f.awal,"onUpdate:modelValue":s[0]||(s[0]=e=>a.f.awal=e),inputId:"f.awal",showIcon:"",iconDisplay:"input","show-button-bar":""},null,8,["modelValue"])]),i("div",ie,[l(P,null,{default:o(()=>[f("Periode Akhir")]),_:1}),l(R,{modelValue:a.f.akhir,"onUpdate:modelValue":s[1]||(s[1]=e=>a.f.akhir=e),inputId:"f.akhir",showIcon:"",iconDisplay:"input","show-button-bar":""},null,8,["modelValue"])]),i("div",oe,[l(S,{modelValue:a.f.id_supplier,"onUpdate:modelValue":s[2]||(s[2]=e=>a.f.id_supplier=e),inputId:"f.kontak","is-supplier":"",label:"Supplier",required:!1},null,8,["modelValue"])]),i("div",ne,[l(P,{for:"status"},{default:o(()=>[f("Status")]),_:1}),l(N,{id:"status",modelValue:a.f.selectedStatus,"onUpdate:modelValue":s[3]||(s[3]=e=>a.f.selectedStatus=e),options:a.statuses,optionLabel:"label",placeholder:"Status"},null,8,["modelValue","options"])]),i("div",re,[l(h,{label:"Search"})])])],2),l(q,{ref:"dt",value:p.filteredItems,selection:a.selectedItem,"onUpdate:selection":s[6]||(s[6]=e=>a.selectedItem=e),dataKey:"id",paginator:!0,rows:10,onRowDblclick:p.onRowDblclick,filters:a.filters,selectionMode:"single",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Pesanan Pembelian",responsiveLayout:"scroll"},{header:o(()=>[i("div",ue,[de,i("div",ce,[i("span",pe,[me,l(j,{modelValue:a.filters.global.value,"onUpdate:modelValue":s[4]||(s[4]=e=>a.filters.global.value=e),placeholder:"Search...",class:"w-full"},null,8,["modelValue"])]),l(E,{modelValue:a.selectedColumns,"onUpdate:modelValue":s[5]||(s[5]=e=>a.selectedColumns=e),options:a.Columns,optionLabel:"header",placeholder:"Select Column",class:"w-3rem"},null,8,["modelValue","options"])])])]),default:o(()=>[l(d,{header:"#",headerStyle:"width:10px"},{body:o(e=>[f(u(e.index+1),1)]),_:1}),(m(!0),g(W,null,J(a.selectedColumns,(e,n)=>(m(),w(d,{field:e.field,header:e.header,class:D(e.class),key:e.field+"_"+n,sortable:!0},{body:o(({data:c,field:_})=>[_=="icon"?(m(),g("div",he,[l(h,{icon:c[_],class:"p-button-rounded p-button-outlined p-button-icon"},null,8,["icon"])])):_=="status"?(m(),g("div",fe,[l(U,{value:t.$h.getLabel(c[_]),severity:t.$h.getLabel(c[_])},null,8,["value","severity"])])):e.type=="date"?(m(),g("div",_e,u(t.$h.formatDate(c[_])),1)):_=="total"?(m(),g("div",ge,u(t.$h.formatNumber(c[_])),1)):(m(),g("div",be,u(c[_]),1))]),_:2},1032,["field","header","class"]))),128)),l(d,{header:"Aksi",headerStyle:"width:6%; max-width:1rem;"},{body:o(({data:e,index:n})=>[l(A,{data:e,index:n,onEdit:c=>p.FormEdit(e),onDelete:c=>p.confirmDelete(e),onPrint:p.Cetak,showDelete:e.status!="C",showPrint:e.status!="D"},null,8,["data","index","onEdit","onDelete","onPrint","showDelete","showPrint"])]),_:1})]),_:1},8,["value","selection","onRowDblclick","filters"]),l(V,{visible:a.deleteDialog,"onUpdate:visible":s[9]||(s[9]=e=>a.deleteDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:o(()=>[l(h,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[7]||(s[7]=e=>a.deleteDialog=!1)}),l(h,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:s[8]||(s[8]=e=>p.Destroy(a.item))})]),default:o(()=>[i("div",ye,[ve,a.item?(m(),g("span",ke,[f("Are you sure you want to delete "),i("b",null,u(a.item.nomor),1),f("?")])):C("",!0)])]),_:1},8,["visible"]),l(V,{visible:a.purchaseRequestDialog,"onUpdate:visible":s[14]||(s[14]=e=>a.purchaseRequestDialog=e),style:{width:"70%"},header:"Pilih Purchase Request",modal:!0,maximizable:!0},{footer:o(()=>[l(h,{label:"TUTUP",icon:"pi pi-times",class:"p-button-text",saverity:"danger",onClick:s[12]||(s[12]=e=>a.purchaseRequestDialog=!1)}),l(h,{label:"PILIH",icon:"pi pi-check",class:"p-button-outlined",onClick:s[13]||(s[13]=e=>p.CreatePurchaseOrder()),loading:t.$isLoading.value},null,8,["loading"])]),default:o(()=>[i("div",Pe,[i("div",De,[l(S,{modelValue:a.id_supplier,"onUpdate:modelValue":s[10]||(s[10]=e=>a.id_supplier=e),label:"Supplier",error:p.FormErrorPermintaan.id_supplier,"is-supplier":""},{option:o(e=>[i("div",we,[i("div",null,u(e.option.kontak),1)])]),_:1},8,["modelValue","error"])]),i("div",Ce,[l(q,{value:a.lPurchaseRequest,style:{"margin-top":"20px"},selection:a.selectedPurchaseRequest,"onUpdate:selection":s[11]||(s[11]=e=>a.selectedPurchaseRequest=e),paginator:!0,rows:10,filters:a.filters,responsiveLayout:"scroll",scrollable:"",editMode:"cell",onCellEditComplete:p.onCellEditComplete},{default:o(()=>[l(d,{selectionMode:"multiple",headerStyle:"width: 3rem",frozen:""}),l(d,{field:"tgl_dibutuhkan",header:"Dibutuhkan"},{body:o(({data:e,field:n})=>[f(u(t.$h.formatDate(e[n])),1)]),_:1}),l(d,{field:"diminta_oleh",header:"Diminta Oleh"},{body:o(({data:e,field:n})=>[f(u(e[n]),1)]),_:1}),l(d,{field:"nomor",header:"No. Permintaan"}),l(d,{field:"nama_barang",header:"Produk/Jasa"},{body:o(({data:e,field:n})=>[i("p",null,u(e[n]),1),i("small",null,u(e.keterangan),1)]),_:1}),l(d,{field:"harga",header:"Harga"},{body:o(({data:e,field:n})=>[i("div",xe,u(t.$h.formatNumber(e[n])),1)]),_:1}),l(d,{field:"diskonrp",header:"Diskon"},{body:o(({data:e,field:n})=>[i("p",Re,u(t.$h.formatNumber(e.diskonpersen))+" %",1),f(" "+u(t.$h.formatNumber(e[n])),1)]),_:1}),l(d,{field:"satuan",header:"Satuan"}),l(d,{field:"qty_pesanan",header:"Permintaan"},{body:o(({data:e,field:n})=>[i("div",Se,[i("p",null,u(t.$h.formatNumber(e[n])),1)])]),_:1}),l(d,{field:"total_order",header:"Telah Dipesan"},{body:o(({data:e,field:n})=>[i("div",qe,[i("p",null,u(t.$h.formatNumber(e[n])),1)])]),_:1}),l(d,{field:"diterima",header:"Telah Diterima"},{body:o(({data:e,field:n})=>[i("div",Ve,[i("p",null,u(t.$h.formatNumber(e[n])),1)])]),_:1}),l(d,{field:"qty",header:"Akan Dipesan",alignFrozen:"right",frozen:""},{body:o(({data:e,field:n})=>[i("div",Te,[i("p",null,u(t.$h.formatNumber(e[n])),1),a.selectedPurchaseRequest.some(c=>c.id==e.id&&c.urut==e.urut)&&e[n]==0?(m(),w(M,{key:0,class:"p-invalid text-red-500"},{default:o(()=>[f("Tidak Boleh 0")]),_:1})):C("",!0)])]),editor:o(({data:e,field:n})=>[Y(l(B,{modelValue:e[n],"onUpdate:modelValue":c=>e[n]=c,min:0,max:e.sisa,maxFractionDigits:5,minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue","max"]),[[O]])]),_:1})]),_:1},8,["value","selection","filters","onCellEditComplete"])])])]),_:1},8,["visible"])])])])}const Ue=z(X,[["render",Ie]]);export{Ue as default};
